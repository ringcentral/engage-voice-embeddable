!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AgentSDK=t():e.AgentSDK=t()}(self,(()=>(()=>{var e={21:function(e,t){var n;e.exports=(n=n||function(e){var t=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),n={},s=n.lib={},i=s.Base={extend:function(e){var n=t(this);return e&&n.mixIn(e),n.hasOwnProperty("init")&&this.init!==n.init||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=s.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,s=this.sigBytes,i=e.sigBytes;if(this.clamp(),s%4)for(var r=0;r<i;r++){var o=n[r>>>2]>>>24-r%4*8&255;t[s+r>>>2]|=o<<24-(s+r)%4*8}else for(r=0;r<i;r+=4)t[s+r>>>2]=n[r>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,s=[],i=function(t){var n=987654321,s=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&s)<<16)+(t=18e3*(65535&t)+(t>>16)&s)&s;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(n||e.random()));n=987654071*a(),s.push(4294967296*a()|0)}return new r.init(s,t)}}),o=n.enc={},a=o.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],i=0;i<n;i++){var r=t[i>>>2]>>>24-i%4*8&255;s.push((r>>>4).toString(16)),s.push((15&r).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s+=2)n[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new r.init(n,t/2)}},c=o.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],i=0;i<n;i++){var r=t[i>>>2]>>>24-i%4*8&255;s.push(String.fromCharCode(r))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s++)n[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new r.init(n,t)}},u=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=s.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,s=n.words,i=n.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var l=0;l<c;l+=o)this._doProcessBlock(s,l);var d=s.splice(0,c);n.sigBytes-=u}return new r.init(d,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=(s.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new d.HMAC.init(e,n).finalize(t)}}}),n.algo={});return n}(Math),n)},636:function(e,t,n){var s;e.exports=(s=n(21),function(e){var t=s,n=t.lib,i=n.WordArray,r=n.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=o.MD5=r.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var s=t+n,i=e[s];e[s]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var r=this._hash.words,o=e[t+0],c=e[t+1],p=e[t+2],h=e[t+3],f=e[t+4],S=e[t+5],T=e[t+6],m=e[t+7],_=e[t+8],I=e[t+9],C=e[t+10],v=e[t+11],y=e[t+12],E=e[t+13],R=e[t+14],A=e[t+15],b=r[0],N=r[1],O=r[2],D=r[3];b=u(b,N,O,D,o,7,a[0]),D=u(D,b,N,O,c,12,a[1]),O=u(O,D,b,N,p,17,a[2]),N=u(N,O,D,b,h,22,a[3]),b=u(b,N,O,D,f,7,a[4]),D=u(D,b,N,O,S,12,a[5]),O=u(O,D,b,N,T,17,a[6]),N=u(N,O,D,b,m,22,a[7]),b=u(b,N,O,D,_,7,a[8]),D=u(D,b,N,O,I,12,a[9]),O=u(O,D,b,N,C,17,a[10]),N=u(N,O,D,b,v,22,a[11]),b=u(b,N,O,D,y,7,a[12]),D=u(D,b,N,O,E,12,a[13]),O=u(O,D,b,N,R,17,a[14]),b=l(b,N=u(N,O,D,b,A,22,a[15]),O,D,c,5,a[16]),D=l(D,b,N,O,T,9,a[17]),O=l(O,D,b,N,v,14,a[18]),N=l(N,O,D,b,o,20,a[19]),b=l(b,N,O,D,S,5,a[20]),D=l(D,b,N,O,C,9,a[21]),O=l(O,D,b,N,A,14,a[22]),N=l(N,O,D,b,f,20,a[23]),b=l(b,N,O,D,I,5,a[24]),D=l(D,b,N,O,R,9,a[25]),O=l(O,D,b,N,h,14,a[26]),N=l(N,O,D,b,_,20,a[27]),b=l(b,N,O,D,E,5,a[28]),D=l(D,b,N,O,p,9,a[29]),O=l(O,D,b,N,m,14,a[30]),b=d(b,N=l(N,O,D,b,y,20,a[31]),O,D,S,4,a[32]),D=d(D,b,N,O,_,11,a[33]),O=d(O,D,b,N,v,16,a[34]),N=d(N,O,D,b,R,23,a[35]),b=d(b,N,O,D,c,4,a[36]),D=d(D,b,N,O,f,11,a[37]),O=d(O,D,b,N,m,16,a[38]),N=d(N,O,D,b,C,23,a[39]),b=d(b,N,O,D,E,4,a[40]),D=d(D,b,N,O,o,11,a[41]),O=d(O,D,b,N,h,16,a[42]),N=d(N,O,D,b,T,23,a[43]),b=d(b,N,O,D,I,4,a[44]),D=d(D,b,N,O,y,11,a[45]),O=d(O,D,b,N,A,16,a[46]),b=g(b,N=d(N,O,D,b,p,23,a[47]),O,D,o,6,a[48]),D=g(D,b,N,O,m,10,a[49]),O=g(O,D,b,N,R,15,a[50]),N=g(N,O,D,b,S,21,a[51]),b=g(b,N,O,D,y,6,a[52]),D=g(D,b,N,O,h,10,a[53]),O=g(O,D,b,N,C,15,a[54]),N=g(N,O,D,b,c,21,a[55]),b=g(b,N,O,D,_,6,a[56]),D=g(D,b,N,O,A,10,a[57]),O=g(O,D,b,N,T,15,a[58]),N=g(N,O,D,b,E,21,a[59]),b=g(b,N,O,D,f,6,a[60]),D=g(D,b,N,O,v,10,a[61]),O=g(O,D,b,N,p,15,a[62]),N=g(N,O,D,b,I,21,a[63]),r[0]=r[0]+b|0,r[1]=r[1]+N|0,r[2]=r[2]+O|0,r[3]=r[3]+D|0},_doFinalize:function(){var t=this._data,n=t.words,s=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var r=e.floor(s/4294967296),o=s;n[15+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return a},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,s,i,r,o){var a=e+(t&n|~t&s)+i+o;return(a<<r|a>>>32-r)+t}function l(e,t,n,s,i,r,o){var a=e+(t&s|n&~s)+i+o;return(a<<r|a>>>32-r)+t}function d(e,t,n,s,i,r,o){var a=e+(t^n^s)+i+o;return(a<<r|a>>>32-r)+t}function g(e,t,n,s,i,r,o){var a=e+(n^(t|~s))+i+o;return(a<<r|a>>>32-r)+t}t.MD5=r._createHelper(c),t.HmacMD5=r._createHmacHelper(c)}(Math),s.MD5)},7:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,s){function i(n){e.removeListener(t,r),s(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}f(e,t,r,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,i)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function u(e,t,n,s){var i,r,o,u;if(a(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),(i=c(e))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=o.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(s);return i.listener=n,s.wrapFn=i,i}function g(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):h(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function f(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(r){s.once&&e.removeEventListener(t,i),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return c(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)s(c,this,t);else{var u=c.length,l=h(c,u);for(n=0;n<u;++n)s(l[n],this,t)}return!0},r.prototype.addListener=function(e,t){return u(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return u(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,s,i,r,o;if(a(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,r=Object.keys(n);for(s=0;s<r.length;++s)"removeListener"!==(i=r[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},r.prototype.listeners=function(e){return g(this,e,!0)},r.prototype.rawListeners=function(e){return g(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},r.prototype.listenerCount=p,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},266:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(813),a=n(346),c=n(948),u=n(557),l=n(41),d=function(e){function t(n,s,i,r){var o=e.call(this)||this;return o.data={},t.initializer(o,n,s,i,r),o}return i(t,e),t.initializer=function(e,t,n,s,i){if(e.type=a.TypeStrings.ClientContext,void 0===s)throw new TypeError("Not enough arguments");e.ua=t,e.logger=t.getLogger("sip.clientcontext"),e.method=n;var r=t.normalizeTarget(s);if(!r)throw new TypeError("Invalid target: "+s);(i=Object.create(i||Object.prototype)).extraHeaders=(i.extraHeaders||[]).slice(),e.request=new u.OutgoingRequest(e.method,r,e.ua,i.params,i.extraHeaders),i.body&&(e.body={},e.body.body=i.body,i.contentType&&(e.body.contentType=i.contentType),e.request.body=e.body),e.request.from&&(e.localIdentity=e.request.from),e.request.to&&(e.remoteIdentity=e.request.to)},t.prototype.send=function(){return new c.RequestSender(this,this.ua).send(),this},t.prototype.receiveResponse=function(e){var t=e.statusCode||0,n=l.Utils.getReasonPhrase(t);switch(!0){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,n);break;case/^2[0-9]{2}$/.test(t.toString()):this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("accepted",e,n);break;default:this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("rejected",e,n),this.emit("failed",e,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,o.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,o.C.causes.CONNECTION_ERROR)},t}(r.EventEmitter);t.ClientContext=d},813:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i,r,o,a=n(775);(s=t.C||(t.C={})).USER_AGENT=a.title+"/"+a.version,s.SIP="sip",s.SIPS="sips",(o=s.causes||(s.causes={})).CONNECTION_ERROR="Connection Error",o.INTERNAL_ERROR="Internal Error",o.REQUEST_TIMEOUT="Request Timeout",o.SIP_FAILURE_CODE="SIP Failure Code",o.ADDRESS_INCOMPLETE="Address Incomplete",o.AUTHENTICATION_ERROR="Authentication Error",o.BUSY="Busy",o.DIALOG_ERROR="Dialog Error",o.INCOMPATIBLE_SDP="Incompatible SDP",o.NOT_FOUND="Not Found",o.REDIRECTED="Redirected",o.REJECTED="Rejected",o.UNAVAILABLE="Unavailable",o.BAD_MEDIA_DESCRIPTION="Bad Media Description",o.CANCELED="Canceled",o.EXPIRES="Expires",o.NO_ACK="No ACK",o.NO_ANSWER="No Answer",o.NO_PRACK="No PRACK",o.RTP_TIMEOUT="RTP Timeout",o.USER_DENIED_MEDIA_ACCESS="User Denied Media Access",o.WEBRTC_ERROR="WebRTC Error",o.WEBRTC_NOT_SUPPORTED="WebRTC Not Supported",(r=s.supported||(s.supported={})).REQUIRED="required",r.SUPPORTED="supported",r.UNSUPPORTED="none",s.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]},s.ACK="ACK",s.BYE="BYE",s.CANCEL="CANCEL",s.INFO="INFO",s.INVITE="INVITE",s.MESSAGE="MESSAGE",s.NOTIFY="NOTIFY",s.OPTIONS="OPTIONS",s.REGISTER="REGISTER",s.UPDATE="UPDATE",s.SUBSCRIBE="SUBSCRIBE",s.PUBLISH="PUBLISH",s.REFER="REFER",s.PRACK="PRACK",s.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},s.OPTION_TAGS={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},(i=s.dtmfType||(s.dtmfType={})).INFO="info",i.RTP="rtp"},321:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(813),i=n(346),r=n(948),o=n(557),a=function(){function e(e,t,n,s){if(this.pracked=[],this.uacPendingReply=!1,this.uasPendingReply=!1,this.type=i.TypeStrings.Dialog,!t.hasHeader("contact"))throw new Error("unable to create a Dialog without Contact header field");if(t.type===i.TypeStrings.IncomingResponse){var r=t.statusCode;s=r&&r<200?i.DialogStatus.STATUS_EARLY:i.DialogStatus.STATUS_CONFIRMED}else s=s||i.DialogStatus.STATUS_CONFIRMED;var o=t.parseHeader("contact");"UAS"===n&&t.type===i.TypeStrings.IncomingRequest?(this.id={callId:t.callId,localTag:t.toTag,remoteTag:t.fromTag,toString:function(){return t.callId+t.toTag+t.fromTag}},this.state=s,this.remoteSeqnum=t.cseq,this.localUri=(t.parseHeader("to")||{}).uri,this.remoteUri=(t.parseHeader("from")||{}).uri,this.remoteTarget=o.uri,this.routeSet=t.getHeaders("record-route"),this.inviteSeqnum=t.cseq,this.localSeqnum=t.cseq):(this.id={callId:t.callId,localTag:t.fromTag,remoteTag:t.toTag,toString:function(){return t.callId+t.fromTag+t.toTag}},this.state=s,this.inviteSeqnum=t.cseq,this.localSeqnum=t.cseq,this.localUri=t.parseHeader("from").uri,this.pracked=[],this.remoteUri=t.parseHeader("to").uri,this.remoteTarget=o.uri,this.routeSet=t.getHeaders("record-route").reverse()),this.logger=e.ua.getLogger("sip.dialog",this.id.toString()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+n+" dialog created with status "+(this.state===i.DialogStatus.STATUS_EARLY?"EARLY":"CONFIRMED")),e.emit("dialog",this)}return e.prototype.update=function(e,t){this.state=i.DialogStatus.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.routeSet=e.getHeaders("record-route").reverse())},e.prototype.terminate=function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==i.DialogStatus.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},e.prototype.createRequest=function(e,t,n){void 0===t&&(t=[]),t=t.slice(),this.localSeqnum||(this.localSeqnum=Math.floor(1e4*Math.random()));var i=e===s.C.CANCEL||e===s.C.ACK?this.inviteSeqnum:this.localSeqnum+=1,r=new o.OutgoingRequest(e,this.remoteTarget,this.owner.ua,{cseq:i,callId:this.id.callId,fromUri:this.localUri,fromTag:this.id.localTag,toIri:this.remoteUri,toTag:this.id.remoteTag,routeSet:this.routeSet},t,n);return r.dialog=this,r},e.prototype.checkInDialogRequest=function(e){var t=this;if(this.remoteSeqnum){if(e.cseq<this.remoteSeqnum)return e.method!==s.C.ACK&&e.reply(500),e.cseq===this.inviteSeqnum}else this.remoteSeqnum=e.cseq;switch(e.method){case s.C.INVITE:if(!0===this.uacPendingReply)e.reply(491);else{if(!0===this.uasPendingReply&&e.cseq>this.remoteSeqnum){var n=Math.floor(10*Math.random())+1;return e.reply(500,void 0,["Retry-After:"+n]),this.remoteSeqnum=e.cseq,!1}this.uasPendingReply=!0;var r=function(){!e.serverTransaction||e.serverTransaction.state!==i.TransactionStatus.STATUS_ACCEPTED&&e.serverTransaction.state!==i.TransactionStatus.STATUS_COMPLETED&&e.serverTransaction.state!==i.TransactionStatus.STATUS_TERMINATED||(e.serverTransaction.removeListener("stateChanged",r),t.uasPendingReply=!1)};e.serverTransaction&&e.serverTransaction.on("stateChanged",r)}e.hasHeader("contact")&&e.serverTransaction&&e.serverTransaction.on("stateChanged",(function(){e.serverTransaction&&e.serverTransaction.state===i.TransactionStatus.STATUS_ACCEPTED&&(t.remoteTarget=e.parseHeader("contact").uri)}));break;case s.C.NOTIFY:e.hasHeader("contact")&&e.serverTransaction&&e.serverTransaction.on("stateChanged",(function(){e.serverTransaction&&e.serverTransaction.state===i.TransactionStatus.STATUS_COMPLETED&&(t.remoteTarget=e.parseHeader("contact").uri)}))}return e.cseq>this.remoteSeqnum&&(this.remoteSeqnum=e.cseq),!0},e.prototype.sendRequest=function(e,t,n){var o=this;void 0===n&&(n={});var a,c=(n.extraHeaders||[]).slice();n.body&&(n.body.body?a=n.body:((a={}).body=n.body,n.contentType&&(a.contentType=n.contentType)));var u=this.createRequest(t,c,a),l=function(t){var n=new r.RequestSender({request:u,onRequestTimeout:e.onRequestTimeout.bind(e),onTransportError:e.onTransportError.bind(e),receiveResponse:function(n){408===n.statusCode||481===n.statusCode?e.onDialogError(n):n.method===s.C.INVITE&&491===n.statusCode?t?e.receiveResponse(n):(u.cseq=o.localSeqnum+=1,setTimeout((function(){void 0!==o.owner.status&&o.owner.status!==i.SessionStatus.STATUS_TERMINATED&&l(!0)}),1e3)):e.receiveResponse(n)}},o.owner.ua);if(n.send(),n.clientTransaction&&n.clientTransaction.type!==i.TypeStrings.AckClientTransaction&&u.method===s.C.INVITE&&n.clientTransaction&&n.clientTransaction.state!==i.TransactionStatus.STATUS_TERMINATED){o.uacPendingReply=!0;var a=function(){var e=n.clientTransaction.state;n.clientTransaction&&n.clientTransaction.type!==i.TypeStrings.AckClientTransaction&&(!n.clientTransaction||e!==i.TransactionStatus.STATUS_ACCEPTED&&e!==i.TransactionStatus.STATUS_COMPLETED&&e!==i.TransactionStatus.STATUS_TERMINATED||(n.clientTransaction.removeListener("stateChanged",a),o.uacPendingReply=!1))};n.clientTransaction.on("stateChanged",a)}};return l(!1),u},e.prototype.receiveRequest=function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)},e.C=i.DialogStatus,e}();t.Dialog=a},458:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(636),i=n(346),r=n(41),o=function(){function e(e){this.type=i.TypeStrings.DigestAuthentication,this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.nc=0,this.ncHex="00000000"}return e.prototype.authenticate=function(e,t,n){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=r.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(n),!0},e.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},e.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.prototype.calculateResponse=function(e){var t,n=s(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(t=s(this.method+":"+this.uri),this.response=s(n+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=s(this.method+":"+this.uri+":"+s(e||"")),this.response=s(n+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):void 0===this.qop&&(t=s(this.method+":"+this.uri),this.response=s(n+":"+this.nonce+":"+t))},e}();t.DigestAuthentication=o},346:(e,t)=>{"use strict";var n,s,i,r,o;Object.defineProperty(t,"__esModule",{value:!0}),(o=t.DialogStatus||(t.DialogStatus={}))[o.STATUS_EARLY=1]="STATUS_EARLY",o[o.STATUS_CONFIRMED=2]="STATUS_CONFIRMED",(r=t.SessionStatus||(t.SessionStatus={}))[r.STATUS_NULL=0]="STATUS_NULL",r[r.STATUS_INVITE_SENT=1]="STATUS_INVITE_SENT",r[r.STATUS_1XX_RECEIVED=2]="STATUS_1XX_RECEIVED",r[r.STATUS_INVITE_RECEIVED=3]="STATUS_INVITE_RECEIVED",r[r.STATUS_WAITING_FOR_ANSWER=4]="STATUS_WAITING_FOR_ANSWER",r[r.STATUS_ANSWERED=5]="STATUS_ANSWERED",r[r.STATUS_WAITING_FOR_PRACK=6]="STATUS_WAITING_FOR_PRACK",r[r.STATUS_WAITING_FOR_ACK=7]="STATUS_WAITING_FOR_ACK",r[r.STATUS_CANCELED=8]="STATUS_CANCELED",r[r.STATUS_TERMINATED=9]="STATUS_TERMINATED",r[r.STATUS_ANSWERED_WAITING_FOR_PRACK=10]="STATUS_ANSWERED_WAITING_FOR_PRACK",r[r.STATUS_EARLY_MEDIA=11]="STATUS_EARLY_MEDIA",r[r.STATUS_CONFIRMED=12]="STATUS_CONFIRMED",(i=t.TransactionStatus||(t.TransactionStatus={}))[i.STATUS_TRYING=1]="STATUS_TRYING",i[i.STATUS_PROCEEDING=2]="STATUS_PROCEEDING",i[i.STATUS_CALLING=3]="STATUS_CALLING",i[i.STATUS_ACCEPTED=4]="STATUS_ACCEPTED",i[i.STATUS_COMPLETED=5]="STATUS_COMPLETED",i[i.STATUS_TERMINATED=6]="STATUS_TERMINATED",i[i.STATUS_CONFIRMED=7]="STATUS_CONFIRMED",(s=t.TypeStrings||(t.TypeStrings={}))[s.AckClientTransaction=0]="AckClientTransaction",s[s.ClientContext=1]="ClientContext",s[s.ConfigurationError=2]="ConfigurationError",s[s.Dialog=3]="Dialog",s[s.DigestAuthentication=4]="DigestAuthentication",s[s.DTMF=5]="DTMF",s[s.IncomingMessage=6]="IncomingMessage",s[s.IncomingRequest=7]="IncomingRequest",s[s.IncomingResponse=8]="IncomingResponse",s[s.InvalidStateError=9]="InvalidStateError",s[s.InviteClientContext=10]="InviteClientContext",s[s.InviteClientTransaction=11]="InviteClientTransaction",s[s.InviteServerContext=12]="InviteServerContext",s[s.InviteServerTransaction=13]="InviteServerTransaction",s[s.Logger=14]="Logger",s[s.LoggerFactory=15]="LoggerFactory",s[s.MethodParameterError=16]="MethodParameterError",s[s.NameAddrHeader=17]="NameAddrHeader",s[s.NonInviteClientTransaction=18]="NonInviteClientTransaction",s[s.NonInviteServerTransaction=19]="NonInviteServerTransaction",s[s.NotSupportedError=20]="NotSupportedError",s[s.OutgoingRequest=21]="OutgoingRequest",s[s.Parameters=22]="Parameters",s[s.PublishContext=23]="PublishContext",s[s.ReferClientContext=24]="ReferClientContext",s[s.ReferServerContext=25]="ReferServerContext",s[s.RegisterContext=26]="RegisterContext",s[s.RenegotiationError=27]="RenegotiationError",s[s.RequestSender=28]="RequestSender",s[s.ServerContext=29]="ServerContext",s[s.Session=30]="Session",s[s.SessionDescriptionHandler=31]="SessionDescriptionHandler",s[s.SessionDescriptionHandlerError=32]="SessionDescriptionHandlerError",s[s.SessionDescriptionHandlerObserver=33]="SessionDescriptionHandlerObserver",s[s.Subscription=34]="Subscription",s[s.Transport=35]="Transport",s[s.TransportError=36]="TransportError",s[s.UA=37]="UA",s[s.URI=38]="URI",(n=t.UAStatus||(t.UAStatus={}))[n.STATUS_INIT=0]="STATUS_INIT",n[n.STATUS_STARTING=1]="STATUS_STARTING",n[n.STATUS_READY=2]="STATUS_READY",n[n.STATUS_USER_CLOSED=3]="STATUS_USER_CLOSED",n[n.STATUS_NOT_READY=4]="STATUS_NOT_READY"},852:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(346),o=function(e){function t(t,n,s){var i=e.call(this,s)||this;return i.code=t,i.name=n,i.message=s,i}return i(t,e),t}(Error);!function(e){var t=function(e){function t(t,n){var s=e.call(this,1,"CONFIGURATION_ERROR",n?"Invalid value "+JSON.stringify(n)+" for parameter '"+t+"'":"Missing parameter: "+t)||this;return s.type=r.TypeStrings.ConfigurationError,s.parameter=t,s.value=n,s}return i(t,e),t}(o);e.ConfigurationError=t;var n=function(e){function t(t){var n=e.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+t)||this;return n.type=r.TypeStrings.InvalidStateError,n.status=t,n}return i(t,e),t}(o);e.InvalidStateError=n;var s=function(e){function t(t){var n=e.call(this,3,"NOT_SUPPORTED_ERROR",t)||this;return n.type=r.TypeStrings.NotSupportedError,n}return i(t,e),t}(o);e.NotSupportedError=s;var a=function(e){function t(t){var n=e.call(this,5,"RENEGOTIATION_ERROR",t)||this;return n.type=r.TypeStrings.RenegotiationError,n}return i(t,e),t}(o);e.RenegotiationError=a;var c=function(e){function t(t,n,s){var i=e.call(this,6,"METHOD_PARAMETER_ERROR",s?"Invalid value "+JSON.stringify(s)+" for parameter '"+n+"'":"Missing parameter: "+n)||this;return i.type=r.TypeStrings.MethodParameterError,i.method=t,i.parameter=n,i.value=s,i}return i(t,e),t}(o);e.MethodParameterError=c;var u=function(e){function t(t){var n=e.call(this,7,"TRANSPORT_ERROR",t)||this;return n.type=r.TypeStrings.TransportError,n}return i(t,e),t}(o);e.TransportError=u;var l=function(e){function t(t,n,s){var i=e.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",s||"Error with Session Description Handler")||this;return i.type=r.TypeStrings.SessionDescriptionHandlerError,i.method=t,i.error=n,i}return i(t,e),t}(o);e.SessionDescriptionHandlerError=l}(t.Exceptions||(t.Exceptions={}))},585:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=n(902);(s=t.Grammar||(t.Grammar={})).parse=function(e,t){var n={startRule:t};try{i.parse(e,n)}catch(e){n.data=-1}return n.data},s.nameAddrHeaderParse=function(e){var t=s.parse(e,"Name_Addr_Header");return-1!==t?t:void 0},s.URIParse=function(e){var t=s.parse(e,"SIP_URI");return-1!==t?t:void 0}},902:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(47),o=n(750),a=function(e){function t(n,s,i,r){var o=e.call(this)||this;return o.message=n,o.expected=s,o.found=i,o.location=r,o.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(o,t),o}return i(t,e),t.buildMessage=function(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function r(e){switch(e.type){case"literal":return'"'+s(e.text)+'"';case"class":var t=e.parts.map((function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)}));return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){var t,n,s=e.map(r);if(s.sort(),s.length>0){for(t=1,n=1;t<s.length;t++)s[t-1]!==s[t]&&(s[n]=s[t],n++);s.length=n}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(e)+" but "+((o=t)?'"'+s(o)+'"':"end of input")+" found.";var o},t}(Error);t.SyntaxError=a,t.parse=function(e,t){t=void 0!==t?t:{};var n,s,i,c,u={},l={Contact:Ba,Name_Addr_Header:function(){var e,t,n,s,i,r,o;for(e=Io,t=[],n=Wa();n!==u;)t.push(n),n=Wa();if(t!==u)if((n=sa())!==u)if(pa()!==u)if(na()!==u){for(s=[],i=Io,(r=ra())!==u&&(o=Qa())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,(r=ra())!==u&&(o=Qa())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?(Co=e,e=t=Ws()):(Io=e,e=u)}else Io=e,e=u;else Io=e,e=u;else Io=e,e=u;else Io=e,e=u;return e},Record_Route:function(){var e,t,n,s,i;if(e=Io,oc()!==u){for(t=[],n=Io,(s=ia())!==u&&(i=oc())!==u?n=s=[s,i]:(Io=n,n=u);n!==u;)t.push(n),n=Io,(s=ia())!==u&&(i=oc())!==u?n=s=[s,i]:(Io=n,n=u);t!==u?(Co=e,e=Ni()):(Io=e,e=u)}else Io=e,e=u;return e},Request_Response:xa,SIP_URI:pa,Subscription_State:function(){var t,n,s,i,r,o;if(t=Io,(n=function(){var t,n;return t=Io,e.substr(Io,6).toLowerCase()===Ji?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(Wi)),n===u&&(e.substr(Io,7).toLowerCase()===Vi?(n=e.substr(Io,7),Io+=7):(n=u,0===Ro&&xo(Yi)),n===u&&(e.substr(Io,10).toLowerCase()===Qi?(n=e.substr(Io,10),Io+=10):(n=u,0===Ro&&xo(Xi)),n===u&&(n=zo()))),n!==u&&(Co=t,n=zi()),n}())!==u){for(s=[],i=Io,(r=ra())!==u&&(o=cc())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,(r=ra())!==u&&(o=cc())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t},Supported:function(){var e,t,n,s,i,r;if(e=Io,t=Io,(n=zo())!==u){for(s=[],i=Io,ia()!==u&&(r=zo())!==u?(Co=i,i=ji(n,r)):(Io=i,i=u);i!==u;)s.push(i),i=Io,ia()!==u&&(r=zo())!==u?(Co=i,i=ji(n,r)):(Io=i,i=u);s!==u?(Co=t,t=n=Bi(n,s)):(Io=t,t=u)}else Io=t,t=u;return t===u&&(t=null),t!==u&&(Co=e,t=_r(t)),t},Require:function(){var e,t,n,s,i,r;if(e=Io,t=Io,(n=zo())!==u){for(s=[],i=Io,ia()!==u&&(r=zo())!==u?(Co=i,i=ji(n,r)):(Io=i,i=u);i!==u;)s.push(i),i=Io,ia()!==u&&(r=zo())!==u?(Co=i,i=ji(n,r)):(Io=i,i=u);s!==u?(Co=t,t=n=Bi(n,s)):(Io=t,t=u)}else Io=t,t=u;return t===u&&(t=null),t!==u&&(Co=e,t=Ki(t)),t},Via:function(){var e,t,n,s,i,r;if(e=Io,(t=lc())!==u){for(n=[],s=Io,(i=ia())!==u&&(r=lc())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ia())!==u&&(r=lc())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?e=t=[t,n]:(Io=e,e=u)}else Io=e,e=u;return e},absoluteURI:Ua,Call_ID:ja,Content_Disposition:function(){var t,n,s,i,r,o;if(t=Io,(n=function(){var t,n;return t=Io,e.substr(Io,6).toLowerCase()===os?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(as)),n===u&&(e.substr(Io,7).toLowerCase()===cs?(n=e.substr(Io,7),Io+=7):(n=u,0===Ro&&xo(us)),n===u&&(e.substr(Io,4).toLowerCase()===ls?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(ds)),n===u&&(e.substr(Io,5).toLowerCase()===gs?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(ps)),n===u&&(n=zo())))),n!==u&&(Co=t,n=hs()),n}())!==u){for(s=[],i=Io,(r=ra())!==u&&(o=Xa())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,(r=ra())!==u&&(o=Xa())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t},Content_Length:function(){var e,t,n;if(e=Io,t=[],(n=qo())!==u)for(;n!==u;)t.push(n),n=qo();else t=u;return t!==u&&(Co=e,t=Cs(t)),t},Content_Type:function(){var t,n;return t=Io,(n=function(){var t,n,s,i,r,o,a,c;if(t=Io,n=function(){var t;return(t=function(){var t;return e.substr(Io,4).toLowerCase()===ys?(t=e.substr(Io,4),Io+=4):(t=u,0===Ro&&xo(Es)),t===u&&(e.substr(Io,5).toLowerCase()===Rs?(t=e.substr(Io,5),Io+=5):(t=u,0===Ro&&xo(As)),t===u&&(e.substr(Io,5).toLowerCase()===bs?(t=e.substr(Io,5),Io+=5):(t=u,0===Ro&&xo(Ns)),t===u&&(e.substr(Io,5).toLowerCase()===Os?(t=e.substr(Io,5),Io+=5):(t=u,0===Ro&&xo(Ds)),t===u&&(e.substr(Io,11).toLowerCase()===ws?(t=e.substr(Io,11),Io+=11):(t=u,0===Ro&&xo(xs)),t===u&&(t=za()))))),t}())===u&&(t=function(){var t;return e.substr(Io,7).toLowerCase()===Us?(t=e.substr(Io,7),Io+=7):(t=u,0===Ro&&xo(qs)),t===u&&(e.substr(Io,9).toLowerCase()===ks?(t=e.substr(Io,9),Io+=9):(t=u,0===Ro&&xo(Ps)),t===u&&(t=za())),t}()),t}(),n!==u)if((s=ea())!==u)if(i=function(){var e;return(e=za())===u&&(e=zo()),e}(),i!==u){for(r=[],o=Io,(a=ra())!==u&&(c=$a())!==u?o=a=[a,c]:(Io=o,o=u);o!==u;)r.push(o),o=Io,(a=ra())!==u&&(c=$a())!==u?o=a=[a,c]:(Io=o,o=u);r!==u?t=n=[n,s,i,r]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t}())!==u&&(Co=t,n=vs()),n},CSeq:function(){var e,t,n,s;return e=Io,(t=function(){var e,t,n;if(e=Io,t=[],(n=qo())!==u)for(;n!==u;)t.push(n),n=qo();else t=u;return t!==u&&(Co=e,t=Hs(t)),t}())!==u&&(n=Vo())!==u&&(s=Ga())!==u?e=t=[t,n,s]:(Io=e,e=u),e},displayName:Wa,Event:function(){var t,n,s,i,r,o;if(t=Io,(n=function(){var t,n,s,i,r,o,a;if(t=Io,n=Io,(s=$o())!==u){for(i=[],r=Io,46===e.charCodeAt(Io)?(o=ee,Io++):(o=u,0===Ro&&xo(te)),o!==u&&(a=$o())!==u?r=o=[o,a]:(Io=r,r=u);r!==u;)i.push(r),r=Io,46===e.charCodeAt(Io)?(o=ee,Io++):(o=u,0===Ro&&xo(te)),o!==u&&(a=$o())!==u?r=o=[o,a]:(Io=r,r=u);i!==u?n=s=[s,i]:(Io=n,n=u)}else Io=n,n=u;return n!==u?e.substring(t,Io):n}())!==u){for(s=[],i=Io,(r=ra())!==u&&(o=Qa())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,(r=ra())!==u&&(o=Qa())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?(Co=t,t=n=Fs(n)):(Io=t,t=u)}else Io=t,t=u;return t},From:function(){var e,t,n,s,i,r;if(e=Io,(t=ga())===u&&(t=Ja()),t!==u){for(n=[],s=Io,(i=ra())!==u&&(r=Za())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=Za())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Gs()):(Io=e,e=u)}else Io=e,e=u;return e},host:ma,Max_Forwards:function(){var e,t,n;if(e=Io,t=[],(n=qo())!==u)for(;n!==u;)t.push(n),n=qo();else t=u;return t!==u&&(Co=e,t=Js(t)),t},Min_SE:function(){var e,t,n,s,i,r;if(e=Io,(t=Ya())!==u){for(n=[],s=Io,(i=ra())!==u&&(r=Qa())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=Qa())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Zr(t)):(Io=e,e=u)}else Io=e,e=u;return e},Proxy_Authenticate:function(){return tc()},quoted_string:ca,Refer_To:function(){var e,t,n,s,i,r;if(e=Io,(t=ga())===u&&(t=Ja())===u&&(t=Io,(n=sa())===u&&(n=null),n!==u&&(s=Ua())!==u?((i=na())===u&&(i=null),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u)),t!==u){for(n=[],s=Io,(i=ra())!==u&&(r=Qa())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=Qa())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Di()):(Io=e,e=u)}else Io=e,e=u;return e},Replaces:function(){var e,t,n,s,i;if(e=Io,function(){var e,t;return e=Io,(t=ja())!==u&&(Co=e,t=xi()),t}()!==u){for(t=[],n=Io,(s=ra())!==u&&(i=ac())!==u?n=s=[s,i]:(Io=n,n=u);n!==u;)t.push(n),n=Io,(s=ra())!==u&&(i=ac())!==u?n=s=[s,i]:(Io=n,n=u);t!==u?(Co=e,e=wi()):(Io=e,e=u)}else Io=e,e=u;return e},Session_Expires:function(){var e,t,n,s,i,r;if(e=Io,(t=Ya())!==u){for(n=[],s=Io,(i=ra())!==u&&(r=hc())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=hc())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Jr(t)):(Io=e,e=u)}else Io=e,e=u;return e},stun_URI:function(){var t,n,s,i;return t=Io,(n=function(){var t,n;return t=Io,e.substr(Io,5).toLowerCase()===eo?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(to)),n===u&&(e.substr(Io,4).toLowerCase()===no?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(so))),n!==u&&(Co=t,n=io(n)),n}())!==u?(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s!==u&&(i=fc())!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t},To:function(){var e,t,n,s,i,r;if(e=Io,(t=ga())===u&&(t=Ja()),t!==u){for(n=[],s=Io,(i=ra())!==u&&(r=uc())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=uc())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Ir()):(Io=e,e=u)}else Io=e,e=u;return e},turn_URI:function(){var t,n,s,i,r,o,a;return t=Io,(n=function(){var t,n;return t=Io,e.substr(Io,5).toLowerCase()===co?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(uo)),n===u&&(e.substr(Io,4).toLowerCase()===lo?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(go))),n!==u&&(Co=t,n=io(n)),n}())!==u?(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s!==u&&(i=fc())!==u?(r=Io,e.substr(Io,11)===oo?(o=oo,Io+=11):(o=u,0===Ro&&xo(ao)),o!==u&&(a=gc())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?t=n=[n,s,i,r]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t},uuid:function(){var t,n,s,i,r,o;return t=Io,function(){var e,t,n;return e=Io,(t=Sc())!==u&&(n=Sc())!==u?e=t=[t,n]:(Io=e,e=u),e}()!==u?(45===e.charCodeAt(Io)?(n=X,Io++):(n=u,0===Ro&&xo(z)),n!==u&&Sc()!==u?(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s!==u&&Sc()!==u?(45===e.charCodeAt(Io)?(i=X,Io++):(i=u,0===Ro&&xo(z)),i!==u&&Sc()!==u?(45===e.charCodeAt(Io)?(r=X,Io++):(r=u,0===Ro&&xo(z)),r!==u?(o=function(){var e,t,n,s;return e=Io,(t=Sc())!==u&&(n=Sc())!==u&&(s=Sc())!==u?e=t=[t,n,s]:(Io=e,e=u),e}(),o!==u?(Co=t,t=po()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t},WWW_Authenticate:function(){return tc()},challenge:tc,sipfrag:function(){var e,t,n,s,i,r;if(e=Io,(t=xa())!==u){for(n=[],s=Da();s!==u;)n.push(s),s=Da();n!==u?(s=Io,(i=Uo())!==u?(r=function(){var e,t;for(e=[],t=Mo();t!==u;)e.push(t),t=Mo();return e}(),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?e=t=[t,n,s]:(Io=e,e=u)):(Io=e,e=u)}else Io=e,e=u;return e},Referred_By:function(){var t,n,s,i,r,o,a,c;if(t=Io,e.substr(Io,11)===ho?(n=ho,Io+=11):(n=u,0===Ro&&xo(fo)),n===u&&(98===e.charCodeAt(Io)?(n=So,Io++):(n=u,0===Ro&&xo(To))),n!==u)if((s=function(){var t,n,s;for(t=Io,n=[],(s=Fo())===u&&(s=Go());s!==u;)n.push(s),(s=Fo())===u&&(s=Go());return n!==u?(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s!==u&&Yo()!==u?(Co=t,t=n=Te()):(Io=t,t=u)):(Io=t,t=u),t}())!==u)if(i=function(){var e;return(e=Ja())===u&&(e=ga()),e}(),i!==u){for(r=[],o=Io,(a=ra())!==u?((c=Tc())===u&&(c=Qa()),c!==u?o=a=[a,c]:(Io=o,o=u)):(Io=o,o=u);o!==u;)r.push(o),o=Io,(a=ra())!==u?((c=Tc())===u&&(c=Qa()),c!==u?o=a=[a,c]:(Io=o,o=u)):(Io=o,o=u);r!==u?t=n=[n,s,i,r]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t}},d=Ba,g="\r\n",p=No("\r\n",!1),h=/^[0-9]/,f=Oo([["0","9"]],!1,!1),S=/^[a-zA-Z]/,T=Oo([["a","z"],["A","Z"]],!1,!1),m=/^[0-9a-fA-F]/,_=Oo([["0","9"],["a","f"],["A","F"]],!1,!1),I=/^[\0-\xFF]/,C=Oo([["\0","ÿ"]],!1,!1),v=/^["]/,y=Oo(['"'],!1,!1),E=" ",R=No(" ",!1),A="\t",b=No("\t",!1),N=/^[a-zA-Z0-9]/,O=Oo([["a","z"],["A","Z"],["0","9"]],!1,!1),D=";",w=No(";",!1),x="/",U=No("/",!1),q="?",k=No("?",!1),P=":",L=No(":",!1),M="@",H=No("@",!1),F="&",G=No("&",!1),j="=",B=No("=",!1),K="+",J=No("+",!1),W="$",V=No("$",!1),Y=",",Q=No(",",!1),X="-",z=No("-",!1),$="_",Z=No("_",!1),ee=".",te=No(".",!1),ne="!",se=No("!",!1),ie="~",re=No("~",!1),oe="*",ae=No("*",!1),ce="'",ue=No("'",!1),le="(",de=No("(",!1),ge=")",pe=No(")",!1),he="%",fe=No("%",!1),Se=function(){return" "},Te=function(){return":"},me=(Oo([["!","~"]],!1,!1),/^[\x80-\uFFFF]/),_e=Oo([["","￿"]],!1,!1),Ie=/^[\x80-\xBF]/,Ce=Oo([["","¿"]],!1,!1),ve=(Oo([["a","f"]],!1,!1),"`"),ye=No("`",!1),Ee="<",Re=No("<",!1),Ae=">",be=No(">",!1),Ne="\\",Oe=No("\\",!1),De="[",we=No("[",!1),xe="]",Ue=No("]",!1),qe="{",ke=No("{",!1),Pe="}",Le=No("}",!1),Me=function(){return"*"},He=function(){return"/"},Fe=function(){return"="},Ge=function(){return">"},je=function(){return"<"},Be=function(){return","},Ke=function(){return";"},Je=function(){return":"},We=function(){return'"'},Ve=(Oo([["!","'"]],!1,!1),Oo([["*","["]],!1,!1),/^[\]-~]/),Ye=Oo([["]","~"]],!1,!1),Qe=function(e){return e},Xe=/^[#-[]/,ze=Oo([["#","["]],!1,!1),$e=/^[\0-\t]/,Ze=Oo([["\0","\t"]],!1,!1),et=/^[\x0B-\f]/,tt=Oo([["\v","\f"]],!1,!1),nt=/^[\x0E-\x7F]/,st=Oo([["",""]],!1,!1),it=function(){(t=t||{data:{}}).data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},rt=function(){(t=t||{data:{}}).data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},ot="sips",at=No("sips",!0),ct="sip",ut=No("sip",!0),lt=function(e){(t=t||{data:{}}).data.scheme=e},dt=function(){(t=t||{data:{}}).data.user=decodeURIComponent(Ao().slice(0,-1))},gt=function(){(t=t||{data:{}}).data.password=Ao()},pt=function(){return(t=t||{data:{}}).data.host=Ao(),t.data.host},ht=function(){return(t=t||{data:{}}).data.host_type="domain",Ao()},ft=/^[a-zA-Z0-9_\-]/,St=Oo([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),Tt=/^[a-zA-Z0-9\-]/,mt=Oo([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),_t=function(){return(t=t||{data:{}}).data.host_type="IPv6",Ao()},It="::",Ct=No("::",!1),vt=function(){return(t=t||{data:{}}).data.host_type="IPv6",Ao()},yt=function(){return(t=t||{data:{}}).data.host_type="IPv4",Ao()},Et="25",Rt=No("25",!1),At=/^[0-5]/,bt=Oo([["0","5"]],!1,!1),Nt="2",Ot=No("2",!1),Dt=/^[0-4]/,wt=Oo([["0","4"]],!1,!1),xt="1",Ut=No("1",!1),qt=/^[1-9]/,kt=Oo([["1","9"]],!1,!1),Pt=function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},Lt="transport=",Mt=No("transport=",!0),Ht="udp",Ft=No("udp",!0),Gt="tcp",jt=No("tcp",!0),Bt="sctp",Kt=No("sctp",!0),Jt="tls",Wt=No("tls",!0),Vt=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},Yt="user=",Qt=No("user=",!0),Xt="phone",zt=No("phone",!0),$t="ip",Zt=No("ip",!0),en=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},tn="method=",nn=No("method=",!0),sn=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},rn="ttl=",on=No("ttl=",!0),an=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.ttl=e},cn="maddr=",un=No("maddr=",!0),ln=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},dn="lr",gn=No("lr",!0),pn=function(){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},hn=function(e,n){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),n=null===n?void 0:n[1],t.data.uri_params[e.toLowerCase()]=n},fn=function(e,n){e=e.join("").toLowerCase(),n=n.join(""),(t=t||{data:{}}).data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(n):t.data.uri_headers[e]=[n]},Sn=function(){"Refer_To"===(t=t||{data:{}}).startRule&&(t.data.uri=new o.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},Tn="//",mn=No("//",!1),_n=function(){(t=t||{data:{}}).data.scheme=Ao()},In=No("SIP",!0),Cn=function(){(t=t||{data:{}}).data.sip_version=Ao()},vn="INVITE",yn=No("INVITE",!1),En="ACK",Rn=No("ACK",!1),An=(No("VXACH",!1),"OPTIONS"),bn=No("OPTIONS",!1),Nn="BYE",On=No("BYE",!1),Dn="CANCEL",wn=No("CANCEL",!1),xn="REGISTER",Un=No("REGISTER",!1),qn="SUBSCRIBE",kn=No("SUBSCRIBE",!1),Pn="NOTIFY",Ln=No("NOTIFY",!1),Mn="REFER",Hn=No("REFER",!1),Fn="PUBLISH",Gn=No("PUBLISH",!1),jn=function(){return(t=t||{data:{}}).data.method=Ao(),t.data.method},Bn=function(e){(t=t||{data:{}}).data.status_code=parseInt(e.join(""))},Kn=function(){(t=t||{data:{}}).data.reason_phrase=Ao()},Jn=function(){(t=t||{data:{}}).data=Ao()},Wn=function(){var e,n;for(n=(t=t||{data:{}}).data.multi_header.length,e=0;e<n;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},Vn=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:Io,offset:bo().start.offset,parsed:e})},Yn=function(e){'"'===(e=Ao().trim())[0]&&(e=e.substring(1,e.length-1)),(t=t||{data:{}}).data.displayName=e},Qn="q",Xn=No("q",!0),zn=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.q=e},$n="expires",Zn=No("expires",!0),es=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.expires=e},ts=function(e){return parseInt(e.join(""))},ns="0",ss=No("0",!1),is=function(){return parseFloat(Ao())},rs=function(e,n){(t=t||{data:{}}).data.params||(t.data.params={}),n=null===n?void 0:n[1],t.data.params[e.toLowerCase()]=n},os="render",as=No("render",!0),cs="session",us=No("session",!0),ls="icon",ds=No("icon",!0),gs="alert",ps=No("alert",!0),hs=function(){"Content_Disposition"===(t=t||{data:{}}).startRule&&(t.data.type=Ao().toLowerCase())},fs="handling",Ss=No("handling",!0),Ts="optional",ms=No("optional",!0),_s="required",Is=No("required",!0),Cs=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},vs=function(){(t=t||{data:{}}).data=Ao()},ys="text",Es=No("text",!0),Rs="image",As=No("image",!0),bs="audio",Ns=No("audio",!0),Os="video",Ds=No("video",!0),ws="application",xs=No("application",!0),Us="message",qs=No("message",!0),ks="multipart",Ps=No("multipart",!0),Ls="x-",Ms=No("x-",!0),Hs=function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},Fs=function(e){(t=t||{data:{}}).data.event=e.toLowerCase()},Gs=function(){var e=(t=t||{data:{}}).data.tag;t.data=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},js="tag",Bs=No("tag",!0),Ks=function(e){(t=t||{data:{}}).data.tag=e},Js=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},Ws=function(){(t=t||{data:{}}).data=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},Vs="digest",Ys=No("Digest",!0),Qs="realm",Xs=No("realm",!0),zs=function(e){(t=t||{data:{}}).data.realm=e},$s="domain",Zs=No("domain",!0),ei="nonce",ti=No("nonce",!0),ni=function(e){(t=t||{data:{}}).data.nonce=e},si="opaque",ii=No("opaque",!0),ri=function(e){(t=t||{data:{}}).data.opaque=e},oi="stale",ai=No("stale",!0),ci="true",ui=No("true",!0),li=function(){(t=t||{data:{}}).data.stale=!0},di="false",gi=No("false",!0),pi=function(){(t=t||{data:{}}).data.stale=!1},hi="algorithm",fi=No("algorithm",!0),Si="md5",Ti=No("MD5",!0),mi="md5-sess",_i=No("MD5-sess",!0),Ii=function(e){(t=t||{data:{}}).data.algorithm=e.toUpperCase()},Ci="qop",vi=No("qop",!0),yi="auth-int",Ei=No("auth-int",!0),Ri="auth",Ai=No("auth",!0),bi=function(e){(t=t||{data:{}}).data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},Ni=function(){var e,n;for(n=(t=t||{data:{}}).data.multi_header.length,e=0;e<n;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},Oi=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:Io,offset:bo().start.offset,parsed:e})},Di=function(){(t=t||{data:{}}).data=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},wi=function(){(t=t||{data:{}}).data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},xi=function(){(t=t||{data:{}}).data={call_id:t.data}},Ui="from-tag",qi=No("from-tag",!0),ki=function(e){(t=t||{data:{}}).data.replaces_from_tag=e},Pi="to-tag",Li=No("to-tag",!0),Mi=function(e){(t=t||{data:{}}).data.replaces_to_tag=e},Hi="early-only",Fi=No("early-only",!0),Gi=function(){(t=t||{data:{}}).data.early_only=!0},ji=function(e,t){return t},Bi=function(e,t){return function(e,t){return[e].concat(t)}(e,t)},Ki=function(e){"Require"===(t=t||{data:{}}).startRule&&(t.data=e||[])},Ji="active",Wi=No("active",!0),Vi="pending",Yi=No("pending",!0),Qi="terminated",Xi=No("terminated",!0),zi=function(){(t=t||{data:{}}).data.state=Ao()},$i="reason",Zi=No("reason",!0),er=function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},tr=function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},nr="retry_after",sr=No("retry_after",!0),ir=function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},rr="deactivated",or=No("deactivated",!0),ar="probation",cr=No("probation",!0),ur="rejected",lr=No("rejected",!0),dr="timeout",gr=No("timeout",!0),pr="giveup",hr=No("giveup",!0),fr="noresource",Sr=No("noresource",!0),Tr="invariant",mr=No("invariant",!0),_r=function(e){"Supported"===(t=t||{data:{}}).startRule&&(t.data=e||[])},Ir=function(){var e=(t=t||{data:{}}).data.tag;t.data=new r.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},Cr="ttl",vr=No("ttl",!0),yr=function(e){(t=t||{data:{}}).data.ttl=e},Er="maddr",Rr=No("maddr",!0),Ar=function(e){(t=t||{data:{}}).data.maddr=e},br="received",Nr=No("received",!0),Or=function(e){(t=t||{data:{}}).data.received=e},Dr="branch",wr=No("branch",!0),xr=function(e){(t=t||{data:{}}).data.branch=e},Ur="rport",qr=No("rport",!0),kr=function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},Pr=function(e){(t=t||{data:{}}).data.protocol=e},Lr=No("UDP",!0),Mr=No("TCP",!0),Hr=No("TLS",!0),Fr=No("SCTP",!0),Gr=function(e){(t=t||{data:{}}).data.transport=e},jr=function(){(t=t||{data:{}}).data.host=Ao()},Br=function(e){(t=t||{data:{}}).data.port=parseInt(e.join(""))},Kr=function(e){return parseInt(e.join(""))},Jr=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.deltaSeconds=e)},Wr="refresher",Vr=No("refresher",!1),Yr="uas",Qr=No("uas",!1),Xr="uac",zr=No("uac",!1),$r=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.refresher=e)},Zr=function(e){"Min_SE"===(t=t||{data:{}}).startRule&&(t.data=e)},eo="stuns",to=No("stuns",!0),no="stun",so=No("stun",!0),io=function(e){(t=t||{data:{}}).data.scheme=e},ro=function(e){(t=t||{data:{}}).data.host=e},oo="?transport=",ao=No("?transport=",!1),co="turns",uo=No("turns",!0),lo="turn",go=No("turn",!0),po=function(){(t=t||{data:{}}).data=Ao()},ho="Referred-By",fo=No("Referred-By",!1),So="b",To=No("b",!1),mo="cid",_o=No("cid",!1),Io=0,Co=0,vo=[{line:1,column:1}],yo=0,Eo=[],Ro=0;if(void 0!==t.startRule){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');d=l[t.startRule]}function Ao(){return e.substring(Co,Io)}function bo(){return wo(Co,Io)}function No(e,t){return{type:"literal",text:e,ignoreCase:t}}function Oo(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function Do(t){var n,s=vo[t];if(s)return s;for(n=t-1;!vo[n];)n--;for(s={line:(s=vo[n]).line,column:s.column};n<t;)10===e.charCodeAt(n)?(s.line++,s.column=1):s.column++,n++;return vo[t]=s,s}function wo(e,t){var n=Do(e),s=Do(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:s.line,column:s.column}}}function xo(e){Io<yo||(Io>yo&&(yo=Io,Eo=[]),Eo.push(e))}function Uo(){var t;return e.substr(Io,2)===g?(t=g,Io+=2):(t=u,0===Ro&&xo(p)),t}function qo(){var t;return h.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(f)),t}function ko(){var t;return S.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(T)),t}function Po(){var t;return m.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(_)),t}function Lo(){var e;return(e=Fo())===u&&(e=Go()),e}function Mo(){var t;return I.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(C)),t}function Ho(){var t;return v.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(y)),t}function Fo(){var t;return 32===e.charCodeAt(Io)?(t=E,Io++):(t=u,0===Ro&&xo(R)),t}function Go(){var t;return 9===e.charCodeAt(Io)?(t=A,Io++):(t=u,0===Ro&&xo(b)),t}function jo(){var t;return N.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(O)),t}function Bo(){var t;return 59===e.charCodeAt(Io)?(t=D,Io++):(t=u,0===Ro&&xo(w)),t===u&&(47===e.charCodeAt(Io)?(t=x,Io++):(t=u,0===Ro&&xo(U)),t===u&&(63===e.charCodeAt(Io)?(t=q,Io++):(t=u,0===Ro&&xo(k)),t===u&&(58===e.charCodeAt(Io)?(t=P,Io++):(t=u,0===Ro&&xo(L)),t===u&&(64===e.charCodeAt(Io)?(t=M,Io++):(t=u,0===Ro&&xo(H)),t===u&&(38===e.charCodeAt(Io)?(t=F,Io++):(t=u,0===Ro&&xo(G)),t===u&&(61===e.charCodeAt(Io)?(t=j,Io++):(t=u,0===Ro&&xo(B)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)),t===u&&(44===e.charCodeAt(Io)?(t=Y,Io++):(t=u,0===Ro&&xo(Q))))))))))),t}function Ko(){var e;return(e=jo())===u&&(e=Jo()),e}function Jo(){var t;return 45===e.charCodeAt(Io)?(t=X,Io++):(t=u,0===Ro&&xo(z)),t===u&&(95===e.charCodeAt(Io)?(t=$,Io++):(t=u,0===Ro&&xo(Z)),t===u&&(46===e.charCodeAt(Io)?(t=ee,Io++):(t=u,0===Ro&&xo(te)),t===u&&(33===e.charCodeAt(Io)?(t=ne,Io++):(t=u,0===Ro&&xo(se)),t===u&&(126===e.charCodeAt(Io)?(t=ie,Io++):(t=u,0===Ro&&xo(re)),t===u&&(42===e.charCodeAt(Io)?(t=oe,Io++):(t=u,0===Ro&&xo(ae)),t===u&&(39===e.charCodeAt(Io)?(t=ce,Io++):(t=u,0===Ro&&xo(ue)),t===u&&(40===e.charCodeAt(Io)?(t=le,Io++):(t=u,0===Ro&&xo(de)),t===u&&(41===e.charCodeAt(Io)?(t=ge,Io++):(t=u,0===Ro&&xo(pe)))))))))),t}function Wo(){var t,n,s,i,r;return t=Io,n=Io,37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s!==u&&(i=Po())!==u&&(r=Po())!==u?n=s=[s,i,r]:(Io=n,n=u),n!==u?e.substring(t,Io):n}function Vo(){var e,t,n,s;for(e=Io,t=Io,n=[],s=Lo();s!==u;)n.push(s),s=Lo();if(n!==u&&(s=Uo())!==u?t=n=[n,s]:(Io=t,t=u),t===u&&(t=null),t!==u){if(n=[],(s=Lo())!==u)for(;s!==u;)n.push(s),s=Lo();else n=u;n!==u?(Co=e,e=t=Se()):(Io=e,e=u)}else Io=e,e=u;return e}function Yo(){var e;return(e=Vo())===u&&(e=null),e}function Qo(){var t;return me.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(_e)),t}function Xo(){var t;return Ie.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(Ce)),t}function zo(){var t,n,s;if(t=Io,n=[],(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(46===e.charCodeAt(Io)?(s=ee,Io++):(s=u,0===Ro&&xo(te)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re)))))))))))),s!==u)for(;s!==u;)n.push(s),(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(46===e.charCodeAt(Io)?(s=ee,Io++):(s=u,0===Ro&&xo(te)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re))))))))))));else n=u;return n!==u?e.substring(t,Io):n}function $o(){var t,n,s;if(t=Io,n=[],(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re))))))))))),s!==u)for(;s!==u;)n.push(s),(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re)))))))))));else n=u;return n!==u?e.substring(t,Io):n}function Zo(){var t,n,s;if(t=Io,n=[],(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(46===e.charCodeAt(Io)?(s=ee,Io++):(s=u,0===Ro&&xo(te)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re)),s===u&&(40===e.charCodeAt(Io)?(s=le,Io++):(s=u,0===Ro&&xo(de)),s===u&&(41===e.charCodeAt(Io)?(s=ge,Io++):(s=u,0===Ro&&xo(pe)),s===u&&(60===e.charCodeAt(Io)?(s=Ee,Io++):(s=u,0===Ro&&xo(Re)),s===u&&(62===e.charCodeAt(Io)?(s=Ae,Io++):(s=u,0===Ro&&xo(be)),s===u&&(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s===u&&(92===e.charCodeAt(Io)?(s=Ne,Io++):(s=u,0===Ro&&xo(Oe)),s===u&&(s=Ho())===u&&(47===e.charCodeAt(Io)?(s=x,Io++):(s=u,0===Ro&&xo(U)),s===u&&(91===e.charCodeAt(Io)?(s=De,Io++):(s=u,0===Ro&&xo(we)),s===u&&(93===e.charCodeAt(Io)?(s=xe,Io++):(s=u,0===Ro&&xo(Ue)),s===u&&(63===e.charCodeAt(Io)?(s=q,Io++):(s=u,0===Ro&&xo(k)),s===u&&(123===e.charCodeAt(Io)?(s=qe,Io++):(s=u,0===Ro&&xo(ke)),s===u&&(125===e.charCodeAt(Io)?(s=Pe,Io++):(s=u,0===Ro&&xo(Le)))))))))))))))))))))))),s!==u)for(;s!==u;)n.push(s),(s=jo())===u&&(45===e.charCodeAt(Io)?(s=X,Io++):(s=u,0===Ro&&xo(z)),s===u&&(46===e.charCodeAt(Io)?(s=ee,Io++):(s=u,0===Ro&&xo(te)),s===u&&(33===e.charCodeAt(Io)?(s=ne,Io++):(s=u,0===Ro&&xo(se)),s===u&&(37===e.charCodeAt(Io)?(s=he,Io++):(s=u,0===Ro&&xo(fe)),s===u&&(42===e.charCodeAt(Io)?(s=oe,Io++):(s=u,0===Ro&&xo(ae)),s===u&&(95===e.charCodeAt(Io)?(s=$,Io++):(s=u,0===Ro&&xo(Z)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(96===e.charCodeAt(Io)?(s=ve,Io++):(s=u,0===Ro&&xo(ye)),s===u&&(39===e.charCodeAt(Io)?(s=ce,Io++):(s=u,0===Ro&&xo(ue)),s===u&&(126===e.charCodeAt(Io)?(s=ie,Io++):(s=u,0===Ro&&xo(re)),s===u&&(40===e.charCodeAt(Io)?(s=le,Io++):(s=u,0===Ro&&xo(de)),s===u&&(41===e.charCodeAt(Io)?(s=ge,Io++):(s=u,0===Ro&&xo(pe)),s===u&&(60===e.charCodeAt(Io)?(s=Ee,Io++):(s=u,0===Ro&&xo(Re)),s===u&&(62===e.charCodeAt(Io)?(s=Ae,Io++):(s=u,0===Ro&&xo(be)),s===u&&(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s===u&&(92===e.charCodeAt(Io)?(s=Ne,Io++):(s=u,0===Ro&&xo(Oe)),s===u&&(s=Ho())===u&&(47===e.charCodeAt(Io)?(s=x,Io++):(s=u,0===Ro&&xo(U)),s===u&&(91===e.charCodeAt(Io)?(s=De,Io++):(s=u,0===Ro&&xo(we)),s===u&&(93===e.charCodeAt(Io)?(s=xe,Io++):(s=u,0===Ro&&xo(Ue)),s===u&&(63===e.charCodeAt(Io)?(s=q,Io++):(s=u,0===Ro&&xo(k)),s===u&&(123===e.charCodeAt(Io)?(s=qe,Io++):(s=u,0===Ro&&xo(ke)),s===u&&(125===e.charCodeAt(Io)?(s=Pe,Io++):(s=u,0===Ro&&xo(Le))))))))))))))))))))))));else n=u;return n!==u?e.substring(t,Io):n}function ea(){var t,n;return t=Io,Yo()!==u?(47===e.charCodeAt(Io)?(n=x,Io++):(n=u,0===Ro&&xo(U)),n!==u&&Yo()!==u?(Co=t,t=He()):(Io=t,t=u)):(Io=t,t=u),t}function ta(){var t,n;return t=Io,Yo()!==u?(61===e.charCodeAt(Io)?(n=j,Io++):(n=u,0===Ro&&xo(B)),n!==u&&Yo()!==u?(Co=t,t=Fe()):(Io=t,t=u)):(Io=t,t=u),t}function na(){var t,n;return t=Io,62===e.charCodeAt(Io)?(n=Ae,Io++):(n=u,0===Ro&&xo(be)),n!==u&&Yo()!==u?(Co=t,t=n=Ge()):(Io=t,t=u),t}function sa(){var t,n;return t=Io,Yo()!==u?(60===e.charCodeAt(Io)?(n=Ee,Io++):(n=u,0===Ro&&xo(Re)),n!==u?(Co=t,t=je()):(Io=t,t=u)):(Io=t,t=u),t}function ia(){var t,n;return t=Io,Yo()!==u?(44===e.charCodeAt(Io)?(n=Y,Io++):(n=u,0===Ro&&xo(Q)),n!==u&&Yo()!==u?(Co=t,t=Be()):(Io=t,t=u)):(Io=t,t=u),t}function ra(){var t,n;return t=Io,Yo()!==u?(59===e.charCodeAt(Io)?(n=D,Io++):(n=u,0===Ro&&xo(w)),n!==u&&Yo()!==u?(Co=t,t=Ke()):(Io=t,t=u)):(Io=t,t=u),t}function oa(){var e;return e=Io,Yo()!==u&&Ho()!==u?(Co=e,e=We()):(Io=e,e=u),e}function aa(){var e;return e=Io,Ho()!==u&&Yo()!==u?(Co=e,e=We()):(Io=e,e=u),e}function ca(){var t,n,s,i,r,o;if(t=Io,n=Io,(s=Yo())!==u)if((i=Ho())!==u){for(r=[],(o=la())===u&&(o=da());o!==u;)r.push(o),(o=la())===u&&(o=da());r!==u&&(o=Ho())!==u?n=s=[s,i,r,o]:(Io=n,n=u)}else Io=n,n=u;else Io=n,n=u;return n!==u?e.substring(t,Io):n}function ua(){var t,n,s,i;if(t=Io,Yo()!==u)if(Ho()!==u){for(n=Io,s=[],(i=la())===u&&(i=da());i!==u;)s.push(i),(i=la())===u&&(i=da());(n=s!==u?e.substring(n,Io):s)!==u&&(s=Ho())!==u?(Co=t,t=Qe(n)):(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;return t}function la(){var t;return(t=Vo())===u&&(33===e.charCodeAt(Io)?(t=ne,Io++):(t=u,0===Ro&&xo(se)),t===u&&(Xe.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(ze)),t===u&&(Ve.test(e.charAt(Io))?(t=e.charAt(Io),Io++):(t=u,0===Ro&&xo(Ye)),t===u&&(t=Qo())))),t}function da(){var t,n,s;return t=Io,92===e.charCodeAt(Io)?(n=Ne,Io++):(n=u,0===Ro&&xo(Oe)),n!==u?($e.test(e.charAt(Io))?(s=e.charAt(Io),Io++):(s=u,0===Ro&&xo(Ze)),s===u&&(et.test(e.charAt(Io))?(s=e.charAt(Io),Io++):(s=u,0===Ro&&xo(tt)),s===u&&(nt.test(e.charAt(Io))?(s=e.charAt(Io),Io++):(s=u,0===Ro&&xo(st)))),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}function ga(){var t,n,s;return t=Io,ha()!==u?(58===e.charCodeAt(Io)?(n=P,Io++):(n=u,0===Ro&&xo(L)),n!==u?((s=fa())===u&&(s=null),s!==u&&Ta()!==u?(Co=t,t=it()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function pa(){var t,n,s,i,r;return t=Io,ha()!==u?(58===e.charCodeAt(Io)?(n=P,Io++):(n=u,0===Ro&&xo(L)),n!==u?((s=fa())===u&&(s=null),s!==u&&Ta()!==u?(i=function(){var t,n,s,i;for(t=[],n=Io,59===e.charCodeAt(Io)?(s=D,Io++):(s=u,0===Ro&&xo(w)),s!==u&&(i=Na())!==u?n=s=[s,i]:(Io=n,n=u);n!==u;)t.push(n),n=Io,59===e.charCodeAt(Io)?(s=D,Io++):(s=u,0===Ro&&xo(w)),s!==u&&(i=Na())!==u?n=s=[s,i]:(Io=n,n=u);return t}(),i!==u?(r=function(){var t,n,s,i,r,o,a;if(t=Io,63===e.charCodeAt(Io)?(n=q,Io++):(n=u,0===Ro&&xo(k)),n!==u)if((s=Da())!==u){for(i=[],r=Io,38===e.charCodeAt(Io)?(o=F,Io++):(o=u,0===Ro&&xo(G)),o!==u&&(a=Da())!==u?r=o=[o,a]:(Io=r,r=u);r!==u;)i.push(r),r=Io,38===e.charCodeAt(Io)?(o=F,Io++):(o=u,0===Ro&&xo(G)),o!==u&&(a=Da())!==u?r=o=[o,a]:(Io=r,r=u);i!==u?t=n=[n,s,i]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;return t}(),r===u&&(r=null),r!==u?(Co=t,t=rt()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function ha(){var t,n;return t=Io,e.substr(Io,4).toLowerCase()===ot?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(at)),n===u&&(e.substr(Io,3).toLowerCase()===ct?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(ut))),n!==u&&(Co=t,n=lt(n)),n}function fa(){var t,n,s,i,r;return t=Io,n=function(){var e,t;if(e=[],(t=Ko())===u&&(t=Wo())===u&&(t=Sa()),t!==u)for(;t!==u;)e.push(t),(t=Ko())===u&&(t=Wo())===u&&(t=Sa());else e=u;return e}(),n!==u?(s=Io,58===e.charCodeAt(Io)?(i=P,Io++):(i=u,0===Ro&&xo(L)),i!==u?(r=function(){var t,n,s;for(t=Io,n=[],(s=Ko())===u&&(s=Wo())===u&&(38===e.charCodeAt(Io)?(s=F,Io++):(s=u,0===Ro&&xo(G)),s===u&&(61===e.charCodeAt(Io)?(s=j,Io++):(s=u,0===Ro&&xo(B)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(36===e.charCodeAt(Io)?(s=W,Io++):(s=u,0===Ro&&xo(V)),s===u&&(44===e.charCodeAt(Io)?(s=Y,Io++):(s=u,0===Ro&&xo(Q)))))));s!==u;)n.push(s),(s=Ko())===u&&(s=Wo())===u&&(38===e.charCodeAt(Io)?(s=F,Io++):(s=u,0===Ro&&xo(G)),s===u&&(61===e.charCodeAt(Io)?(s=j,Io++):(s=u,0===Ro&&xo(B)),s===u&&(43===e.charCodeAt(Io)?(s=K,Io++):(s=u,0===Ro&&xo(J)),s===u&&(36===e.charCodeAt(Io)?(s=W,Io++):(s=u,0===Ro&&xo(V)),s===u&&(44===e.charCodeAt(Io)?(s=Y,Io++):(s=u,0===Ro&&xo(Q)))))));return n!==u&&(Co=t,n=gt()),t=n}(),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?(64===e.charCodeAt(Io)?(i=M,Io++):(i=u,0===Ro&&xo(H)),i!==u?(Co=t,t=n=dt()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function Sa(){var t;return 38===e.charCodeAt(Io)?(t=F,Io++):(t=u,0===Ro&&xo(G)),t===u&&(61===e.charCodeAt(Io)?(t=j,Io++):(t=u,0===Ro&&xo(B)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)),t===u&&(44===e.charCodeAt(Io)?(t=Y,Io++):(t=u,0===Ro&&xo(Q)),t===u&&(59===e.charCodeAt(Io)?(t=D,Io++):(t=u,0===Ro&&xo(w)),t===u&&(63===e.charCodeAt(Io)?(t=q,Io++):(t=u,0===Ro&&xo(k)),t===u&&(47===e.charCodeAt(Io)?(t=x,Io++):(t=u,0===Ro&&xo(U))))))))),t}function Ta(){var t,n,s,i,r;return t=Io,(n=ma())!==u?(s=Io,58===e.charCodeAt(Io)?(i=P,Io++):(i=u,0===Ro&&xo(L)),i!==u&&(r=ba())!==u?s=i=[i,r]:(Io=s,s=u),s===u&&(s=null),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}function ma(){var e,t;return e=Io,(t=_a())===u&&(t=Ra())===u&&(t=Ca()),t!==u&&(Co=e,t=pt()),t}function _a(){var t,n,s,i,r;for(t=Io,n=[],s=Io,(i=Ia())!==u?(46===e.charCodeAt(Io)?(r=ee,Io++):(r=u,0===Ro&&xo(te)),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=Ia())!==u?(46===e.charCodeAt(Io)?(r=ee,Io++):(r=u,0===Ro&&xo(te)),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u);return n!==u?(s=function(){var t,n,s,i;if(t=Io,S.test(e.charAt(Io))?(n=e.charAt(Io),Io++):(n=u,0===Ro&&xo(T)),n!==u){for(s=[],Tt.test(e.charAt(Io))?(i=e.charAt(Io),Io++):(i=u,0===Ro&&xo(mt));i!==u;)s.push(i),Tt.test(e.charAt(Io))?(i=e.charAt(Io),Io++):(i=u,0===Ro&&xo(mt));s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t}(),s!==u?(46===e.charCodeAt(Io)?(i=ee,Io++):(i=u,0===Ro&&xo(te)),i===u&&(i=null),i!==u?(Co=t,t=n=ht()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function Ia(){var t,n;if(t=[],ft.test(e.charAt(Io))?(n=e.charAt(Io),Io++):(n=u,0===Ro&&xo(St)),n!==u)for(;n!==u;)t.push(n),ft.test(e.charAt(Io))?(n=e.charAt(Io),Io++):(n=u,0===Ro&&xo(St));else t=u;return t}function Ca(){var t,n,s;return t=Io,91===e.charCodeAt(Io)?(n=De,Io++):(n=u,0===Ro&&xo(we)),n!==u&&va()!==u?(93===e.charCodeAt(Io)?(s=xe,Io++):(s=u,0===Ro&&xo(Ue)),s!==u?(Co=t,t=n=_t()):(Io=t,t=u)):(Io=t,t=u),t}function va(){var t,n,s,i,r,o,a,c,l,d,g,p,h,f,S;return t=Io,n=Io,(s=ya())!==u?(58===e.charCodeAt(Io)?(i=P,Io++):(i=u,0===Ro&&xo(L)),i!==u&&(r=ya())!==u?(58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?(58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?(58===e.charCodeAt(Io)?(d=P,Io++):(d=u,0===Ro&&xo(L)),d!==u&&(g=ya())!==u?(58===e.charCodeAt(Io)?(p=P,Io++):(p=u,0===Ro&&xo(L)),p!==u&&(h=ya())!==u?(58===e.charCodeAt(Io)?(f=P,Io++):(f=u,0===Ro&&xo(L)),f!==u&&(S=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g,p,h,f,S]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?(58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?(58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?(58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=ya())!==u?(58===e.charCodeAt(Io)?(g=P,Io++):(g=u,0===Ro&&xo(L)),g!==u&&(p=ya())!==u?(58===e.charCodeAt(Io)?(h=P,Io++):(h=u,0===Ro&&xo(L)),h!==u&&(f=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g,p,h,f]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?(58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?(58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?(58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=ya())!==u?(58===e.charCodeAt(Io)?(g=P,Io++):(g=u,0===Ro&&xo(L)),g!==u&&(p=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g,p]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?(58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?(58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?(58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=Ea())!==u?n=s=[s,i,r,o,a,c,l,d]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?(58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?(58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=Ea())!==u?n=s=[s,i,r,o,a,c]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?(58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=Ea())!==u?n=s=[s,i,r,o]:(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=Ea())!==u?n=s=[s,i]:(Io=n,n=u),n===u&&(n=Io,e.substr(Io,2)===It?(s=It,Io+=2):(s=u,0===Ro&&xo(Ct)),s!==u&&(i=ya())!==u?n=s=[s,i]:(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(e.substr(Io,2)===It?(i=It,Io+=2):(i=u,0===Ro&&xo(Ct)),i!==u&&(r=ya())!==u?(58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?(58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?(58===e.charCodeAt(Io)?(d=P,Io++):(d=u,0===Ro&&xo(L)),d!==u&&(g=ya())!==u?(58===e.charCodeAt(Io)?(p=P,Io++):(p=u,0===Ro&&xo(L)),p!==u&&(h=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g,p,h]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(e.substr(Io,2)===It?(r=It,Io+=2):(r=u,0===Ro&&xo(Ct)),r!==u&&(o=ya())!==u?(58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?(58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=ya())!==u?(58===e.charCodeAt(Io)?(g=P,Io++):(g=u,0===Ro&&xo(L)),g!==u&&(p=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g,p]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(r=Io,58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?(e.substr(Io,2)===It?(o=It,Io+=2):(o=u,0===Ro&&xo(Ct)),o!==u&&(a=ya())!==u?(58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?(58===e.charCodeAt(Io)?(d=P,Io++):(d=u,0===Ro&&xo(L)),d!==u&&(g=Ea())!==u?n=s=[s,i,r,o,a,c,l,d,g]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(r=Io,58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?(o=Io,58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?o=a=[a,c]:(Io=o,o=u),o===u&&(o=null),o!==u?(e.substr(Io,2)===It?(a=It,Io+=2):(a=u,0===Ro&&xo(Ct)),a!==u&&(c=ya())!==u?(58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=Ea())!==u?n=s=[s,i,r,o,a,c,l,d]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(r=Io,58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?(o=Io,58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?o=a=[a,c]:(Io=o,o=u),o===u&&(o=null),o!==u?(a=Io,58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?a=c=[c,l]:(Io=a,a=u),a===u&&(a=null),a!==u?(e.substr(Io,2)===It?(c=It,Io+=2):(c=u,0===Ro&&xo(Ct)),c!==u&&(l=Ea())!==u?n=s=[s,i,r,o,a,c,l]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(r=Io,58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?(o=Io,58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?o=a=[a,c]:(Io=o,o=u),o===u&&(o=null),o!==u?(a=Io,58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?a=c=[c,l]:(Io=a,a=u),a===u&&(a=null),a!==u?(c=Io,58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=ya())!==u?c=l=[l,d]:(Io=c,c=u),c===u&&(c=null),c!==u?(e.substr(Io,2)===It?(l=It,Io+=2):(l=u,0===Ro&&xo(Ct)),l!==u&&(d=ya())!==u?n=s=[s,i,r,o,a,c,l,d]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u),n===u&&(n=Io,(s=ya())!==u?(i=Io,58===e.charCodeAt(Io)?(r=P,Io++):(r=u,0===Ro&&xo(L)),r!==u&&(o=ya())!==u?i=r=[r,o]:(Io=i,i=u),i===u&&(i=null),i!==u?(r=Io,58===e.charCodeAt(Io)?(o=P,Io++):(o=u,0===Ro&&xo(L)),o!==u&&(a=ya())!==u?r=o=[o,a]:(Io=r,r=u),r===u&&(r=null),r!==u?(o=Io,58===e.charCodeAt(Io)?(a=P,Io++):(a=u,0===Ro&&xo(L)),a!==u&&(c=ya())!==u?o=a=[a,c]:(Io=o,o=u),o===u&&(o=null),o!==u?(a=Io,58===e.charCodeAt(Io)?(c=P,Io++):(c=u,0===Ro&&xo(L)),c!==u&&(l=ya())!==u?a=c=[c,l]:(Io=a,a=u),a===u&&(a=null),a!==u?(c=Io,58===e.charCodeAt(Io)?(l=P,Io++):(l=u,0===Ro&&xo(L)),l!==u&&(d=ya())!==u?c=l=[l,d]:(Io=c,c=u),c===u&&(c=null),c!==u?(l=Io,58===e.charCodeAt(Io)?(d=P,Io++):(d=u,0===Ro&&xo(L)),d!==u&&(g=ya())!==u?l=d=[d,g]:(Io=l,l=u),l===u&&(l=null),l!==u?(e.substr(Io,2)===It?(d=It,Io+=2):(d=u,0===Ro&&xo(Ct)),d!==u?n=s=[s,i,r,o,a,c,l,d]:(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u)):(Io=n,n=u))))))))))))))),n!==u&&(Co=t,n=vt()),n}function ya(){var e,t,n,s,i;return e=Io,(t=Po())!==u?((n=Po())===u&&(n=null),n!==u?((s=Po())===u&&(s=null),s!==u?((i=Po())===u&&(i=null),i!==u?e=t=[t,n,s,i]:(Io=e,e=u)):(Io=e,e=u)):(Io=e,e=u)):(Io=e,e=u),e}function Ea(){var t,n,s,i;return t=Io,(n=ya())!==u?(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s!==u&&(i=ya())!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t===u&&(t=Ra()),t}function Ra(){var t,n,s,i;return t=Io,Aa()!==u?(46===e.charCodeAt(Io)?(n=ee,Io++):(n=u,0===Ro&&xo(te)),n!==u&&Aa()!==u?(46===e.charCodeAt(Io)?(s=ee,Io++):(s=u,0===Ro&&xo(te)),s!==u&&Aa()!==u?(46===e.charCodeAt(Io)?(i=ee,Io++):(i=u,0===Ro&&xo(te)),i!==u&&Aa()!==u?(Co=t,t=yt()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function Aa(){var t,n,s,i;return t=Io,e.substr(Io,2)===Et?(n=Et,Io+=2):(n=u,0===Ro&&xo(Rt)),n!==u?(At.test(e.charAt(Io))?(s=e.charAt(Io),Io++):(s=u,0===Ro&&xo(bt)),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t===u&&(t=Io,50===e.charCodeAt(Io)?(n=Nt,Io++):(n=u,0===Ro&&xo(Ot)),n!==u?(Dt.test(e.charAt(Io))?(s=e.charAt(Io),Io++):(s=u,0===Ro&&xo(wt)),s!==u&&(i=qo())!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t===u&&(t=Io,49===e.charCodeAt(Io)?(n=xt,Io++):(n=u,0===Ro&&xo(Ut)),n!==u&&(s=qo())!==u&&(i=qo())!==u?t=n=[n,s,i]:(Io=t,t=u),t===u&&(t=Io,qt.test(e.charAt(Io))?(n=e.charAt(Io),Io++):(n=u,0===Ro&&xo(kt)),n!==u&&(s=qo())!==u?t=n=[n,s]:(Io=t,t=u),t===u&&(t=qo())))),t}function ba(){var e,t,n,s,i,r,o;return e=Io,t=Io,(n=qo())===u&&(n=null),n!==u?((s=qo())===u&&(s=null),s!==u?((i=qo())===u&&(i=null),i!==u?((r=qo())===u&&(r=null),r!==u?((o=qo())===u&&(o=null),o!==u?t=n=[n,s,i,r,o]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t!==u&&(Co=e,t=Pt(t)),t}function Na(){var t;return(t=function(){var t,n,s;return t=Io,e.substr(Io,10).toLowerCase()===Lt?(n=e.substr(Io,10),Io+=10):(n=u,0===Ro&&xo(Mt)),n!==u?(e.substr(Io,3).toLowerCase()===Ht?(s=e.substr(Io,3),Io+=3):(s=u,0===Ro&&xo(Ft)),s===u&&(e.substr(Io,3).toLowerCase()===Gt?(s=e.substr(Io,3),Io+=3):(s=u,0===Ro&&xo(jt)),s===u&&(e.substr(Io,4).toLowerCase()===Bt?(s=e.substr(Io,4),Io+=4):(s=u,0===Ro&&xo(Kt)),s===u&&(e.substr(Io,3).toLowerCase()===Jt?(s=e.substr(Io,3),Io+=3):(s=u,0===Ro&&xo(Wt)),s===u&&(s=zo())))),s!==u?(Co=t,t=n=Vt(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,5).toLowerCase()===Yt?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(Qt)),n!==u?(e.substr(Io,5).toLowerCase()===Xt?(s=e.substr(Io,5),Io+=5):(s=u,0===Ro&&xo(zt)),s===u&&(e.substr(Io,2).toLowerCase()===$t?(s=e.substr(Io,2),Io+=2):(s=u,0===Ro&&xo(Zt)),s===u&&(s=zo())),s!==u?(Co=t,t=n=en(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,7).toLowerCase()===tn?(n=e.substr(Io,7),Io+=7):(n=u,0===Ro&&xo(nn)),n!==u&&(s=Ga())!==u?(Co=t,t=n=sn(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,4).toLowerCase()===rn?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(on)),n!==u&&(s=pc())!==u?(Co=t,t=n=an(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,6).toLowerCase()===cn?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(un)),n!==u&&(s=ma())!==u?(Co=t,t=n=ln(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i,r;return t=Io,e.substr(Io,2).toLowerCase()===dn?(n=e.substr(Io,2),Io+=2):(n=u,0===Ro&&xo(gn)),n!==u?(s=Io,61===e.charCodeAt(Io)?(i=j,Io++):(i=u,0===Ro&&xo(B)),i!==u&&(r=zo())!==u?s=i=[i,r]:(Io=s,s=u),s===u&&(s=null),s!==u?(Co=t,t=n=pn()):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i,r;return t=Io,n=function(){var t,n,s;if(t=Io,n=[],(s=Oa())!==u)for(;s!==u;)n.push(s),s=Oa();else n=u;return t=n!==u?e.substring(t,Io):n}(),n!==u?(s=Io,61===e.charCodeAt(Io)?(i=j,Io++):(i=u,0===Ro&&xo(B)),i!==u?(r=function(){var t,n,s;if(t=Io,n=[],(s=Oa())!==u)for(;s!==u;)n.push(s),s=Oa();else n=u;return t=n!==u?e.substring(t,Io):n}(),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?(Co=t,t=n=hn(n,s)):(Io=t,t=u)):(Io=t,t=u),t}()),t}function Oa(){var t;return(t=function(){var t;return 91===e.charCodeAt(Io)?(t=De,Io++):(t=u,0===Ro&&xo(we)),t===u&&(93===e.charCodeAt(Io)?(t=xe,Io++):(t=u,0===Ro&&xo(Ue)),t===u&&(47===e.charCodeAt(Io)?(t=x,Io++):(t=u,0===Ro&&xo(U)),t===u&&(58===e.charCodeAt(Io)?(t=P,Io++):(t=u,0===Ro&&xo(L)),t===u&&(38===e.charCodeAt(Io)?(t=F,Io++):(t=u,0===Ro&&xo(G)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)))))))),t}())===u&&(t=Ko())===u&&(t=Wo()),t}function Da(){var t,n,s,i;return t=Io,n=function(){var e,t;if(e=[],(t=wa())===u&&(t=Ko())===u&&(t=Wo()),t!==u)for(;t!==u;)e.push(t),(t=wa())===u&&(t=Ko())===u&&(t=Wo());else e=u;return e}(),n!==u?(61===e.charCodeAt(Io)?(s=j,Io++):(s=u,0===Ro&&xo(B)),s!==u?(i=function(){var e,t;for(e=[],(t=wa())===u&&(t=Ko())===u&&(t=Wo());t!==u;)e.push(t),(t=wa())===u&&(t=Ko())===u&&(t=Wo());return e}(),i!==u?(Co=t,t=n=fn(n,i)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function wa(){var t;return 91===e.charCodeAt(Io)?(t=De,Io++):(t=u,0===Ro&&xo(we)),t===u&&(93===e.charCodeAt(Io)?(t=xe,Io++):(t=u,0===Ro&&xo(Ue)),t===u&&(47===e.charCodeAt(Io)?(t=x,Io++):(t=u,0===Ro&&xo(U)),t===u&&(63===e.charCodeAt(Io)?(t=q,Io++):(t=u,0===Ro&&xo(k)),t===u&&(58===e.charCodeAt(Io)?(t=P,Io++):(t=u,0===Ro&&xo(L)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)))))))),t}function xa(){var e;return(e=function(){var e,t,n,s,i,r;return e=Io,(t=Fa())!==u&&(n=Fo())!==u?(s=function(){var e,t;return e=Io,t=function(){var e,t,n,s;return e=Io,(t=qo())!==u&&(n=qo())!==u&&(s=qo())!==u?e=t=[t,n,s]:(Io=e,e=u),e}(),t!==u&&(Co=e,t=Bn(t)),e=t}(),s!==u&&(i=Fo())!==u?(r=function(){var e,t,n;for(e=Io,t=[],(n=Bo())===u&&(n=Ko())===u&&(n=Wo())===u&&(n=Qo())===u&&(n=Xo())===u&&(n=Fo())===u&&(n=Go());n!==u;)t.push(n),(n=Bo())===u&&(n=Ko())===u&&(n=Wo())===u&&(n=Qo())===u&&(n=Xo())===u&&(n=Fo())===u&&(n=Go());return t!==u&&(Co=e,t=Kn()),e=t}(),r!==u?e=t=[t,n,s,i,r]:(Io=e,e=u)):(Io=e,e=u)):(Io=e,e=u),e}())===u&&(e=function(){var e,t,n,s,i,r;return e=Io,(t=Ga())!==u&&(n=Fo())!==u?(s=function(){var e;return(e=pa())===u&&(e=Ua()),e}(),s!==u&&(i=Fo())!==u&&(r=Fa())!==u?e=t=[t,n,s,i,r]:(Io=e,e=u)):(Io=e,e=u),e}()),e}function Ua(){var t,n,s,i;return t=Io,n=function(){var t,n,s,i,r;if(t=Io,n=Io,(s=ko())!==u){for(i=[],(r=ko())===u&&(r=qo())===u&&(43===e.charCodeAt(Io)?(r=K,Io++):(r=u,0===Ro&&xo(J)),r===u&&(45===e.charCodeAt(Io)?(r=X,Io++):(r=u,0===Ro&&xo(z)),r===u&&(46===e.charCodeAt(Io)?(r=ee,Io++):(r=u,0===Ro&&xo(te)))));r!==u;)i.push(r),(r=ko())===u&&(r=qo())===u&&(43===e.charCodeAt(Io)?(r=K,Io++):(r=u,0===Ro&&xo(J)),r===u&&(45===e.charCodeAt(Io)?(r=X,Io++):(r=u,0===Ro&&xo(z)),r===u&&(46===e.charCodeAt(Io)?(r=ee,Io++):(r=u,0===Ro&&xo(te)))));i!==u?n=s=[s,i]:(Io=n,n=u)}else Io=n,n=u;return n!==u&&(Co=t,n=_n()),t=n}(),n!==u?(58===e.charCodeAt(Io)?(s=P,Io++):(s=u,0===Ro&&xo(L)),s!==u?(i=function(){var t,n,s,i,r;return t=Io,n=function(){var t,n,s,i;return t=Io,e.substr(Io,2)===Tn?(n=Tn,Io+=2):(n=u,0===Ro&&xo(mn)),n!==u?(s=function(){var t;return t=function(){var t,n,s,i;return t=Io,n=Io,(s=fa())!==u?(64===e.charCodeAt(Io)?(i=M,Io++):(i=u,0===Ro&&xo(H)),i!==u?n=s=[s,i]:(Io=n,n=u)):(Io=n,n=u),n===u&&(n=null),n!==u&&(s=Ta())!==u?t=n=[n,s]:(Io=t,t=u),t===u&&(t=null),t}(),t===u&&(t=Ha()),t}(),s!==u?((i=qa())===u&&(i=null),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}(),n===u&&(n=qa()),n!==u?(s=Io,63===e.charCodeAt(Io)?(i=q,Io++):(i=u,0===Ro&&xo(k)),i!==u?(r=function(){var e,t;for(e=[],t=ka();t!==u;)e.push(t),t=ka();return e}(),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}(),i===u&&(i=function(){var t,n,s,i;if(t=Io,n=function(){var t;return(t=Ko())===u&&(t=Wo())===u&&(59===e.charCodeAt(Io)?(t=D,Io++):(t=u,0===Ro&&xo(w)),t===u&&(63===e.charCodeAt(Io)?(t=q,Io++):(t=u,0===Ro&&xo(k)),t===u&&(58===e.charCodeAt(Io)?(t=P,Io++):(t=u,0===Ro&&xo(L)),t===u&&(64===e.charCodeAt(Io)?(t=M,Io++):(t=u,0===Ro&&xo(H)),t===u&&(38===e.charCodeAt(Io)?(t=F,Io++):(t=u,0===Ro&&xo(G)),t===u&&(61===e.charCodeAt(Io)?(t=j,Io++):(t=u,0===Ro&&xo(B)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)),t===u&&(44===e.charCodeAt(Io)?(t=Y,Io++):(t=u,0===Ro&&xo(Q))))))))))),t}(),n!==u){for(s=[],i=ka();i!==u;)s.push(i),i=ka();s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t}()),i!==u?(Co=t,t=n=Sn()):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}function qa(){var t,n,s;return t=Io,47===e.charCodeAt(Io)?(n=x,Io++):(n=u,0===Ro&&xo(U)),n!==u?(s=function(){var t,n,s,i,r,o;if(t=Io,(n=Pa())!==u){for(s=[],i=Io,47===e.charCodeAt(Io)?(r=x,Io++):(r=u,0===Ro&&xo(U)),r!==u&&(o=Pa())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,47===e.charCodeAt(Io)?(r=x,Io++):(r=u,0===Ro&&xo(U)),r!==u&&(o=Pa())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t}(),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}function ka(){var e;return(e=Bo())===u&&(e=Ko())===u&&(e=Wo()),e}function Pa(){var t,n,s,i,r,o;for(t=Io,n=[],s=Ma();s!==u;)n.push(s),s=Ma();if(n!==u){for(s=[],i=Io,59===e.charCodeAt(Io)?(r=D,Io++):(r=u,0===Ro&&xo(w)),r!==u&&(o=La())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,59===e.charCodeAt(Io)?(r=D,Io++):(r=u,0===Ro&&xo(w)),r!==u&&(o=La())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t}function La(){var e,t;for(e=[],t=Ma();t!==u;)e.push(t),t=Ma();return e}function Ma(){var t;return(t=Ko())===u&&(t=Wo())===u&&(58===e.charCodeAt(Io)?(t=P,Io++):(t=u,0===Ro&&xo(L)),t===u&&(64===e.charCodeAt(Io)?(t=M,Io++):(t=u,0===Ro&&xo(H)),t===u&&(38===e.charCodeAt(Io)?(t=F,Io++):(t=u,0===Ro&&xo(G)),t===u&&(61===e.charCodeAt(Io)?(t=j,Io++):(t=u,0===Ro&&xo(B)),t===u&&(43===e.charCodeAt(Io)?(t=K,Io++):(t=u,0===Ro&&xo(J)),t===u&&(36===e.charCodeAt(Io)?(t=W,Io++):(t=u,0===Ro&&xo(V)),t===u&&(44===e.charCodeAt(Io)?(t=Y,Io++):(t=u,0===Ro&&xo(Q))))))))),t}function Ha(){var t,n;if(t=[],(n=Ko())===u&&(n=Wo())===u&&(36===e.charCodeAt(Io)?(n=W,Io++):(n=u,0===Ro&&xo(V)),n===u&&(44===e.charCodeAt(Io)?(n=Y,Io++):(n=u,0===Ro&&xo(Q)),n===u&&(59===e.charCodeAt(Io)?(n=D,Io++):(n=u,0===Ro&&xo(w)),n===u&&(58===e.charCodeAt(Io)?(n=P,Io++):(n=u,0===Ro&&xo(L)),n===u&&(64===e.charCodeAt(Io)?(n=M,Io++):(n=u,0===Ro&&xo(H)),n===u&&(38===e.charCodeAt(Io)?(n=F,Io++):(n=u,0===Ro&&xo(G)),n===u&&(61===e.charCodeAt(Io)?(n=j,Io++):(n=u,0===Ro&&xo(B)),n===u&&(43===e.charCodeAt(Io)?(n=K,Io++):(n=u,0===Ro&&xo(J)))))))))),n!==u)for(;n!==u;)t.push(n),(n=Ko())===u&&(n=Wo())===u&&(36===e.charCodeAt(Io)?(n=W,Io++):(n=u,0===Ro&&xo(V)),n===u&&(44===e.charCodeAt(Io)?(n=Y,Io++):(n=u,0===Ro&&xo(Q)),n===u&&(59===e.charCodeAt(Io)?(n=D,Io++):(n=u,0===Ro&&xo(w)),n===u&&(58===e.charCodeAt(Io)?(n=P,Io++):(n=u,0===Ro&&xo(L)),n===u&&(64===e.charCodeAt(Io)?(n=M,Io++):(n=u,0===Ro&&xo(H)),n===u&&(38===e.charCodeAt(Io)?(n=F,Io++):(n=u,0===Ro&&xo(G)),n===u&&(61===e.charCodeAt(Io)?(n=j,Io++):(n=u,0===Ro&&xo(B)),n===u&&(43===e.charCodeAt(Io)?(n=K,Io++):(n=u,0===Ro&&xo(J))))))))));else t=u;return t}function Fa(){var t,n,s,i,r,o,a;if(t=Io,e.substr(Io,3).toLowerCase()===ct?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(In)),n!==u)if(47===e.charCodeAt(Io)?(s=x,Io++):(s=u,0===Ro&&xo(U)),s!==u){if(i=[],(r=qo())!==u)for(;r!==u;)i.push(r),r=qo();else i=u;if(i!==u)if(46===e.charCodeAt(Io)?(r=ee,Io++):(r=u,0===Ro&&xo(te)),r!==u){if(o=[],(a=qo())!==u)for(;a!==u;)o.push(a),a=qo();else o=u;o!==u?(Co=t,t=n=Cn()):(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u}else Io=t,t=u;else Io=t,t=u;return t}function Ga(){var t,n;return t=Io,n=function(){var t;return e.substr(Io,6)===vn?(t=vn,Io+=6):(t=u,0===Ro&&xo(yn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,3)===En?(t=En,Io+=3):(t=u,0===Ro&&xo(Rn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,7)===An?(t=An,Io+=7):(t=u,0===Ro&&xo(bn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,3)===Nn?(t=Nn,Io+=3):(t=u,0===Ro&&xo(On)),t}(),n===u&&(n=function(){var t;return e.substr(Io,6)===Dn?(t=Dn,Io+=6):(t=u,0===Ro&&xo(wn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,8)===xn?(t=xn,Io+=8):(t=u,0===Ro&&xo(Un)),t}(),n===u&&(n=function(){var t;return e.substr(Io,9)===qn?(t=qn,Io+=9):(t=u,0===Ro&&xo(kn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,7)===Fn?(t=Fn,Io+=7):(t=u,0===Ro&&xo(Gn)),t}(),n===u&&(n=function(){var t;return e.substr(Io,6)===Pn?(t=Pn,Io+=6):(t=u,0===Ro&&xo(Ln)),t}(),n===u&&(n=function(){var t;return e.substr(Io,5)===Mn?(t=Mn,Io+=5):(t=u,0===Ro&&xo(Hn)),t}(),n===u&&(n=zo())))))))))),n!==u&&(Co=t,n=jn()),n}function ja(){var t,n,s,i;return t=Io,Zo()!==u?(n=Io,64===e.charCodeAt(Io)?(s=M,Io++):(s=u,0===Ro&&xo(H)),s!==u&&(i=Zo())!==u?n=s=[s,i]:(Io=n,n=u),n===u&&(n=null),n!==u?(Co=t,t=Jn()):(Io=t,t=u)):(Io=t,t=u),t}function Ba(){var t,n,s,i,r,o,a;if(t=Io,n=function(){var t,n;return t=Io,Yo()!==u?(42===e.charCodeAt(Io)?(n=oe,Io++):(n=u,0===Ro&&xo(ae)),n!==u&&Yo()!==u?(Co=t,t=Me()):(Io=t,t=u)):(Io=t,t=u),t}(),n===u)if(n=Io,(s=Ka())!==u){for(i=[],r=Io,(o=ia())!==u&&(a=Ka())!==u?r=o=[o,a]:(Io=r,r=u);r!==u;)i.push(r),r=Io,(o=ia())!==u&&(a=Ka())!==u?r=o=[o,a]:(Io=r,r=u);i!==u?n=s=[s,i]:(Io=n,n=u)}else Io=n,n=u;return n!==u&&(Co=t,n=Wn()),n}function Ka(){var e,t,n,s,i,r;if(e=Io,(t=ga())===u&&(t=Ja()),t!==u){for(n=[],s=Io,(i=ra())!==u&&(r=Va())!==u?s=i=[i,r]:(Io=s,s=u);s!==u;)n.push(s),s=Io,(i=ra())!==u&&(r=Va())!==u?s=i=[i,r]:(Io=s,s=u);n!==u?(Co=e,e=t=Vn()):(Io=e,e=u)}else Io=e,e=u;return e}function Ja(){var e,t,n,s,i;return e=Io,(t=Wa())===u&&(t=null),t!==u&&(n=sa())!==u&&(s=pa())!==u&&(i=na())!==u?e=t=[t,n,s,i]:(Io=e,e=u),e}function Wa(){var e,t,n,s,i,r,o;if(e=Io,t=Io,(n=zo())!==u){for(s=[],i=Io,(r=Vo())!==u&&(o=zo())!==u?i=r=[r,o]:(Io=i,i=u);i!==u;)s.push(i),i=Io,(r=Vo())!==u&&(o=zo())!==u?i=r=[r,o]:(Io=i,i=u);s!==u?t=n=[n,s]:(Io=t,t=u)}else Io=t,t=u;return t===u&&(t=ca()),t!==u&&(Co=e,t=Yn(t)),t}function Va(){var t;return(t=function(){var t,n,s;return t=Io,e.substr(Io,1).toLowerCase()===Qn?(n=e.charAt(Io),Io++):(n=u,0===Ro&&xo(Xn)),n!==u&&ta()!==u?(s=function(){var t,n,s,i,r,o,a;return t=Io,48===e.charCodeAt(Io)?(n=ns,Io++):(n=u,0===Ro&&xo(ss)),n!==u?(s=Io,46===e.charCodeAt(Io)?(i=ee,Io++):(i=u,0===Ro&&xo(te)),i!==u?((r=qo())===u&&(r=null),r!==u?((o=qo())===u&&(o=null),o!==u?((a=qo())===u&&(a=null),a!==u?s=i=[i,r,o,a]:(Io=s,s=u)):(Io=s,s=u)):(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?(Co=t,t=n=is()):(Io=t,t=u)):(Io=t,t=u),t}(),s!==u?(Co=t,t=n=zn(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,7).toLowerCase()===$n?(n=e.substr(Io,7),Io+=7):(n=u,0===Ro&&xo(Zn)),n!==u&&ta()!==u&&(s=Ya())!==u?(Co=t,t=n=es(s)):(Io=t,t=u),t}())===u&&(t=Qa()),t}function Ya(){var e,t,n;if(e=Io,t=[],(n=qo())!==u)for(;n!==u;)t.push(n),n=qo();else t=u;return t!==u&&(Co=e,t=ts(t)),t}function Qa(){var e,t,n,s,i;return e=Io,(t=zo())!==u?(n=Io,(s=ta())!==u?(i=function(){var e;return(e=zo())===u&&(e=ma())===u&&(e=ca()),e}(),i!==u?n=s=[s,i]:(Io=n,n=u)):(Io=n,n=u),n===u&&(n=null),n!==u?(Co=e,e=t=rs(t,n)):(Io=e,e=u)):(Io=e,e=u),e}function Xa(){var t;return(t=function(){var t,n,s,i;return t=Io,e.substr(Io,8).toLowerCase()===fs?(n=e.substr(Io,8),Io+=8):(n=u,0===Ro&&xo(Ss)),n!==u&&(s=ta())!==u?(e.substr(Io,8).toLowerCase()===Ts?(i=e.substr(Io,8),Io+=8):(i=u,0===Ro&&xo(ms)),i===u&&(e.substr(Io,8).toLowerCase()===_s?(i=e.substr(Io,8),Io+=8):(i=u,0===Ro&&xo(Is)),i===u&&(i=zo())),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=Qa()),t}function za(){var t;return(t=zo())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,2).toLowerCase()===Ls?(n=e.substr(Io,2),Io+=2):(n=u,0===Ro&&xo(Ms)),n!==u&&(s=zo())!==u?t=n=[n,s]:(Io=t,t=u),t}()),t}function $a(){var e,t,n,s;return e=Io,(t=zo())!==u&&(n=ta())!==u?(s=function(){var e;return(e=zo())===u&&(e=ca()),e}(),s!==u?e=t=[t,n,s]:(Io=e,e=u)):(Io=e,e=u),e}function Za(){var e;return(e=ec())===u&&(e=Qa()),e}function ec(){var t,n,s;return t=Io,e.substr(Io,3).toLowerCase()===js?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(Bs)),n!==u&&ta()!==u&&(s=zo())!==u?(Co=t,t=n=Ks(s)):(Io=t,t=u),t}function tc(){var t,n,s,i,r,o,a,c;if(t=Io,e.substr(Io,6).toLowerCase()===Vs?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(Ys)),n!==u)if((s=Vo())!==u)if((i=sc())!==u){for(r=[],o=Io,(a=ia())!==u&&(c=sc())!==u?o=a=[a,c]:(Io=o,o=u);o!==u;)r.push(o),o=Io,(a=ia())!==u&&(c=sc())!==u?o=a=[a,c]:(Io=o,o=u);r!==u?t=n=[n,s,i,r]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t===u&&(t=function(){var e,t,n,s,i,r,o,a;if(e=Io,(t=zo())!==u)if((n=Vo())!==u)if((s=nc())!==u){for(i=[],r=Io,(o=ia())!==u&&(a=nc())!==u?r=o=[o,a]:(Io=r,r=u);r!==u;)i.push(r),r=Io,(o=ia())!==u&&(a=nc())!==u?r=o=[o,a]:(Io=r,r=u);i!==u?e=t=[t,n,s,i]:(Io=e,e=u)}else Io=e,e=u;else Io=e,e=u;else Io=e,e=u;return e}()),t}function nc(){var e,t,n,s;return e=Io,(t=zo())!==u&&(n=ta())!==u?((s=zo())===u&&(s=ca()),s!==u?e=t=[t,n,s]:(Io=e,e=u)):(Io=e,e=u),e}function sc(){var t;return(t=function(){var t,n,s,i;return t=Io,e.substr(Io,5).toLowerCase()===Qs?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(Xs)),n!==u&&(s=ta())!==u?(i=function(){var e,t;return e=Io,(t=ua())!==u&&(Co=e,t=zs(t)),e=t}(),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i,r,o,a,c,l;if(t=Io,e.substr(Io,6).toLowerCase()===$s?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(Zs)),n!==u)if((s=ta())!==u)if((i=oa())!==u)if((r=ic())!==u){if(o=[],a=Io,c=[],(l=Fo())!==u)for(;l!==u;)c.push(l),l=Fo();else c=u;for(c!==u&&(l=ic())!==u?a=c=[c,l]:(Io=a,a=u);a!==u;){if(o.push(a),a=Io,c=[],(l=Fo())!==u)for(;l!==u;)c.push(l),l=Fo();else c=u;c!==u&&(l=ic())!==u?a=c=[c,l]:(Io=a,a=u)}o!==u&&(a=aa())!==u?t=n=[n,s,i,r,o,a]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t}())===u&&(t=function(){var t,n,s,i;return t=Io,e.substr(Io,5).toLowerCase()===ei?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(ti)),n!==u&&(s=ta())!==u?(i=function(){var e,t;return e=Io,(t=ua())!==u&&(Co=e,t=ni(t)),e=t}(),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,6).toLowerCase()===si?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(ii)),n!==u&&ta()!==u&&(s=ua())!==u?(Co=t,t=n=ri(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i,r;return t=Io,e.substr(Io,5).toLowerCase()===oi?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(ai)),n!==u&&(s=ta())!==u?(i=Io,e.substr(Io,4).toLowerCase()===ci?(r=e.substr(Io,4),Io+=4):(r=u,0===Ro&&xo(ui)),r!==u&&(Co=i,r=li()),(i=r)===u&&(i=Io,e.substr(Io,5).toLowerCase()===di?(r=e.substr(Io,5),Io+=5):(r=u,0===Ro&&xo(gi)),r!==u&&(Co=i,r=pi()),i=r),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,9).toLowerCase()===hi?(n=e.substr(Io,9),Io+=9):(n=u,0===Ro&&xo(fi)),n!==u&&ta()!==u?(e.substr(Io,3).toLowerCase()===Si?(s=e.substr(Io,3),Io+=3):(s=u,0===Ro&&xo(Ti)),s===u&&(e.substr(Io,8).toLowerCase()===mi?(s=e.substr(Io,8),Io+=8):(s=u,0===Ro&&xo(_i)),s===u&&(s=zo())),s!==u?(Co=t,t=n=Ii(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i,r,o,a,c,l,d;if(t=Io,e.substr(Io,3).toLowerCase()===Ci?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(vi)),n!==u)if((s=ta())!==u)if((i=oa())!==u){if(r=Io,(o=rc())!==u){for(a=[],c=Io,44===e.charCodeAt(Io)?(l=Y,Io++):(l=u,0===Ro&&xo(Q)),l!==u&&(d=rc())!==u?c=l=[l,d]:(Io=c,c=u);c!==u;)a.push(c),c=Io,44===e.charCodeAt(Io)?(l=Y,Io++):(l=u,0===Ro&&xo(Q)),l!==u&&(d=rc())!==u?c=l=[l,d]:(Io=c,c=u);a!==u?r=o=[o,a]:(Io=r,r=u)}else Io=r,r=u;r!==u&&(o=aa())!==u?t=n=[n,s,i,r,o]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t}())===u&&(t=nc()),t}function ic(){var e;return(e=Ua())===u&&(e=qa()),e}function rc(){var t,n;return t=Io,e.substr(Io,8).toLowerCase()===yi?(n=e.substr(Io,8),Io+=8):(n=u,0===Ro&&xo(Ei)),n===u&&(e.substr(Io,4).toLowerCase()===Ri?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(Ai)),n===u&&(n=zo())),n!==u&&(Co=t,n=bi(n)),n}function oc(){var e,t,n,s,i;if(e=Io,Ja()!==u){for(t=[],n=Io,(s=ra())!==u&&(i=Qa())!==u?n=s=[s,i]:(Io=n,n=u);n!==u;)t.push(n),n=Io,(s=ra())!==u&&(i=Qa())!==u?n=s=[s,i]:(Io=n,n=u);t!==u?(Co=e,e=Oi()):(Io=e,e=u)}else Io=e,e=u;return e}function ac(){var t,n,s;return t=Io,e.substr(Io,8).toLowerCase()===Ui?(n=e.substr(Io,8),Io+=8):(n=u,0===Ro&&xo(qi)),n!==u&&ta()!==u&&(s=zo())!==u?(Co=t,t=n=ki(s)):(Io=t,t=u),t===u&&(t=Io,e.substr(Io,6).toLowerCase()===Pi?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(Li)),n!==u&&ta()!==u&&(s=zo())!==u?(Co=t,t=n=Mi(s)):(Io=t,t=u),t===u&&(t=Io,e.substr(Io,10).toLowerCase()===Hi?(n=e.substr(Io,10),Io+=10):(n=u,0===Ro&&xo(Fi)),n!==u&&(Co=t,n=Gi()),(t=n)===u&&(t=Qa()))),t}function cc(){var t,n,s;return t=Io,e.substr(Io,6).toLowerCase()===$i?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(Zi)),n!==u&&ta()!==u?(s=function(){var t;return e.substr(Io,11).toLowerCase()===rr?(t=e.substr(Io,11),Io+=11):(t=u,0===Ro&&xo(or)),t===u&&(e.substr(Io,9).toLowerCase()===ar?(t=e.substr(Io,9),Io+=9):(t=u,0===Ro&&xo(cr)),t===u&&(e.substr(Io,8).toLowerCase()===ur?(t=e.substr(Io,8),Io+=8):(t=u,0===Ro&&xo(lr)),t===u&&(e.substr(Io,7).toLowerCase()===dr?(t=e.substr(Io,7),Io+=7):(t=u,0===Ro&&xo(gr)),t===u&&(e.substr(Io,6).toLowerCase()===pr?(t=e.substr(Io,6),Io+=6):(t=u,0===Ro&&xo(hr)),t===u&&(e.substr(Io,10).toLowerCase()===fr?(t=e.substr(Io,10),Io+=10):(t=u,0===Ro&&xo(Sr)),t===u&&(e.substr(Io,9).toLowerCase()===Tr?(t=e.substr(Io,9),Io+=9):(t=u,0===Ro&&xo(mr)),t===u&&(t=zo()))))))),t}(),s!==u?(Co=t,t=n=er(s)):(Io=t,t=u)):(Io=t,t=u),t===u&&(t=Io,e.substr(Io,7).toLowerCase()===$n?(n=e.substr(Io,7),Io+=7):(n=u,0===Ro&&xo(Zn)),n!==u&&ta()!==u&&(s=Ya())!==u?(Co=t,t=n=tr(s)):(Io=t,t=u),t===u&&(t=Io,e.substr(Io,11).toLowerCase()===nr?(n=e.substr(Io,11),Io+=11):(n=u,0===Ro&&xo(sr)),n!==u&&ta()!==u&&(s=Ya())!==u?(Co=t,t=n=ir(s)):(Io=t,t=u),t===u&&(t=Qa()))),t}function uc(){var e;return(e=ec())===u&&(e=Qa()),e}function lc(){var t,n,s,i,r,o,a,c;if(t=Io,n=function(){var t,n,s,i,r,o;return t=Io,n=function(){var t,n;return t=Io,e.substr(Io,3).toLowerCase()===ct?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(In)),n===u&&(n=zo()),n!==u&&(Co=t,n=Pr(n)),t=n}(),n!==u&&(s=ea())!==u&&(i=zo())!==u&&(r=ea())!==u&&(o=gc())!==u?t=n=[n,s,i,r,o]:(Io=t,t=u),t}(),n!==u)if((s=Vo())!==u)if(i=function(){var t,n,s,i,r;return t=Io,n=function(){var e,t;return e=Io,(t=_a())===u&&(t=Ra())===u&&(t=Ca()),t!==u&&(Co=e,t=jr()),e=t}(),n!==u?(s=Io,i=function(){var t,n;return t=Io,Yo()!==u?(58===e.charCodeAt(Io)?(n=P,Io++):(n=u,0===Ro&&xo(L)),n!==u&&Yo()!==u?(Co=t,t=Je()):(Io=t,t=u)):(Io=t,t=u),t}(),i!==u?(r=function(){var e,t,n,s,i,r,o;return e=Io,t=Io,(n=qo())===u&&(n=null),n!==u?((s=qo())===u&&(s=null),s!==u?((i=qo())===u&&(i=null),i!==u?((r=qo())===u&&(r=null),r!==u?((o=qo())===u&&(o=null),o!==u?t=n=[n,s,i,r,o]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t!==u&&(Co=e,t=Br(t)),e=t}(),r!==u?s=i=[i,r]:(Io=s,s=u)):(Io=s,s=u),s===u&&(s=null),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}(),i!==u){for(r=[],o=Io,(a=ra())!==u&&(c=dc())!==u?o=a=[a,c]:(Io=o,o=u);o!==u;)r.push(o),o=Io,(a=ra())!==u&&(c=dc())!==u?o=a=[a,c]:(Io=o,o=u);r!==u?t=n=[n,s,i,r]:(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;else Io=t,t=u;return t}function dc(){var t;return(t=function(){var t,n,s;return t=Io,e.substr(Io,3).toLowerCase()===Cr?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(vr)),n!==u&&ta()!==u&&(s=pc())!==u?(Co=t,t=n=yr(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,5).toLowerCase()===Er?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(Rr)),n!==u&&ta()!==u&&(s=ma())!==u?(Co=t,t=n=Ar(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,8).toLowerCase()===br?(n=e.substr(Io,8),Io+=8):(n=u,0===Ro&&xo(Nr)),n!==u&&ta()!==u?((s=Ra())===u&&(s=va())===u&&(s=Ca()),s!==u?(Co=t,t=n=Or(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s;return t=Io,e.substr(Io,6).toLowerCase()===Dr?(n=e.substr(Io,6),Io+=6):(n=u,0===Ro&&xo(wr)),n!==u&&ta()!==u&&(s=zo())!==u?(Co=t,t=n=xr(s)):(Io=t,t=u),t}())===u&&(t=function(){var t,n,s,i;if(t=Io,e.substr(Io,5).toLowerCase()===Ur?(n=e.substr(Io,5),Io+=5):(n=u,0===Ro&&xo(qr)),n!==u)if(ta()!==u){for(s=[],i=qo();i!==u;)s.push(i),i=qo();s!==u?(Co=t,t=n=kr(s)):(Io=t,t=u)}else Io=t,t=u;else Io=t,t=u;return t}())===u&&(t=Qa()),t}function gc(){var t,n;return t=Io,e.substr(Io,3).toLowerCase()===Ht?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(Lr)),n===u&&(e.substr(Io,3).toLowerCase()===Gt?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(Mr)),n===u&&(e.substr(Io,3).toLowerCase()===Jt?(n=e.substr(Io,3),Io+=3):(n=u,0===Ro&&xo(Hr)),n===u&&(e.substr(Io,4).toLowerCase()===Bt?(n=e.substr(Io,4),Io+=4):(n=u,0===Ro&&xo(Fr)),n===u&&(n=zo())))),n!==u&&(Co=t,n=Gr(n)),n}function pc(){var e,t,n,s,i;return e=Io,t=Io,(n=qo())!==u?((s=qo())===u&&(s=null),s!==u?((i=qo())===u&&(i=null),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t!==u&&(Co=e,t=Kr(t)),t}function hc(){var t;return(t=function(){var t,n,s;return t=Io,e.substr(Io,9)===Wr?(n=Wr,Io+=9):(n=u,0===Ro&&xo(Vr)),n!==u&&ta()!==u?(e.substr(Io,3)===Yr?(s=Yr,Io+=3):(s=u,0===Ro&&xo(Qr)),s===u&&(e.substr(Io,3)===Xr?(s=Xr,Io+=3):(s=u,0===Ro&&xo(zr))),s!==u?(Co=t,t=n=$r(s)):(Io=t,t=u)):(Io=t,t=u),t}())===u&&(t=Qa()),t}function fc(){var t,n,s,i,r;return t=Io,n=function(){var e,t;return e=Io,(t=Ra())===u&&(t=Ca())===u&&(t=Ha()),t!==u&&(Co=e,t=ro(t)),e=t}(),n!==u?(s=Io,58===e.charCodeAt(Io)?(i=P,Io++):(i=u,0===Ro&&xo(L)),i!==u&&(r=ba())!==u?s=i=[i,r]:(Io=s,s=u),s===u&&(s=null),s!==u?t=n=[n,s]:(Io=t,t=u)):(Io=t,t=u),t}function Sc(){var e,t,n,s,i;return e=Io,(t=Po())!==u&&(n=Po())!==u&&(s=Po())!==u&&(i=Po())!==u?e=t=[t,n,s,i]:(Io=e,e=u),e}function Tc(){var t,n,s,i;return t=Io,e.substr(Io,3)===mo?(n=mo,Io+=3):(n=u,0===Ro&&xo(_o)),n!==u&&(s=ta())!==u?(i=function(){var t,n,s,i,r,o;return t=Io,(n=oa())!==u&&(s=Jo())!==u?(64===e.charCodeAt(Io)?(i=M,Io++):(i=u,0===Ro&&xo(H)),i!==u?((r=Jo())===u&&(r=ma()),r!==u&&(o=aa())!==u?t=n=[n,s,i,r,o]:(Io=t,t=u)):(Io=t,t=u)):(Io=t,t=u),t}(),i!==u?t=n=[n,s,i]:(Io=t,t=u)):(Io=t,t=u),t}if(t.data={},(n=d())!==u&&Io===e.length)return n;throw n!==u&&Io<e.length&&xo({type:"end"}),s=Eo,i=yo<e.length?e.charAt(yo):null,c=yo<e.length?wo(yo,yo+1):wo(yo,yo),new a(a.buildMessage(s,i),s,i,c)}},838:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=n(346);!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(s=t.Levels||(t.Levels={}));var r=function(){function e(){this.builtinEnabled=!0,this._level=s.log,this.loggers={},this.type=i.TypeStrings.LoggerFactory,this.logger=this.getLogger("sip:loggerfactory")}return Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:s.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connector",{get:function(){return this._connector},set:function(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0},enumerable:!0,configurable:!0}),e.prototype.getLogger=function(e,t){if(t&&3===this.level)return new o(this,e,t);if(this.loggers[e])return this.loggers[e];var n=new o(this,e);return this.loggers[e]=n,n},e.prototype.genericLog=function(e,t,n,i){this.level>=e&&(this.builtinEnabled&&this.print(console[s[e]],t,n,i),this.connector&&this.connector(s[e],t,n,i))},e.prototype.print=function(e,t,n,s){if("string"==typeof s){var i=[new Date,t];n&&i.push(n),s=i.concat(s).join(" | ")}e.call(console,s)},e}();t.LoggerFactory=r;var o=function(){function e(e,t,n){this.type=i.TypeStrings.Logger,this.logger=e,this.category=t,this.label=n}return e.prototype.error=function(e){this.genericLog(s.error,e)},e.prototype.warn=function(e){this.genericLog(s.warn,e)},e.prototype.log=function(e){this.genericLog(s.log,e)},e.prototype.debug=function(e){this.genericLog(s.debug,e)},e.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)},e}();t.Logger=o},47:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(346),o=function(e){function t(t,n,s){var i=e.call(this,s)||this;if(i.type=r.TypeStrings.NameAddrHeader,!t||t.type!==r.TypeStrings.URI)throw new TypeError('missing or invalid "uri" parameter');return i.uri=t,i._displayName=n,i}return i(t,e),Object.defineProperty(t.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))},t.prototype.toString=function(){var e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";for(var t in e+="<"+this.uri.toString()+">",this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e},t}(n(750).Parameters);t.NameAddrHeader=o},125:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(346),i=n(585),r=n(557);!function(e){function t(e,t){var n=t,s=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===s;){if(-1===(i=e.indexOf("\r\n",n)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:s=i}return s}function n(e,t,n,r){var o,a=t.indexOf(":",n),c=t.substring(n,a).trim(),u=t.substring(a+1,r).trim();switch(c.toLowerCase()){case"via":case"v":e.addHeader("via",u),1===e.getHeaders("via").length?(o=e.parseHeader("Via"))&&(e.via=o,e.viaBranch=o.branch):o=0;break;case"from":case"f":e.setHeader("from",u),(o=e.parseHeader("from"))&&(e.from=o,e.fromTag=o.getParam("tag"));break;case"to":case"t":e.setHeader("to",u),(o=e.parseHeader("to"))&&(e.to=o,e.toTag=o.getParam("tag"));break;case"record-route":if(-1===(o=i.Grammar.parse(u,"Record_Route"))){o=void 0;break}for(var l in o)o[l]&&(e.addHeader("record-route",u.substring(o[l].position,o[l].offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=o[l].parsed);break;case"call-id":case"i":e.setHeader("call-id",u),(o=e.parseHeader("call-id"))&&(e.callId=u);break;case"contact":case"m":if(-1===(o=i.Grammar.parse(u,"Contact"))){o=void 0;break}for(var l in o)o[l]&&(e.addHeader("contact",u.substring(o[l].position,o[l].offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=o[l].parsed);break;case"content-length":case"l":e.setHeader("content-length",u),o=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",u),o=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",u),(o=e.parseHeader("cseq"))&&(e.cseq=o.value),e.type===s.TypeStrings.IncomingResponse&&(e.method=o.method);break;case"max-forwards":e.setHeader("max-forwards",u),o=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",u),o=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",u),o=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",u),(o=e.parseHeader("refer-to"))&&(e.referTo=o);break;default:e.setHeader(c,u),o=0}return void 0!==o||{error:"error parsing header '"+c+"'"}}e.getHeader=t,e.parseHeader=n,e.parseMessage=function(e,s){var o=0,a=e.indexOf("\r\n"),c=s.getLogger("sip.parser");if(-1!==a){var u,l=e.substring(0,a),d=i.Grammar.parse(l,"Request_Response");if(-1!==d){var g;for(d.status_code?((u=new r.IncomingResponse(s)).statusCode=d.status_code,u.reasonPhrase=d.reason_phrase):((u=new r.IncomingRequest(s)).method=d.method,u.ruri=d.uri),u.data=e,o=a+2;;){if(-2===(a=t(e,o))){g=o+2;break}if(-1===a)return void c.error("malformed message");if(!0!==n(u,e,o,a))return void c.error(d.error);o=a+2}return u.hasHeader("content-length")?u.body=e.substr(g,Number(u.getHeader("content-length"))):u.body=e.substring(g),u}c.warn('error parsing first line of SIP message: "'+l+'"')}else c.warn("no CRLF found, not a SIP message, discarded")}}(t.Parser||(t.Parser={}))},928:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(266),o=n(813),a=n(346),c=n(852),u=n(557),l=n(41),d=function(e){function t(t,n,s,i){void 0===i&&(i={});var r=this;if(i.extraHeaders=(i.extraHeaders||[]).slice(),i.contentType=i.contentType||"text/plain","number"!=typeof i.expires||i.expires%1!=0?i.expires=3600:i.expires=Number(i.expires),"boolean"!=typeof i.unpublishOnClose&&(i.unpublishOnClose=!0),null==n||""===n)throw new c.Exceptions.MethodParameterError("Publish","Target",n);if(void 0===(n=t.normalizeTarget(n)))throw new c.Exceptions.MethodParameterError("Publish","Target",n);if((r=e.call(this,t,o.C.PUBLISH,n,i)||this).type=a.TypeStrings.PublishContext,r.options=i,r.target=n,null==s||""===s)throw new c.Exceptions.MethodParameterError("Publish","Event",s);return r.event=s,r.logger=t.getLogger("sip.publish"),r.pubRequestExpires=r.options.expires,t.on("transportCreated",(function(e){e.on("transportError",(function(){return r.onTransportError()}))})),r}return i(t,e),t.prototype.publish=function(e){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.options.body=e,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this),this.sendPublishRequest()},t.prototype.unpublish=function(){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,void 0!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.onRequestTimeout=function(){e.prototype.onRequestTimeout.call(this),this.emit("unpublished",void 0,o.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.prototype.onTransportError.call(this),this.emit("unpublished",void 0,o.C.causes.CONNECTION_ERROR)},t.prototype.receiveResponse=function(e){var t=this,n=e.statusCode||0,s=l.Utils.getReasonPhrase(n);switch(!0){case/^1[0-9]{2}$/.test(n.toString()):this.emit("progress",e,s);break;case/^2[0-9]{2}$/.test(n.toString()):if(e.hasHeader("SIP-ETag")?this.pubRequestEtag=e.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),e.hasHeader("Expires")){var i=Number(e.getHeader("Expires"));"number"==typeof i&&i>=0&&i<=this.pubRequestExpires?this.pubRequestExpires=i:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}else this.logger.warn("Expires header missing in a 200-class response to PUBLISH");0!==this.pubRequestExpires?(this.publishRefreshTimer=setTimeout((function(){return t.refreshRequest()}),900*this.pubRequestExpires),this.emit("published",e,s)):this.emit("unpublished",e,s);break;case/^412$/.test(n.toString()):void 0!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=void 0,this.emit("progress",e,s),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,s),this.emit("unpublished",e,s));break;case/^423$/.test(n.toString()):if(0!==this.pubRequestExpires&&e.hasHeader("Min-Expires")){var r=Number(e.getHeader("Min-Expires"));"number"==typeof r||r>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=r,this.emit("progress",e,s),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",e,s),this.emit("unpublished",e,s))}else this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,s),this.emit("unpublished",e,s);break;default:this.pubRequestExpires=0,this.emit("failed",e,s),this.emit("unpublished",e,s)}0===this.pubRequestExpires&&(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestEtag=void 0)},t.prototype.refreshRequest=function(){if(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,void 0===this.pubRequestEtag)throw new c.Exceptions.MethodParameterError("Publish","Body",void 0);if(0===this.pubRequestExpires)throw new c.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires);this.sendPublishRequest()},t.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice(),e.extraHeaders.push("Event: "+this.event),e.extraHeaders.push("Expires: "+this.pubRequestExpires),void 0!==this.pubRequestEtag&&e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new u.OutgoingRequest(o.C.PUBLISH,this.target,this.ua,this.options.params,e.extraHeaders),void 0!==this.pubRequestBody&&(this.request.body={},this.request.body.body=this.pubRequestBody,this.request.body.contentType=this.options.contentType),this.send()},t}(r.ClientContext);t.PublishContext=d},88:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(266),a=n(813),c=n(346),u=n(852),l=n(585),d=n(41);var g=function(e){function t(t,n){void 0===n&&(n={});var s=this,i=function(e){var t={expires:600,extraContactHeaderParams:[],instanceId:void 0,params:{},regId:void 0,registrar:void 0},n={mandatory:{},optional:{expires:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},extraContactHeaderParams:function(e){if(e instanceof Array)return e.filter((function(e){return"string"==typeof e}))},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===l.Grammar.parse(e,"uuid")?void 0:e},params:function(e){if("object"==typeof e)return e},regId:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},registrar:function(e){if("string"==typeof e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=l.Grammar.URIParse(e);return t?t.user?void 0:t:void 0}}}};for(var s in n.mandatory){if(!e.hasOwnProperty(s))throw new u.Exceptions.ConfigurationError(s);var i=e[s];if(void 0===(r=n.mandatory[s](i)))throw new u.Exceptions.ConfigurationError(s,i);t[s]=r}for(var s in n.optional)if(e.hasOwnProperty(s)){var r;if((i=e[s])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(r=n.optional[s](i)))throw new u.Exceptions.ConfigurationError(s,i);t[s]=r}return t}(n);if(i.regId&&!i.instanceId?i.instanceId=d.Utils.newUUID():!i.regId&&i.instanceId&&(i.regId=1),i.params.toUri=i.params.toUri||t.configuration.uri,i.params.toDisplayName=i.params.toDisplayName||t.configuration.displayName,i.params.callId=i.params.callId||d.Utils.createRandomToken(22),i.params.cseq=i.params.cseq||Math.floor(1e4*Math.random()),!i.registrar){var r={};"object"==typeof t.configuration.uri?(r=t.configuration.uri.clone()).user=void 0:r=t.configuration.uri,i.registrar=r}for(var o in(s=e.call(this,t,a.C.REGISTER,i.registrar,i)||this).type=c.TypeStrings.RegisterContext,s.options=i,s.logger=t.getLogger("sip.registercontext"),s.logger.log("configuration parameters for RegisterContext after validation:"),i)i.hasOwnProperty(o)&&s.logger.log("· "+o+": "+JSON.stringify(i[o]));return s.expires=i.expires,s.cseq=i.params.cseq,s.contact=t.contact.toString(),s.registered=!1,t.on("transportCreated",(function(e){e.on("disconnected",(function(){return s.onTransportDisconnected()}))})),s}return i(t,e),t.prototype.register=function(e){var t=this;void 0===e&&(e={}),this.options=r({},this.options,e);var n=(this.options.extraHeaders||[]).slice();n.push("Contact: "+this.generateContactHeader(this.expires)),n.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(e){if(e.cseq===t.cseq){void 0!==t.registrationTimer&&(clearTimeout(t.registrationTimer),t.registrationTimer=void 0);var n=(e.statusCode||0).toString();switch(!0){case/^1[0-9]{2}$/.test(n):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(n):t.emit("accepted",e);var s=void 0;e.hasHeader("expires")&&(s=Number(e.getHeader("expires"))),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0);var i=e.getHeaders("contact").length;if(!i){t.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(var r=void 0;i--;){if((r=e.parseHeader("contact",i)).uri.user===t.ua.contact.uri.user){s=r.getParam("expires");break}r=void 0}if(!r){t.logger.warn("no Contact header pointing to us, response ignored");break}void 0===s&&(s=t.expires),t.registrationTimer=setTimeout((function(){t.registrationTimer=void 0,t.register(t.options)}),1e3*s-3e3),t.registrationExpiredTimer=setTimeout((function(){t.logger.warn("registration expired"),t.registered&&t.unregistered(void 0,a.C.causes.EXPIRES)}),1e3*s),r.hasParam("temp-gruu")&&(t.ua.contact.temp_gruu=l.Grammar.URIParse(r.getParam("temp-gruu").replace(/"/g,""))),r.hasParam("pub-gruu")&&(t.ua.contact.pub_gruu=l.Grammar.URIParse(r.getParam("pub-gruu").replace(/"/g,""))),t.registered=!0,t.emit("registered",e||void 0);break;case/^423$/.test(n):e.hasHeader("min-expires")?(t.expires=Number(e.getHeader("min-expires")),t.register(t.options)):(t.logger.warn("423 response received for REGISTER without Min-Expires"),t.registrationFailure(e,a.C.causes.SIP_FAILURE_CODE));break;default:t.registrationFailure(e,d.Utils.sipErrorCause(e.statusCode||0))}}},this.onRequestTimeout=function(){t.registrationFailure(void 0,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){t.registrationFailure(void 0,a.C.causes.CONNECTION_ERROR)},this.cseq++,this.request&&(this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n),this.send()},t.prototype.close=function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered,this.registered&&this.unregister(e)},t.prototype.unregister=function(e){var t=this;void 0===e&&(e={}),this.registered||e.all||this.logger.warn("Already unregistered, but sending an unregister anyways.");var n=(e.extraHeaders||[]).slice();this.registered=!1,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),e.all?(n.push("Contact: *"),n.push("Expires: 0")):n.push("Contact: "+this.generateContactHeader(0)),this.receiveResponse=function(e){var n=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(n):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(n):t.emit("accepted",e),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0),t.unregistered(e);break;default:t.unregistered(e,d.Utils.sipErrorCause(e.statusCode||0))}},this.onRequestTimeout=function(){},this.cseq++,this.request&&(this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n),this.send()},t.prototype.unregistered=function(e,t){this.registered=!1,this.emit("unregistered",e||void 0,t||void 0)},t.prototype.registrationFailure=function(e,t){this.emit("failed",e||void 0,t||void 0)},t.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),void 0!==this.registrationExpiredTimer&&(clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=void 0),this.registered&&this.unregistered(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.generateContactHeader=function(e){void 0===e&&(e=0);var t=this.contact;return this.options.regId&&this.options.instanceId&&(t+=";reg-id="+this.options.regId,t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'),this.options.extraContactHeaderParams&&this.options.extraContactHeaderParams.forEach((function(e){t+=";"+e})),t+=";expires="+e},t}(o.ClientContext);t.RegisterContext=g},948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(813),i=n(346),r=n(615),o=function(){function e(e,t){this.type=i.TypeStrings.RequestSender,this.logger=t.getLogger("sip.requestsender"),this.ua=t,this.applicant=e,this.method=e.request.method,this.request=e.request,this.credentials=void 0,this.challenged=!1,this.staled=!1,t.status===i.UAStatus.STATUS_USER_CLOSED&&this.method!==s.C.BYE&&this.method!==s.C.ACK&&this.onTransportError()}return e.prototype.send=function(){if(!this.ua.transport)throw new Error("No transport to make transaction");switch(this.method){case"INVITE":this.clientTransaction=new r.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new r.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new r.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},e.prototype.onRequestTimeout=function(){this.applicant.onRequestTimeout()},e.prototype.onTransportError=function(){this.applicant.onTransportError()},e.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;if(401===t||407===t){var n=void 0,i=void 0;if(401===t?(n=e.parseHeader("www-authenticate"),i="authorization"):(n=e.parseHeader("proxy-authenticate"),i="proxy-authorization"),!n)return this.logger.warn(t+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(e);if(!this.challenged||!this.staled&&!0===n.stale){if(!this.credentials&&this.ua.configuration.authenticationFactory&&(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,n))return void this.applicant.receiveResponse(e);this.challenged=!0,n.stale&&(this.staled=!0);var r=void 0;e.method===s.C.REGISTER?r=this.applicant.cseq+=1:this.request.dialog?r=this.request.dialog.localSeqnum+=1:(r=(this.request.cseq||0)+1,this.request.cseq=r),this.request.setHeader("cseq",r+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(e)}else this.applicant.receiveResponse(e)},e}();t.RequestSender=o},557:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(813),o=n(346),a=n(585),c=n(41),u=function(e){var t=[];e.method===r.C.REGISTER?t.push("path","gruu"):e.method===r.C.INVITE&&(e.ua.contact.pubGruu||e.ua.contact.tempGruu)&&t.push("gruu"),e.ua.configuration.rel100===r.C.supported.SUPPORTED&&t.push("100rel"),e.ua.configuration.replaces===r.C.supported.SUPPORTED&&t.push("replaces"),t.push("outbound"),t=t.concat(e.ua.configuration.extraSupported||[]);var n=e.ua.configuration.hackAllowUnregisteredOptionTags||!1,s={};return"Supported: "+(t=t.filter((function(e){var t=r.C.OPTION_TAGS[e],i=!s[e];return s[e]=!0,(t||n)&&i}))).join(", ")+"\r\n"},l=function(){function e(e,t,n,s,i,r){void 0===s&&(s={}),this.type=o.TypeStrings.OutgoingRequest,this.logger=n.getLogger("sip.sipmessage"),this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=r,this.extraHeaders=(i||[]).slice(),this.statusCode=s.statusCode,this.reasonPhrase=s.reasonPhrase,s.routeSet?this.setHeader("route",s.routeSet):n.configuration.usePreloadedRoute&&n.transport&&this.setHeader("route",n.transport.server.sipUri),this.setHeader("via",""),this.setHeader("max-forwards","70");var u=s.toUri||t,l=s.toDisplayName||0===s.toDisplayName?'"'+s.toDisplayName+'" ':"";l+="<"+(u.type===o.TypeStrings.URI?u.toRaw():u)+">",l+=s.toTag?";tag="+s.toTag:"",this.to=a.Grammar.nameAddrHeaderParse(l),this.setHeader("to",l);var d,g=s.fromUri||n.configuration.uri||"";d=s.fromDisplayName||0===s.fromDisplayName?'"'+s.fromDisplayName+'" ':n.configuration.displayName?'"'+n.configuration.displayName+'" ':"",d+="<"+(g.type===o.TypeStrings.URI?g.toRaw():g)+">;tag=",d+=s.fromTag||c.Utils.newTag(),this.from=a.Grammar.nameAddrHeaderParse(d),this.setHeader("from",d),this.callId=s.callId||n.configuration.sipjsId+c.Utils.createRandomToken(15),this.setHeader("call-id",this.callId),this.cseq=s.cseq||Math.floor(1e4*Math.random()),this.setHeader("cseq",this.cseq+" "+e)}return e.prototype.setHeader=function(e,t){this.headers[c.Utils.headerize(e)]=t instanceof Array?t:[t]},e.prototype.getHeader=function(e){var t=this.headers[c.Utils.headerize(e)];if(t){if(t[0])return t[0]}else for(var n=new RegExp("^\\s*"+e+"\\s*:","i"),s=0,i=this.extraHeaders;s<i.length;s++){var r=i[s];if(n.test(r))return r.substring(r.indexOf(":")+1).trim()}},e.prototype.cancel=function(e,t){},e.prototype.getHeaders=function(e){var t=[],n=this.headers[c.Utils.headerize(e)];if(n)for(var s=0,i=n;s<i.length;s++){var r=i[s];t.push(r)}else for(var o=new RegExp("^\\s*"+e+"\\s*:","i"),a=0,u=this.extraHeaders;a<u.length;a++){var l=u[a];o.test(l)&&t.push(l.substring(l.indexOf(":")+1).trim())}return t},e.prototype.hasHeader=function(e){if(this.headers[c.Utils.headerize(e)])return!0;for(var t=new RegExp("^\\s*"+e+"\\s*:","i"),n=0,s=this.extraHeaders;n<s.length;n++){var i=s[n];if(t.test(i))return!0}return!1},e.prototype.toString=function(){var e="";for(var t in e+=this.method+" "+(this.ruri.type===o.TypeStrings.URI?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)if(this.headers[t])for(var n=0,s=this.headers[t];n<s.length;n++)e+=t+": "+s[n]+"\r\n";for(var i=0,r=this.extraHeaders;i<r.length;i++)e+=(t=r[i]).trim()+"\r\n";return e+=u(this),e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+c.Utils.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+c.Utils.str_utf8_length(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e},e}();t.OutgoingRequest=l;var d=function(){function e(){this.type=o.TypeStrings.IncomingMessage,this.headers={}}return e.prototype.addHeader=function(e,t){var n={raw:t};e=c.Utils.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]},e.prototype.getHeader=function(e){var t=this.headers[c.Utils.headerize(e)];if(t)return t[0]?t[0].raw:void 0},e.prototype.getHeaders=function(e){var t=this.headers[c.Utils.headerize(e)],n=[];if(!t)return[];for(var s=0,i=t;s<i.length;s++){var r=i[s];n.push(r.raw)}return n},e.prototype.hasHeader=function(e){return!!this.headers[c.Utils.headerize(e)]},e.prototype.parseHeader=function(e,t){if(void 0===t&&(t=0),e=c.Utils.headerize(e),this.headers[e]&&!(t>=this.headers[e].length)){var n=this.headers[e][t],s=n.raw;if(n.parsed)return n.parsed;var i=a.Grammar.parse(s,e.replace(/-/g,"_"));return-1===i?void this.headers[e].splice(t,1):(n.parsed=i,i)}},e.prototype.s=function(e,t){return void 0===t&&(t=0),this.parseHeader(e,t)},e.prototype.setHeader=function(e,t){this.headers[c.Utils.headerize(e)]=[{raw:t}]},e.prototype.toString=function(){return this.data},e}(),g=function(e){function t(t){var n=e.call(this)||this;return n.type=o.TypeStrings.IncomingRequest,n.logger=t.getLogger("sip.sipmessage"),n.ua=t,n}return i(t,e),t.prototype.reply=function(e,t,n,s,i,o){var a=c.Utils.buildStatusLine(e,t);if(n=(n||[]).slice(),this.method===r.C.INVITE&&e>100&&e<=200)for(var l=0,d=this.getHeaders("record-route");l<d.length;l++)a+="Record-Route: "+d[l]+"\r\n";for(var g=0,p=this.getHeaders("via");g<p.length;g++)a+="Via: "+p[g]+"\r\n";var h=this.getHeader("to")||"";!this.toTag&&e>100?h+=";tag="+c.Utils.newTag():this.toTag&&!this.s("to").hasParam("tag")&&(h+=";tag="+this.toTag),a+="To: "+h+"\r\n",a+="From: "+this.getHeader("From")+"\r\n",a+="Call-ID: "+this.callId+"\r\n",a+="CSeq: "+this.cseq+" "+this.method+"\r\n";for(var f=0,S=n;f<S.length;f++)a+=S[f].trim()+"\r\n";return a+=u(this),a+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",s?"string"==typeof s?(a+="Content-Type: application/sdp\r\n",a+="Content-Length: "+c.Utils.str_utf8_length(s)+"\r\n\r\n",a+=s):s.body&&s.contentType?(a+="Content-Type: "+s.contentType+"\r\n",a+="Content-Length: "+c.Utils.str_utf8_length(s.body)+"\r\n\r\n",a+=s.body):a+="Content-Length: 0\r\n\r\n":a+="Content-Length: 0\r\n\r\n",this.serverTransaction&&this.serverTransaction.receiveResponse(e,a).then(i,o),a},t.prototype.reply_sl=function(e,t){for(var n=c.Utils.buildStatusLine(e,t),s=0,i=this.getHeaders("via");s<i.length;s++)n+="Via: "+i[s]+"\r\n";var r=this.getHeader("To")||"";!this.toTag&&e>100?r+=";tag="+c.Utils.newTag():this.toTag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.toTag),n+="To: "+r+"\r\n",n+="From: "+this.getHeader("From")+"\r\n",n+="Call-ID: "+this.callId+"\r\n",n+="CSeq: "+this.cseq+" "+this.method+"\r\n",n+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",n+="Content-Length: 0\r\n\r\n",this.transport&&this.transport.send(n)},t}(d);t.IncomingRequest=g;var p=function(e){function t(t){var n=e.call(this)||this;return n.type=o.TypeStrings.IncomingResponse,n.logger=t.getLogger("sip.sipmessage"),n.headers={},n}return i(t,e),t}(d);t.IncomingResponse=p},54:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(813),i=n(346),r=n(41);!function(e){function t(e,t,n){for(var s=r.Utils.buildStatusLine(e),i=0,o=t.getHeaders("via");i<o.length;i++)s+="Via: "+o[i]+"\r\n";var a=t.getHeader("To")||"";t.toTag||(a+=";tag="+r.Utils.newTag()),s+="To: "+a+"\r\n",s+="From: "+t.getHeader("From")+"\r\n",s+="Call-ID: "+t.callId+"\r\n",s+="CSeq: "+t.cseq+" "+t.method+"\r\n",s+="\r\n",n.send(s)}function n(e,n,s){return!(!e.ruri||"sip"!==e.ruri.scheme)||(t(416,e,s),!1)}function o(e,n,s){return!(!e.toTag&&e.callId.substr(0,5)===n.configuration.sipjsId&&(t(482,e,s),1))}function a(e,n,s){var i=r.Utils.str_utf8_length(e.body),o=e.getHeader("content-length");return!(o&&i<Number(o)&&(t(400,e,s),1))}function c(e,n,i){var r=e.fromTag,o=e.callId,a=e.cseq;if(!e.toTag)if(e.method===s.C.INVITE){if(n.transactions.ist[e.viaBranch])return!0;for(var c in n.transactions.ist)if(n.transactions.ist.hasOwnProperty(c)&&(u=n.transactions.ist[c]).request.fromTag===r&&u.request.callId===o&&u.request.cseq===a)return t(482,e,i),!1}else{if(n.transactions.nist[e.viaBranch])return!0;for(var c in n.transactions.nist){var u;if(n.transactions.nist.hasOwnProperty(c)&&(u=n.transactions.nist[c]).request.fromTag===r&&u.request.callId===o&&u.request.cseq===a)return t(482,e,i),!1}}return!0}function u(e,t){return!(e.getHeaders("via").length>1&&(t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),1))}function l(e,t){return e.via.host===t.configuration.viaHost&&void 0===e.via.port||(t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1)}function d(e,t){var n=r.Utils.str_utf8_length(e.body),s=e.getHeader("content-length");return!(s&&n<Number(s)&&(t.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),1))}function g(e,t){for(var n=0,s=["from","to","call_id","cseq","via"];n<s.length;n++){var i=s[n];if(!e.hasHeader(i))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+i+". Dropping the response"),!1}return!0}e.reply=t,e.rfc3261_8_2_2_1=n,e.rfc3261_16_3_4=o,e.rfc3261_18_3_request=a,e.rfc3261_8_2_2_2=c,e.rfc3261_8_1_3_3=u,e.rfc3261_18_1_2=l,e.rfc3261_18_3_response=d,e.minimumHeaders=g,e.sanityCheck=function(e,t,s){for(var r=[n,o,a,c],p=[u,l,d],h=0,f=[g];h<f.length;h++)if(!(0,f[h])(e,t,s))return!1;if(e.type===i.TypeStrings.IncomingRequest){for(var S=0,T=r;S<T.length;S++)if(!(0,T[S])(e,t,s))return!1}else if(e.type===i.TypeStrings.IncomingResponse)for(var m=0,_=p;m<_.length;m++)if(!(0,_[m])(e,t,s))return!1;return!0}}(t.SanityCheck||(t.SanityCheck={}))},598:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(813),a=n(346),c=n(585),u=n(615),l=n(41),d=function(e){function t(n,s){var i=e.call(this)||this;return i.data={},t.initializer(i,n,s),i}return i(t,e),t.initializer=function(e,t,n){if(e.type=a.TypeStrings.ServerContext,e.ua=t,e.logger=t.getLogger("sip.servercontext"),e.request=n,n.method===o.C.INVITE?e.transaction=new u.InviteServerTransaction(n,t):e.transaction=new u.NonInviteServerTransaction(n,t),n.body&&(e.body=n.body),n.hasHeader("Content-Type")&&(e.contentType=n.getHeader("Content-Type")),e.method=n.method,e.localIdentity=n.to,e.remoteIdentity=n.from,n.hasHeader("P-Asserted-Identity")){var s=n.getHeader("P-Asserted-Identity");s&&(e.assertedIdentity=c.Grammar.nameAddrHeaderParse(s))}},t.prototype.progress=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||180,e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||200,e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||480,e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(e){var t=this;void 0===e&&(e={});var n=e.statusCode||100,s=e.minCode||100,i=e.maxCode||699,r=l.Utils.getReasonPhrase(n,e.reasonPhrase),o=e.extraHeaders||[],a=e.body,c=e.events||[];if(n<s||n>i)throw new TypeError("Invalid statusCode: "+n);var u=this.request.reply(n,r,o,a);return c.forEach((function(e){t.emit(e,u,r)})),this},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,o.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,o.C.causes.CONNECTION_ERROR)},t}(r.EventEmitter);t.ServerContext=d},36:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(266),a=n(813),c=n(321),u=n(346),l=n(852),d=n(585),g=n(948),p=n(598),h=n(344),f=n(557),S=n(312),T=n(41),m=function(e){function t(n){var s=e.call(this)||this;if(s.data={},s.type=u.TypeStrings.Session,!n)throw new l.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function");return s.status=t.C.STATUS_NULL,s.dialog=void 0,s.pendingReinvite=!1,s.earlyDialogs={},s.sessionDescriptionHandlerFactory=n,s.hasOffer=!1,s.hasAnswer=!1,s.timers={ackTimer:void 0,expiresTimer:void 0,invite2xxTimer:void 0,userNoAnswerTimer:void 0,rel1xxTimer:void 0,prackTimer:void 0},s.startTime=void 0,s.endTime=void 0,s.tones=void 0,s.localHold=!1,s.earlySdp=void 0,s.rel100=a.C.supported.UNSUPPORTED,s.originalReceiveRequest=s.receiveRequest,s}return i(t,e),t.prototype.dtmf=function(e,t){var n=this;if(void 0===t&&(t={}),this.status!==u.SessionStatus.STATUS_CONFIRMED&&this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK)throw new l.Exceptions.InvalidStateError(this.status);if(!e||!e.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);var s=function(){if(n.status!==u.SessionStatus.STATUS_TERMINATED&&n.tones&&0!==n.tones.length){var e,i=n.tones.shift();","===i.tone?e=2e3:(i.on("failed",(function(){n.tones=void 0})),i.send(t),e=i.duration+i.interToneGap),setTimeout(s,e)}else n.tones=void 0};e=e.toString();var i=this.ua.configuration.dtmfType;if(this.sessionDescriptionHandler&&i===a.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(e,t)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),i=a.C.dtmfType.INFO)),i===a.C.dtmfType.INFO){for(var r=[],o=e.split("");o.length>0;)r.push(new h.DTMF(this,o.shift(),t));if(this.tones)return this.tones=this.tones.concat(r),this;this.tones=r,s()}return this},t.prototype.bye=function(e){if(void 0===e&&(e={}),this.status===u.SessionStatus.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||t>=700))throw new TypeError("Invalid statusCode: "+t);return e.receiveResponse=function(){},this.sendRequest(a.C.BYE,e).terminated()},t.prototype.refer=function(e,t){if(void 0===t&&(t={}),this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new l.Exceptions.InvalidStateError(this.status);return this.referContext=new C(this.ua,this,e,t),this.emit("referRequested",this.referContext),this.referContext.refer(t),this.referContext},t.prototype.sendRequest=function(e,t){var n=this;if(void 0===t&&(t={}),t=t||{},!this.dialog)throw new Error("sending request without a dialog");var s=new f.OutgoingRequest(e,this.dialog.remoteTarget,this.ua,{cseq:t.cseq||(this.dialog.localSeqnum+=1),callId:this.dialog.id.callId,fromUri:this.dialog.localUri,fromTag:this.dialog.id.localTag,ToUri:this.dialog.remoteUri,toTag:this.dialog.id.remoteTag,routeSet:this.dialog.routeSet,statusCode:t.statusCode,reasonPhrase:t.reasonPhrase},t.extraHeaders||[],t.body);return new g.RequestSender({request:s,onRequestTimeout:function(){return n.onRequestTimeout()},onTransportError:function(){return n.onTransportError()},receiveResponse:function(e){return(t.receiveResponse||n.receiveNonInviteResponse.bind(n))(e)}},this.ua).send(),this.emit(e.toLowerCase(),s),this},t.prototype.close=function(){if(this.status===u.SessionStatus.STATUS_TERMINATED)return this;for(var e in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)this.timers[e]&&clearTimeout(this.timers[e]);for(var t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs.hasOwnProperty(t)&&(this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t]);return this.status=u.SessionStatus.STATUS_TERMINATED,this.ua.transport&&this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},t.prototype.createDialog=function(e,t,n){void 0===n&&(n=!1);var s,i=e["UAS"===t?"toTag":"fromTag"],r=e["UAS"===t?"fromTag":"toTag"],o=e.callId+i+r;if(n)return!!this.earlyDialogs[o]||((s=new c.Dialog(this,e,t,c.Dialog.C.STATUS_EARLY)).error?(this.logger.error(s.error),this.failed(e,a.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[o]=s,!0));if(s=this.earlyDialogs[o]){for(var u in s.update(e,t),this.dialog=s,delete this.earlyDialogs[o],this.earlyDialogs)this.earlyDialogs.hasOwnProperty(u)&&(this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u]);return!0}var l=new c.Dialog(this,e,t);return l.error?(this.logger.error(l.error),this.failed(e,a.C.causes.INTERNAL_ERROR),!1):(this.toTag=e.toTag,this.dialog=l,!0)},t.prototype.hold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new l.Exceptions.InvalidStateError(this.status);this.localHold?this.logger.log("Session is already on hold, cannot put it on hold again"):(e.modifiers=t,this.sessionDescriptionHandler&&e.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.localHold=!0,this.sendReinvite(e))},t.prototype.unhold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new l.Exceptions.InvalidStateError(this.status);this.localHold?(e.modifiers=t,this.localHold=!1,this.sendReinvite(e)):this.logger.log("Session is not on hold, cannot unhold it")},t.prototype.reinvite=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=[]),e.modifiers=t,this.sendReinvite(e)},t.prototype.receiveRequest=function(e){switch(e.method){case a.C.BYE:e.reply(200),this.status===u.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e),this.terminated(e,a.C.BYE));break;case a.C.INVITE:this.status===u.SessionStatus.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case a.C.INFO:if(this.status===u.SessionStatus.STATUS_CONFIRMED||this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(e);var t=e.getHeader("content-type");if(t)if(t.match(/^application\/dtmf-relay/i)){if(e.body){var n=e.body.split("\r\n",2);if(2===n.length){var s=void 0,i=void 0,r=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;r.test(n[0])&&(s=n[0].replace(r,"$2"));var o=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;o.test(n[1])&&(i=parseInt(n[1].replace(o,"$2"),10)),s&&i&&new h.DTMF(this,s,{duration:i}).init_incoming(e)}}}else e.reply(415,void 0,["Accept: application/dtmf-relay"])}break;case a.C.REFER:if(this.status===u.SessionStatus.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new v(this.ua,e),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var c={followRefer:!0};this.passedOptions&&(c.inviteOptions=this.passedOptions),this.referContext.accept(c,this.modifiers)}break;case a.C.NOTIFY:if(this.referContext&&this.referContext.type===u.TypeStrings.ReferClientContext&&e.hasHeader("event")&&/^refer(;.*)?$/.test(e.getHeader("event")))return void this.referContext.receiveNotify(e);e.reply(200,"OK"),this.emit("notify",e)}},t.prototype.terminate=function(e){return this},t.prototype.onTransportError=function(){this.status!==u.SessionStatus.STATUS_CONFIRMED&&this.status!==u.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.onRequestTimeout=function(){this.status===u.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT):this.status!==u.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,a.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT))},t.prototype.onDialogError=function(e){this.status===u.SessionStatus.STATUS_CONFIRMED?this.terminated(e,a.C.causes.DIALOG_ERROR):this.status!==u.SessionStatus.STATUS_TERMINATED&&(this.failed(e,a.C.causes.DIALOG_ERROR),this.terminated(e,a.C.causes.DIALOG_ERROR))},t.prototype.receiveReinvite=function(e){var t,n=this;if(this.emit("reinvite",this,e),e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),this.sessionDescriptionHandler){if("0"!==e.getHeader("Content-Length")||e.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||""))return e.reply(415),void this.emit("reinviteFailed",this);t=this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else t=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(e){e.method===a.C.ACK&&n.status===u.SessionStatus.STATUS_WAITING_FOR_ACK?n.sessionDescriptionHandler&&n.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(n.hasAnswer=!0,n.sessionDescriptionHandler.setDescription(e.body,n.sessionDescriptionHandlerOptions,n.modifiers).then((function(){clearTimeout(n.timers.ackTimer),clearTimeout(n.timers.invite2xxTimer),n.status=u.SessionStatus.STATUS_CONFIRMED,n.emit("confirmed",e)}))):(clearTimeout(n.timers.ackTimer),clearTimeout(n.timers.invite2xxTimer),n.status=u.SessionStatus.STATUS_CONFIRMED,n.emit("confirmed",e)):n.originalReceiveRequest(e)},t.catch((function(t){var s;throw t.type===u.TypeStrings.SessionDescriptionHandlerError?s=500:t.type===u.TypeStrings.RenegotiationError?(n.emit("renegotiationError",t),n.logger.warn(t.toString()),s=488):(n.logger.error(t),s=488),e.reply(s),n.emit("reinviteFailed",n),t})).then((function(t){var s=["Contact: "+n.contact];e.reply(200,void 0,s,t,(function(){n.status=u.SessionStatus.STATUS_WAITING_FOR_ACK,n.setACKTimer(),n.emit("reinviteAccepted",n)}))}))}else this.logger.warn("No SessionDescriptionHandler to reinvite")},t.prototype.sendReinvite=function(e){var t=this;if(void 0===e&&(e={}),this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else if(this.sessionDescriptionHandler){this.pendingReinvite=!0,e.modifiers=e.modifiers||[];var n=(e.extraHeaders||[]).slice();n.push("Contact: "+this.contact),n.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then((function(e){t.sendRequest(a.C.INVITE,{extraHeaders:n,body:e,receiveResponse:function(e){return t.receiveReinviteResponse(e)}})})).catch((function(e){if(e.type===u.TypeStrings.RenegotiationError)throw t.pendingReinvite=!1,t.emit("renegotiationError",e),t.logger.warn("Renegotiation Error"),t.logger.warn(e.toString()),e;throw t.logger.error("sessionDescriptionHandler error"),t.logger.error(e),e}))}else this.logger.warn("No SessionDescriptionHandler, can't reinvite..")},t.prototype.receiveReinviteResponse=function(e){var t=this;if(this.status!==u.SessionStatus.STATUS_TERMINATED)if(this.pendingReinvite){var n=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(n):break;case/^2[0-9]{2}$/.test(n):if(this.status=u.SessionStatus.STATUS_CONFIRMED,this.emit("ack",e.transaction.sendACK()),this.pendingReinvite=!1,clearTimeout(this.timers.invite2xxTimer),!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",this),this.emit("renegotiationError",new l.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch((function(e){throw t.logger.error("Could not set the description in 2XX response"),t.logger.error(e),t.emit("reinviteFailed",t),t.emit("renegotiationError",e),t.sendRequest(a.C.BYE,{extraHeaders:["Reason: "+T.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),t.terminated(void 0,a.C.causes.INCOMPATIBLE_SDP),e})).then((function(){t.emit("reinviteAccepted",t)}));break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",this),this.emit("renegotiationError",new l.Exceptions.RenegotiationError("Invalid response to a re-invite"))}}else this.logger.error("Received reinvite response, but have no pending reinvite");else this.logger.error("Received reinvite response, but in STATUS_TERMINATED")},t.prototype.acceptAndTerminate=function(e,t,n){var s=[];return t&&s.push("Reason: "+T.Utils.getReasonHeaderValue(t,n)),(this.dialog||this.createDialog(e,"UAC"))&&(this.emit("ack",e.transaction.sendACK()),this.sendRequest(a.C.BYE,{extraHeaders:s})),this},t.prototype.setInvite2xxTimer=function(e,t){var n=this,s=S.Timers.T1,i=function(){if(n.status===u.SessionStatus.STATUS_WAITING_FOR_ACK){n.logger.log("no ACK received, attempting to retransmit OK");var r=["Contact: "+n.contact];e.reply(200,void 0,r,t),s=Math.min(2*s,S.Timers.T2),n.timers.invite2xxTimer=setTimeout(i,s)}};this.timers.invite2xxTimer=setTimeout(i,s)},t.prototype.setACKTimer=function(){var e=this;this.timers.ackTimer=setTimeout((function(){e.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(e.logger.log("no ACK received for an extended period of time, terminating the call"),clearTimeout(e.timers.invite2xxTimer),e.sendRequest(a.C.BYE),e.terminated(void 0,a.C.causes.NO_ACK))}),S.Timers.TIMER_H)},t.prototype.failed=function(e,t){return this.status===u.SessionStatus.STATUS_TERMINATED||this.emit("failed",e,t),this},t.prototype.rejected=function(e,t){return this.emit("rejected",e,t),this},t.prototype.canceled=function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},t.prototype.accepted=function(e,t){return e instanceof String||(t=T.Utils.getReasonPhrase(e&&e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",e,t),this},t.prototype.terminated=function(e,t){return this.status===u.SessionStatus.STATUS_TERMINATED||(this.endTime=new Date,this.close(),this.emit("terminated",e,t)),this},t.prototype.connecting=function(e){return this.emit("connecting",{request:e}),this},t.prototype.receiveNonInviteResponse=function(e){},t.C=u.SessionStatus,t}(r.EventEmitter);t.Session=m;var _=function(e){function t(t,n){var s=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ISC Constructor Failed");s=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,p.ServerContext.initializer(s,t,n),s.type=u.TypeStrings.InviteServerContext;var i=n.parseHeader("Content-Disposition");i&&"render"===i.type&&(s.renderbody=n.body,s.rendertype=n.getHeader("Content-Type")),s.status=u.SessionStatus.STATUS_INVITE_RECEIVED,s.fromTag=n.fromTag,s.id=n.callId+s.fromTag,s.request=n,s.contact=s.ua.contact.toString(),s.receiveNonInviteResponse=function(){},s.logger=t.getLogger("sip.inviteservercontext",s.id),s.ua.sessions[s.id]=s;var r=function(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(s.rel100=t)};if(r("require",a.C.supported.REQUIRED),r("supported",a.C.supported.SUPPORTED),n.toTag=T.Utils.newTag(),s.createDialog(n,"UAS",!0)){var o={extraHeaders:["Contact: "+s.contact]};if(s.rel100!==a.C.supported.REQUIRED&&s.progress(o),s.status=u.SessionStatus.STATUS_WAITING_FOR_ANSWER,s.timers.userNoAnswerTimer=setTimeout((function(){n.reply(408),s.failed(n,a.C.causes.NO_ANSWER),s.terminated(n,a.C.causes.NO_ANSWER)}),s.ua.configuration.noAnswerTimeout||60),n.hasHeader("expires")){var c=1e3*Number(n.getHeader("expires")||0);s.timers.expiresTimer=setTimeout((function(){s.status===u.SessionStatus.STATUS_WAITING_FOR_ANSWER&&(n.reply(487),s.failed(n,a.C.causes.EXPIRES),s.terminated(n,a.C.causes.EXPIRES))}),c)}return s.errorListener=s.onTransportError.bind(s),t.transport&&t.transport.on("transportError",s.errorListener),s}n.reply(500,"Missing Contact header field")}return i(t,e),t.prototype.reject=function(e){var t=this;if(void 0===e&&(e={}),this.status===u.SessionStatus.STATUS_TERMINATED)throw new l.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");var n=e.statusCode||480,s=T.Utils.getReasonPhrase(n,e.reasonPhrase),i=e.extraHeaders||[];if(n<300||n>699)throw new TypeError("Invalid statusCode: "+n);var r=this.request.reply(n,s,i,e.body);return["rejected","failed"].forEach((function(e){t.emit(e,r,s)})),this.terminated()},t.prototype.reply=function(e){return void 0===e&&(e={}),this},t.prototype.terminate=function(e){var t=this;void 0===e&&(e={});var n=(e.extraHeaders||[]).slice();if(this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.request.serverTransaction&&this.request.serverTransaction.state!==u.TransactionStatus.STATUS_TERMINATED){var s=this.dialog;this.receiveRequest=function(e){e.method===a.C.ACK&&(t.sendRequest(a.C.BYE,{extraHeaders:n}),t.dialog&&t.dialog.terminate())},this.request.serverTransaction.on("stateChanged",(function(){t.request.serverTransaction&&t.request.serverTransaction.state===u.TransactionStatus.STATUS_TERMINATED&&t.dialog&&(t.bye(),t.dialog.terminate())})),this.emit("bye",this.request),this.terminated(),this.dialog=s,this.dialog&&(this.ua.dialogs[this.dialog.id.toString()]=this.dialog)}else this.status===u.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.reject(e);return this},t.prototype.progress=function(e){var t=this;void 0===e&&(e={});var n=e.statusCode||180,s=(e.extraHeaders||[]).slice();if(n<100||n>199)throw new TypeError("Invalid statusCode: "+n);if(this.status===u.SessionStatus.STATUS_TERMINATED)return this;var i,r=function(){var n=e.statusCode||183;t.status=u.SessionStatus.STATUS_WAITING_FOR_PRACK,s.push("Contact: "+t.contact),s.push("Require: 100rel"),s.push("RSeq: "+Math.floor(1e4*Math.random())),t.sessionDescriptionHandler?t.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then((function(i){if(t.status!==u.SessionStatus.STATUS_TERMINATED){t.earlySdp=i.body,t[t.hasOffer?"hasAnswer":"hasOffer"]=!0;var r=S.Timers.T1,o=function(){t.request.reply(n,void 0,s,i),r*=2,t.timers.rel1xxTimer=setTimeout(o,r)};t.timers.rel1xxTimer=setTimeout(o,r),t.timers.prackTimer=setTimeout((function(){t.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK&&(t.logger.log("no PRACK received, rejecting the call"),clearTimeout(t.timers.rel1xxTimer),t.request.reply(504),t.terminated(void 0,a.C.causes.NO_PRACK))}),64*S.Timers.T1);var c=t.request.reply(n,e.reasonPhrase,s,i);t.emit("progress",c,e.reasonPhrase)}}),(function(){t.request.reply(480),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR)})):t.logger.warn("No SessionDescriptionHandler, can't do 100rel")};return 100!==e.statusCode&&(this.rel100===a.C.supported.REQUIRED||this.rel100===a.C.supported.SUPPORTED&&e.rel100||this.rel100===a.C.supported.SUPPORTED&&this.ua.configuration.rel100===a.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||"")?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,e.sessionDescriptionHandlerOptions,e.modifiers).then(r).catch((function(e){throw t.logger.warn("invalid description"),t.logger.warn(e),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR),e}))):r()):(i=t.request.reply(n,e.reasonPhrase,s,e.body),t.emit("progress",i,e.reasonPhrase)),this},t.prototype.accept=function(e){var t=this;void 0===e&&(e={}),this.onInfo=e.onInfo;var n=(e.extraHeaders||[]).slice(),s=function(e){n.push("Contact: "+t.contact),n.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.hasOffer?t.hasAnswer=!0:t.hasOffer=!0;var s=t.request.reply(200,void 0,n,e,(function(){t.status=u.SessionStatus.STATUS_WAITING_FOR_ACK,t.setInvite2xxTimer(t.request,e),t.setACKTimer()}),(function(){t.failed(void 0,a.C.causes.CONNECTION_ERROR),t.terminated(void 0,a.C.causes.CONNECTION_ERROR)}));t.status!==u.SessionStatus.STATUS_TERMINATED&&t.accepted(s,T.Utils.getReasonPhrase(200))},i=function(e){throw e.type===u.TypeStrings.SessionDescriptionHandlerError&&(t.logger.log(e.message),e.error&&t.logger.log(e.error)),t.request.reply(480),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR),e};if(this.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK)return this.status=u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===u.SessionStatus.STATUS_WAITING_FOR_ANSWER)this.status=u.SessionStatus.STATUS_ANSWERED;else if(this.status!==u.SessionStatus.STATUS_EARLY_MEDIA)throw new l.Exceptions.InvalidStateError(this.status);if(!this.createDialog(this.request,"UAS"))return this.request.reply(500,"Missing Contact header field"),this;if(clearTimeout(this.timers.userNoAnswerTimer),this.status===u.SessionStatus.STATUS_EARLY_MEDIA)s({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||""))return this.request.reply(415),this;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,e.sessionDescriptionHandlerOptions,e.modifiers).then((function(){if(!t.sessionDescriptionHandler)throw new Error("No SDH");return t.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers)})).catch(i).then(s)}else this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).catch(i).then(s);return this},t.prototype.receiveRequest=function(e){var t=this,n=function(){clearTimeout(t.timers.ackTimer),clearTimeout(t.timers.invite2xxTimer),t.status=u.SessionStatus.STATUS_CONFIRMED;var n=e.getHeader("Content-Disposition");n&&"render"===n.type&&(t.renderbody=e.body,t.rendertype=e.getHeader("Content-Type")),t.emit("confirmed",e)};switch(e.method){case a.C.CANCEL:this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER&&this.status!==u.SessionStatus.STATUS_WAITING_FOR_PRACK&&this.status!==u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==u.SessionStatus.STATUS_EARLY_MEDIA&&this.status!==u.SessionStatus.STATUS_ANSWERED||(this.status=u.SessionStatus.STATUS_CANCELED,this.request.reply(487),this.canceled(),this.rejected(e,a.C.causes.CANCELED),this.failed(e,a.C.causes.CANCELED),this.terminated(e,a.C.causes.CANCELED));break;case a.C.ACK:this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(this.status=u.SessionStatus.STATUS_CONFIRMED,this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch((function(n){throw t.logger.warn(n),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION),n})).then((function(){return n()}))):n());break;case a.C.PRACK:this.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(clearTimeout(this.timers.rel1xxTimer),clearTimeout(this.timers.prackTimer),e.reply(200),this.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.SessionStatus.STATUS_EARLY_MEDIA,this.accept()),this.status=u.SessionStatus.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){clearTimeout(t.timers.rel1xxTimer),clearTimeout(t.timers.prackTimer),e.reply(200),t.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.accept()),t.status=u.SessionStatus.STATUS_EARLY_MEDIA}),(function(n){t.logger.warn(n),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION)}))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===u.SessionStatus.STATUS_EARLY_MEDIA&&e.reply(200);break;default:m.prototype.receiveRequest.apply(this,[e])}},t.prototype.setupSessionDescriptionHandler=function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},t}(m);t.InviteServerContext=_;var I=function(e){function t(t,n,s,i){void 0===s&&(s={}),void 0===i&&(i=[]);var r=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ICC Constructor Failed");s.params=s.params||{};var c=s.anonymous||!1,d=T.Utils.newTag();s.params.fromTag=d;var g=t.contact.toString({anonymous:c,outbound:c?!t.contact.temp_gruu:!t.contact.pub_gruu}),p=(s.extraHeaders||[]).slice();if(c&&t.configuration.uri&&(s.params.from_displayName="Anonymous",s.params.from_uri="sip:anonymous@anonymous.invalid",p.push("P-Preferred-Identity: "+t.configuration.uri.toString()),p.push("Privacy: id")),p.push("Contact: "+g),p.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.configuration.rel100===a.C.supported.REQUIRED&&p.push("Require: 100rel"),t.configuration.replaces===a.C.supported.REQUIRED&&p.push("Require: replaces"),s.extraHeaders=p,r=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,o.ClientContext.initializer(r,t,a.C.INVITE,n,s),r.type=u.TypeStrings.InviteClientContext,r.passedOptions=s,r.sessionDescriptionHandlerOptions=s.sessionDescriptionHandlerOptions||{},r.modifiers=i,r.inviteWithoutSdp=s.inviteWithoutSdp||!1,r.anonymous=s.anonymous||!1,r.renderbody=s.renderbody||void 0,r.rendertype=s.rendertype||"text/plain",r.fromTag=d,r.contact=g,r.status!==u.SessionStatus.STATUS_NULL)throw new l.Exceptions.InvalidStateError(r.status);return r.isCanceled=!1,r.received100=!1,r.method=a.C.INVITE,r.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[r.toString()]=r,r.id=r.request.callId+r.fromTag,r.onInfo=s.onInfo,r.errorListener=r.onTransportError.bind(r),t.transport&&t.transport.on("transportError",r.errorListener),r}return i(t,e),t.prototype.receiveNonInviteResponse=function(e){this.receiveInviteResponse(e)},t.prototype.receiveResponse=function(e){this.receiveInviteResponse(e)},t.prototype.send=function(){return new g.RequestSender(this,this.ua).send(),this},t.prototype.invite=function(){var e=this;return this.ua.sessions[this.id]=this,Promise.resolve().then((function(){e.inviteWithoutSdp?(e.request.body=e.renderbody,e.status=u.SessionStatus.STATUS_INVITE_SENT,e.send()):(e.sessionDescriptionHandler=e.sessionDescriptionHandlerFactory(e,e.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),e.emit("SessionDescriptionHandler-created",e.sessionDescriptionHandler),e.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then((function(t){e.isCanceled||e.status===u.SessionStatus.STATUS_TERMINATED||(e.hasOffer=!0,e.request.body=t,e.status=u.SessionStatus.STATUS_INVITE_SENT,e.send())}),(function(t){t.type===u.TypeStrings.SessionDescriptionHandlerError&&(e.logger.log(t.message),t.error&&e.logger.log(t.error)),e.status!==u.SessionStatus.STATUS_TERMINATED&&(e.failed(void 0,a.C.causes.WEBRTC_ERROR),e.terminated(void 0,a.C.causes.WEBRTC_ERROR))})))})),this},t.prototype.receiveInviteResponse=function(e){var t=this;if(this.status!==u.SessionStatus.STATUS_TERMINATED&&e.method===a.C.INVITE){var n=e.callId+e.fromTag+e.toTag,s=[];if(this.dialog&&e.statusCode&&e.statusCode>=200&&e.statusCode<=299){if(n!==this.dialog.id.toString()){if(!this.createDialog(e,"UAC",!0))return;return this.emit("ack",e.transaction.sendACK({body:T.Utils.generateFakeSDP(e.body)})),this.earlyDialogs[n].sendRequest(this,a.C.BYE),void(this.status!==u.SessionStatus.STATUS_CONFIRMED&&(this.failed(e,a.C.causes.WEBRTC_ERROR),this.terminated(e,a.C.causes.WEBRTC_ERROR)))}if(this.status===u.SessionStatus.STATUS_CONFIRMED)return void this.emit("ack",e.transaction.sendACK());if(!this.hasAnswer)return}var i=e&&e.statusCode;if(this.dialog&&i&&i<200){var r=e.getHeader("rseq");if(r&&(-1!==this.dialog.pracked.indexOf(r)||Number(this.dialog.pracked[this.dialog.pracked.length-1])>=Number(r)&&this.dialog.pracked.length>0))return;if(!this.earlyDialogs[n]&&!this.createDialog(e,"UAC",!0))return;if(-1!==this.earlyDialogs[n].pracked.indexOf(e.getHeader("rseq"))||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=Number(r)&&this.earlyDialogs[n].pracked.length>0)return;return s.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[n].pracked.push(e.getHeader("rseq")),void this.earlyDialogs[n].sendRequest(this,a.C.PRACK,{extraHeaders:s,body:T.Utils.generateFakeSDP(e.body)})}if(this.isCanceled){if(i&&i>=100&&i<200)this.request.cancel(this.cancelReason,s),this.canceled();else if(i&&i>=200&&i<299)this.acceptAndTerminate(e),this.emit("bye",this.request);else if(i&&i>=300){var o=a.C.REASON_PHRASE[e.statusCode||0]||a.C.causes.CANCELED;this.rejected(e,o),this.failed(e,o),this.terminated(e,o)}}else{var c=i?i.toString():"";switch(!0){case/^100$/.test(c):this.received100=!0,this.emit("progress",e);break;case/^1[0-9]{2}$/.test(c):if(!e.toTag){this.logger.warn("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this.createDialog(e,"UAC",!0))break;if(this.status=u.SessionStatus.STATUS_1XX_RECEIVED,e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),e.hasHeader("require")&&-1!==e.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[n])break;var l=e.getHeader("rseq");if(-1!==this.earlyDialogs[n].pracked.indexOf(l)||this.earlyDialogs[n].pracked[this.earlyDialogs[n].pracked.length-1]>=Number(l)&&this.earlyDialogs[n].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||""))if(this.hasOffer){if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,void 0!==this.dialog&&l&&this.dialog.pracked.push(l),this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){s.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),t.sendRequest(a.C.PRACK,{extraHeaders:s,receiveResponse:function(){}}),t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",e)}),(function(n){t.logger.warn(n),t.acceptAndTerminate(e,488,"Not Acceptable Here"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION)}))}else{var g=this.earlyDialogs[n];g.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",g.sessionDescriptionHandler),l&&g.pracked.push(l),g.sessionDescriptionHandler&&g.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){return g.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)})).then((function(n){s.push("RAck: "+l+" "+e.getHeader("cseq")),g.sendRequest(t,a.C.PRACK,{extraHeaders:s,body:n}),t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",e)})).catch((function(e){if(l&&e.type===u.TypeStrings.SessionDescriptionHandlerError){if(g.pracked.push(l),t.status===u.SessionStatus.STATUS_TERMINATED)return;t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR)}else l&&g.pracked.splice(g.pracked.indexOf(l),1),t.logger.warn("invalid description"),t.logger.warn(e)}))}else s.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[n].pracked.push(e.getHeader("rseq")),this.earlyDialogs[n].sendRequest(this,a.C.PRACK,{extraHeaders:s}),this.emit("progress",e)}else this.emit("progress",e);break;case/^2[0-9]{2}$/.test(c):if(this.request.cseq+" "+this.request.method!==e.getHeader("cseq"))break;if(e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),this.status===u.SessionStatus.STATUS_EARLY_MEDIA&&this.dialog){this.status=u.SessionStatus.STATUS_CONFIRMED;var p={};this.renderbody&&(s.push("Content-Type: "+this.rendertype),p.extraHeaders=s,p.body=this.renderbody),this.emit("ack",e.transaction.sendACK(p)),this.accepted(e);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)p={},this.renderbody&&(s.push("Content-Type: "+this.rendertype),p.extraHeaders=s,p.body=this.renderbody),this.emit("ack",e.transaction.sendACK(p));else{if(!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){var n={};t.status=u.SessionStatus.STATUS_CONFIRMED,t.renderbody&&(s.push("Content-Type: "+t.rendertype),n.extraHeaders=s,n.body=t.renderbody),t.emit("ack",e.transaction.sendACK(n)),t.accepted(e)}),(function(n){t.logger.warn(n),t.acceptAndTerminate(e,488,"Not Acceptable Here"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION)}))}else if(this.earlyDialogs[n]&&this.earlyDialogs[n].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[n].sessionDescriptionHandler,!this.createDialog(e,"UAC"))break;this.status=u.SessionStatus.STATUS_CONFIRMED,this.emit("ack",e.transaction.sendACK()),this.accepted(e)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then((function(){return t.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)})).then((function(n){t.isCanceled||t.status===u.SessionStatus.STATUS_TERMINATED||(t.status=u.SessionStatus.STATUS_CONFIRMED,t.hasAnswer=!0,t.emit("ack",e.transaction.sendACK({body:n})),t.accepted(e))})).catch((function(n){n.type===u.TypeStrings.SessionDescriptionHandlerError&&(t.logger.warn("invalid description"),t.logger.warn(n.toString()),t.acceptAndTerminate(e,488,"Invalid session description"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION))}))}break;default:o=T.Utils.sipErrorCause(i||0),this.rejected(e,o),this.failed(e,o),this.terminated(e,o)}}}},t.prototype.cancel=function(e){if(void 0===e&&(e={}),e.extraHeaders=(e.extraHeaders||[]).slice(),this.isCanceled)throw new l.Exceptions.InvalidStateError(u.SessionStatus.STATUS_CANCELED);if(this.status===u.SessionStatus.STATUS_TERMINATED||this.status===u.SessionStatus.STATUS_CONFIRMED)throw new l.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession"),this.isCanceled=!0;var t=T.Utils.getCancelReason(e.statusCode,e.reasonPhrase);return this.status===u.SessionStatus.STATUS_NULL||this.status===u.SessionStatus.STATUS_INVITE_SENT&&!this.received100?this.cancelReason=t:this.status!==u.SessionStatus.STATUS_INVITE_SENT&&this.status!==u.SessionStatus.STATUS_1XX_RECEIVED&&this.status!==u.SessionStatus.STATUS_EARLY_MEDIA||this.request.cancel(t,e.extraHeaders),this.canceled()},t.prototype.terminate=function(e){return this.status===u.SessionStatus.STATUS_TERMINATED||(this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===u.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.cancel(e)),this},t.prototype.receiveRequest=function(t){return t.method,a.C.CANCEL,t.method===a.C.ACK&&this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.status=u.SessionStatus.STATUS_CONFIRMED,this.accepted()),e.prototype.receiveRequest.call(this,t)},t}(m);t.InviteClientContext=I;var C=function(e){function t(t,n,s,i){void 0===i&&(i={});var r=this;if(void 0===t||void 0===n||void 0===s)throw new TypeError("Not enough arguments");if((r=e.call(this,t,a.C.REFER,n.remoteIdentity.uri.toString(),i)||this).type=u.TypeStrings.ReferClientContext,r.options=i,r.extraHeaders=(r.options.extraHeaders||[]).slice(),r.applicant=n,"string"==typeof s||s.type!==u.TypeStrings.InviteServerContext&&s.type!==u.TypeStrings.InviteClientContext){var o=d.Grammar.parse(s,"Refer_To");r.target=o&&o.uri?o.uri:s;var c=r.ua.normalizeTarget(r.target);if(!c)throw new TypeError("Invalid target: "+s);r.target=c}else{var l=s.dialog;if(!l)throw new TypeError("Invalid target due to no dialog: "+s);r.target='"'+s.remoteIdentity.friendlyName+'" <'+l.remoteTarget.toString()+"?Replaces="+l.id.callId+"%3Bto-tag%3D"+l.id.remoteTag+"%3Bfrom-tag%3D"+l.id.localTag+">"}return r.ua&&r.extraHeaders.push("Referred-By: <"+r.ua.configuration.uri+">"),r.extraHeaders.push("Contact: "+n.contact),r.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),r.extraHeaders.push("Refer-To: "+r.target),r.errorListener=r.onTransportError.bind(r),t.transport&&t.transport.on("transportError",r.errorListener),r}return i(t,e),t.prototype.refer=function(e){var t=this;void 0===e&&(e={});var n=(this.extraHeaders||[]).slice();return e.extraHeaders&&n.concat(e.extraHeaders),this.applicant.sendRequest(a.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(n){var s=n&&n.statusCode?n.statusCode.toString():"";/^1[0-9]{2}$/.test(s)?t.emit("referRequestProgress",t):/^2[0-9]{2}$/.test(s)?t.emit("referRequestAccepted",t):/^[4-6][0-9]{2}$/.test(s)&&t.emit("referRequestRejected",t),e.receiveResponse&&e.receiveResponse(n)}}),this},t.prototype.receiveNotify=function(e){var t=e.hasHeader("Content-Type")?e.getHeader("Content-Type"):void 0;if(t&&-1!==t.search(/^message\/sipfrag/)){var n=d.Grammar.parse(e.body,"sipfrag");if(-1===n)return void e.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(n.statusCode):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(n.statusCode):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return e.reply(200),void this.emit("notify",e)}e.reply(489,"Bad Event")},t}(o.ClientContext);t.ReferClientContext=C;var v=function(e){function t(t,n){var s=e.call(this,t,n)||this;return s.type=u.TypeStrings.ReferServerContext,s.ua=t,s.status=u.SessionStatus.STATUS_INVITE_RECEIVED,s.fromTag=n.fromTag,s.id=n.callId+s.fromTag,s.request=n,s.contact=s.ua.contact.toString(),s.logger=t.getLogger("sip.referservercontext",s.id),s.cseq=Math.floor(1e4*Math.random()),s.callId=s.request.callId,s.fromUri=s.request.to.uri,s.fromTag=s.request.to.parameters.tag,s.remoteTarget=s.request.headers.Contact[0].parsed.uri,s.toUri=s.request.from.uri,s.toTag=s.request.fromTag,s.routeSet=s.request.getHeaders("record-route"),s.request.hasHeader("refer-to")?(s.referTo=s.request.parseHeader("refer-to"),s.referredSession=s.ua.findSession(n),s.request.hasHeader("referred-by")&&(s.referredBy=s.request.getHeader("referred-by")),s.referTo.uri.hasHeader("replaces")&&(s.replaces=s.referTo.uri.getHeader("replaces")),s.errorListener=s.onTransportError.bind(s),t.transport&&t.transport.on("transportError",s.errorListener),s.status=u.SessionStatus.STATUS_WAITING_FOR_ANSWER,s):(s.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),s.reject(),s)}return i(t,e),t.prototype.receiveNonInviteResponse=function(e){},t.prototype.progress=function(){if(this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new l.Exceptions.InvalidStateError(this.status);this.request.reply(100)},t.prototype.reject=function(t){if(void 0===t&&(t={}),this.status===u.SessionStatus.STATUS_TERMINATED)throw new l.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=u.SessionStatus.STATUS_TERMINATED,e.prototype.reject.call(this,t),this.emit("referRequestRejected",this)},t.prototype.accept=function(e,t){var n=this;if(void 0===e&&(e={}),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new l.Exceptions.InvalidStateError(this.status);if(this.status=u.SessionStatus.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var s=this.referTo.uri;if(!s.scheme||!s.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var i=e.inviteOptions||{},r=(i.extraHeaders||[]).slice();if(this.replaces&&r.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&r.push("Referred-By: "+this.referredBy),i.extraHeaders=r,s.clearHeaders(),this.targetSession=this.ua.invite(s.toString(),i,t),this.emit("referInviteSent",this),this.targetSession){this.targetSession.once("progress",(function(e){var t=e.statusCode||100,s=e.reasonPhrase;n.sendNotify(("SIP/2.0 "+t+" "+s).trim()),n.emit("referProgress",n),n.referredSession&&n.referredSession.emit("referProgress",n)})),this.targetSession.once("accepted",(function(){n.logger.log("Successfully followed the refer"),n.sendNotify("SIP/2.0 200 OK"),n.emit("referAccepted",n),n.referredSession&&n.referredSession.emit("referAccepted",n)}));var o=function(e){if(n.status!==u.SessionStatus.STATUS_TERMINATED){if(n.logger.log("Refer was not successful. Resuming session"),e&&429===e.statusCode)return n.logger.log("Alerting referrer that identity is required."),void n.sendNotify("SIP/2.0 429 Provide Referrer Identity");n.sendNotify("SIP/2.0 603 Declined"),n.status=u.SessionStatus.STATUS_TERMINATED,n.emit("referRejected",n),n.referredSession&&n.referredSession.emit("referRejected")}};this.targetSession.once("rejected",o),this.targetSession.once("failed",o)}}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)},t.prototype.sendNotify=function(e){if(this.status!==u.SessionStatus.STATUS_ANSWERED)throw new l.Exceptions.InvalidStateError(this.status);if(-1===d.Grammar.parse(e,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var t=new f.OutgoingRequest(a.C.NOTIFY,this.remoteTarget,this.ua,{cseq:this.cseq+=1,callId:this.callId,fromUri:this.fromUri,fromTag:this.fromTag,toUri:this.toUri,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],e);new g.RequestSender({request:t,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()},t}(p.ServerContext);t.ReferServerContext=v},344:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(813),a=n(346),c=n(852),u=n(41),l=function(e){function t(t,n,s){void 0===s&&(s={});var i=e.call(this)||this;if(i.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},i.type=a.TypeStrings.DTMF,void 0===n)throw new TypeError("Not enough arguments");if(i.logger=t.ua.getLogger("sip.invitecontext.dtmf",t.id),i.owner=t,"string"==typeof n)n=n.toUpperCase();else{if("number"!=typeof n)throw new TypeError("Invalid tone: "+n);n=n.toString()}if(!n.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+n);i.tone=n;var r=s.duration,o=s.interToneGap;if(r&&!u.Utils.isDecimal(r))throw new TypeError("Invalid tone duration: "+r);if(r?r<i.C.MIN_DURATION?(i.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+i.C.MIN_DURATION+" milliseconds"),r=i.C.MIN_DURATION):r>i.C.MAX_DURATION?(i.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+i.C.MAX_DURATION+" milliseconds"),r=i.C.MAX_DURATION):r=Math.abs(r):r=i.C.DEFAULT_DURATION,i.duration=r,o&&!u.Utils.isDecimal(o))throw new TypeError("Invalid interToneGap: "+o);return o?o<i.C.MIN_INTER_TONE_GAP?(i.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+i.C.MIN_INTER_TONE_GAP+" milliseconds"),o=i.C.MIN_INTER_TONE_GAP):o=Math.abs(o):o=i.C.DEFAULT_INTER_TONE_GAP,i.interToneGap=o,i}return i(t,e),t.prototype.send=function(e){if(void 0===e&&(e={}),this.owner.status!==a.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==a.SessionStatus.STATUS_WAITING_FOR_ACK)throw new c.Exceptions.InvalidStateError(this.owner.status);var t=e.extraHeaders?e.extraHeaders.slice():[],n={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.dialog){var s=this.owner.dialog.sendRequest(this,o.C.INFO,{extraHeaders:t,body:n});this.owner.emit("dtmf",s,this)}},t.prototype.init_incoming=function(e){e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(!0){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var n=u.Utils.sipErrorCause(t);this.emit("failed",e,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,o.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",void 0,o.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(e){this.emit("failed",e,o.C.causes.DIALOG_ERROR),this.owner.onDialogError(e)},t}(r.EventEmitter);t.DTMF=l},35:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(266),o=n(813),a=n(321),c=n(346),u=n(312),l=n(41),d=function(e){function t(t,n,s,i){void 0===i&&(i={});var r,a=this;if(!s)throw new TypeError("Event necessary to create a subscription.");return i.extraHeaders=(i.extraHeaders||[]).slice(),"number"!=typeof i.expires?(t.logger.warn("expires must be a number. Using default of 3600."),r=3600):r=i.expires,i.extraHeaders.push("Event: "+s),i.extraHeaders.push("Expires: "+r),i.extraHeaders.push("Contact: "+t.contact.toString()),i.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),(a=e.call(this,t,o.C.SUBSCRIBE,n,i)||this).type=c.TypeStrings.Subscription,a.event=s,a.requestedExpires=r,a.state="init",a.contact=t.contact.toString(),a.extraHeaders=i.extraHeaders,a.logger=t.getLogger("sip.subscription"),a.expires=r,a.timers={N:void 0,subDuration:void 0},a.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604],a}return i(t,e),t.prototype.subscribe=function(){var e=this;return"active"===this.state?(this.refresh(),this):("notify_wait"===this.state||(clearTimeout(this.timers.subDuration),clearTimeout(this.timers.N),this.timers.N=setTimeout((function(){return e.timer_fire()}),u.Timers.TIMER_N),this.request&&this.request.from&&(this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event]=this),this.send(),this.state="notify_wait"),this)},t.prototype.refresh=function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog&&this.dialog.sendRequest(this,o.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},t.prototype.receiveResponse=function(e){var t=this,n=e.statusCode?e.statusCode:0,s=l.Utils.getReasonPhrase(n);if("notify_wait"===this.state&&n>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(n))this.failed(e,void 0);else if(/^2[0-9]{2}$/.test(n.toString())){this.emit("accepted",e,s);var i=e.getHeader("Expires");i&&Number(i)<=this.requestedExpires?(this.expires=Number(i),this.timers.subDuration=setTimeout((function(){return t.refresh()}),900*Number(i))):i?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(e,"Invalid Expires Header")):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(e,"Expires Header Missing"))}else n>300&&(this.emit("failed",e,s),this.emit("rejected",e,s))},t.prototype.unsubscribe=function(){var e=this,t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.receiveResponse=function(){},this.dialog&&this.dialog.sendRequest(this,o.C.SUBSCRIBE,{extraHeaders:t,body:this.body}),clearTimeout(this.timers.subDuration),clearTimeout(this.timers.N),this.timers.N=setTimeout((function(){return e.timer_fire()}),u.Timers.TIMER_N),this.emit("terminated")},t.prototype.receiveRequest=function(e){var t,n=this,s=function(){t.expires&&(clearTimeout(n.timers.subDuration),t.expires=Math.min(n.expires,Math.max(t.expires,0)),n.timers.subDuration=setTimeout((function(){return n.refresh()}),900*t.expires))};if(this.matchEvent(e))if(this.dialog||this.createConfirmedDialog(e,"UAS")&&this.dialog&&(this.id=this.dialog.id.toString(),this.request&&this.request.from&&(delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id||""]=this)),t=e.parseHeader("Subscription-State"),e.reply(200),clearTimeout(this.timers.N),this.emit("notify",{request:e}),"terminated"!==this.state)switch(t.state){case"active":this.state="active",s();break;case"pending":"notify_wait"===this.state&&s(),this.state="pending";break;case"terminated":if(clearTimeout(this.timers.subDuration),t.reason)switch(this.logger.log("terminating subscription with reason "+t.reason),t.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(t.params&&t.params["retry-after"]?this.timers.subDuration=setTimeout((function(){return n.subscribe()}),t.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===t.state&&(this.terminateDialog(),clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),delete this.ua.subscriptions[this.id||""]);else e.reply(489)},t.prototype.close=function(){"notify_wait"===this.state?(this.state="terminated",clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),this.receiveResponse=function(){},this.request&&this.request.from&&delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event],this.emit("terminated")):"terminated"!==this.state&&this.unsubscribe()},t.prototype.onDialogError=function(e){this.failed(e,o.C.causes.DIALOG_ERROR)},t.prototype.timer_fire=function(){"terminated"===this.state?(this.terminateDialog(),clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),delete this.ua.subscriptions[this.id||""]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},t.prototype.createConfirmedDialog=function(e,t){this.terminateDialog();var n=new a.Dialog(this,e,t);return this.request&&(n.inviteSeqnum=this.request.cseq,n.localSeqnum=this.request.cseq),!n.error&&(this.dialog=n,!0)},t.prototype.terminateDialog=function(){this.dialog&&(delete this.ua.subscriptions[this.id||""],this.dialog.terminate(),delete this.dialog)},t.prototype.failed=function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},t.prototype.matchEvent=function(e){if(!e.hasHeader("Event"))return this.logger.warn("missing Event header"),!1;if(!e.hasHeader("Subscription-State"))return this.logger.warn("missing Subscription-State header"),!1;var t=e.parseHeader("event").event;return this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)},t}(r.ClientContext);t.Subscription=d},312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Timers={T1:500,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},615:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(813),a=n(346),c=n(557),u=n(312),l=function(e,t,n){var s="SIP/2.0/"+(e.configuration.hackViaTcp?"TCP":t.server.scheme);return s+=" "+e.configuration.viaHost+";branch="+n,e.configuration.forceRport&&(s+=";rport"),s},d=function(e){function t(t,n,s){var i=e.call(this)||this;i.kind="nict",i.type=a.TypeStrings.NonInviteClientTransaction,i.transport=s,i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.requestSender=t,i.request=n,i.logger=t.ua.getLogger("sip.transaction.nict",i.id);var r=l(t.ua,s,i.id);return i.request.setHeader("via",r),i.requestSender.ua.newTransaction(i),i}return i(t,e),t.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},t.prototype.send=function(){var e=this;this.stateChanged(a.TransactionStatus.STATUS_TRYING),this.F=setTimeout((function(){return e.timer_F()}),u.Timers.TIMER_F),this.transport.send(this.request).catch((function(){return e.onTransportError()}))},t.prototype.receiveResponse=function(e){var t=this,n=e.statusCode||0;if(n<200)switch(this.state){case a.TransactionStatus.STATUS_TRYING:case a.TransactionStatus.STATUS_PROCEEDING:this.stateChanged(a.TransactionStatus.STATUS_PROCEEDING),this.requestSender.receiveResponse(e)}else switch(this.state){case a.TransactionStatus.STATUS_TRYING:case a.TransactionStatus.STATUS_PROCEEDING:this.stateChanged(a.TransactionStatus.STATUS_COMPLETED),this.F&&clearTimeout(this.F),408===n?this.requestSender.onRequestTimeout():this.requestSender.receiveResponse(e),this.K=setTimeout((function(){return t.timer_K()}),u.Timers.TIMER_K);case a.TransactionStatus.STATUS_COMPLETED:}},t.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this),this.requestSender.onTransportError()},t.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this),this.requestSender.onRequestTimeout()},t.prototype.timer_K=function(){this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this)},t}(r.EventEmitter);t.NonInviteClientTransaction=d;var g=function(e){function t(t,n,s){var i=e.call(this)||this;i.kind="ict",i.type=a.TypeStrings.InviteClientTransaction,i.transport=s,i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.requestSender=t,i.request=n,i.logger=t.ua.getLogger("sip.transaction.ict",i.id);var r=l(t.ua,s,i.id);return i.request.setHeader("via",r),i.requestSender.ua.newTransaction(i),i.request.cancel=function(e,t){for(var n="",s=0,r=t=(t||[]).slice();s<r.length;s++)n+=r[s].trim()+"\r\n";i.cancelRequest(i,e,n)},i}return i(t,e),t.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},t.prototype.send=function(){var e=this;this.stateChanged(a.TransactionStatus.STATUS_CALLING),this.B=setTimeout((function(){return e.timer_B()}),u.Timers.TIMER_B),this.transport.send(this.request).catch((function(){return e.onTransportError()}))},t.prototype.receiveResponse=function(e){var t=this,n=e.statusCode||0;if(e.transaction=this,this.response&&this.response.statusCode===e.statusCode&&this.response.cseq===e.cseq)return this.logger.debug("ICT Received a retransmission for cseq: "+e.cseq),void(this.ackSender&&this.ackSender.send());if(this.response=e,n>=100&&n<=199)switch(this.state){case a.TransactionStatus.STATUS_CALLING:this.stateChanged(a.TransactionStatus.STATUS_PROCEEDING),this.requestSender.receiveResponse(e),this.cancel&&this.transport.send(this.cancel);break;case a.TransactionStatus.STATUS_PROCEEDING:this.requestSender.receiveResponse(e)}else if(n>=200&&n<=299)switch(this.state){case a.TransactionStatus.STATUS_CALLING:case a.TransactionStatus.STATUS_PROCEEDING:this.stateChanged(a.TransactionStatus.STATUS_ACCEPTED),this.M=setTimeout((function(){return t.timer_M()}),u.Timers.TIMER_M),this.requestSender.receiveResponse(e);break;case 4:this.requestSender.receiveResponse(e)}else if(n>=300&&n<=699)switch(this.state){case a.TransactionStatus.STATUS_CALLING:case a.TransactionStatus.STATUS_PROCEEDING:this.stateChanged(a.TransactionStatus.STATUS_COMPLETED),this.sendACK(),this.requestSender.receiveResponse(e);break;case a.TransactionStatus.STATUS_COMPLETED:this.sendACK()}},t.prototype.sendACK=function(e){var t,n=this;if(void 0===e&&(e={}),t=this.response&&this.response.getHeader("contact")?this.response.parseHeader("contact").uri:this.request.ruri,this.response){var s=new c.OutgoingRequest("ACK",t.toString(),this.request.ua,{cseq:this.response.cseq,callId:this.response.callId,fromUri:this.response.from.uri,fromTag:this.response.fromTag,toUri:this.response.to.uri,toTag:this.response.toTag,routeSet:this.response.getHeaders("record-route").reverse()},e.extraHeaders||[],e.body);if(!s.ua.transport)throw new Error("No transport to make transaction");return this.ackSender=new p({onTransportError:this.requestSender.applicant?this.requestSender.applicant.onTransportError.bind(this.requestSender.applicant):function(){n.logger.warn("ACK Request had a transport error")},ua:s.ua},s,s.ua.transport),this.ackSender.send(),s}},t.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this),this.state!==a.TransactionStatus.STATUS_ACCEPTED&&this.requestSender.onTransportError()},t.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id),this.state===a.TransactionStatus.STATUS_ACCEPTED&&(this.B&&(clearTimeout(this.B),this.B=void 0),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this))},t.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id),this.state===a.TransactionStatus.STATUS_CALLING&&(this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this),this.requestSender.onRequestTimeout())},t.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id),this.B&&(clearTimeout(this.B),this.B=void 0),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.requestSender.ua.destroyTransaction(this)},t.prototype.cancelRequest=function(e,t,n){var s=e.request;this.cancel=o.C.CANCEL+" "+s.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+s.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+s.headers.Route.toString()+"\r\n"),this.cancel+="To: "+s.headers.To.toString()+"\r\n",this.cancel+="From: "+s.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+s.headers["Call-ID"].toString()+"\r\n",this.cancel+="Max-Forwards: 70\r\n",this.cancel+="CSeq: "+s.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",t&&(this.cancel+="Reason: "+t+"\r\n"),n&&(this.cancel+=n),this.cancel+="Content-Length: 0\r\n\r\n",this.state===a.TransactionStatus.STATUS_PROCEEDING&&this.transport.send(this.cancel)},t}(r.EventEmitter);t.InviteClientTransaction=g;var p=function(e){function t(t,n,s){var i=e.call(this)||this;i.type=a.TypeStrings.AckClientTransaction,i.transport=s,i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.requestSender=t,i.request=n,i.logger=t.ua.getLogger("sip.transaction.nict",i.id);var r=l(t.ua,s,i.id);return i.request.setHeader("via",r),i}return i(t,e),t.prototype.send=function(){var e=this;this.transport.send(this.request).catch((function(){e.logger.log("transport error occurred, for an ACK client transaction "+e.id),e.requestSender.onTransportError()}))},t}(r.EventEmitter);t.AckClientTransaction=p;var h=function(e){function t(t,n){var s=e.call(this)||this;return s.kind="nist",s.type=a.TypeStrings.NonInviteServerTransaction,s.id=t.viaBranch,s.request=t,s.transport=n.transport,s.ua=n,s.lastResponse="",s.transportError=!1,t.serverTransaction=s,s.logger=n.getLogger("sip.transaction.nist",s.id),s.state=a.TransactionStatus.STATUS_TRYING,n.newTransaction(s),s}return i(t,e),t.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},t.prototype.receiveResponse=function(e,t){var n=this;return new Promise((function(s,i){if(100===e)switch(n.state){case a.TransactionStatus.STATUS_TRYING:n.stateChanged(2),n.transport&&n.transport.send(t).catch((function(){return n.onTransportError()}));break;case a.TransactionStatus.STATUS_PROCEEDING:n.lastResponse=t,n.transport&&n.transport.send(t).then(s).catch((function(){n.onTransportError(),i()}))}else if(e>=200&&e<=699)switch(n.state){case a.TransactionStatus.STATUS_TRYING:case a.TransactionStatus.STATUS_PROCEEDING:n.stateChanged(5),n.lastResponse=t,n.J=setTimeout((function(){n.logger.debug("Timer J expired for non-INVITE server transaction "+n.id),n.stateChanged(6),n.ua.destroyTransaction(n)}),u.Timers.TIMER_J),n.transport&&n.transport.send(t).then(s).catch((function(){n.onTransportError(),i()}));case a.TransactionStatus.STATUS_COMPLETED:}}))},t.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),this.J&&(clearTimeout(this.J),this.J=void 0),this.stateChanged(6),this.ua.destroyTransaction(this))},t}(r.EventEmitter);t.NonInviteServerTransaction=h;var f=function(e){function t(t,n){var s=e.call(this)||this;return s.kind="ist",s.type=a.TypeStrings.InviteServerTransaction,s.id=t.viaBranch,s.request=t,s.transport=n.transport,s.ua=n,s.lastResponse="",s.transportError=!1,t.serverTransaction=s,s.logger=n.getLogger("sip.transaction.ist",s.id),s.state=a.TransactionStatus.STATUS_PROCEEDING,n.newTransaction(s),t.reply(100),s}return i(t,e),t.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},t.prototype.timer_I=function(){this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.ua.destroyTransaction(this)},t.prototype.receiveResponse=function(e,t){var n=this;return new Promise((function(s,i){if(e>=100&&e<=199&&n.state===a.TransactionStatus.STATUS_PROCEEDING)n.transport&&n.transport.send(t).catch((function(){return n.onTransportError()})),n.lastResponse=t,e>100&&void 0===n.resendProvisionalTimer&&(n.resendProvisionalTimer=setInterval((function(){n.transport&&n.transport.send(t).catch((function(){return n.onTransportError()}))}),u.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(e>=200&&e<=299)switch(n.state){case a.TransactionStatus.STATUS_PROCEEDING:n.stateChanged(4),n.lastResponse=t,n.L=setTimeout((function(){return n.timer_L()}),u.Timers.TIMER_L),void 0!==n.resendProvisionalTimer&&(clearInterval(n.resendProvisionalTimer),n.resendProvisionalTimer=void 0);case a.TransactionStatus.STATUS_ACCEPTED:n.transport&&n.transport.send(t).then(s).catch((function(e){n.logger.error(e),n.onTransportError(),i()}))}else e>=300&&e<=699&&n.state===a.TransactionStatus.STATUS_PROCEEDING&&(void 0!==n.resendProvisionalTimer&&(clearInterval(n.resendProvisionalTimer),n.resendProvisionalTimer=void 0),n.transport&&n.transport.send(t).then((function(){n.stateChanged(a.TransactionStatus.STATUS_COMPLETED),n.H=setTimeout((function(){return n.timer_H()}),u.Timers.TIMER_H),s()})).catch((function(e){n.logger.error(e),n.onTransportError(),i()})))}))},t.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id),this.state===a.TransactionStatus.STATUS_COMPLETED&&this.logger.warn("transactions: ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.ua.destroyTransaction(this)},t.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id),this.state===a.TransactionStatus.STATUS_ACCEPTED&&(this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.ua.destroyTransaction(this))},t.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),void 0!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.stateChanged(a.TransactionStatus.STATUS_TERMINATED),this.ua.destroyTransaction(this))},t}(r.EventEmitter);t.InviteServerTransaction=f,t.checkTransaction=function(e,t){var n=e.transactions.ist[t.viaBranch];switch(t.method){case o.C.INVITE:if(n){switch(n.state){case a.TransactionStatus.STATUS_PROCEEDING:n.transport&&n.transport.send(n.lastResponse);case a.TransactionStatus.STATUS_ACCEPTED:}return!0}break;case o.C.ACK:if(!n)return!1;if(n.state===a.TransactionStatus.STATUS_ACCEPTED)return!1;if(n.state===a.TransactionStatus.STATUS_COMPLETED)return n.stateChanged(a.TransactionStatus.STATUS_CONFIRMED),n.I=setTimeout(n.timer_I.bind(n),u.Timers.TIMER_I),!0;break;case o.C.CANCEL:return n?(t.reply_sl(200),n.state!==a.TransactionStatus.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:var s=e.transactions.nist[t.viaBranch];if(s){switch(s.state){case a.TransactionStatus.STATUS_TRYING:break;case a.TransactionStatus.STATUS_PROCEEDING:case a.TransactionStatus.STATUS_COMPLETED:s.transport&&s.transport.send(s.lastResponse)}return!0}}return!1}},213:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(346),a=function(e){function t(t,n){var s=e.call(this)||this;return s.type=o.TypeStrings.Transport,s.logger=t,s}return i(t,e),t.prototype.connect=function(e){var t=this;return void 0===e&&(e={}),this.connectPromise(e).then((function(e){e.overrideEvent||t.emit("connected")}))},t.prototype.send=function(e,t){var n=this;return void 0===t&&(t={}),this.sendPromise(e).then((function(e){e.overrideEvent||n.emit("messageSent",e.msg)}))},t.prototype.disconnect=function(e){var t=this;return void 0===e&&(e={}),this.disconnectPromise(e).then((function(e){e.overrideEvent||t.emit("disconnected")}))},t.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},t.prototype.waitForConnected=function(){var e=this;return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new Promise((function(t){e.afterConnected(t)}))},t}(r.EventEmitter);t.Transport=a},192:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(266),a=n(813),c=n(458),u=n(346),l=n(852),d=n(585),g=n(838),p=n(125),h=n(928),f=n(88),S=n(54),T=n(598),m=n(36),_=n(35),I=n(615),C=n(750),v=n(41),y=n(11),E=n(708),R=n.g.window||n.g,A=function(e){function t(n){var s=e.call(this)||this;s.type=u.TypeStrings.UA,s.log=new g.LoggerFactory,s.logger=s.getLogger("sip.ua"),s.cache={credentials:{}},s.configuration={},s.dialogs={},s.applicants={},s.data={},s.sessions={},s.subscriptions={},s.earlySubscriptions={},s.publishers={},s.status=u.UAStatus.STATUS_INIT,s.transactions={nist:{},nict:{},ist:{},ict:{}},void 0===n?n={}:("string"==typeof n||n instanceof String)&&(n={uri:n}),n.log&&(n.log.hasOwnProperty("builtinEnabled")&&(s.log.builtinEnabled=n.log.builtinEnabled),n.log.hasOwnProperty("level")&&(s.log.level=n.log.level),n.log.hasOwnProperty("connector")&&(s.log.connector=n.log.connector));try{s.loadConfig(n)}catch(e){throw s.status=u.UAStatus.STATUS_NOT_READY,s.error=t.C.CONFIGURATION_ERROR,e}return s.registerContext=new f.RegisterContext(s,n.registerOptions),s.registerContext.on("failed",s.emit.bind(s,"registrationFailed")),s.registerContext.on("registered",s.emit.bind(s,"registered")),s.registerContext.on("unregistered",s.emit.bind(s,"unregistered")),s.configuration.autostart&&s.start(),s}return i(t,e),Object.defineProperty(t.prototype,"transactionsCount",{get:function(){for(var e=0,t=0,n=["nist","nict","ist","ict"];t<n.length;t++){var s=n[t];e+=Object.keys(this.transactions[s]).length}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nictTransactionsCount",{get:function(){return Object.keys(this.transactions.nict).length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nistTransactionsCount",{get:function(){return Object.keys(this.transactions.nist).length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ictTransactionsCount",{get:function(){return Object.keys(this.transactions.ict).length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"istTransactionsCount",{get:function(){return Object.keys(this.transactions.ist).length},enumerable:!0,configurable:!0}),t.prototype.register=function(e){return void 0===e&&(e={}),e.register&&(this.configuration.register=!0),this.registerContext.register(e),this},t.prototype.unregister=function(e){var t=this;return this.configuration.register=!1,this.transport&&this.transport.afterConnected((function(){t.registerContext.unregister(e)})),this},t.prototype.isRegistered=function(){return this.registerContext.registered},t.prototype.invite=function(e,t,n){var s=this,i=new m.InviteClientContext(this,e,t,n);return this.transport&&this.transport.afterConnected((function(){i.invite(),s.emit("inviteSent",i)})),i},t.prototype.subscribe=function(e,t,n){var s=new _.Subscription(this,e,t,n);return this.transport&&this.transport.afterConnected((function(){return s.subscribe()})),s},t.prototype.publish=function(e,t,n,s){var i=new h.PublishContext(this,e,t,s);return this.transport&&this.transport.afterConnected((function(){i.publish(n)})),i},t.prototype.message=function(e,t,n){if(void 0===n&&(n={}),void 0===t)throw new TypeError("Not enough arguments");return n.contentType=n.contentType||"text/plain",n.body=t,this.request(a.C.MESSAGE,e,n)},t.prototype.request=function(e,t,n){var s=new o.ClientContext(this,e,t,n);return this.transport&&this.transport.afterConnected((function(){return s.send()})),s},t.prototype.stop=function(){var e=this;if(this.logger.log("user requested closure..."),this.status===u.UAStatus.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(var t in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.sessions[t]&&(this.logger.log("closing session "+t),this.sessions[t].terminate());for(var s in this.subscriptions)this.subscriptions[s]&&(this.logger.log("unsubscribing from subscription "+s),this.subscriptions[s].close());for(var i in this.earlySubscriptions)this.earlySubscriptions[i]&&(this.logger.log("unsubscribing from early subscription "+i),this.earlySubscriptions[i].close());for(var r in this.publishers)this.publishers[r]&&(this.logger.log("unpublish "+r),this.publishers[r].close());for(var o in this.applicants)this.applicants[o]&&this.applicants[o].close();if(this.status=u.UAStatus.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&this.transport)this.transport.disconnect();else{var a=function(){0===e.nistTransactionsCount&&0===e.nictTransactionsCount&&(e.removeListener("transactionDestroyed",a),e.transport&&e.transport.disconnect())};this.on("transactionDestroyed",a)}return"function"==typeof R.removeEventListener&&(n.g.chrome&&n.g.chrome.app&&n.g.chrome.app.runtime||R.removeEventListener("unload",this.environListener)),this},t.prototype.start=function(){var e=this;if(this.logger.log("user requested startup..."),this.status===u.UAStatus.STATUS_INIT){if(this.status=u.UAStatus.STATUS_STARTING,!this.configuration.transportConstructor)throw new l.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===u.UAStatus.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=u.UAStatus.STATUS_READY,this.transport&&this.transport.connect()):this.status===u.UAStatus.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===u.UAStatus.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof R.addEventListener&&(n.g.chrome&&n.g.chrome.app&&n.g.chrome.app.runtime||(this.environListener=this.stop,R.addEventListener("unload",(function(){return e.environListener()})))),this},t.prototype.normalizeTarget=function(e){return v.Utils.normalizeTarget(e,this.configuration.hostportParams)},t.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},t.prototype.newTransaction=function(e){this.transactions[e.kind][e.id]=e,this.emit("newTransaction",{transaction:e})},t.prototype.destroyTransaction=function(e){delete this.transactions[e.kind][e.id],this.emit("transactionDestroyed",{transaction:e})},t.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||void 0},t.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},t.prototype.getCredentials=function(e){var t=e.ruri.type===u.TypeStrings.URI?e.ruri.host:"";if(t&&this.cache.credentials[t]&&this.cache.credentials[t][e.ruri.toString()]){var n=this.cache.credentials[t][e.ruri.toString()];return n.method=e.method,n}},t.prototype.onTransportError=function(){this.status!==u.UAStatus.STATUS_USER_CLOSED&&(this.error&&this.error===t.C.NETWORK_ERROR||(this.status=u.UAStatus.STATUS_NOT_READY,this.error=t.C.NETWORK_ERROR))},t.prototype.setTransportListeners=function(){var e=this;this.transport&&(this.transport.on("connected",(function(){return e.onTransportConnected()})),this.transport.on("message",(function(t){return e.onTransportReceiveMsg(t)})),this.transport.on("transportError",(function(){return e.onTransportError()})))},t.prototype.onTransportConnected=function(){var e=this;this.configuration.register&&Promise.resolve().then((function(){return e.registerContext.register()}))},t.prototype.onTransportReceiveMsg=function(e){var t=p.Parser.parseMessage(e,this);if(this.status===u.UAStatus.STATUS_USER_CLOSED&&t&&t.type===u.TypeStrings.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else if(t&&this.transport&&S.SanityCheck.sanityCheck(t,this,this.transport))if(t.type===u.TypeStrings.IncomingRequest)t.transport=this.transport,this.receiveRequest(t);else if(t.type===u.TypeStrings.IncomingResponse)switch(t.method){case a.C.INVITE:var n=this.transactions.ict[t.viaBranch];n&&n.receiveResponse(t);break;case a.C.ACK:break;default:var s=this.transactions.nict[t.viaBranch];s&&s.receiveResponse(t)}},t.prototype.receiveRequest=function(e){var n=function(t){return!!t&&!!e.ruri&&t.user===e.ruri.user};if(this.configuration.uri.type===u.TypeStrings.URI&&!(n(this.configuration.uri)||this.contact&&(n(this.contact.uri)||n(this.contact.pubGruu)||n(this.contact.tempGruu))))return this.logger.warn("Request-URI does not point to us"),void(e.method!==a.C.ACK&&e.reply_sl(404));if(e.ruri&&e.ruri.scheme===a.C.SIPS)e.reply_sl(416);else if(!this.checkTransaction(e)){var s,i=e.method;if(i===a.C.OPTIONS?(new I.NonInviteServerTransaction(e,this),e.reply(200,void 0,["Allow: "+t.C.ALLOWED_METHODS.toString(),"Accept: "+t.C.ACCEPTED_BODY_TYPES.toString()])):i===a.C.MESSAGE?((s=new T.ServerContext(this,e)).body=e.body,s.contentType=e.getHeader("Content-Type")||"text/plain",e.reply(200,void 0),this.emit("message",s)):i!==a.C.INVITE&&i!==a.C.ACK&&(s=new T.ServerContext(this,e)),e.toTag){var r=this.findDialog(e);if(r)i===a.C.INVITE&&new I.InviteServerTransaction(e,this),r.receiveRequest(e);else if(i===a.C.NOTIFY){g=this.findSession(e);var o=this.findEarlySubscription(e);g?g.receiveRequest(e):o?o.receiveRequest(e):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),e.reply(481,"Subscription does not exist"))}else i!==a.C.ACK&&e.reply(481)}else switch(i){case a.C.INVITE:var c=this.configuration.replaces!==a.C.supported.UNSUPPORTED&&e.parseHeader("replaces"),l=void 0;if(c){if(!(l=this.dialogs[c.callId+c.replacesToTag+c.replacesFromTag]))return void e.reply_sl(481,void 0);if(l.owner.type!==u.TypeStrings.Subscription&&l.owner.status===u.SessionStatus.STATUS_TERMINATED)return void e.reply_sl(603,void 0);if(l.state===u.DialogStatus.STATUS_CONFIRMED&&c.earlyOnly)return void e.reply_sl(486,void 0)}var d=new m.InviteServerContext(this,e);l&&l.owner.type!==u.TypeStrings.Subscription&&(d.replacee=l&&l.owner),this.emit("invite",d);break;case a.C.BYE:e.reply(481);break;case a.C.CANCEL:var g;(g=this.findSession(e))?g.receiveRequest(e):this.logger.warn("received CANCEL request for a non existent session");break;case a.C.ACK:break;case a.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(e.reply(200,void 0),this.emit("notify",{request:e})):e.reply(481,"Subscription does not exist");break;case a.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var p=new m.ReferServerContext(this,e);this.listeners("outOfDialogReferRequested").length?this.emit("outOfDialogReferRequested",p):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),p.accept({followRefer:!0}));break}e.reply(405);break;default:e.reply(405)}}},t.prototype.checkTransaction=function(e){return I.checkTransaction(this,e)},t.prototype.findDialog=function(e){return this.dialogs[e.callId+e.fromTag+e.toTag]||this.dialogs[e.callId+e.toTag+e.fromTag]||void 0},t.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.callId+e.toTag+e.getHeader("event")]||void 0},t.prototype.checkAuthenticationFactory=function(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return Promise.resolve()}),e},t.prototype.loadConfig=function(e){var t=this,n={viaHost:v.Utils.createRandomToken(12)+".invalid",uri:new C.URI("sip","anonymous."+v.Utils.createRandomToken(6),"anonymous.invalid",void 0,void 0),custom:{},displayName:"",password:void 0,register:!0,registerOptions:{},transportConstructor:E.Transport,transportOptions:{},userAgentString:a.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:v.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:a.C.supported.UNSUPPORTED,dtmfType:a.C.dtmfType.INFO,replaces:a.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:y.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory((function(e){return new c.DigestAuthentication(e)})),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1},s=this.getConfigurationCheck();for(var i in s.mandatory){if(!e.hasOwnProperty(i))throw new l.Exceptions.ConfigurationError(i);var r=e[i];if(void 0===(o=s.mandatory[i](r)))throw new l.Exceptions.ConfigurationError(i,r);n[i]=o}for(var i in s.optional)if(e.hasOwnProperty(i)){var o;if((r=e[i])instanceof Array&&0===r.length||null===r||""===r||void 0===r||"number"==typeof r&&isNaN(r))continue;if(void 0===(o=s.optional[i](r)))throw new l.Exceptions.ConfigurationError(i,r);n[i]=o}0===n.displayName&&(n.displayName="0"),n.sipjsId=v.Utils.createRandomToken(5);var u=n.uri.clone();if(u.user=void 0,n.hostportParams=u.toRaw().replace(/^sip:/i,""),n.authorizationUser||(n.authorizationUser=n.uri.user),n.noAnswerTimeout=1e3*n.noAnswerTimeout,n.hackIpInContact)if("boolean"==typeof n.hackIpInContact){var d=Math.floor(254*Math.random()+1);n.viaHost="192.0.2."+d}else"string"==typeof n.hackIpInContact&&(n.viaHost=n.hackIpInContact);n.hackWssInTransport&&(n.contactTransport="wss"),this.contact={pubGruu:void 0,tempGruu:void 0,uri:new C.URI("sip",n.contactName,n.viaHost,void 0,{transport:n.contactTransport}),toString:function(e){void 0===e&&(e={});var s=e.anonymous||!1,i=e.outbound||!1,r="<";return r+=s?(t.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+n.contactTransport).toString():(t.contact.pubGruu||t.contact.uri).toString(),i&&(r+=";ob"),r+">"}};var g={};for(var i in n)n.hasOwnProperty(i)&&(g[i]=n[i]);for(var i in Object.assign(this.configuration,g),this.logger.log("configuration parameters after validation:"),n)if(n.hasOwnProperty(i))switch(i){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+i+": "+n[i]);break;case"password":this.logger.log("· "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+i+": "+n[i].name);break;default:this.logger.log("· "+i+": "+JSON.stringify(n[i]))}},t.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=d.Grammar.URIParse(e);return t&&t.user?t:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(e){return-1===d.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},displayName:function(e){return-1===d.Grammar.parse('"'+e+'"',"displayName")?void 0:e},dtmfType:function(e){switch(e){case a.C.dtmfType.RTP:return a.C.dtmfType.RTP;case a.C.dtmfType.INFO:default:return a.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e||"string"==typeof e&&-1!==d.Grammar.parse(e,"host")?e:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},extraSupported:function(e){if(e instanceof Array){for(var t=0,n=e;t<n.length;t++)if("string"!=typeof n[t])return;return e}},forceRport:function(e){if("boolean"==typeof e)return e},noAnswerTimeout:function(e){if(v.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},password:function(e){return String(e)},rel100:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},replaces:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerOptions:function(e){if("object"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},t.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10},t}(r.EventEmitter);t.UA=A},750:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(813),o=n(346),a=function(){function e(e){for(var t in this.parameters={},this.type=o.TypeStrings.Parameters,e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}return e.prototype.setParam=function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},e.prototype.getParam=function(e){if(e)return this.parameters[e.toLowerCase()]},e.prototype.hasParam=function(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())},e.prototype.deleteParam=function(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){var t=this.parameters[e];return delete this.parameters[e],t}},e.prototype.clearParams=function(){this.parameters={}},e}();t.Parameters=a;var c=function(e){function t(t,n,s,i,a,c){var u=e.call(this,a)||this;if(u.headers={},u.type=o.TypeStrings.URI,!s)throw new TypeError('missing or invalid "host" parameter');for(var l in t=t||r.C.SIP,c)c.hasOwnProperty(l)&&u.setHeader(l,c[l]);return u.raw={scheme:t,user:n,host:s,port:i},u.normal={scheme:t.toLowerCase(),user:n,host:s.toLowerCase(),port:i},u}return i(t,e),Object.defineProperty(t.prototype,"_normal",{get:function(){return this.normal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_raw",{get:function(){return this.raw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e,this.normal.host=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e},enumerable:!0,configurable:!0}),t.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]},t.prototype.getHeader=function(e){if(e)return this.headers[this.headerize(e)]},t.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))},t.prototype.deleteHeader=function(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){var t=this.headers[e];return delete this.headers[e],t}},t.prototype.clearHeaders=function(){this.headers={}},t.prototype.clone=function(){return new t(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},t.prototype.toRaw=function(){return this._toString(this._raw)},t.prototype.toString=function(){return this._toString(this._normal)},t.prototype._toString=function(e){var t=e.scheme+":";for(var n in e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port),this.parameters)this.parameters.hasOwnProperty(n)&&(t+=";"+n,null!==this.parameters[n]&&(t+="="+this.parameters[n]));var s=[];for(var i in this.headers)if(this.headers.hasOwnProperty(i))for(var r in this.headers[i])this.headers[i].hasOwnProperty(r)&&s.push(i+"="+this.headers[i][r]);return s.length>0&&(t+="?"+s.join("&")),t},t.prototype.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},t.prototype.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},n=e.toLowerCase().replace(/_/g,"-").split("-"),s=n.length,i="",r=0;r<s;r++)0!==r&&(i+="-"),i+=n[r].charAt(0).toUpperCase()+n[r].substring(1);return t[i]&&(i=t[i]),i},t}(a);t.URI=c},41:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=n(813),r=n(346),o=n(585);(s=t.Utils||(t.Utils={})).defer=function(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e},s.reducePromises=function(e,t){return e.reduce((function(e,t){return e.then(t)}),Promise.resolve(t))},s.str_utf8_length=function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},s.generateFakeSDP=function(e){if(e){var t=e.indexOf("o="),n=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,n)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},s.isDecimal=function(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t},s.createRandomToken=function(e,t){void 0===t&&(t=32);for(var n="",s=0;s<e;s++)n+=Math.floor(Math.random()*t).toString(t);return n},s.newTag=function(){return s.createRandomToken(10)},s.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=Math.floor(16*Math.random());return("x"===e?t:t%4+8).toString(16)}))},s.normalizeTarget=function(e,t){if(e){if(e.type===r.TypeStrings.URI)return e;if("string"==typeof e){var n=e.split("@"),a=void 0,c=void 0;switch(n.length){case 1:if(!t)return;a=e,c=t;break;case 2:a=n[0],c=n[1];break;default:a=n.slice(0,n.length-1).join("@"),c=n[n.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),e=i.C.SIP+":"+s.escapeUser(a)+"@"+c,o.Grammar.URIParse(e)}}},s.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},s.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},n=e.toLowerCase().replace(/_/g,"-").split("-"),s=n.length,i="",r=0;r<s;r++)0!==r&&(i+="-"),i+=n[r].charAt(0).toUpperCase()+n[r].substring(1);return t[i]&&(i=t[i]),i},s.sipErrorCause=function(e){for(var t in i.C.SIP_ERROR_CAUSES)if(-1!==i.C.SIP_ERROR_CAUSES[t].indexOf(e))return i.C.causes[t];return i.C.causes.SIP_FAILURE_CODE},s.getReasonPhrase=function(e,t){return t||i.C.REASON_PHRASE[e]||""},s.getReasonHeaderValue=function(e,t){return"SIP;cause="+e+';text="'+(t=s.getReasonPhrase(e,t))+'"'},s.getCancelReason=function(e,t){if(e&&e<200||e>699)throw new TypeError("Invalid statusCode: "+e);if(e)return s.getReasonHeaderValue(e,t)},s.buildStatusLine=function(e,t){if(!e||e<100||e>699)throw new TypeError("Invalid statusCode: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason: "+t);return"SIP/2.0 "+e+" "+(t=s.getReasonPhrase(e,t))+"\r\n"}},163:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){for(var n,s=[],i=e.split(/\r\n/),r=0;r<i.length;){var o=i[r];if(/^m=(?:audio|video)/.test(o))n={index:r,stripped:[]},s.push(n);else if(n){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(o);if(a&&t===a[2]){i.splice(r,1),n.stripped.push(a[1]);continue}}r++}for(var c=0,u=s;c<u.length;c++){for(var l=u[c],d=i[l.index].split(" "),g=3;g<d.length;)-1===l.stripped.indexOf(d[g])?g++:d.splice(g,1);i[l.index]=d.join(" ")}return i.join("\r\n")};t.stripTcpCandidates=function(e){return e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),Promise.resolve(e)},t.stripTelephoneEvent=function(e){return e.sdp=n(e.sdp||"","telephone-event"),Promise.resolve(e)},t.cleanJitsiSdpImageattr=function(e){return e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),Promise.resolve(e)},t.stripG722=function(e){return e.sdp=n(e.sdp||"","G722"),Promise.resolve(e)},t.stripRtpPayload=function(e){return function(t){return t.sdp=n(t.sdp||"",e),Promise.resolve(t)}},t.stripVideo=function(e){return e.sdp=function(e,t){var n=new RegExp("m=video.*$","gm"),s=new RegExp("^a=group:.*$","gm");if(n.test(e)){var i,r=(e=e.split(/^m=/gm).filter((function(e){if(e.substr(0,5)===t){if(i=e.match(/^a=mid:.*$/gm)){var n=i[0].match(/:.+$/g);n&&(i=n[0].substr(1))}return!1}return!0})).join("m=")).match(s);if(r&&1===r.length){var o=r[0],a=new RegExp(" *"+i+"[^ ]*","g");o=o.replace(a,""),e=e.split(s).join(o)}}return e}(e.sdp||"","video"),Promise.resolve(e)},t.addMidLines=function(e){var t=e.sdp||"";if(-1===t.search(/^a=mid.*$/gm)){var n=t.match(/^m=.*$/gm),s=t.split(/^m=.*$/gm);n&&n.forEach((function(e,t){n[t]=e+"\na=mid:"+t})),s.forEach((function(e,t){n&&n[t]&&(s[t]=e+n[t])})),t=s.join(""),e.sdp=t}return Promise.resolve(e)}},11:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(346),a=n(852),c=n(41),u=n(163),l=n(937),d=function(e){function t(t,s,i){var r=e.call(this)||this;r.type=o.TypeStrings.SessionDescriptionHandler,r.options=i||{},r.logger=t,r.observer=s,r.dtmfSender=void 0,r.shouldAcquireMedia=!0,r.CONTENT_TYPE="application/sdp",r.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}},r.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(r.options)),r.direction=r.C.DIRECTION.NULL,r.modifiers=r.options.modifiers||[],Array.isArray(r.modifiers)||(r.modifiers=[r.modifiers]);var a=n.g.window||n.g;return r.WebRTC={MediaStream:a.MediaStream,getUserMedia:a.navigator.mediaDevices.getUserMedia.bind(a.navigator.mediaDevices),RTCPeerConnection:a.RTCPeerConnection},r.iceGatheringTimeout=!1,r.initPeerConnection(r.options.peerConnectionOptions),r.constraints=r.checkAndDefaultConstraints(r.options.constraints),r}return i(t,e),t.defaultFactory=function(e,n){return new t(e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),new l.SessionDescriptionHandlerObserver(e,n),n)},t.prototype.close=function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach((function(e){e.track&&e.track.stop()})):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach((function(e){e.getTracks().forEach((function(e){e.stop()}))}))),this.resetIceGatheringComplete(),this.peerConnection.close())},t.prototype.getDescription=function(e,t){var n=this;void 0===e&&(e={}),void 0===t&&(t=[]),e.peerConnectionOptions&&this.initPeerConnection(e.peerConnectionOptions);var s=Object.assign({},this.constraints,e.constraints);return s=this.checkAndDefaultConstraints(s),JSON.stringify(s)!==JSON.stringify(this.constraints)&&(this.constraints=s,this.shouldAcquireMedia=!0),Array.isArray(t)||(t=[t]),t=t.concat(this.modifiers),Promise.resolve().then((function(){if(n.shouldAcquireMedia)return n.acquire(n.constraints).then((function(){n.shouldAcquireMedia=!1}))})).then((function(){return n.createOfferOrAnswer(e.RTCOfferOptions,t)})).then((function(e){return n.emit("getDescription",e),{body:e.sdp,contentType:n.CONTENT_TYPE}}))},t.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE},t.prototype.holdModifier=function(e){return e.sdp?(/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)?(e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),Promise.resolve(e)):Promise.resolve(e)},t.prototype.setDescription=function(e,t,n){var s=this;void 0===t&&(t={}),void 0===n&&(n=[]),t.peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions),Array.isArray(n)||(n=[n]),n=n.concat(this.modifiers);var i={type:this.hasOffer("local")?"answer":"offer",sdp:e};return Promise.resolve().then((function(){if(s.shouldAcquireMedia&&s.options.alwaysAcquireMediaFirst)return s.acquire(s.constraints).then((function(){s.shouldAcquireMedia=!1}))})).then((function(){return c.Utils.reducePromises(n,i)})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");throw s.logger.error(t.message),s.emit("peerConnection-setRemoteDescriptionFailed",t),t})).then((function(e){return s.emit("setDescription",e),s.peerConnection.setRemoteDescription(e)})).catch((function(i){if(i.type===o.TypeStrings.SessionDescriptionHandlerError)throw i;if(/^m=video.+$/gm.test(e)&&!t.disableAudioFallback)return t.disableAudioFallback=!0,s.setDescription(e,t,[u.stripVideo].concat(n));var r=new a.Exceptions.SessionDescriptionHandlerError("setDescription",i);throw r.error&&s.logger.error(r.error),s.emit("peerConnection-setRemoteDescriptionFailed",r),r})).then((function(){s.peerConnection.getReceivers?s.emit("setRemoteDescription",s.peerConnection.getReceivers()):s.emit("setRemoteDescription",s.peerConnection.getRemoteStreams()),s.emit("confirmed",s)}))},t.prototype.sendDtmf=function(e,t){if(void 0===t&&(t={}),!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var n=this.peerConnection.getSenders();n.length>0&&(this.dtmfSender=n[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var s=this.peerConnection.getLocalStreams();if(s.length>0){var i=s[0].getAudioTracks();i.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(i[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0},t.prototype.getDirection=function(){return this.direction},t.prototype.createOfferOrAnswer=function(e,t){var n=this;void 0===e&&(e={}),void 0===t&&(t=[]);var s=this.hasOffer("remote")?"createAnswer":"createOffer",i=this.peerConnection;return this.logger.log(s),i[s](e).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+s+"Failed");throw n.emit("peerConnection-"+s+"Failed",t),t})).then((function(e){return c.Utils.reducePromises(t,n.createRTCSessionDescriptionInit(e))})).then((function(e){return n.resetIceGatheringComplete(),n.logger.log("Setting local sdp."),n.logger.log("sdp is "+e.sdp||0),i.setLocalDescription(e)})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");throw n.emit("peerConnection-SetLocalDescriptionFailed",t),t})).then((function(){return n.waitForIceGatheringComplete()})).then((function(){var e=n.createRTCSessionDescriptionInit(n.peerConnection.localDescription);return c.Utils.reducePromises(t,e)})).then((function(e){return n.setDirection(e.sdp||""),e})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);throw n.logger.error(t.toString()),t}))},t.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}},t.prototype.addDefaultIceCheckingTimeout=function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e},t.prototype.addDefaultIceServers=function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e},t.prototype.checkAndDefaultConstraints=function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e},t.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)},t.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)},t.prototype.initPeerConnection=function(e){var t=this;void 0===e&&(e={}),(e=this.addDefaultIceCheckingTimeout(e)).rtcConfiguration=e.rtcConfiguration||{},e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(e.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",(function(e){t.logger.log("track added"),t.observer.trackAdded(),t.emit("addTrack",e)})):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){t.logger.log("stream added"),t.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e),e.candidate?t.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(t.logger.log("ICE candidate gathering complete"),t.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState),t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t),!t.iceGatheringTimer&&e.iceCheckingTimeout&&(t.iceGatheringTimeout=!1,t.iceGatheringTimer=setTimeout((function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds"),t.iceGatheringTimeout=!0,t.triggerIceGatheringComplete()}),e.iceCheckingTimeout));break;case"complete":t.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState)}t.logger.log("ICE Connection State changed to "+e),t.emit(e,t)}},t.prototype.acquire=function(e){var t=this;return e=this.checkAndDefaultConstraints(e),new Promise((function(n,s){t.logger.log("acquiring local media"),t.emit("userMediaRequest",e),e.audio||e.video?t.WebRTC.getUserMedia(e).then((function(e){t.observer.trackAdded(),t.emit("userMedia",e),n(e)})).catch((function(e){t.emit("userMediaFailed",e),s(e)})):n([])})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var n=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");throw t.logger.error(n.message),n.error&&t.logger.error(n.error),n})).then((function(e){t.logger.log("acquired local media streams");try{return t.peerConnection.removeTrack&&t.peerConnection.getSenders().forEach((function(e){t.peerConnection.removeTrack(e)})),e}catch(e){return Promise.reject(e)}})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var n=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");throw t.logger.error(n.message),n.error&&t.logger.error(n.error),n})).then((function(e){try{(e=[].concat(e)).forEach((function(e){t.peerConnection.addTrack?e.getTracks().forEach((function(n){t.peerConnection.addTrack(n,e)})):t.peerConnection.addStream(e)}))}catch(e){return Promise.reject(e)}return Promise.resolve()})).catch((function(e){if(e.type===o.TypeStrings.SessionDescriptionHandlerError)throw e;var n=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");throw t.logger.error(n.message),n.error&&t.logger.error(n.error),n}))},t.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t},t.prototype.isIceGatheringComplete=function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout},t.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=!1,this.logger.log("resetIceGatheringComplete"),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=void 0)},t.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var n=t[1];switch(n){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=n;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()},t.prototype.triggerIceGatheringComplete=function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=void 0))},t.prototype.waitForIceGatheringComplete=function(){return this.logger.log("waitForIceGatheringComplete"),this.isIceGatheringComplete()?(this.logger.log("ICE is already complete. Return resolved."),Promise.resolve()):(this.iceGatheringDeferred||(this.iceGatheringDeferred=c.Utils.defer()),this.logger.log("ICE is not complete. Returning promise"),this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve())},t}(r.EventEmitter);t.SessionDescriptionHandler=d},937:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(346),i=function(){function e(e,t){this.type=s.TypeStrings.SessionDescriptionHandlerObserver,this.session=e,this.options=t}return e.prototype.trackAdded=function(){this.session.emit("trackAdded")},e.prototype.directionChanged=function(){this.session.emit("directionChanged")},e}();t.SessionDescriptionHandlerObserver=i},263:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(7),a=n(192),c=n(163);!function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_NEW=1]="STATUS_NEW",e[e.STATUS_CONNECTING=2]="STATUS_CONNECTING",e[e.STATUS_CONNECTED=3]="STATUS_CONNECTED",e[e.STATUS_COMPLETED=4]="STATUS_COMPLETED"}(r=t.SimpleStatus||(t.SimpleStatus={}));var u=function(e){function t(t){var s=e.call(this)||this;if(t.media.remote.video?s.video=!0:s.video=!1,t.media.remote.audio?s.audio=!0:s.audio=!1,!s.audio&&!s.video)throw new Error("At least one remote audio or video element is required for Simple.");s.options=t;var i=n.g.navigator.userAgent.toLowerCase(),o=!1,u=!1;i.indexOf("safari")>-1&&i.indexOf("chrome")<0?o=!0:i.indexOf("firefox")>-1&&i.indexOf("chrome")<0&&(u=!0);var l={};return o&&(l.modifiers=[c.stripG722]),u&&(l.alwaysAcquireMediaFirst=!0),s.options.ua.uri?s.anonymous=!1:s.anonymous=!0,s.ua=new a.UA({uri:s.options.ua.uri,authorizationUser:s.options.ua.authorizationUser,password:s.options.ua.password,displayName:s.options.ua.displayName,userAgentString:s.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:l,transportOptions:{traceSip:s.options.ua.traceSip,wsServers:s.options.ua.wsServers}}),s.state=r.STATUS_NULL,s.logger=s.ua.getLogger("sip.simple"),s.ua.on("registered",(function(){s.emit("registered",s.ua)})),s.ua.on("unregistered",(function(){s.emit("unregistered",s.ua)})),s.ua.on("failed",(function(){s.emit("unregistered",s.ua)})),s.ua.on("invite",(function(e){if(s.state!==r.STATUS_NULL&&s.state!==r.STATUS_COMPLETED)return s.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();s.session=e,s.setupSession(),s.emit("ringing",s.session)})),s.ua.on("message",(function(e){s.emit("message",e)})),s}return i(t,e),t.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===r.STATUS_NULL||this.state===r.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},t.prototype.answer=function(){if(this.state===r.STATUS_NEW||this.state===r.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},t.prototype.reject=function(){if(this.state===r.STATUS_NEW||this.state===r.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},t.prototype.hangup=function(){if(this.state===r.STATUS_CONNECTED||this.state===r.STATUS_CONNECTING||this.state===r.STATUS_NEW)return this.state!==r.STATUS_CONNECTED?this.session.cancel():this.session?this.session.bye():void 0;this.logger.warn("No active call to hang up on")},t.prototype.hold=function(){if(this.state===r.STATUS_CONNECTED&&this.session&&!this.session.localHold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},t.prototype.unhold=function(){if(this.state===r.STATUS_CONNECTED&&this.session&&this.session.localHold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},t.prototype.mute=function(){this.state===r.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},t.prototype.unmute=function(){this.state===r.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},t.prototype.sendDTMF=function(e){this.state===r.STATUS_CONNECTED&&this.session?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},t.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},t.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},t.prototype.setupRemoteMedia=function(){var e=this;if(this.session){var t,s=this.session.sessionDescriptionHandler.peerConnection;s.getReceivers?(t=new n.g.window.MediaStream,s.getReceivers().forEach((function(e){var n=e.track;n&&t.addTrack(n)}))):t=s.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=t,this.options.media.remote.video.play().catch((function(){e.logger.log("play was rejected")}))):this.audio&&(this.options.media.remote.audio.srcObject=t,this.options.media.remote.audio.play().catch((function(){e.logger.log("play was rejected")})))}else this.logger.warn("No session to set remote media on")},t.prototype.setupLocalMedia=function(){if(this.session){if(this.video&&this.options.media.local&&this.options.media.local.video){var e,t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?(e=new n.g.window.MediaStream,t.getSenders().forEach((function(t){var n=t.track;n&&"video"===n.kind&&e.addTrack(n)}))):e=t.getLocalStreams()[0],this.options.media.local.video.srcObject=e,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}else this.logger.warn("No session to set local media on")},t.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},t.prototype.setupSession=function(){var e=this;this.session?(this.state=r.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",(function(){return e.onProgress()})),this.session.on("accepted",(function(){return e.onAccepted()})),this.session.on("rejected",(function(){return e.onEnded()})),this.session.on("failed",(function(){return e.onFailed()})),this.session.on("terminated",(function(){return e.onEnded()}))):this.logger.warn("No session to set up")},t.prototype.destroyMedia=function(){this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.close()},t.prototype.toggleMute=function(e){if(this.session){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach((function(t){t.track&&(t.track.enabled=!e)})):t.getLocalStreams().forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e})),t.getVideoTracks().forEach((function(t){t.enabled=!e}))}))}else this.logger.warn("No session to toggle mute")},t.prototype.onAccepted=function(){var e=this;this.session?(this.state=r.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler&&(this.session.sessionDescriptionHandler.on("addTrack",(function(){e.logger.log("A track has been added, triggering new remoteMedia setup"),e.setupRemoteMedia()})),this.session.sessionDescriptionHandler.on("addStream",(function(){e.logger.log("A stream has been added, trigger new remoteMedia setup"),e.setupRemoteMedia()}))),this.session.on("dtmf",(function(t,n){e.emit("dtmf",n.tone)})),this.session.on("bye",(function(){return e.onEnded()}))):this.logger.warn("No session for accepting")},t.prototype.onProgress=function(){this.state=r.STATUS_CONNECTING,this.emit("connecting",this.session)},t.prototype.onFailed=function(){this.onEnded()},t.prototype.onEnded=function(){this.state=r.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},t.C=r,t}(o.EventEmitter);t.Simple=u},708:function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(346),a=n(852),c=n(585),u=n(213),l=n(41);!function(e){e[e.STATUS_CONNECTING=0]="STATUS_CONNECTING",e[e.STATUS_OPEN=1]="STATUS_OPEN",e[e.STATUS_CLOSING=2]="STATUS_CLOSING",e[e.STATUS_CLOSED=3]="STATUS_CLOSED"}(r=t.TransportStatus||(t.TransportStatus={}));var d=function(e){function t(t,s){void 0===s&&(s={});var i=e.call(this,t,s)||this;return i.WebSocket=(n.g.window||n.g).WebSocket,i.type=o.TypeStrings.Transport,i.reconnectionAttempts=0,i.status=r.STATUS_CONNECTING,i.configuration={},i.loadConfig(s),i}return i(t,e),t.prototype.isConnected=function(){return this.status===r.STATUS_OPEN},t.prototype.sendPromise=function(e,t){if(void 0===t&&(t={}),!this.statusAssert(r.STATUS_OPEN,t.force))return this.onError("unable to send message - WebSocket not open"),Promise.reject();var n=e.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),Promise.resolve({msg:n})):(this.onError("unable to send message - WebSocket does not exist"),Promise.reject())},t.prototype.disconnectPromise=function(e){var t=this;return void 0===e&&(e={}),this.disconnectionPromise?this.disconnectionPromise:(e.code=e.code||1e3,this.statusTransition(r.STATUS_CLOSING,e.force)?(this.emit("disconnecting"),this.disconnectionPromise=new Promise((function(n,s){t.disconnectDeferredResolve=n,t.reconnectTimer&&(clearTimeout(t.reconnectTimer),t.reconnectTimer=void 0),t.ws?(t.stopSendingKeepAlives(),t.logger.log("closing WebSocket "+t.server.wsUri),t.ws.close(e.code,e.reason)):s("Attempted to disconnect but the websocket doesn't exist")})),this.disconnectionPromise):this.status===r.STATUS_CLOSED?Promise.resolve({overrideEvent:!0}):this.connectionPromise?this.connectionPromise.then((function(){return Promise.reject("The websocket did not disconnect")})).catch((function(){return Promise.resolve({overrideEvent:!0})})):Promise.reject("The websocket did not disconnect"))},t.prototype.connectPromise=function(e){var t=this;return void 0===e&&(e={}),this.status!==r.STATUS_CLOSING||e.force?(this.connectionPromise||(this.server=this.server||this.getNextWsServer(e.force),this.connectionPromise=new Promise((function(n,s){if((t.status===r.STATUS_OPEN||t.status===r.STATUS_CLOSING)&&!e.force)return t.logger.warn("WebSocket "+t.server.wsUri+" is already connected"),void s("Failed status check - attempted to open a connection but already open/closing");t.connectDeferredResolve=n,t.status=r.STATUS_CONNECTING,t.emit("connecting"),t.logger.log("connecting to WebSocket "+t.server.wsUri),t.disposeWs();try{t.ws=new WebSocket(t.server.wsUri,"sip")}catch(e){return t.ws=null,t.status=r.STATUS_CLOSED,t.onError("error connecting to WebSocket "+t.server.wsUri+":"+e),void s("Failed to create a websocket")}t.ws?(t.connectionTimeout=setTimeout((function(){t.statusTransition(r.STATUS_CLOSED),t.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+t.configuration.connectionTimeout+"s"),t.emit("disconnected",{code:1e3}),t.connectionPromise=void 0,s("Connection timeout")}),1e3*t.configuration.connectionTimeout),t.boundOnOpen=t.onOpen.bind(t),t.boundOnMessage=t.onMessage.bind(t),t.boundOnClose=t.onClose.bind(t),t.boundOnError=t.onWebsocketError.bind(t),t.ws.addEventListener("open",t.boundOnOpen),t.ws.addEventListener("message",t.boundOnMessage),t.ws.addEventListener("close",t.boundOnClose),t.ws.addEventListener("error",t.boundOnError)):s("Unexpected instance websocket not set")}))),this.connectionPromise):Promise.reject("WebSocket "+this.server.wsUri+" is closing")},t.prototype.onMessage=function(e){var t,n=e.data;if(/^(\r\n)+$/.test(n))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(n){if("string"!=typeof n){try{t=String.fromCharCode.apply(null,new Uint8Array(n))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+n+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+n+"\n"),t=n;this.emit("message",t)}else this.logger.warn("received empty message, message discarded")},t.prototype.onOpen=function(){if(this.status===r.STATUS_CLOSED){var e=this.ws;return this.disposeWs(),void e.close(1e3)}this.status=r.STATUS_OPEN,this.emit("connected"),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0),this.logger.log("WebSocket "+this.server.wsUri+" connected"),void 0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.reconnectionAttempts=0,this.disconnectionPromise=void 0,this.disconnectDeferredResolve=void 0,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")},t.prototype.onClose=function(e){if(this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.status!==r.STATUS_CLOSING&&(this.logger.warn("WebSocket closed without SIP.js requesting it"),this.emit("transportError")),this.stopSendingKeepAlives(),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0,this.connectionPromise=void 0,this.connectDeferredResolve=void 0,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(r.STATUS_CLOSED),void(this.disconnectDeferredResolve=void 0);this.status=r.STATUS_CLOSED,this.emit("disconnected",{code:e.code,reason:e.reason}),this.reconnect()},t.prototype.disposeWs=function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.ws=void 0)},t.prototype.onError=function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")},t.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")},t.prototype.reconnect=function(){var e=this;if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("no available ws servers left - going to closed state"),this.status=r.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri),this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.server=this.getNextWsServer(),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=setTimeout((function(){e.connect(),e.reconnectTimer=void 0}),1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))},t.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++)t[e].isError=!1},t.prototype.getNextWsServer=function(e){if(void 0===e&&(e=!1),!this.noAvailableServers()){for(var t=[],n=0,s=this.configuration.wsServers;n<s.length;n++){var i=s[n];i.isError&&!e||(0===t.length?t.push(i):i.weight>t[0].weight?t=[i]:i.weight===t[0].weight&&t.push(i))}return t[Math.floor(Math.random()*t.length)]}this.logger.warn("attempted to get next ws server but there are no available ws servers left")},t.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++)if(!t[e].isError)return!1;return!0},t.prototype.sendKeepAlive=function(){var e=this;if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=setTimeout((function(){e.emit("keepAliveDebounceTimeout"),e.clearKeepAliveTimeout()}),1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")},t.prototype.clearKeepAliveTimeout=function(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0},t.prototype.startSendingKeepAlives=function(){var e,t,n=this;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval((function(){n.sendKeepAlive(),n.startSendingKeepAlives()}),(t=.8*(e=this.configuration.keepAliveInterval),1e3*(Math.random()*(e-t)+t))))},t.prototype.stopSendingKeepAlives=function(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0},t.prototype.statusAssert=function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(r)[this.status]+" as "+Object.keys(r)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(r)[e]+" but is currently "+Object.keys(r)[this.status]),!1))},t.prototype.statusTransition=function(e,t){return void 0===t&&(t=!1),this.logger.log("Attempting to transition status from "+Object.keys(r)[this.status]+" to "+Object.keys(r)[e]),e===r.STATUS_CONNECTING&&this.statusAssert(r.STATUS_CLOSED,t)||e===r.STATUS_OPEN&&this.statusAssert(r.STATUS_CONNECTING,t)||e===r.STATUS_CLOSING&&this.statusAssert(r.STATUS_OPEN,t)||e===r.STATUS_CLOSED?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)},t.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1},n=this.getConfigurationCheck();for(var s in n.mandatory){if(!e.hasOwnProperty(s))throw new a.Exceptions.ConfigurationError(s);var i=e[s];if(void 0===(r=n.mandatory[s](i)))throw new a.Exceptions.ConfigurationError(s,i);t[s]=r}for(var s in n.optional)if(e.hasOwnProperty(s)){var r;if((i=e[s])instanceof Array&&0===i.length||null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(r=n.optional[s](i)))throw new a.Exceptions.ConfigurationError(s,i);t[s]=r}var o={};for(var s in t)t.hasOwnProperty(s)&&(o[s]={value:t[s]});for(var s in Object.defineProperties(this.configuration,o),this.logger.log("configuration parameters after validation:"),t)t.hasOwnProperty(s)&&this.logger.log("· "+s+": "+JSON.stringify(t[s]))},t.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if("string"==typeof e)e=[{wsUri:e}];else{if(!(e instanceof Array))return;for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={wsUri:e[t]})}if(0===e.length)return!1;for(var n=0,s=e;n<s.length;n++){var i=s[n];if(!i.wsUri)return;if(i.weight&&!Number(i.weight))return;var r=c.Grammar.parse(i.wsUri,"absoluteURI");if(-1===r)return;if(["wss","ws","udp"].indexOf(r.scheme)<0)return;i.sipUri="<sip:"+r.host+(r.port?":"+r.port:"")+";transport="+r.scheme.replace(/^wss$/i,"ws")+";lr>",i.weight||(i.weight=0),i.isError=!1,i.scheme=r.scheme.toUpperCase()}return e},keepAliveInterval:function(e){if(l.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},keepAliveDebounce:function(e){if(l.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(e){if(l.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},maxReconnectionAttempts:function(e){if(l.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},reconnectionTimeout:function(e){if(l.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}}}}},t.C=r,t}(u.Transport);t.Transport=d},529:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(163);t.Modifiers=s;var i=n(263);t.Simple=i.Simple;var r=n(11);t.SessionDescriptionHandler=r.SessionDescriptionHandler;var o=n(708);t.Transport=o.Transport},96:(e,t,n)=>{"use strict";n(266).ClientContext;var s=n(813);t.C=s.C,n(321).Dialog,n(458).DigestAuthentication;var i=n(346);i.DialogStatus,i.SessionStatus,i.TransactionStatus,i.TypeStrings,i.UAStatus,n(852).Exceptions,n(585).Grammar,n(838).LoggerFactory,n(47).NameAddrHeader,n(125).Parser,n(928).PublishContext,n(88).RegisterContext,n(948).RequestSender,n(54).SanityCheck.sanityCheck,n(598).ServerContext;var r=n(36);r.InviteClientContext,r.InviteServerContext,r.ReferClientContext,r.ReferServerContext,r.Session;var o=n(557);o.IncomingRequest,o.IncomingResponse,o.OutgoingRequest,n(35).Subscription,n(312).Timers;var a=n(615);a.AckClientTransaction,a.checkTransaction,a.InviteClientTransaction,a.InviteServerTransaction,a.NonInviteClientTransaction,a.NonInviteServerTransaction,n(213).Transport;var c=n(192);t.UA=c.UA,n(750).URI,n(41).Utils;var u=n(529);t.Nc=u;var l=n(775);l.title,l.version},775:e=>{"use strict";e.exports=JSON.parse('{"name":"sip.js","title":"SIP.js","description":"A simple, intuitive, and powerful JavaScript signaling library","version":"0.13.5","license":"MIT","main":"lib/index.js","homepage":"https://sipjs.com","author":"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)","contributors":[{"url":"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],"repository":{"type":"git","url":"https://github.com/onsip/SIP.js.git"},"keywords":["sip","websocket","webrtc","library","javascript"],"dependencies":{"crypto-js":"^3.1.9-1"},"devDependencies":{"@types/node":"^11.9.0","circular-dependency-plugin":"^5.0.2","jasmine-core":"^3.3.0","karma":"^4.0.0","karma-chrome-launcher":"^2.2.0","karma-cli":"^2.0.0","karma-jasmine":"^2.0.1","karma-jasmine-html-reporter":"^1.4.0","karma-mocha-reporter":"^2.2.5","karma-webpack":"^3.0.5","pegjs":"^0.10.0","ts-loader":"^5.3.3","ts-pegjs":"0.2.2","tslint":"^5.12.1","typescript":"^3.3.3","webpack":"^4.29.3","webpack-cli":"^3.2.3"},"engines":{"node":">=8.0"},"scripts":{"prebuild":"tslint -p tsconfig.json -c tslint.json","generate-grammar":"node build/grammarGenerator.js","build-reg-bundle":"webpack --progress --config build/webpack.config.js --env.buildType reg","build-min-bundle":"webpack --progress --config build/webpack.config.js --env.buildType min","build-bundles":"npm run build-reg-bundle && npm run build-min-bundle","build-lib":"tsc","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js  dist/sip-$npm_package_version.min.js","build":"npm run generate-grammar && npm run build-lib && npm run build-reg-bundle && npm run build-min-bundle && npm run copy-dist-files","browserTest":"sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run","commandLineTest":"karma start --reporters mocha --browsers ChromeHeadless --single-run","buildAndTest":"npm run build && npm run commandLineTest","buildAndBrowserTest":"npm run build && npm run browserTest"},"types":"./types"}')}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";function e(e,t,n,s){return new(n||(n=Promise))((function(i,r){function o(e){try{c(s.next(e))}catch(e){r(e)}}function a(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}n.d(s,{default:()=>jn}),"function"==typeof SuppressedError&&SuppressedError;const t="x-engage-client-request-id";var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let r;const o=new Uint8Array(16);function a(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));var u=()=>{const e=`:${function(e,t,n){if(i.randomUUID&&!t&&!e)return i.randomUUID();const s=(e=e||{}).random||(e.rng||a)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=s[e];return t}return function(e,t=0){return c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]}(s)}()}`;return{[t]:e}};class l{static getClaimsFromToken(e){if(e&&0===e.length)throw new Error("No accessToken was provided");const t=e&&e.split(".")[1];if("string"!=typeof t||0===t.length)throw new Error("Invalid token was provided");try{const e=window.atob(t);return JSON.parse(e)}catch(e){throw new Error("Invalid token was provided")}}static isObject(e){return"object"==typeof e&&null!==e}static dispatchStorageEvent(){const e=window.document.createEvent("Event");e.initEvent("storage",!0,!0),window.dispatchEvent(e)}static isJwtTimeExpired(e){return Math.round(1e3*e-Date.now()-200)<=0}}let d=window.location.origin;function g(e,t){if(!l.isObject(e))return;const n=e.headers;l.isObject(n)&&Object.getOwnPropertyNames(n).forEach((e=>{t.setRequestHeader(e,n&&n[e]||"")}))}function p(e){const t=u();Object.keys(t).forEach((n=>{e.setRequestHeader(n,t[n])}))}function h(e,t,n){n.addEventListener("error",(e=>t(e))),n.addEventListener("timeout",(()=>t(new Error("request timeout")))),n.addEventListener("load",(function(){200!==this.status?t({status:this.status,response:this.responseText}):e({status:this.status,response:this.responseText})}))}function f(e){const t=e&&e.headers&&e.headers["Content-Type"];let n=e&&e.body||"";if("application/json"===t)n=JSON.stringify(n);else if(l.isObject(n)){const e=Object.assign({},n);n="",n+=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}return n}class S{static getApiBase(){return d}static setApiBase(e){d=e}static get(e,t){return new Promise(((n,s)=>{const i=new XMLHttpRequest;i.open("GET",d+e),g(t,i),p(i),h(n,s,i),i.send()}))}static post(e,t){return new Promise(((n,s)=>{const i=new XMLHttpRequest;i.open("POST",d+e),g(t,i),p(i),h(n,s,i),i.send(f(t))}))}static delete(e,t){return new Promise(((n,s)=>{const i=new XMLHttpRequest;i.open("DELETE",d+e),t&&g(t,i),p(i),h(n,s,i),i.send()}))}static externalPost(e,t,n){return new Promise(((s,i)=>{const r=new XMLHttpRequest;r.open("POST",e+t),g(n,r),p(r),h(s,i,r),r.send(f(n))}))}}const T={},m=Object.freeze({LOGIN:"login",FETCH_TOKEN_FROM_AUTH_CODE:"fetchTokenFromAuthCode",VALIDATE_TOKEN:"validateToken",REFRESH_TOKEN:"refreshToken",FULL_USER_DETAILS:"fullUserDetails",PERMISSIONS:"permissions",REFRESH_RC_TOKEN:"refreshRcToken"});class _{static get KEYS(){return m}static setIfEmpty(e,t){if("string"==typeof e&&"function"==typeof t&&!T[e]){const n=t();n&&"object"==typeof n&&"function"==typeof n.then&&(T[e]=n.then((e=>e)).finally((()=>{delete T[e]})))}}static get(e){return T[e]}}const I="OMNICHANNEL";var C;!function(e){e.ACCESS_TOKEN="accessToken",e.REFRESH_TOKEN="refreshToken",e.DIGITAL_TOKEN="digitalToken",e.TOKEN_TYPE="tokenType",e.USER_DETAILS="userDetails",e.FULL_USER_DETAILS="fullUserDetails",e.RC_ACCESS_TOKEN="rcAccessToken",e.RC_REFRESH_TOKEN="rcRefreshToken",e.RC_DETAILS="rcDetails"}(C||(C={}));const v={redirectUrl:null,accessToken:"",platformId:"",refreshToken:"",tokenType:"",iqUrl:"",port:0,adminId:null,rcUser:null,ssoLogin:!1,adminUrl:null,agentUrl:null,analyticsUrl:null,mainAccountId:null,managedMainAccountIds:null,loginHashcode:null,agentDetails:null,passwordReset:!1,userManagedByRC:!1,availableWEM:!1,availableRingSense:!1,regionalSettings:{homeCountry:1,homeCountryCode:"1",timeFormat:null,timezone:null,language:null,greetingLanguage:null,formattingLocale:null},esu:!1,rcPlatform:"",agentAssistantClientId:"",agentAssistantDomain:"",customerDataClientId:"",customerDataDomain:""},y={accountType:I,adminId:null,digitalAccountId:null,digitalAccountApiUrl:null,digitalAccountAdminUrl:null,digitalAccountEmbedUrl:null,agentDetails:null,rcUserId:null,rcAccountId:null,evMainAccountId:null,inboxModeEnabled:!1,taskModeEnabled:!1,digitalAdminEnabled:!1,digitalAnalyticsEnabled:!1,digitalAgentEnabled:!1},E={rcPlatform:"",agentAssistantClientId:"",agentAssistantDomain:"",customerDataClientId:"",customerDataDomain:""},R=e=>"engage-auth:"+e;function A(e,t){window.localStorage.setItem(R(e),t),l.dispatchStorageEvent()}function b(e){return window.localStorage.getItem(R(e))||""}function N(e){window.localStorage.removeItem(R(e)),l.dispatchStorageEvent()}class O{static getAccessToken(){return b(C.ACCESS_TOKEN)}static setAccessToken(e){A(C.ACCESS_TOKEN,e)}static getRefreshToken(){return b(C.REFRESH_TOKEN)}static setRefreshToken(e){A(C.REFRESH_TOKEN,e)}static getTokenType(){return b(C.TOKEN_TYPE)}static setTokenType(e){A(C.TOKEN_TYPE,e)}static getRCAccessToken(){return b(C.RC_ACCESS_TOKEN)}static setRCAccessToken(e){A(C.RC_ACCESS_TOKEN,e)}static getRCRefreshToken(){return b(C.RC_REFRESH_TOKEN)}static setRCRefreshToken(e){A(C.RC_REFRESH_TOKEN,e)}static getRCDetails(){try{const e=b(C.RC_DETAILS);if(!e)return E;const t=JSON.parse(e);return l.isObject(t)&&t||E}catch(e){return window.console.error("Engage-Auth-JS: ",e),E}}static setRCDetails(e){A(C.RC_DETAILS,JSON.stringify(e))}static getUserDetails(){try{const e=b(C.USER_DETAILS);if(e){const t=JSON.parse(e);return l.isObject(t)&&t||v}return v}catch(e){return window.console.error("Engage-Auth-JS: ",e),v}}static setUserDetails(e){A(C.USER_DETAILS,JSON.stringify(e))}static setFullUserDetails(e){A(C.FULL_USER_DETAILS,JSON.stringify(e))}static getFullUserDetails(){try{const e=b(C.FULL_USER_DETAILS);if(e){const t=JSON.parse(e);return l.isObject(t)&&t||y}return y}catch(e){return window.console.error("Engage-Auth-JS: ",e),y}}static clearSession(){Object.values(C).forEach(N)}}O.makeKey=R;const D="rcx_client_app_type",w="RCX_UI";var x,U,q,k;(k=x||(x={})).ADMIN="admin",k.AGENT="agent",k.ANALYTICS="analytics",k.NONE="none",k.RESET_PASSWORD="reset_password",function(e){e.ADMIN="ADMIN",e.AGENT="AGENT",e.ANALYTICS="ANALYTICS",e.SSO="SSO"}(U||(U={})),function(e){e.AGENT="agent",e.ADMIN="admin"}(q||(q={}));const P={};const L=function(){const e=Symbol();return function(e,t){let n=t;var s;!function(e){return!!e&&"[object Function]"==={}.toString.call(e)}(n)?Array.isArray(n)?n=[...n]:!("object"!=typeof(s=n)||Array.isArray(s)||function(e){return null==e}(s)||s instanceof Date)&&(n=Object.assign({},n)):n=n(),P[e]={value:n,originalValue:t}}(e,{jwt:"",exp:0,type:null,id:""}),Object.defineProperty({},"value",{get:()=>P[e].value,set(t){P[e].value=t}})}();class M{static getAdminLoginUrl(){return this.getLoginUrl()}static navigateToAdminLogin(){window.location.href=this.getAdminLoginUrl()}static getAgentLoginUrl(){return this.getLoginUrl()}static navigateToAgentLogin(){window.location.href=this.getAgentLoginUrl()}static getLoginUrl(e={}){const t=S.getApiBase()+"/",n=F.getUserDetails(),s={};let i,r=x.NONE,o="",a="",c="";l.isObject(e)&&(r=e.fallbackSessionType||r,o="string"==typeof e.errorMessage&&e.errorMessage||o),o.length>0&&(s.error=o);try{i=F.getSessionType()}catch(e){i=r}switch(i){case x.ADMIN:case x.RESET_PASSWORD:a=`${t}login/admin`,s.plat=n&&n.platformId;break;case x.ANALYTICS:a=`${t}login/analytics`,s.plat=n&&n.platformId;break;case x.AGENT:a=`${t}login/agent`,s.plat=n&&n.platformId;break;default:a=t}c+=Object.keys(s).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(s[e]||"")}`)).join("&"),F.isDefaultClientAppType()||(a+=`?${D}=${F.rcxClientAppType}`);const u=a.includes("?")?"&":"?";return a+(c.length>0?`${u}${c}`:"")}static getAgentUrl(e){const{agentUrl:t}=O.getUserDetails(),n=F.isCRMClientAppType()||F.isEmbeddedAgentClientAppType()?F.rcxClientAppType:"";return"string"==typeof t&&t.length>0?`${t}?agentId=${e}${n?`&${D}=${n}`:""}`:""}static getAdminUrl(){const{adminUrl:e}=O.getUserDetails(),t=F.isEmbeddedAdminClientAppType()?F.rcxClientAppType:"";return"string"==typeof e&&e?`${e}${t?`?${D}=${t}`:""}`:""}static getAnalyticsUrl(){const{analyticsUrl:e}=O.getUserDetails();return"string"==typeof e&&e||""}}function H({response:e}){try{const t=JSON.parse(e);O.setAccessToken(t.accessToken||""),delete t.accessToken,O.setRefreshToken(t.refreshToken||""),delete t.refreshToken,O.setTokenType(t.tokenType||""),delete t.tokenType,delete t.rcAccessToken,delete t.rcRefreshToken;const{redirectUrl:n}=O.getUserDetails();"string"==typeof n&&n.length>0&&!t.redirectUrl&&(t.redirectUrl=n),O.setUserDetails(t)}catch(e){throw new Error("Couldn't deserialize server response!")}}class F{static isDefaultClientAppType(){return F.rcxClientAppType===w}static isEmbeddedAgentClientAppType(){return"RCX_EMBEDDED_AGENT"===F.rcxClientAppType}static isEmbeddedAdminClientAppType(){return"RCX_EMBEDDED_ADMIN"===F.rcxClientAppType}static isCRMClientAppType(){switch(F.rcxClientAppType){case"RCX_ZENDESK":case"RCX_SALESFORCE":case"RCX_DYNAMICS365":case"RCX_ZOHO":case"RCX_HUBSPOT":case"RCX_SERVICE_NOW":case"RCX_WHITELABEL_CRM":case"RCX_NETSUITE":case"RCX_FRESHDESK":return!0;default:return!1}}static isLoggedIn(){return O.getRefreshToken().length>0}static getUserDetails(){return O.getUserDetails()}static getRCDetails(){return O.getRCDetails()}static getAuthHeader(){return{Authorization:`${O.getTokenType()} ${O.getAccessToken()}`}}static getRCAuthHeader(){return{Authorization:`${O.getTokenType()} ${O.getRCAccessToken()}`}}static getXAuthToken(){return l.getClaimsFromToken(O.getAccessToken()).xauth}static getAccessToken(){return O.getAccessToken()}static validateToken(){return _.setIfEmpty(_.KEYS.VALIDATE_TOKEN,(()=>S.get("/api/auth/token/validate",{headers:Object.assign(Object.assign({},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}),this.getAuthHeader())}))),_.get(_.KEYS.VALIDATE_TOKEN)}static getSessionType(){const e=l.getClaimsFromToken(O.getAccessToken());if(e.lapp)switch(e.lapp){case U.ADMIN:return x.ADMIN;case U.AGENT:return x.AGENT;case U.ANALYTICS:return x.ANALYTICS;case U.SSO:return x.NONE}const{passwordReset:t=!1}=O.getUserDetails();if(t)return x.RESET_PASSWORD;throw new Error("Couldn't determine session type!")}static isSuperUser(){return l.getClaimsFromToken(O.getAccessToken()).esu}static getClaims(){return l.getClaimsFromToken(O.getAccessToken())}static isAccessTokenExpired(){const{exp:e}=this.getClaims();return l.isJwtTimeExpired(e)}static clearRedirectUrl(){const e=O.getUserDetails();l.isObject(e)&&delete e.redirectUrl,O.setUserDetails(e)}static clearSession(){O.clearSession()}static getDigitalJwt({modifier:t,evSubAccountId:n,agentId:s,force:i}){return e(this,void 0,void 0,(function*(){const{jwt:e,exp:r,type:o,id:a}=L.value,c={[q.ADMIN]:n,[q.AGENT]:s}[t];if(!i&&e&&t===o&&c===a&&!l.isJwtTimeExpired(r))return Promise.resolve(e);this.isAccessTokenExpired()&&(yield this.refreshToken());let u=`/api/auth/token/digitaljwt/${t}`;t===q.ADMIN&&n&&/^\d+$/.test(n)&&(u+=`?evSubAccountId=${n}`),t===q.AGENT&&s&&(u+=`?agentId=${s}`);const d=yield S.get(u,{headers:Object.assign(Object.assign({},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}),this.getAuthHeader())}).then((e=>e.response));return(({jwt:e,exp:t,type:n,id:s})=>{L.value.jwt=e,L.value.exp=t,L.value.type=n,L.value.id=s})({jwt:d,exp:l.getClaimsFromToken(d).exp,type:t,id:c||""}),Promise.resolve(d)}))}static init(e){return new Promise(((t,n)=>{this.initClientAppType(),this.fetchTokenFromAuthCode().then((()=>{t("ok")})).catch((()=>this.refreshToken().then((()=>{t("ok")})).catch((()=>{n("invalid token"),e&&(window.location.href=M.getLoginUrl())}))))}))}static refreshToken(e){const t={refresh_token:O.getRefreshToken()};return"string"==typeof e&&e.length>0&&(t["X-Auth-Token"]=e),_.setIfEmpty(_.KEYS.REFRESH_TOKEN,(()=>S.post("/api/auth/token/refresh",{headers:Object.assign(Object.assign({},{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}),this.getAuthHeader()),body:t}).then((e=>(H(e),"ok"))))),_.get(_.KEYS.REFRESH_TOKEN)}static refreshRCToken(){const{rcPlatform:e}=O.getUserDetails(),t={grant_type:"refresh_token",refresh_token:O.getRCRefreshToken(),client_id:"GBN6JgdsTmWpaSesm0jjvg"};return _.setIfEmpty(_.KEYS.REFRESH_RC_TOKEN,(()=>S.externalPost(e,"/restapi/oauth/token",{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then((e=>{const t=JSON.parse(e.response);return O.setRCAccessToken(t.access_token||""),O.setRCRefreshToken(t.refresh_token||""),"ok"})))),_.get(_.KEYS.REFRESH_RC_TOKEN)}static getRCAuthCode(t,n=!0){return e(this,void 0,void 0,(function*(){try{yield this.refreshRCToken()}catch(e){return yield this.logout(),this.clearSession(),window.location.href=M.getLoginUrl(),Promise.reject("invalid token")}try{const e=yield this.generateRCAuthCode(t),n=JSON.parse(e);return Promise.resolve(n.code)}catch(e){return n?this.getRCAuthCode(t,!1):(yield this.logout(),this.clearSession(),window.location.href=M.getLoginUrl(),Promise.reject("invalid token"))}}))}static generateRCAuthCode(t){return e(this,void 0,void 0,(function*(){const{rcPlatform:e}=O.getUserDetails(),n={clientId:t};try{const t=yield S.externalPost(e,"/restapi/v1.0/interop/generate-code",{headers:Object.assign({"Content-Type":"application/json"},this.getRCAuthHeader()),body:n});return Promise.resolve(t.response)}catch(e){return Promise.reject(e)}}))}static initClientAppType(){const e=new URLSearchParams(window.location.search);this.rcxClientAppType=e.get(D)||w,window.__settings.rcxClientAppType=this.rcxClientAppType}static fetchTokenFromAuthCode(){var e,t;const n=new URLSearchParams(window.location.search),s=n.get("code");if("string"==typeof s&&s.length>0){try{if(window.opener&&(null===(e=window.opener)||void 0===e?void 0:e.handleCallbackUri)){const e=null===(t=window.opener)||void 0===t?void 0:t.handleCallbackUri;return delete window.opener.handleCallbackUri,e&&e(window.location.href),window.close(),Promise.reject("Handled in opener")}}catch(e){}_.setIfEmpty(_.KEYS.FETCH_TOKEN_FROM_AUTH_CODE,(()=>S.post("/api/auth/login/code",{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:{code:s}}).then((e=>(H(e),function({response:e}){try{const t=JSON.parse(e);O.setRCAccessToken(t.rcAccessToken||""),O.setRCRefreshToken(t.rcRefreshToken||"");const n={agentAssistantClientId:t.agentAssistantClientId,agentAssistantDomain:t.agentAssistantDomain,customerDataClientId:t.customerDataClientId,customerDataDomain:t.customerDataDomain,rcPlatform:t.rcPlatform};O.setRCDetails(n)}catch(e){throw new Error("Couldn't deserialize server response!")}}(e),"ok"))).finally((()=>{try{n.delete("code");const e=window.location.href.split("?")[0],t=n.get(D)?`${e}?${n.toString()}`:e;window.history.pushState({path:t},"",t)}catch(e){window.console.log("error removing code query param")}}))))}return _.get(_.KEYS.FETCH_TOKEN_FROM_AUTH_CODE)||Promise.reject("ok")}static legacyLogin(e){if(!l.isObject(e)||"string"!=typeof e.username||"string"!=typeof e.password||"string"!=typeof e.platformId||"string"!=typeof e.loginType||"admin"!==e.loginType&&"agent"!==e.loginType&&"analytics"!==e.loginType)return Promise.reject(`Credentials must be an object of the format {"username": string, "password": string, "platformId": string, "loginType": "admin"|"agent"|"analytics"}, got ${l.isObject(e)?JSON.stringify(e):e}`);const{username:t,password:n,platformId:s,loginType:i}=e,r={username:t,password:n,platformId:s,redirectToApp:!0};return _.setIfEmpty(_.KEYS.LOGIN,(()=>S.post(`/api/auth/login/${i}`,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:r}).then((e=>(H(e),"ok"))))),_.get(_.KEYS.LOGIN)}static logout(){const e=O.getRefreshToken();return S.delete(`/api/auth/logout/${e}`,null)}}F.rcxClientAppType=w;const G={Agent:!1,Admin:!1,Analytics:!1,WEMEnterprise:!1,RingSense:!1};class j{static getFullUserDetails(){return O.getFullUserDetails()}static getLoggedInUser(e={}){const{force:t,evSubAccountId:n}=e,s=Object.assign(Object.assign({},F.getAuthHeader()),{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}),i=j.getFullUserDetails();return i&&this.anyIdExists(i)&&!t?Promise.resolve(i):(_.setIfEmpty(_.KEYS.FULL_USER_DETAILS,(()=>{const e=new URLSearchParams;return n&&e.append("evSubAccountId",n),S.get("/api/v6/userDetail/self"+(e.size?"?"+e.toString():""),{headers:s}).then((e=>{try{const t=JSON.parse(e.response);return O.setFullUserDetails(t),t}catch(e){window.console.error("There was an error parsing the response from /userDetail/self: ",e)}}))})),_.get(_.KEYS.FULL_USER_DETAILS))}static anyIdExists(e){let t=!1;return null!==e.agentDetails&&e.agentDetails.length>0&&(t=e.agentDetails.some((e=>e.agentId))),null!==e.rcUserId||null!==e.adminId||t}static getPermissions(t={}){return e(this,void 0,void 0,(function*(){const{force:e,evSubAccountId:n}=t,s=Object.assign({},G),{availableWEM:i,availableRingSense:r}=yield F.getUserDetails(),{adminId:o,agentDetails:a}=yield j.getLoggedInUser({force:e,evSubAccountId:n});return s.Analytics=null!==o,s.Admin=null!==o,s.Agent=null!==a&&a.length>0,s.WEMEnterprise=i,s.RingSense=void 0===r?i:r,(F.isCRMClientAppType()||F.isEmbeddedAgentClientAppType())&&(s.Admin=!1,s.Analytics=!1,s.WEMEnterprise=!1,s.RingSense=!1),F.isEmbeddedAdminClientAppType()&&(s.Agent=!1,s.Analytics=!1,s.WEMEnterprise=!1,s.RingSense=!1),s}))}}const B=/([?&])([^=]+)=([^&]+)/g,K=/([0-9a-fA-F:]*\d{1,3}\.\d{1,3})\.\d{1,3}\.\d{1,3}/g,J=/(([0-9a-fA-F]{0,4}:){4})[0-9a-fA-F]{0,4}:[0-9a-fA-F]{0,4}:[0-9a-fA-F]{0,4}:[0-9a-fA-F]{0,4}/g,W=/((\w{2}[:-]){3})(\w{2}[:-]){2}\w{2}/g;class V{static setAdvanceMode(e){this.advanceMode=e}static maskEmail(e){if(this.advanceMode||!e)return e;const t=e.indexOf("@");if(-1!==t){const n=e.substring(0,t);return this.maskString(n)+e.substring(t)}return this.maskString(e)}static maskPhone(e){if(this.advanceMode||!e)return e;let t=e;const n=e.length;let s=0;return n>this.kMaskMinLen&&(s=n-this.kMaskMinLen),s>this.kPhoneNumberRetainedDigits&&(s=this.kPhoneNumberRetainedDigits),t=t.split("").map(((e,n)=>n<t.length-s&&e>="0"&&e<="9"?"*":e)).join(""),t}static maskIPv4(e){return this.advanceMode||!e?e:e.replace(K,"$1.*.*")}static maskIPv6(e){return this.advanceMode||!e?e:e.replace(J,"$1****:****:****:****")}static maskIP(e){return this.advanceMode||!e?e:K.test(e)?e.replace(K,"$1.*.*"):e.replace(J,"$1****:****:****:****")}static maskMacAddress(e){return this.advanceMode||!e?e:e.replace(W,"$1*:*:*")}static maskToken(e){if(this.advanceMode||!e)return e;let t=e.length;t>this.kTokenRetainedLen&&(t=this.kTokenRetainedLen);let n=0;t>this.kMaskMinLen&&(n=t-this.kMaskMinLen),n>this.kTokenRetainedChars&&(n=this.kTokenRetainedChars);let s="*".repeat(t);for(let i=1;i<=n;++i)s=s.substring(0,t-i)+e[e.length-i]+s.substring(t-i+1);return s}static maskQuery(e){return this.advanceMode||!e?e:e.replace(B,"$1$2=*")}static maskString(e){if(this.advanceMode||!e)return e;let t="*".repeat(e.length);return e.length>this.kMaskMinLen&&(t=e[0]+t.substring(1,t.length-1)+e[e.length-1]),t}}V.advanceMode=!1,V.kPhoneNumberRetainedDigits=4,V.kTokenRetainedChars=6,V.kTokenRetainedLen=32,V.kMaskMinLen=3;var Y,Q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},X={exports:{}},z={exports:{}},$=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})})),t}(Object.freeze({__proto__:null,default:{}}));z.exports=Y=Y||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==Q&&Q.crypto&&(t=Q.crypto),!t)try{t=$}catch(e){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},r=i.lib={},o=r.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,s=this.sigBytes,i=e.sigBytes;if(this.clamp(),s%4)for(var r=0;r<i;r++){var o=n[r>>>2]>>>24-r%4*8&255;t[s+r>>>2]|=o<<24-(s+r)%4*8}else for(var a=0;a<i;a+=4)t[s+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(n());return new a.init(t,e)}}),c=i.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],i=0;i<n;i++){var r=t[i>>>2]>>>24-i%4*8&255;s.push((r>>>4).toString(16)),s.push((15&r).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s+=2)n[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new a.init(n,t/2)}},l=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,s=[],i=0;i<n;i++){var r=t[i>>>2]>>>24-i%4*8&255;s.push(String.fromCharCode(r))}return s.join("")},parse:function(e){for(var t=e.length,n=[],s=0;s<t;s++)n[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new a.init(n,t)}},d=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},g=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,s=this._data,i=s.words,r=s.sigBytes,o=this.blockSize,c=r/(4*o),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,l=e.min(4*u,r);if(u){for(var d=0;d<u;d+=o)this._doProcessBlock(i,d);n=i.splice(0,u),s.sigBytes-=l}return new a.init(n,l)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=g.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new p.HMAC.init(e,n).finalize(t)}}});var p=i.algo={};return i}(Math),X.exports=function(e){return function(t){var n=e,s=n.lib,i=s.WordArray,r=s.Hasher,o=n.algo,a=[],c=[];!function(){function e(e){for(var n=t.sqrt(e),s=2;s<=n;s++)if(!(e%s))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var s=2,i=0;i<64;)e(s)&&(i<8&&(a[i]=n(t.pow(s,.5))),c[i]=n(t.pow(s,1/3)),i++),s++}();var u=[],l=o.SHA256=r.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,s=n[0],i=n[1],r=n[2],o=n[3],a=n[4],l=n[5],d=n[6],g=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var h=u[p-15],f=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,S=u[p-2],T=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;u[p]=f+u[p-7]+T+u[p-16]}var m=s&i^s&r^i&r,_=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),I=g+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[p]+u[p];g=d,d=l,l=a,a=o+I|0,o=r,r=i,i=s,s=I+(_+m)|0}n[0]=n[0]+s|0,n[1]=n[1]+i|0,n[2]=n[2]+r|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+g|0},_doFinalize:function(){var e=this._data,n=e.words,s=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(s/4294967296),n[15+(i+64>>>9<<4)]=s,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=r._createHelper(l),n.HmacSHA256=r._createHmacHelper(l)}(Math),e.SHA256}(z.exports);var Z=X.exports;class ee extends V{static hashBySHA256=e=>e?Z(e).toString():e}const te={ani:ee.hashBySHA256,aniE164:ee.hashBySHA256,email:ee.maskEmail,agentEmail:ee.maskEmail,name:ee.maskString,firstName:ee.maskString,lastName:ee.maskString,agentFirstName:ee.maskString,agentLastName:ee.maskString,agentUserName:ee.maskString,destination:ee.hashBySHA256,dnis:ee.hashBySHA256,dnisE164:ee.hashBySHA256,phone:ee.hashBySHA256,leadPhone:ee.hashBySHA256,leadPhoneE164:ee.hashBySHA256,dialDest:ee.hashBySHA256,edUuid:ee.maskString,username:ee.maskString},ne=new class{constructor(e){this.defaultMaskRules=e}appendOrOverrideDefaultMaskRules(e){this.defaultMaskRules={...this.defaultMaskRules,...e}}sanitize(e,t){try{return JSON.parse(this.sanitizeToString(e,t))}catch(t){return e}}sanitizeToString(e,t){try{return JSON.stringify(e,((e,n)=>{const s=(t||this.defaultMaskRules)[e];return s&&n?s.call(ee,String(n)):n}))}catch(t){return e}}}(te);var se=n(7),ie=n.n(se),re=n(96);const oe={STATUS_NULL:0,STATUS_NEW:1,STATUS_CONNECTING:2,STATUS_CONNECTED:3,STATUS_COMPLETED:4};class ae extends ie().EventEmitter{constructor(e){super(),this.options=e,this.initSimpleSip(e),this.C=oe}initSimpleSip(e){if(e.media.remote.video?this.video=!0:this.video=!1,e.media.remote.audio?this.audio=!0:this.audio=!1,!this.audio&&!this.video)throw new Error("At least one remote audio or video element is required for CFSimpleSip.");this.options=e;const t=window.navigator.userAgent.toLowerCase();let n=!1,s=!1;t.indexOf("safari")>-1&&t.indexOf("chrome")<0?n=!0:t.indexOf("firefox")>-1&&t.indexOf("chrome")<0&&(s=!0);const i={peerConnectionOptions:{iceCheckingTimeout:500,rtcConfiguration:{iceServers:[{urls:"stun:stun1.eo1.engage.ringcentral.com:19302"},{urls:"stun:stun2.eo1.engage.ringcentral.com:19302"},{urls:"stun:stun3.eo1.engage.ringcentral.com:19302"}]}}};n&&(i.modifiers=[re.Nc.Modifiers.stripG722]),s&&(i.alwaysAcquireMediaFirst=!0,i.modifiers=[re.Nc.Modifiers.addMidLines]),this.options.ua.uri||(this.anonymous=!0);const r=this.options.ua.dialDest.indexOf("@RC_SOFTPHONE")>=0,o={uri:this.options.ua.uri,authorizationUser:this.options.ua.authorizationUser,password:this.options.ua.password,displayName:this.options.ua.displayName,userAgentString:re.C.USER_AGENT+";"+t,autostop:!1,register:!0,registerOptions:{expires:this.options.ua.registerExpires||60},sessionDescriptionHandlerFactoryOptions:i,transportOptions:{traceSip:this.options.ua.traceSip,wsServers:this.options.ua.wsServers,maxReconnectionAttempts:2},dtmfType:re.C.dtmfType.RTP};return this.ua=r?new re.UA(o).register({extraHeaders:["P-RC-Supported-Ept-Roles: rc-engage-agent-ept"]}):new re.UA(o),this.state=oe.STATUS_NULL,this.logger=this.ua.getLogger("sip.simple"),this.ua.on("registered",function(){this.emit("registered",this.ua)}.bind(this)),this.ua.on("unregistered",function(e,t){this.emit("unregistered",this.ua,t)}.bind(this)),this.ua.on("failed",function(){this.emit("unregistered",this.ua)}.bind(this)),this.ua.on("invite",function(e){if(this.state!==oe.STATUS_NULL&&this.state!==oe.STATUS_COMPLETED)return this.logger.warn("Rejecting incoming call. CFSimpleSip only supports 1 call at a time"),void e.reject();this.session=e,this.setupSession(),this.emit("ringing",this.session)}.bind(this)),this.ua.on("message",function(e){this.emit("message",e)}.bind(this)),this}call(e){if(this.ua&&this.checkRegistration()){if(this.state===oe.STATUS_NULL||this.state===oe.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with CFSimpleSip")}else this.logger.warn("A registered UA is required for calling")}answer(){if(this.state===oe.STATUS_NEW||this.state===oe.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")}reject(){if(this.state===oe.STATUS_NEW||this.state===oe.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")}hangup(){if(this.state===oe.STATUS_CONNECTED||this.state===oe.STATUS_CONNECTING||this.state===oe.STATUS_NEW)return this.state!==oe.STATUS_CONNECTED?this.session.cancel():this.session.bye();this.logger.warn("No active call to hang up on")}hold(){if(this.state===oe.STATUS_CONNECTED&&!this.session.local_hold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")}unhold(){if(this.state===oe.STATUS_CONNECTED&&this.session.local_hold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")}mute(){this.state===oe.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")}unmute(){this.state===oe.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")}sendDTMF(e){this.state===oe.STATUS_CONNECTED?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")}message(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")}checkRegistration(){return this.anonymous||this.ua&&this.ua.isRegistered()}setupRemoteMedia(){const e=this.session.sessionDescriptionHandler.peerConnection;let t;e.getReceivers?(t=new window.window.MediaStream,e.getReceivers().forEach((function(e){const n=e.track;n&&t.addTrack(n)}))):t=e.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=t,this.options.media.remote.video.play().catch(function(){this.logger.log("play was rejected")}.bind(this))):this.audio&&(this.options.media.remote.audio.srcObject=t,this.options.media.remote.audio.play().catch(function(){this.logger.log("play was rejected")}.bind(this)))}setupLocalMedia(){if(this.video&&this.options.media.local&&this.options.media.local.video){const e=this.session.sessionDescriptionHandler.peerConnection;let t;e.getSenders?(t=new window.window.MediaStream,e.getSenders().forEach((function(e){const n=e.track;n&&"video"===n.kind&&t.addTrack(n)}))):t=e.getLocalStreams()[0],this.options.media.local.video.srcObject=t,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}cleanupMedia(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())}setupSession(){this.state=oe.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",this.onProgress.bind(this)),this.session.on("accepted",this.onAccepted.bind(this)),this.session.on("rejected",this.onEnded.bind(this)),this.session.on("failed",this.onFailed.bind(this)),this.session.on("terminated",this.onEnded.bind(this))}destroyMedia(){this.session.sessionDescriptionHandler.close()}toggleMute(e){const t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach((function(t){t.track&&(t.track.enabled=!e)})):t.getLocalStreams().forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e})),t.getVideoTracks().forEach((function(t){t.enabled=!e}))}))}onAccepted(){this.state=oe.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler.on("addTrack",function(){this.logger.log("A track has been added, triggering new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.sessionDescriptionHandler.on("addStream",function(){this.logger.log("A stream has been added, trigger new remoteMedia setup"),this.setupRemoteMedia()}.bind(this)),this.session.on("hold",function(){this.emit("hold",this.session)}.bind(this)),this.session.on("unhold",function(){this.emit("unhold",this.session)}.bind(this)),this.session.on("dtmf",function(e){this.emit("dtmf",e)}.bind(this)),this.session.on("bye",this.onEnded.bind(this))}onProgress(){this.state=oe.STATUS_CONNECTING,this.emit("connecting",this.session)}onFailed(){this.onEnded()}onEnded(){this.state=oe.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()}}const ce=Object.freeze({DEBUG:"debug",STATS:"stats",INFO:"info",WARN:"warn",ERROR:"error"});Object.freeze({USERNAME_PASSWORD:"USERNAME_PASSWORD",RC_TOKEN:"RC_TOKEN",ENGAGE_TOKEN:"ENGAGE_TOKEN"});const ue=Object.freeze({AUTHENTICATE:"authenticateResponse",OFFHOOK_TERM:"offhookTermNotification",WEBRTC_INFO:"webRtcInfoResponse",UPDATE_DIAL_DEST:"updateDialDestination",REFRESH_TOKEN:"getRefreshedToken",SIP_CONNECTED:"sipConnectedNotification",SIP_DIAL_DEST_CHANGED:"sipDialDestChangedNotification",SIP_ENDED:"sipEndedNotification",SIP_MUTE:"sipMuteResponse",SIP_REGISTERED:"sipRegisteredNotification",SIP_REGISTRATION_FAILED:"sipRegistrationFailedNotification",SIP_UNSTABLE_CONNECTION:"sipUnstableConnectionNotification",SIP_RESTORED_CONNECTION:"sipRestoredConnectionNotification",SIP_RINGING:"sipRingingNotification",SIP_SWITCH_REGISTRAR:"sipSwitchRegistrarNotification",SIP_UNMUTE:"sipUnmuteResponse",SIP_UNREGISTERED:"sipUnregisteredNotification",ROTATE_WEBRTC_SERVER:"rotateWebRtcServer"});class le{static instance=null;model={agentSettings:{agentId:0,dialDest:""},callbacks:{},softphoneSettings:{webRtc:null,isRegistered:!1,muteActive:!1,registerPending:null,maintainOH:!1,autoStartOH:!1,wsServers:[],sipInfo:[],uri:"",displayName:"",authorizationUser:"",sipPassword:"",sipDialDest:"",attemptingSoftphoneReconnect:!1,reconnectionAttempt:0,lastSipFetchTime:0,instanceId:""},authHost:window.location.origin,socketProtocol:"wss://",baseApiUri:"/api/v1/",authenticateRequest:{refreshToken:null,engageAccessToken:null,ssoLogin:!1},authenticatePacket:null,webRTCRequest:null};constructor(e){return le.instance||(e&&(this.model={...this.model,...e}),le.instance=this),le.instance}setCallback(e,t){e&&de(t)&&(this.model.callbacks[e]=t)}getCallback(e){return this.model.callbacks[e]}hasCallback(e){return de(this.getCallback(e))}removeCallback(e){return!!this.hasCallback(e)&&delete this.model.callbacks[e]}fireCallback(e,...t){const n=this.getCallback(e);if(de(n))return n.call(this.model,...t)}getInstance(){return this.model}resetInstance(){le.instance=null}}function de(e){return"function"==typeof e}const ge=new le;Object.freeze(ge);class pe{static logMessage(e,t,n){const s={logLevel:e,message:t,dts:new Date,data:n};console.log(JSON.stringify(s))}static escapeSoftphoneUsername(e){return e&&e.replace(/[@]/g,"_at_")}static generateUUID(){const e=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}let he="SDK";const fe=window.encodeURIComponent;function Se(e,t){if(!Ie(e))return;const n=e.headers;Ie(n)&&Object.getOwnPropertyNames(n).forEach((e=>t.setRequestHeader(e,n[e])))}function Te(e){const t={"x-engage-client-request-id":`${he}:${pe.generateUUID()}`};Object.keys(t).forEach((n=>{e.setRequestHeader(n,t[n])}))}function me(e,t,n){n.addEventListener("error",(e=>t(e))),n.addEventListener("timeout",(()=>t(new Error("request timeout")))),n.addEventListener("load",(function(){200!==this.status?t({status:this.status,response:this.responseText}):e({status:this.status,response:this.responseText})}))}function _e(e){if(Ie(e))return Object.keys(e).map((t=>`${fe(t)}=${fe(e[t])}`)).join("&")}function Ie(e){return"object"==typeof e&&null!==e}class Ce{static httpGet(e,t){return new Promise(((n,s)=>{const i=new XMLHttpRequest;let r="";t.queryParams&&(r=`?${_e(t.queryParams)}`),i.open("GET",`${e}${r}`),Se(t,i),Te(i),me(n,s,i),i.send()}))}static httpPost(e,t){return new Promise((function(n,s){const i=new this.XMLHttpRequest;let r="";t.queryParams&&(r=`?${_e(t.queryParams)}`),i.open("POST",`${e}${r}`),Se(t,i),Te(i),me(n,s,i),i.send(function(e){const t=e&&e.headers&&e.headers["Content-type"];let n=e&&e.body||"";if("application/json"===t)n=JSON.stringify(n);else if(this.isObject(n)){const e=Object.assign({},n);n="",Object.getOwnPropertyNames(e).forEach(((t,s,i)=>{n+=`${fe(t)}=${fe(e[t])}`,s<i.length-1&&(n+="&")}))}return n}(t))}))}static isObject(e){return"object"==typeof e&&null!==e}}class ve{async getSipRegistrationInfo(e){const t=e.getInstance(),n=`${t.authHost}${t.baseApiUri}sip/sipRegistrationInfo`,s=`Bearer ${t.authenticateRequest.engageAccessToken}`,i={headers:{"Content-type":"application/json",Authorization:s},queryParams:{agentId:t.agentSettings.agentId,ssoLogin:t.authenticateRequest.ssoLogin}},r=`Error on request get to sip registration info. URL: ${n}`;await Ce.httpGet(n,i).then((n=>{try{const s=JSON.parse(n.response);t.softphoneSettings.sipInfo=s.sipInfo,t.softphoneSettings.lastSipFetchTime=Date.now(),e.fireCallback(ue.WEBRTC_INFO,t.softphoneSettings.sipInfo)}catch(e){pe.logMessage(ce.WARN,r,e)}}),(function(t){if(t.status&&403==t.status)this.refreshAccessToken(s,e);else{const n={type:"Error retrieving sip registration information",message:r};pe.logMessage(ce.WARN,r,t),e.fireCallback(ue.WEBRTC_INFO,n)}}))}async refreshAccessToken(e,t){const n=`Error on request to get refresh token callback function : ${ue.REFRESH_TOKEN}`;(await t.fireCallback(ue.REFRESH_TOKEN,e)).then((e=>{try{if(200===e.status&&e.response){const n=t.getInstance(),s=JSON.parse(e.response);n.authenticateRequest.engageAccessToken=s.engageAccessToken,this.getSipRegistrationInfo(t)}}catch(e){pe.logMessage(ce.WARN,n,e)}}),(function(e){const s={type:"Error retrieving refresh token",message:n};pe.logMessage(ce.WARN,n,e),t.fireCallback(ue.REFRESH_TOKEN,s)}))}}class ye{constructor(e){this.init(e)}getUIModel(){return this.UIModel}getSoftphoneSettings(){return this.UIModel.getInstance().softphoneSettings}async sipInitAndRegister(e){return this.init(e),new Promise(((e,t)=>{this.getWebRtcInfo().then((()=>{this.sipInit(),this.sipRegister(),e(!0)})).catch((()=>{throw t(!1),"Unable to fetch sipInfo details."}))}))}switchSoftphoneRegistrar(e,t){void 0===t&&(t=!0),this.UIModel.getInstance().softphoneSettings.attemptingSoftphoneReconnect&&t?(this._updateOHFlags(e,t),this.UIModel.fireCallback(ue.SIP_SWITCH_REGISTRAR,{message:"Updating offhook flags, set status message",status:"UPDATE"})):(this.resetSoftphoneSession({maintainOH:e,autoStartOH:t}),this.UIModel.fireCallback(ue.SIP_SWITCH_REGISTRAR,{message:"Triggering softphone registrar swap",status:"RESET"}))}resetSoftphoneSession(e){const t=this.UIModel.getInstance().softphoneSettings,n=this;if(t.isRegistered&&!t.attemptingSoftphoneReconnect){if(t.reconnectionAttempt>30)return void this.UIModel.fireCallback(ue.SIP_REGISTRATION_FAILED,{message:"SIP registration failed"});this.sipTerminate(),this._rotateWebRtcServer((function(){n.setupWebRtcServer(),e&&("null"===e.maintainOH&&(e.maintainOH=t.maintainOH),n._updateOHFlags(e.maintainOH,e.autoStartOH)),n.sipInit(),n.sipRegister()}))}}sipInit(){const e=this.UIModel.getInstance().softphoneSettings;try{if(""!==e.uri&&0!==e.wsServers.length&&""!==e.displayName&&""!==e.authorizationUser||this.setupWebRtcServer(),!(e.wsServers.length>0))throw"Unable to setup WebRtc server";{const t=new ae(this._getSipConfig());t.on("connected",this._connected.bind(this)),t.on("ended",this._ended.bind(this)),t.on("registered",this._registered.bind(this)),t.on("unregistered",this._unregistered.bind(this)),t.on("registrationFailed",this._registrationFailed.bind(this)),t.on("ringing",this._ringing.bind(this)),t.on("mute",this._mute.bind(this)),t.on("unmute",this._unmute.bind(this)),e.registerPending=setTimeout(this._handleNoRegisterResponse.bind(this),15e3),e.instanceId=t.ua.configuration?.instanceId,e.webRtc=t}}catch(e){return e}}sipTerminate(){const e=this.UIModel.getInstance();let t=e.softphoneSettings.webRtc;if(t&&t.ua){const n={all:!0};return this.UIModel.fireCallback(ue.OFFHOOK_TERM,{message:"Offhook terminated"}),t.hangup(),t.ua.unregister(n),t.removeAllListeners("connected"),t.removeAllListeners("ended"),t.removeAllListeners("registered"),t.removeAllListeners("unregistered"),t.removeAllListeners("registrationFailed"),t.removeAllListeners("ringing"),t.removeAllListeners("mute"),t.removeAllListeners("unmute"),t.ua.stop(),t=null,e.softphoneSettings.webRtc=t,e.softphoneSettings.isRegistered=!1,e.softphoneSettings.attemptingSoftphoneReconnect=!1,e.softphoneSettings.muteActive=!1,e.softphoneSettings.registerPending=null,e.softphoneSettings.uri="",!0}return console.warn("sipTerminate: sip rtc settings or ua missing",t),!1}sipAnswer(){const e=this.UIModel.getInstance().softphoneSettings.webRtc;e&&e.answer()}sipReject(){const e=this.UIModel.getInstance().softphoneSettings.webRtc;e&&e.reject&&e.reject()}sipRegister(){const e=this.UIModel.getInstance(),t=e.softphoneSettings.webRtc;try{if(window.webkitNotifications&&0!==window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission(),!t)return;e.softphoneSettings.isRegistered&&this.sipHangUp()}catch(e){console.error("sip reg error:"+e)}}sipHangUp(){const e=this.UIModel.getInstance().softphoneSettings.webRtc;e&&e.hangup&&e.hangup()}sipSendDTMF(e){const t=this.UIModel.getInstance().softphoneSettings.webRtc;t&&t.sendDTMF(e)}sipToggleMute(e){const t=this.UIModel.getInstance().softphoneSettings,n=t.webRtc,s=t.muteActive;n&&(s||!1===e?(n.unmute(),this.UIModel.fireCallback(ue.SIP_UNMUTE,{message:"Call unmuted"})):(n.mute(),this.UIModel.fireCallback(ue.SIP_MUTE,{message:"Call muted"})))}setupWebRtcServer(){const e=this.UIModel.getInstance().softphoneSettings,t=this._getCurrentWebRtcServerInfo();if(null!==t){const n=t.username.toLowerCase(),s=t.transport.toLowerCase()+"://"+t.outboundProxy;return e.uri=pe.escapeSoftphoneUsername(n)+"@"+t.domain,e.wsServers=[s],e.displayName=n,e.authorizationUser=t.authorizationId,e.sipPassword=t.password,e.sipDialDest="sip:"+e.uri,{webRtcServer:s,username:n,password:e.sipPassword,domain:t.domain||null,dialDest:e.sipDialDest||null,uri:e.uri||null,wsServers:e.wsServers||[]}}return null}setCallbacks(e){e&&Object.keys(e).forEach((t=>{const n=t,s=e[n];this.setCallback(n,s)}))}setCallback(e,t){this.UIModel.setCallback(e,t)}getCallback(e){return this.UIModel.getCallback(e)}hasCallback(e){return this.UIModel.hasCallback(e)}_getSipConfig(){const e=document.getElementById("remoteAudio"),t=this.UIModel.getInstance(),n=t.softphoneSettings;return{media:{remote:{audio:e}},ua:{displayName:pe.escapeSoftphoneUsername(n.displayName),authorizationUser:pe.escapeSoftphoneUsername(n.authorizationUser),password:n.sipPassword,uri:n.uri,wsServers:n.wsServers,traceSip:!0,registerExpires:60,userAgentString:navigator.userAgent,dialDest:t.agentSettings.dialDest}}}init(e){try{ge.resetInstance(),this.UIModel=new le(e.UIModel||{});const t=this.UIModel.getInstance();t.authenticateRequest.engageAccessToken=e.authToken,t.agentSettings.agentId=e.agentId,t.agentSettings.dialDest=e.dialDest,t.authenticateRequest.ssoLogin=e.ssoLogin,void 0!==e.authHost&&(t.authHost=e.authHost),e.componentName&&(e=>{he=e})(e.componentName),this.setCallbacks(e&&e.callbacks||{})}catch(e){console.error("sip init error:"+e)}}_handleNoRegisterResponse(){const e=this.UIModel.getInstance().softphoneSettings;e.isRegistered=!0,e.attemptingSoftphoneReconnect=!1,e.reconnectionAttempt+=1,console.warn(`<-- unstable sip connection, attempt to reconnect #${e.reconnectionAttempt} --\x3e`),this.UIModel.fireCallback(ue.SIP_UNSTABLE_CONNECTION,{message:"SIP unstable"}),this.switchSoftphoneRegistrar(e.maintainOH,e.autoStartOH)}_registerHasResponse(){clearTimeout(this.UIModel.getInstance().softphoneSettings.registerPending)}async _rotateWebRtcServer(e){const t=this.UIModel.getInstance().softphoneSettings;this.UIModel.setCallback(ue.ROTATE_WEBRTC_SERVER,e);const n=t.sipInfo,s=Date.now()-t.lastSipFetchTime;if(console.log("## Checking to rotate webRtc Server.SipInfo array length is "+n.length+". Time since last fetch of webRtcInfo is "+s/6e4+" mins."),n.length>1&&s<3e5)n.shift(),console.log("## rotated sip server.Will now attempt to new server: "+n[0].domain),t.attemptingSoftphoneReconnect=!0,this.UIModel.fireCallback(ue.ROTATE_WEBRTC_SERVER,e);else{console.log("## fetching webRtcInfo.");try{await this.getWebRtcInfo(e,!0)}catch(e){console.log("Error receive response with sip info")}finally{this.UIModel.fireCallback(ue.ROTATE_WEBRTC_SERVER,e)}}}_updateOHFlags(e,t){const n=this.UIModel.getInstance().softphoneSettings;n.maintainOH=e,n.autoStartOH=t}_getCurrentWebRtcServerInfo(){const e=this.UIModel.getInstance().softphoneSettings;return null!=e.sipInfo&&e.sipInfo.length>0?e.sipInfo[0]:null}_connected(){this.UIModel.fireCallback(ue.SIP_CONNECTED,{message:"SIP connected"})}_ended(){this.UIModel.fireCallback(ue.SIP_ENDED,{message:"SIP ended"})}_registered(){const e=this.UIModel.getInstance();if(this._registerHasResponse(),e.softphoneSettings.reconnectionAttempt&&this.UIModel.fireCallback(ue.SIP_RESTORED_CONNECTION,{message:"SIP established"}),e.softphoneSettings.reconnectionAttempt=0,e.softphoneSettings.isRegistered=!0,!e.agentSettings||!e.agentSettings.dialDest)return!1;if(e.agentSettings.dialDest!==e.softphoneSettings.sipDialDest&&-1===e.agentSettings.dialDest.indexOf("@RC_SOFTPHONE")){e.agentSettings.dialDest=JSON.parse(JSON.stringify(e.softphoneSettings.sipDialDest));const t={message:"SIP dial destination changed",dialDest:e.agentSettings.dialDest,maintainOH:e.softphoneSettings.maintainOH,autoStartOH:e.softphoneSettings.autoStartOH};e.softphoneSettings.autoStartOH||(e.softphoneSettings.attemptingSoftphoneReconnect=!1),this.UIModel.fireCallback(ue.SIP_DIAL_DEST_CHANGED,t),this.UIModel.fireCallback(ue.UPDATE_DIAL_DEST,e.agentSettings.dialDest,!0)}this.UIModel.fireCallback(ue.SIP_REGISTERED,{message:"SIP registered"})}_unregistered(e,t){const n=this.UIModel.getInstance();this._registerHasResponse(),n.softphoneSettings.isRegistered=!1,this.sipTerminate(),this.sipInit(),console.log("<-- Error response registration information --\x3e",t),t&&(n.softphoneSettings.reconnectionAttempt+=1,console.warn(`<-- unstable sip connection, attempt to reconnect #${n.softphoneSettings.reconnectionAttempt} --\x3e`),this.UIModel.fireCallback(ue.SIP_UNSTABLE_CONNECTION,{message:"SIP unstable"}))}_registrationFailed(){const e=this.UIModel.getInstance();this._registerHasResponse(),e.softphoneSettings.isRegistered=!1,this.sipTerminate()}_ringing(e){const t=e.transaction&&e.transaction.request&&e.transaction.request.headers["P-Rc-Destination"];!t||t&&1===t.length&&"ev-agent"!==t[0].raw||this.UIModel.fireCallback(ue.SIP_RINGING,{message:"SIP ringing",data:e})}_mute(){return this.UIModel.getInstance().softphoneSettings.muteActive=!0,this.UIModel.getInstance().softphoneSettings.muteActive}_unmute(){return this.UIModel.getInstance().softphoneSettings.muteActive=!1,this.UIModel.getInstance().softphoneSettings.muteActive}async getWebRtcInfo(e,t=!1){const n=this._getCurrentWebRtcServerInfo(),s=this.UIModel.getInstance();if(this.UIModel.fireCallback(ue.WEBRTC_INFO,e),(!n||t)&&s.authenticateRequest.engageAccessToken&&s.agentSettings.agentId){const e=new ve;await e.getSipRegistrationInfo(this.UIModel)}else this.UIModel.fireCallback(ue.WEBRTC_INFO,s.softphoneSettings.sipInfo)}}const Ee="debug",Re="info",Ae="warn",be="USERNAME_PASSWORD",Ne="RC_TOKEN",Oe="ENGAGE_TOKEN",De=Object.freeze({AUTHENTICATE:"authenticateResponse",OFFHOOK_TERM:"offhookTermNotification",WEBRTC_INFO:"webRtcInfoResponse"}),we=Object.freeze(Object.assign({},De,{ACK:"acknowledgeResponse",ADD_SESSION:"addSessionNotification",AGENT_DEBUG_EMAIL_NOTIF:"agentDebugEmailNotification",AGENT_STATE:"agentStateResponse",BARGE_IN:"bargeInResponse",CALLBACK_CANCEL:"callbackCancelResponse",CALLBACK_PENDING:"callbacksPendingResponse",CALL_NOTES:"callNotesResponse",CAMPAIGN_DISPOSITIONS:"campaignDispositionsResponse",CHAT:"chatResponse",CHAT_ACTIVE:"chatActiveNotification",CHAT_CANCELLED:"chatCancelledNotification",CHAT_CLIENT_RECONNECT:"chatClientReconnectNotification",CHAT_INACTIVE:"chatInactiveNotification",CHAT_LIST:"chatListResponse",CHAT_LOAD_MEDIA:"chatLoadMediaResponse",CHAT_AGENT_ASSIGN_FAILURE:"chatAgentAssignFailureResponse",CHAT_MESSAGE:"chatMessageNotification",CHAT_NEW:"chatNewNotification",CHAT_PRESENTED:"chatPresentedNotification",CHAT_ROOM_STATE:"chatRoomStateResponse",CHAT_STATE:"chatStateResponse",CHAT_STOP_MONITOR:"stopAgentChatMonitorNotification",CHAT_TYPING:"chatTypingNotification",CLOSE_SOCKET:"closeResponse",COACH_CALL:"coachResponse",CONFIG:"configureResponse",DIAL_GROUP_CHANGE:"dialGroupChangeNotification",DIAL_GROUP_CHANGE_PENDING:"dialGroupChangePendingNotification",DIRECT_AGENT_TRANSFER:"directAgentTransferResponse",DIRECT_AGENT_TRANSFER_LIST:"directAgentTransferListResponse",DIRECT_AGENT_TRANSFER_NOTIF:"directAgentTransferNotification",DROP_SESSION:"dropSessionNotification",EARLY_UII:"earlyUiiNotification",END_CALL:"endCallNotification",GATES_CHANGE:"gatesChangeNotification",GENERIC_NOTIFICATION:"genericNotification",GENERIC_RESPONSE:"genericResponse",HOLD:"holdResponse",LEAD_HISTORY:"leadHistoryResponse",LEAD_INSERT:"leadInsertResponse",LEAD_SEARCH:"leadSearchResponse",LEAD_UPDATE:"leadUpdateResponse",LOGIN:"loginResponse",LOGIN_PHASE_1:"loginPhase1Response",LOGIN_MULTISOCKET:"multiSocketResponse",LOGOUT:"logoutResponse",LOG_CONSOLE_RESULTS:"logConsoleResultsResponse",LOG_RESULTS:"logResultsResponse",NEW_CALL:"newCallNotification",OFFHOOK_INIT:"offhookInitResponse",OPEN_SOCKET:"openResponse",PAUSE_RECORD:"pauseRecordResponse",PENDING_CHAT_DISP:"pendingChatDispNotification",PENDING_DISP:"pendingDispNotification",PREVIEW_FETCH:"previewFetchResponse",PREVIEW_LEAD_STATE:"previewLeadStateNotification",RECORD:"recordResponse",REQUEUE:"requeueResponse",REQUEST_SUMMARY:"summaryRequest",REVERSE_MATCH:"reverseMatchNotification",SAFE_MODE_FETCH:"safeModeFetchResponse",SAFE_MODE_SEARCH:"safeModeSearchResponse",SCRIPT_CONFIG:"scriptConfigResponse",SILENT_MONITOR:"monitorResponse",STATS_AGENT:"agentStats",STATS_SUPERVISOR:"supervisorStats",STATS_AGENT_DAILY:"agentDailyStats",STATS_CAMPAIGN:"campaignStats",STATS_CHAT_QUEUE:"chatQueueStats",STATS_QUEUE:"queueStats",SUMMARY:"dispositionSummary",SUMMARY_ERROR:"dispositionSummaryError",SUPERVISOR_LIST:"supervisorListResponse",TCPA_SAFE_LEAD_STATE:"tcpaSafeLeadStateNotification",XFER_COLD:"coldXferResponse",XFER_WARM:"warmXferResponse",SEARCH_DIR:"searchDirectoryResponse",EXTENSION_PRESENCE:"extensionPresenceInfo"})),xe=Object.freeze(Object.assign({},De,{UPDATE_DIAL_DEST:"updateDialDestination",REFRESH_TOKEN:"getRefreshedToken",SIP_CONNECTED:"sipConnectedNotification",SIP_DIAL_DEST_CHANGED:"sipDialDestChangedNotification",SIP_ENDED:"sipEndedNotification",SIP_MUTE:"sipMuteResponse",SIP_REGISTERED:"sipRegisteredNotification",SIP_REGISTRATION_FAILED:"sipRegistrationFailedNotification",SIP_UNSTABLE_CONNECTION:"sipUnstableConnectionNotification",SIP_RESTORED_CONNECTION:"sipRestoredConnectionNotification",SIP_RINGING:"sipRingingNotification",SIP_SWITCH_REGISTRAR:"sipSwitchRegistrarNotification",SIP_UNMUTE:"sipUnmuteResponse",SIP_UNREGISTERED:"sipUnregisteredNotification"})),Ue=Object.freeze(Object.assign({},we,xe)),qe={ACK:"ACK",ADD_SESSION:"ADD-SESSION",AGENT_DEBUG_EMAIL:"AGENT-DEBUG-EMAIL",AGENT_STATE:"AGENT-STATE",BARGE_IN:"BARGE-IN",CALLBACK_CANCEL:"CANCEL-CALLBACK",CALLBACK_PENDING:"PENDING-CALLBACKS",CALL_NOTES:"CALL-NOTES",CAMPAIGN_DISPOSITIONS:"CAMPAIGN-DISPOSITIONS",CHAT_ACTIVE:"CHAT-ACTIVE",CHAT_AGENT_END:"CHAT-END",CHAT_ALIAS:"CHAT-ALIAS",CHAT_CANCELLED:"CHAT-CANCELLED",CHAT_CLIENT_RECONNECT:"CHAT-CLIENT-RECONNECT",CHAT_DISPOSITION:"CHAT-DISPOSITION",CHAT_INACTIVE:"CHAT-INACTIVE",CHAT_LIST:"CHAT-LIST",CHAT_MANUAL_SMS:"MANUAL-SMS",CHAT_MESSAGE:"CHAT-MESSAGE",CHAT_NEW:"NEW-CHAT",CHAT_PRESENTED:"CHAT-PRESENTED",CHAT_PRESENTED_RESPONSE:"CHAT-PRESENTED-RESPONSE",CHAT_REQUEUE:"CHAT-REQUEUE",CHAT_ROOM:"CHAT-ROOM",CHAT_ROOM_STATE:"CHAT-ROOM-STATE",CHAT_SEND:"CHAT",CHAT_STATE:"CHAT-STATE",CHAT_TYPING:"CHAT-TYPING",CHAT_LOAD_MEDIA:"LOAD-MEDIA",CHAT_AGENT_ASSIGN_FAILURE:"CHAT-AGENT-ASSIGN-FAILURE",DIAL_GROUP_CHANGE:"DIAL_GROUP_CHANGE",DIAL_GROUP_CHANGE_PENDING:"DIAL_GROUP_CHANGE_PENDING",DIRECT_AGENT_ROUTE:"DIRECT-AGENT-ROUTE",DIRECT_AGENT_TRANSFER:"DIRECT-AGENT-TRANSFER",DIRECT_AGENT_TRANSFER_LIST:"DIRECT-AGENT-TRANSFER-LIST",DROP_SESSION:"DROP-SESSION",EARLY_UII:"EARLY_UII",END_CALL:"END-CALL",GATES_CHANGE:"GATES_CHANGE",GENERIC:"GENERIC",HANGUP:"HANGUP",HOLD:"HOLD",INBOUND_DISPOSITION:"INBOUND-DISPOSITION",LEAD_HISTORY:"LEAD-HISTORY",LEAD_INSERT:"LEAD-INSERT",LEAD_UPDATE:"LEAD-UPDATE",LEAVE_CHAT:"CHAT-DROP-SESSION",LOGIN:"LOGIN",LOGIN_PHASE_1:"LOGIN-PHASE-1",LOGIN_MULTISOCKET:"MULTISOCKET",LOGOUT:"LOGOUT",MONITOR_CHAT:"CHAT-MONITOR",NEW_CALL:"NEW-CALL",OFFHOOK_INIT:"OFF-HOOK-INIT",OFFHOOK_TERM:"OFF-HOOK-TERM",ONE_TO_ONE_OUTDIAL:"ONE-TO-ONE-OUTDIAL",ONE_TO_ONE_OUTDIAL_CANCEL:"ONE-TO-ONE-OUTDIAL-CANCEL",ON_MESSAGE:"ON-MESSAGE",OUTDIAL_DISPOSITION:"OUTDIAL-DISPOSITION",PAUSE_RECORD:"PAUSE-RECORD",PENDING_CHAT_DISP:"PENDING-CHAT-DISP",PENDING_DISP:"PENDING_DISP",PING_CALL:"PING-CALL",PREVIEW_DIAL:"PREVIEW-DIAL",PREVIEW_DIAL_ID:"PREVIEW_DIAL",PREVIEW_LEAD_STATE:"PREVIEW-LEAD-STATE",RECORD:"RECORD",REQUEUE:"RE-QUEUE",REQUEST_SUMMARY:"REQUEST-SUMMARY",REVERSE_MATCH:"REVERSE_MATCH",SCRIPT_CONFIG:"SCRIPT-CONFIG",SCRIPT_RESULT:"SCRIPT-RESULT",STATS:"STATS",STATS_AGENT:"AGENT",STATS_SUPERVISOR:"SUPERVISOR",STATS_AGENT_DAILY:"AGENTDAILY",STATS_CAMPAIGN:"CAMPAIGN",STATS_CHAT:"CHAT",STATS_QUEUE:"GATE",STOP_MONITOR_CHAT:"CHAT-DROP-MONITORING-SESSION",SUPERVISOR_LIST:"SUPERVISOR-LIST",TCPA_SAFE:"TCPA-SAFE",TCPA_SAFE_ID:"TCPA_SAFE",TCPA_SAFE_LEAD_STATE:"TCPA-SAFE-LEAD-STATE",UPDATE_DIAL_DESTINATION:"UPDATE_DIAL_DESTINATION",XFER_COLD:"COLD-XFER",XFER_WARM:"WARM-XFER",XFER_WARM_CANCEL:"WARM-XFER-CANCEL",SUMMARY:"SUMMARY",SUMMARY_ERROR:"SUMMARY-ERROR",SETUP_WEB_RTC_SERVER:"SETUP_WEB_RTC_SERVER",SIP_INIT:"SIP_INIT",SIP_ANSWER:"SIP_ANSWER",SIP_REJECT:"SIP_REJECT",SIP_REGISTER:"SIP_REGISTER",SIP_HANGUP:"SIP_HANGUP",SIP_SEND_DTMF:"SIP_SEND_DTMF",SIP_TOGGLE_MUTE:"SIP_TOGGLE_MUTE",SOFTPHONE_RESET_SESSION:"SOFTPHONE_RESET_SESSION",SWITCH_SOFTPHONE_REGISTRAR:"SWITCH_SOFTPHONE_REGISTRAR"},ke={requestChannel:null,responseChannel:null,currentCallMessageId:null,currentCallRequestCallback:null,init:function(){if(null==this.requestChannel){var e=this;this.requestChannel=new BroadcastChannel("ev-multisocket-request"),this.responseChannel=new BroadcastChannel("ev-multisocket-response"),this.requestChannel.onmessage=function(t){var n=t.data.type,s=t.data.messageId;"currentCall"===n&&e._sendCurrentCall(s)},this.responseChannel.onmessage=function(t){"currentCall"===t.data.type&&e._processCurrentCallResponse(t.data.data,t.data.messageId)}}},destroy:function(){null!=this.requestChannel&&(this.requestChannel.onmessage=null,this.responseChannel.onmessage=null,this.requestChannel.close(),this.responseChannel.close(),this.requestChannel=null,this.responseChannel=null)},requestCurrentCall:function(e){this.currentCallMessageId=Math.random(),this.currentCallRequestCallback=e,this.requestChannel.postMessage({type:"currentCall",messageId:this.currentCallMessageId})},_sendCurrentCall:function(e){if(null!=Mn.getInstance().currentCall){var t={type:"currentCall",messageId:e,data:Mn.getInstance().currentCall};this.responseChannel.postMessage(t)}},_processCurrentCallResponse:function(e,t){this.currentCallMessageId===t&&(Mn.getInstance().currentCall=e,null!=this.currentCallRequestCallback&&this.currentCallRequestCallback(e),this.currentCallMessageId=null,this.currentCallRequestCallback=null)}},Pe="x-engage-client-request-id",Le=function(){let e="SDK";function t(){return e+":"+sn.getMessageId()}return{setComponentName:function(t){e=t},getLoggingHeaders:function(){var e={};return e[Pe]=t(),e},getLoggingQueryParameters:function(){return"&"+Pe+"="+t()}}}();function Me(e){this.XMLHttpRequest=window.XMLHttpRequest,this.encodeURIComponent=window.encodeURIComponent,this.apiBase=e||"http://localhost:81";var t=this;function n(e){return"object"==typeof e&&null!==e}function s(e,t){if(n(e)){var s=e.headers;if(n(s))for(var i in s)t.setRequestHeader(i,s[i])}}function i(e){const t=Le.getLoggingHeaders();Object.keys(t).forEach((function(n){e.setRequestHeader(n,t[n])}))}function r(e,t,n){n.addEventListener("error",(function(e){t(e)})),n.addEventListener("timeout",(function(){t(new Error("request timeout"))})),n.addEventListener("load",(function(){200!==this.status?t({status:this.status,response:this.responseText}):e({status:this.status,response:this.responseText})}))}function o(e){if(n(e))return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}this.httpGet=function(e,n){return new Promise((function(a,c){var u=new t.XMLHttpRequest,l="";n.queryParams&&(l="?"+o(n.queryParams)),u.open("GET",t.apiBase+e+l),s(n,u),i(u),r(a,c,u),u.send()}))},this.httpPost=function(e,a){return new Promise((function(c,u){var l=new t.XMLHttpRequest,d="";a.queryParams&&(d="?"+o(a.queryParams)),l.open("POST",t.apiBase+e+d),s(a,l),i(l),r(c,u,l),l.send(function(e){var t=e&&e.headers&&e.headers["Content-Type"],s=e&&e.body||"";return"application/json"===t?s=JSON.stringify(s):n(s)&&(s=o(s)),s}(a))}))}}const He=function(e){window.localStorage||console.log("Browser does not support HTML5 Web Storage"),this.prefix=e+":"};He.prototype.save=function(e,t){if(!e||!t)return console.log("Missing parameters key or value on add"),!1;localStorage.setItem(this.prefix+e,JSON.stringify(t))},He.prototype.get=function(e){return e&&localStorage.getItem(this.prefix+e)?localStorage.getItem(this.prefix+e):(console.log("Missing parameter key on retrieve"),!1)},He.prototype.remove=function(e){if(!e||!localStorage.getItem(this.prefix+e))return console.log("Missing parameter key on remove"),!1;localStorage.removeItem(this.prefix+e)};const Fe=function(){};Fe.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification,s=sn.getText(n,"agent_id");"AGENT"===sn.getText(n,"session_type")&&t.incrementTotalCalls(),s===t.agentSettings.agentId?t.currentCall.sessionId=sn.getText(n,"session_id"):""!=s&&(t.currentCall.monitorAgentId=s);var i=sn.getText(n,"session_type"),r=sn.getText(n,"allow_control"),o=sn.getText(n,"session_id"),a=sn.getText(n,"uii"),c=t.currentCall.isMonitoring,u=t.currentCall.monitoringType,l=c&&"FULL"===u,d=s!==t.agentSettings.agentId,g=!1;if("1"!==o&&d&&(l?g=!0:r&&("OUTBOUND"!==i&&"AGENT"!==i||(g=!0))),g){var p=sn.getText(n,"phone");"AGENT"!==i&&""===s||(p=sn.getText(n,"agent_name")),t.transferSessions[o]={sessionId:o,destination:p,uii:a}}"2"===n.session_id&&(t.agentSettings.onCall=!0),d||(t.currentCall.segmentId=sn.getText(n,"segment_id"),t.currentCall.enableConversationSummary=sn.getText(n,"summary"));var h=sn.buildDefaultResponse(e);return h.status="OK",h.message="Received ADD-SESSION notification",h.sessionId=sn.getText(n,"session_id"),h.uii=sn.getText(n,"uii"),h.dialogId=sn.getText(n,"dialog_id"),h.phone=sn.getText(n,"phone"),h.sessionType=sn.getText(n,"session_type"),h.sessionLabel=sn.getText(n,"session_label"),h.allowControl=sn.getText(n,"allow_control"),h.monitoring=sn.getText(n,"monitoring"),h.agentId=sn.getText(n,"agent_id"),h.recordingUrl=sn.getText(n,"recording_url"),h.transferSessions=t.transferSessions,h.segmentId=sn.getText(n,"segment_id"),h.summary=sn.getText(n,"summary"),h};const Ge=function(){};Ge.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e),n=e.ui_notification;return t.status="OK",t.message="Received AGENT-DEBUG-EMAIL notification",t.emailTo=sn.getText(n,"email_to"),t.requestedBy=sn.getText(n,"requested_by"),t};const je=function(){};je.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification,s=t.loginRequest.loginType,i=sn.getText(n,"dial_group_id");t.dialGroupChangeNotification=e,t.loginRequest.loginType=!i||""===i||"INBOUND"!==s&&"BLENDED"!==s?i&&""!==i?"OUTBOUND":"INBOUND"===s?"INBOUND":"NO-SELECTION":"BLENDED",Mn.getInstance().loginRequest.dialGroupId=i;var r=sn.buildDefaultResponse(e);return r.message="Dial Group Updated Successfully.",r.detail="Dial Group changed to ["+i+"].",r.dialGroupId=sn.getText(n,"dial_group_id"),r.dialGroupName=sn.getText(n,"dialGroupName"),r.dialGroupDesc=sn.getText(n,"dial_group_desc"),r.agentId=sn.getText(n,"agent_id"),r};const Be=function(){};Be.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification;t.agentSettings.pendingDialGroupChange=parseInt(sn.getText(n,"dial_group_id"),10),n.update_from_adminui?t.agentSettings.updateDGFromAdminUI=!0===sn.getText(n,"update_from_adminui"):t.agentSettings.updateDGFromAdminUI=!1;var s=sn.buildDefaultResponse(e);return s.message="Dial Group Change Pending notification received.",s.detail="DialGroup switch for existing session pending until active call ends.",s.agentId=sn.getText(n,"agent_id"),s.dialGroupId=sn.getText(n,"dial_group_id"),s.updateFromAdminUI=sn.getText(n,"update_from_adminui"),s};const Ke=function(){};Ke.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e),n=e.ui_notification;return t.message="Received DIRECT-AGENT-ROUTE notification",t.status=sn.getText(n,"status"),t.agentId=sn.getText(n,"agent_id"),t.uii=sn.getText(n,"uii"),t.ani=sn.getText(n,"ani"),t.dnis=sn.getText(n,"dnis"),t.sourceType=sn.getText(n,"source_type"),t.sourceId=sn.getText(n,"source_id"),t.sourceName=sn.getText(n,"source_name"),t.voicemailUrl=sn.getText(n,"voicemail_url"),t};const Je=function(){};Je.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e),n=e.ui_notification,s=sn.getText(n,"session_id"),i=sn.getText(n,"uii"),r=Mn.getInstance().transferSessions[s];return r&&(console.log(i+" TRANSFER TO "+r.destination+" TERMINATED"),sn.logMessage(Ee,"Transfer to "+r.destination+" has terminated",""),delete Mn.getInstance().transferSessions[s],t.transferEnd=r),console.log(i+" END SESSION "+s),t.message="Received DROP-SESSION Notification",t.status="OK",t.sessionId=sn.getText(n,"session_id"),t.uii=sn.getText(n,"uii"),t};const We=function(){};We.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e),n=e.ui_notification;return t.message="Received EARLY_UII notification",t.status="OK",t.agentId=sn.getText(n,"agent_id"),t.uii=sn.getText(n,"uii"),t};const Ve=function(e){this.libInstance=e};Ve.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification;t.endCallNotification=e,t.currentCall.duration=sn.getText(n,"call_duration"),t.currentCall.termParty=sn.getText(n,"term_party"),t.currentCall.termReason=sn.getText(n,"term_reason"),t.agentSettings.callState="CALL-ENDED",t.agentSettings.onCall=!1,t.agentSettings.onManualOutdial=!1,t.transferSessions={},(t.agentSettings.pendingDialGroupChange>0||-1==t.agentSettings.pendingDialGroupChange)&&(t.loginRequest.dialGroupId=t.agentSettings.pendingDialGroupChange,this.libInstance.loginAgent(t.loginRequest.dialDest,t.loginRequest.queueIds,t.loginRequest.chatIds,t.loginRequest.skillProfileId,t.loginRequest.dialGroupId,t.agentSettings.updateDGFromAdminUI),t.agentSettings.pendingDialGroupChange=0,t.agentSettings.updateDGFromAdminUI=!1),t.currentCall.outdialDispositions&&t.currentCall.outdialDispositions.dispositions&&t.currentCall.outdialDispositions.dispositions.length>0&&"SUPPRESS"!==t.currentCall.surveyPopType&&!t.currentCall.isMonitoring&&(clearInterval(t.pingIntervalId),t.pingIntervalId=setInterval(sn.sendPingCallMessage,3e4));var s=sn.buildDefaultResponse(e);return s.message="End Call Notification Received.",s.detail="",s.uii=sn.getText(n,"uii"),s.sessionId=sn.getText(n,"session_id"),s.agentId=sn.getText(n,"agent_id"),s.callDts=sn.getText(n,"call_dts"),s.duration=t.currentCall.duration,s.termParty=t.currentCall.termParty,s.termReason=t.currentCall.termReason,s.recordingUrl=sn.getText(n,"recording_url"),s.dispositionTimeout=sn.getText(n,"disposition_timeout"),console.log(s.uii+" END CALL"),s};const Ye=function(){};Ye.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification,s=[],i=t.inboundSettings.availableQueues,r=sn.getText(n,"gate_ids");""!==r&&(r=r.split(","));for(var o=0;o<r.length;o++){var a=r[o],c=sn.findObjById(i,a,"gateId");if(c)s.push(c);else{var u={gateId:a,gateName:"",gateDesc:"",defaultDestOverride:"",isAgentSelectable:!1};s.push(u)}}t.inboundSettings.queues=JSON.parse(JSON.stringify(s));var l=sn.buildDefaultResponse(e);return l.agentId=sn.getText(n,"agent_id"),l.message="Gates Change notification received.",l.queues=s,l};const Qe=function(){};Qe.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return t.messageCode=sn.getText(e.ui_notification,"message_code"),t};const Xe=function(){};Xe.prototype.processResponse=function(e){var t=Mn.getInstance(),n=e.ui_notification,s=sn.buildDefaultResponse(e);s.message="Received NEW-CALL notification",s.status="OK",s.uii=sn.getText(n,"uii"),s.agentId=sn.getText(n,"agent_id"),s.dialDest=sn.getText(n,"dial_dest"),s.queueDts=sn.getText(n,"queue_dts"),s.queueTime=sn.getText(n,"queue_time"),s.ani=sn.getText(n,"ani"),s.aniE164=sn.getText(n,"ani_e164"),s.dnis=sn.getText(n,"dnis"),s.dnisE164=sn.getText(n,"dnis_e164"),s.callType=sn.getText(n,"call_type"),s.appUrl=sn.getText(n,"app_url"),s.isMonitoring=sn.getText(n,"is_monitoring"),s.allowHold=sn.getText(n,"allow_hold"),s.allowTransfer=sn.getText(n,"allow_transfer"),s.allowManualInternationalTransfer=sn.getText(n,"allow_manual_international_transfer"),s.allowDirectAgentTransfer=sn.getText(n,"allow_direct_agent_transfer"),s.allowHangup=sn.getText(n,"allow_hangup"),s.allowRequeue=sn.getText(n,"allow_requeue"),s.allowEndCallForEveryone=sn.getText(n,"allow_endcallforeveryone"),s.scriptId=sn.getText(n,"script_id"),s.scriptVersion=sn.getText(n,"script_version"),s.surveyId=sn.getText(n,"survey_id"),s.surveyPopType=sn.getText(n,"survey_pop_type"),s.requeueType=sn.getText(n,"requeue_type"),s.hangupOnDisposition=sn.getText(n,"hangup_on_disposition"),s.callerName=sn.getText(n,"caller_name"),s.isMonitoring&&(s.monitoringType=sn.getText(n,"monitoring_type")),s.queue=sn.processResponseCollection(e,"ui_notification","gate")[0],s.agentRecording=sn.processResponseCollection(e,"ui_notification","agent_recording","agentRecording")[0],s.outdialDispositions=sn.processResponseCollection(e,"ui_notification","outdial_dispositions","disposition")[0],s.requeueShortcuts=sn.processResponseCollection(e,"ui_notification","requeue_shortcuts","requeueShortcut")[0]||[],s.baggage=sn.processResponseCollection(e,"ui_notification","baggage")[0],s.surveyResponse=sn.processResponseCollection(e,"ui_notification","survey_response","detail")[0],s.scriptResponse={},s.transferPhoneBook=sn.processResponseCollection(e,"ui_notification","transfer_phone_book")[0],s.lead=sn.processResponseCollection(e,"ui_notification","lead")[0];try{if(n.lead&&n.lead.extra_data)for(var i in delete s.lead.extraDatas,s.lead.extraData={},n.lead.extra_data)s.lead.extraData[i]=n.lead.extra_data[i]["#text"]}catch(e){console.warn("error parsing new call lead extra data: "+e)}if(s.baggage){s.baggage.customLabels={};var r=n.baggage.custom_labels;for(var o in r){var a="";r&&r[o]&&r[o]["#text"]&&(a=r[o]["#text"]),s.baggage.customLabels[o]=a}}try{for(var c=JSON.parse(n.script_result["#text"]).model,u={},l=Object.keys(c),d=0;d<l.length;d++){var g=c[l[d]].value;u[i]=g}s.scriptResponse=u}catch(e){}if(s.transferPhoneBook&&s.transferPhoneBook.entrys&&(s.transferPhoneBook=s.transferPhoneBook.entrys),s.requeueShortcuts&&s.requeueShortcuts.requeueShortcuts&&(s.requeueShortcuts=s.requeueShortcuts.requeueShortcuts),s.outdialDispositions&&s.outdialDispositions.disposition&&(s.outdialDispositions.dispositions=[s.outdialDispositions]),s.queue.isCampaign="1"===s.queue.isCampaign,s.outdialDispositions&&s.outdialDispositions.dispositions)for(var p=0;p<s.outdialDispositions.dispositions.length;p++){var h=s.outdialDispositions.dispositions[p];h.isComplete="1"===h.isComplete,h.requireNote="1"===h.requireNote,h.saveSurvey="1"===h.saveSurvey,h.xfer="1"===h.xfer,h.isDefault="1"===h.isDefault}return t.callTokens=function(e,t){var n=Mn.getInstance(),s=t.baggage||{};if(e.baggage&&e.baggage.generic_key_value_pairs){var i=[],r=sn.getText(e.baggage,"generic_key_value_pairs");for(var o in r.length>0&&(i=sn.parseKeyValuePairsFromString(r,"|","::")),i)s[o]=i[o]}s.ani=t.ani,s.aniE164=t.aniE164,s.dnis=t.dnis,s.dnisE164=t.dnisE164,s.uii=t.uii;try{t.queue.number?(s.sourceId=t.queue.number||"",s.sourceName=t.queue.name||"",s.sourceDesc=t.queue.description||"","1"===t.queue.isCampaign||!0===t.queue.isCampaign?s.sourceType="OUTBOUND":s.sourceType="INBOUND"):(s.sourceId="0",s.sourceType="MANUAL",s.sourceName="",s.sourceDesc="")}catch(e){console.error("There was an error processing source tokenization",+e)}try{s.agentFirstName=n.agentSettings.firstName,s.agentLastName=n.agentSettings.lastName,s.agentExternalId=n.agentSettings.externalAgentId,s.agentType=n.agentSettings.agentType,s.agentEmail=n.agentSettings.email,s.agentUserName=n.agentSettings.username}catch(e){console.error("There was an error parsing tokens for agent info. ",e)}return s}(n,s),s.baggage=t.callTokens,s.isMonitoring?t.agentSettings.callState="ACTIVE-MONITORING":(t.agentSettings.callState="ACTIVE",s.baggage&&""!=s.baggage.auxPhone&&(t.transferNumber=s.baggage.auxPhone)),t.agentDailyStats.currCallTime=0,t.currentCall=s,t.callHistory[s.uii]=s,s.segmentContext=function(e={}){const t=e.dialog||{},n=e.customer_identity||{},s=e.agent_context||{};return{segmentId:sn.getText(e,"segment_id"),dialog:{dialogId:sn.getText(t,"dialog_id"),channelId:sn.getText(t,"channel_id"),channelType:sn.getText(t,"channel_type"),dialogDirection:sn.getText(t,"dialog_direction")},customerIdentity:{id:sn.getText(n,"id"),ani:sn.getText(n,"ani"),aniE164:sn.getText(n,"ani_e164")},agentContext:{knowledgeBaseId:sn.getText(s,"knowledge_base_id"),perspectiveRecordingMode:sn.getText(s,"perspective_recording_mode")}}}(n.segment_context),s};const ze=function(){};ze.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return t.message="Received PENDING-CHAT-DISP notification",t.status="OK",t.agentId=sn.getText(e.ui_notification,"agent_id"),t.uii=sn.getText(e.ui_notification,"uii"),t.status="true"===sn.getText(e.ui_notification,"status"),t};const $e=function(){};$e.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return t.message="Received PENDING-DISP notification",t.status="OK",t.agentId=sn.getText(e.ui_notification,"agent_id"),t.status=sn.getText(e.ui_notification,"status"),t};const Ze=function(){};Ze.prototype.processResponse=function(e){var t=e.ui_notification;Mn.getInstance().agentSettings.onManualOutdial=!0;var n=sn.buildDefaultResponse(e);return n.callType=t["@call_type"],n.messageId=t["@message_id"],n.requestId=sn.getText(t,"request_id"),n.leadState=sn.getText(t,"lead_state"),n.callback=sn.getText(t,"callback"),n};const et=function(){};et.prototype.processResponse=function(e){var t=e.ui_notification,n=Mn.getInstance();return n.tokens.first_name=sn.getText(t,"first_name"),n.tokens.mid_name=sn.getText(t,"mid_name"),n.tokens.last_name=sn.getText(t,"last_name"),n.tokens.address1=sn.getText(t,"address1"),n.tokens.address2=sn.getText(t,"address2"),n.tokens.suffix=sn.getText(t,"suffix"),n.tokens.title=sn.getText(t,"title"),n.tokens.city=sn.getText(t,"city"),n.tokens.state=sn.getText(t,"state"),n.tokens.zip=sn.getText(t,"zip"),n.tokens.business_name=sn.getText(t,"business_name"),n.tokens};const tt=function(){};tt.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return t.message="Received SUMMARY notification",t.status="OK",t.summary=sn.getText(e.ui_notification,"body"),t.final=sn.getText(e.ui_notification,"final"),t.sequenceNo=sn.getText(e.ui_notification,"sequence"),t.segmentId=sn.getText(e.ui_notification,"segment_id"),t};const nt=function(){};nt.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return t.message="Received SUMMARY ERROR notification",t.status="ERROR",t.uii=sn.getText(e.ui_notification,"uii"),t.requestMessageId=sn.getText(e.ui_notification,"request_message_id:"),t.details=sn.getText(e.ui_notification,"details"),t.segmentId=sn.getText(e.ui_notification,"segment_id"),t.sessionId=sn.getText(e.ui_notification,"session_id"),t.errorCode=sn.getText(e.ui_notification,"error_code"),t.errorMessage=sn.getText(e.ui_notification,"error_message"),t};const st=function(){};st.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e);return n.callType=t["@call_type"],n.messageId=t["@message_id"],n.requestId=sn.getText(t,"request_id"),n.leadState=sn.getText(t,"lead_state"),n.callback=sn.getText(t,"callback"),n};const it=function(e,t,n,s){this.audioType=e||"FULL",this.agentId=t,this.uii=n,this.monitorAgentId=s};it.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return n.type=sn.getText(t,"type"),"OK"===n.status?sn.logMessage(Ee,n.message,e):sn.logMessage(Ae,n.message+": "+n.detail,e),n};const rt=function(e,t){"ON-BREAK"===e.toUpperCase()&&!0===Mn.getInstance().agentSettings.onCall?(this.agentState="BREAK-AFTER-CALL",this.agentAuxState=""):(this.agentState=e.toUpperCase()||"",this.agentAuxState=t||"")};rt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.AGENT_STATE,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},state:{"#text":this.agentState},agent_aux_state:{"#text":this.agentAuxState}}};return JSON.stringify(e)},rt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.getText(t,"status"),s=sn.getText(t,"prev_state"),i=sn.getText(t,"current_state"),r=sn.getTextString(t,"prev_aux_state"),o=sn.getTextString(t,"agent_aux_state"),a=Mn.getInstance(),c=sn.buildDefaultResponse(e);if(c.agentId=e.ui_response.agent_id["#text"]||"",c.previousState=s,c.currentState=i,c.previousAuxState=r,c.currentAuxState=o,"OK"==n)r.length,o.length,a.agentSettings.currentState=i,a.agentSettings.currentStateLabel=o,a.agentStatePacket=e;else{""===c.message&&(c.message="Unable to change agent state");var u="Unable to change agent state. "+c.detail;sn.logMessage(Ae,u,e)}return c};const ot=function(e){this.username=e.username,this.password=e.password,this.platformId=e.platformId,this.rcAccessToken=e.rcAccessToken,this.tokenType=e.tokenType,this.engageAccessToken=e.engageAccessToken,this.authType=e.authType};function at(e,t,n){var s=Mn.getInstance(),i=s.authHost+s.baseAuthUri,r={headers:{"Content-Type":"application/json"}};switch(e){case be:case Ne:r.queryParams=n;var o="Error on agent authenticate POST to engage-auth. URL: "+i+t;new Me(i).httpPost(t,r).then((function(e){try{e=JSON.parse(e.response);var t=Mn.getInstance().authenticateRequest.processResponse(e);sn.fireCallback(Mn.getInstance().libraryInstance,Ue.AUTHENTICATE,t)}catch(e){sn.logMessage(Ae,o,e)}}),(function(e){var t={type:"Authenticate Error",message:o,err:e};sn.logMessage(Ae,o,e),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.AUTHENTICATE,t)}));break;case Oe:var a="Error on agent authenticate GET to engage-auth. URL: "+i+t;r.headers.Authorization="Bearer "+sn.toString(Mn.getInstance().authenticateRequest.engageAccessToken),new Me(i).httpGet(t,r).then((function(e){try{e=JSON.parse(e.response);var t=Mn.getInstance().authenticateRequest.processResponse(e);sn.fireCallback(Mn.getInstance().libraryInstance,Ue.AUTHENTICATE,t)}catch(e){sn.logMessage(Ae,a,e)}}),(function(e){sn.logMessage(Ae,a,e),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.AUTHENTICATE,e)}))}}ot.prototype.sendHttpRequest=function(){switch(Mn.getInstance().authenticateRequest=this,this.authType){case be:at(this.authType,"login/agent",{username:this.username,password:this.password,platformId:this.platformId});break;case Ne:at(this.authType,"login/rc/accesstoken",{rcAccessToken:this.rcAccessToken,rcTokenType:this.tokenType});break;case Oe:at(this.authType,"login",{})}},ot.prototype.processResponse=function(e){var t=Mn.getInstance();return t.authenticatePacket=e,t.authenticateRequest.accessToken=e.accessToken,t.authenticateRequest.refreshToken=e.refreshToken,t.authenticateRequest.tokenType=e.tokenType,t.authenticateRequest.socketUrl=e.iqUrl,t.authenticateRequest.socketPort=e.port,t.authenticateRequest.agents=e.agentDetails,t.authenticateRequest.platformId=e.platformId,t.authenticateRequest.mainAccountId=e.mainAccountId,t.authenticateRequest.regionalSettings=e.regionalSettings,t.authenticateRequest};const ct=function(e,t,n,s){this.audioType=e||"FULL",this.agentId=t,this.uii=n,this.monitorAgentId=s};ct.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.BARGE_IN,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(this.agentId)},uii:{"#text":sn.toString(this.uii)},audio_state:{"#text":sn.toString(this.audioType)},monitor_agent_id:{"#text":sn.toString(this.monitorAgentId)}}};return JSON.stringify(e)},ct.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return n.agentId=sn.getText(t,"agent_id"),n.uii=sn.getText(t,"uii"),"OK"===n.status?sn.logMessage(Ee,n.message,e):sn.logMessage(Ae,"There was an error processing the Barge-In request. "+n.detail,e),n};const ut=function(e,t){this.agentId=t||Mn.getInstance().agentSettings.agentId,this.leadId=e};ut.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CALLBACK_CANCEL,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},lead_id:{"#text":this.leadId}}};return JSON.stringify(e)};const lt=function(e){this.agentId=e||Mn.getInstance().agentSettings.agentId};function dt(e){return{auxData1:e["@aux_data1"],auxData2:e["@aux_data2"],auxData3:e["@aux_data3"],auxData4:e["@aux_data4"],auxData5:e["@aux_data5"],destination:e["@destination"],destinationE164:e["@destinationE164"],dialGroupId:e["@dial_group_id"],dialGroupName:e["@dial_group_name"],dialTime:e["@dial_time"],externId:e["@extern_id"],leadId:e["@lead_id"],firstName:sn.getText(e,"first_name"),midName:sn.getText(e,"mid_name"),lastName:sn.getText(e,"last_name"),sufix:sn.getText(e,"suffix"),title:sn.getText(e,"title"),address1:sn.getText(e,"address1"),address2:sn.getText(e,"address2"),city:sn.getText(e,"city"),state:sn.getText(e,"state"),zip:sn.getText(e,"zip"),gateKeeper:sn.getText(e,"gate_keeper")}}lt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CALLBACK_PENDING,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":this.agentId}}};return JSON.stringify(e)},lt.prototype.processResponse=function(e){var t=e.ui_response.lead,n=[];Array.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){var i=t[s];null!=i&&n.push(dt(i))}return Mn.getInstance().agentSettings.pendingCallbacks=JSON.parse(JSON.stringify(n)),Mn.getInstance().agentSettings.pendingCallbacks};const gt=function(e){this.notes=e};gt.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":sn.getMessageId(),response_to:"","@type":qe.CALL_NOTES,agent_id:{"#text":sn.toString(e.agentSettings.agentId)},uii:{"#text":sn.toString(e.currentCall.uii)},notes:{"#text":sn.toString(this.notes)}}};return JSON.stringify(t)},gt.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);return"OK"===t.status?(t.message="Call notes have been updated.",t.type="INFO_EVENT"):(t.type="ERROR_EVENT",t.message="Unable to update notes."),t};const pt=function(e){this.agentId=Mn.getInstance().agentSettings.agentId,this.campaignId=e};pt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CAMPAIGN_DISPOSITIONS,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":sn.toString(this.agentId)},campaign_id:{"#text":sn.toString(this.campaignId)}}};return JSON.stringify(e)},pt.prototype.processResponse=function(e){var t=e.ui_response,n=Mn.getInstance(),s=sn.processResponseCollection(t,"outdial_dispositions","disposition","disposition");return n.outboundSettings.campaignDispositions=s,s};const ht=function(e){this.chatState=e&&e.toUpperCase()||""};ht.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_STATE,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},state:{"#text":this.chatState}}};return JSON.stringify(e)},ht.prototype.processResponse=function(e){var t=e.ui_response,n=sn.getText(t,"status"),s=sn.getText(t,"prev_state"),i=sn.getText(t,"current_state"),r=Mn.getInstance(),o=sn.buildDefaultResponse(e);if(o.agentId=e.ui_response.agent_id["#text"]||"",o.previousState=s,o.currentState=i,"OK"==n)r.agentSettings.currentChatState=i,r.chatStatePacket=e;else{""===o.message&&(o.message="Unable to change chat state");var a="Unable to change chat state. "+o.detail;sn.logMessage(Ae,a,e)}return o};const ft=function(e,t,n,s){this.dialDest=e,this.callerId=t||"",this.sipHeaders=n||[],this.countryId=s||""};ft.prototype.formatJSON=function(){for(var e=[],t=0;t<this.sipHeaders.length;t++){var n=this.sipHeaders[t];e.push({"@name":sn.toString(n.name),"@value":sn.toString(n.value)})}var s={ui_request:{"@destination":"IQ","@type":qe.XFER_COLD,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},uii:{"#text":Mn.getInstance().currentCall.uii},dial_dest:{"#text":sn.toString(this.dialDest)},caller_id:{"#text":sn.toString(this.callerId)},country_id:{"#text":sn.toString(this.countryId)},xfer_header:e}};return JSON.stringify(s)},ft.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);if(n.agentId=sn.getText(t,"agent_id"),n.uii=sn.getText(t,"uii"),n.sessionId=sn.getText(t,"session_id"),n.dialDest=sn.getText(t,"dial_dest"),"OK"!==n.status){var s="There was an error processing the Cold Xfer request. "+n.message+" : "+n.detail;sn.logMessage(Ae,s,e)}return n};const St=function(e,t,n){this.targetAgentId=e,this.transferType=t,this.uii=n||Mn.getInstance().currentCall.uii};St.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@type":qe.DIRECT_AGENT_TRANSFER,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(e.agentSettings.agentId)},uii:{"#text":sn.toString(this.uii)},target_agent_id:{"#text":sn.toString(this.targetAgentId)},transfer_type:{"#text":sn.toString(this.transferType)}}};return JSON.stringify(t)},St.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);if(n.type=sn.getText(t,"type"),"OK"!==n.status){var s="There was an error processing the Direct Agent Transfer request. "+n.message+" : "+n.detail;sn.logMessage(Ae,s,e)}return n};const Tt=function(){};Tt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.DIRECT_AGENT_TRANSFER_LIST,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId}}};return JSON.stringify(e)},Tt.prototype.processResponse=function(e){var t=sn.buildDefaultResponse(e);if(t.agents=sn.processResponseCollection(e,"ui_response","agents"),"OK"!==t.status){var n="There was an error processing the Direct Agent Transfer List request. "+t.message+" : "+t.detail;sn.logMessage(Ae,n,e)}return t};const mt=function(e,t,n,s,i,r,o,a,c,u){this.uii=e,this.dispId=t,this.notes=n,this.callback=s,this.callbackDTS=i||"",this.contactForwardNumber=r||null,this.externId=a||null,this.leadId=c||null,this.requestId=u||null,this.survey=o||null};mt.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":sn.getMessageId(),"@response_to":"","@type":qe.OUTDIAL_DISPOSITION,agent_id:{"#text":sn.toString(e.agentSettings.agentId)},session_id:{"#text":""},uii:{"#text":sn.toString(this.uii)},disposition_id:{"#text":sn.toString(this.dispId)},notes:{"#text":sn.toString(this.notes)},call_back:{"#text":!0===this.callback?"TRUE":"FALSE"},call_back_DTS:{"#text":sn.toString(this.callbackDTS)},contact_forwarding:{"#text":sn.toString(this.contactForwardNumber)},outbound_externid:{"#text":sn.toString(this.externId)},lead_id:{"#text":sn.toString(this.leadId)},pending_request_id:{"#text":sn.toString(this.requestId)}}};if(e.currentCall.outdialDispositions&&"GATE"===e.currentCall.outdialDispositions.type&&(t.ui_request["@type"]=qe.INBOUND_DISPOSITION),e.currentCall.sessionId&&(t.ui_request.session_id={"#text":e.currentCall.sessionId}),null!==this.survey){for(var n=[],s=Object.keys(this.survey),i=0;i<s.length;i++){var r=s[i],o={"@extern_id":r,"@lead_update_column":sn.toString(this.survey[r].leadField),"#text":sn.toString(this.survey[r].value)};n.push(o)}t.ui_request.survey={response:n}}return JSON.stringify(t)};const _t=function(e,t,n,s,i,r,o){this.dispId=e,this.notes=t,this.callback=n,this.callbackDTS=s||"",this.leadId=i||null,this.requestId=r||null,this.externId=o||null};_t.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@message_id":sn.getMessageId(),"@response_to":"","@type":qe.OUTDIAL_DISPOSITION,manual_disp:{"#text":"TRUE"},agent_id:{"#text":sn.toString(e.agentSettings.agentId)},request_key:{"#text":sn.toString(this.requestId)},disposition_id:{"#text":sn.toString(this.dispId)},notes:{"#text":sn.toString(this.notes)},call_back:{"#text":!0===this.callback?"TRUE":"FALSE"},call_back_DTS:{"#text":sn.toString(this.callbackDTS)},lead_id:{"#text":sn.toString(this.leadId)},extern_id:{"#text":sn.toString(this.externId)},contact_forwarding:{"#text":"null"},session_id:{},uii:{}}};return JSON.stringify(t)};const It=function(){};function Ct(e,t,n,s){return e.then((function(e){try{t[s]=JSON.parse(e.response)}catch(e){sn.logMessage(Ae,n,e)}}),(function(e){sn.logMessage(Ae,n,e)}))}function vt(e,t){var n=Mn.getInstance(),s={headers:{"Content-Type":"application/json",Authorization:"Bearer "+t}};return new Me(n.authHost+n.baseEtrUri).httpGet(e,s).catch((function(e){sn.logMessage(Ae,e.message)}))}It.prototype.initEtrAPI=function(){return async function(e){var t=e.agentSettings.accountId;const n=await async function(e){const t=e.agentSettings.accountId;let n=!1;try{const{accountType:e}=await j.getLoggedInUser({evSubAccountId:t,force:!0});n=e===I}catch(e){n=!1}return n}(e);if(e.isOmni=n,n){const n=function(e,t,n){return[{request:vt(n+"/sources",t),uiModel:e.applicationSettings.edSources,error:"Error retrieving ED source name from ETR."},{request:vt(n+"/languages",t),uiModel:e.applicationSettings.edLanguages,error:"Error retrieving ED language name from ETR."},{request:vt(n+"/categories",t),uiModel:e.applicationSettings.edCategories,error:"Error retrieving ED categories from ETR."}]}(e,e.authenticateRequest.engageAccessToken,"digital-api-proxy/evSubAccount/"+t);for(var s=0;s<n.length;s++)await Ct(n[s].request,n[s].uiModel,n[s].error,t)}}(Mn.getInstance())};const yt=function(){};yt.prototype.getExtensionPresenceInfo=function(e){Mn.getInstance().ExtensionPresenceRequest=this,function(e,t){var n=Mn.getInstance(),s=n.authHost+n.baseApiUri,i="Bearer "+sn.toString(Mn.getInstance().authenticateRequest.engageAccessToken),r={headers:{"Content-Type":"application/json"}};r.headers.Authorization=i,r.queryParams=t;var o="Error while fetching extension presence response. URL: "+s+e;new Me(s).httpGet(e,r).then((function(e){try{e=JSON.parse(e.response);var t=Mn.getInstance().extensionPresenceRequest.processResponse(e);sn.fireCallback(Mn.getInstance().libraryInstance,Ue.EXTENSION_PRESENCE,t)}catch(e){sn.logMessage(Ae,o,e)}}),(function(e){var t={type:"Error while fetching extension presence response.",message:o};sn.logMessage(Ae,o,e),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.EXTENSION_PRESENCE,t)}))}("rcdirectory/getExtensionPresenceStatus",{extensionIds:e})},yt.prototype.processResponse=function(e){return Mn.getInstance().extensionPresenceResponse=e,Mn.getInstance().extensionPresenceResponse};const Et=function(e,t){this.sessionId=e||null,this.resetPendingDisp=t||!1};Et.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.HANGUP,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},uii:{"#text":sn.toString(Mn.getInstance().currentCall.uii)},session_id:{"#text":sn.toString(null===this.sessionId?Mn.getInstance().currentCall.sessionId:this.sessionId)},cancel_pending_disp:{"#text":!0===this.resetPendingDisp?"TRUE":"FALSE"}}};return JSON.stringify(e)};const Rt=function(e,t){this.holdState=e,this.sessionId=t||"1"};Rt.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@type":qe.HOLD,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(e.currentCall.agentId)},uii:{"#text":sn.toString(e.currentCall.uii)},session_id:{"#text":sn.toString(this.sessionId)},hold_state:{"#text":!0===this.holdState||"true"===this.holdState?"ON":"OFF"}}};return JSON.stringify(t)},Rt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e),s="";Mn.getInstance().currentCall.uii&&(s=Mn.getInstance().currentCall.uii),n.holdState="ON"===sn.getText(t,"hold_state"),n.sessionId=sn.getText(t,"session_id"),n.uii=sn.getText(t,"uii"),"OK"===n.status?n.uii===s?(""===n.message&&(n.message="Broadcasting new hold state of "+n.holdState),sn.logMessage(Ee,"Broadcasting new hold state of "+n.holdState,e)):sn.logMessage(Ee,"Hold Response is for a different call...discarding",e):(""===n.message&&(n.message="Error processing HOLD request. "+ +n.message+"\n"+n.detail),sn.logMessage(Ae,"Error processing HOLD request. "+n.detail,e));var i=Mn.getInstance();return"1"!==n.sessionId&&i.transferSessions[n.sessionId]&&(i.transferSessions[n.sessionId].onHold=n.holdState),n};const At=function(e){this.leadId=e};At.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@type":qe.LEAD_HISTORY,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(e.agentSettings.agentId)},lead_id:{"#text":sn.toString(this.leadId)}}};return JSON.stringify(t)},At.prototype.processResponse=function(e){var t={leadId:e.ui_response["@lead_id"]},n=sn.processResponseCollection(e,"ui_response","previous_dial");return Array.isArray(n)||(n=[n]),t.leadHistory=n,t};const bt=function(e){e.agent_reserved&&!0===e.agent_reserved?e.agent_reserved="1":e.agent_reserved="0",e.dialable&&!0===e.dialable?e.dialable="1":e.dialable="0",this.dataObj=e};bt.prototype.formatJSON=function(){const e={ui_request:{"@destination":"IQ","@type":qe.LEAD_INSERT,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(this.dataObj.agent_id)},campaign_id:{"#text":sn.toString(this.dataObj.campaign_id)},lead_phone:{"#text":sn.toString(this.dataObj.lead_phone)},lead_phone_e164:{"#text":sn.toString(this.dataObj.lead_phone_e164)},dialable:{"#text":sn.toString(this.dataObj.dialable)},agent_reserved:{"#text":sn.toString(this.dataObj.agent_reserved)},call_back_dts:{"#text":sn.toString(this.dataObj.callback_dts)},first_name:{"#text":sn.toString(this.dataObj.first_name)},mid_name:{"#text":sn.toString(this.dataObj.mid_name)},last_name:{"#text":sn.toString(this.dataObj.last_name)},suffix:{"#text":sn.toString(this.dataObj.suffix)},title:{"#text":sn.toString(this.dataObj.title)},address1:{"#text":sn.toString(this.dataObj.address1)},address2:{"#text":sn.toString(this.dataObj.address2)},city:{"#text":sn.toString(this.dataObj.city)},state:{"#text":sn.toString(this.dataObj.state)},zip:{"#text":sn.toString(this.dataObj.zip)},email:{"#text":sn.toString(this.dataObj.email)},gate_keeper:{"#text":sn.toString(this.dataObj.gate_keeper)},aux_data1:{"#text":sn.toString(this.dataObj.aux_data1)},aux_data2:{"#text":sn.toString(this.dataObj.aux_data2)},aux_data3:{"#text":sn.toString(this.dataObj.aux_data3)},aux_data4:{"#text":sn.toString(this.dataObj.aux_data4)},aux_data5:{"#text":sn.toString(this.dataObj.aux_data5)},phoneNumbersI18nEnabled:{"#text":sn.toString(this.dataObj.phoneNumbersI18nEnabled)}}};return JSON.stringify(e)},bt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return n.message=t.msg["#text"],n};const Nt=function(e,t,n,s,i){this.leadId=e,this.leadPhone=t,this.leadPhoneE164=n,this.phoneNumbersI18nEnabled=s,this.baggage=i,this.agentId=sn.toString(Mn.getInstance().agentSettings.agentId)};Nt.prototype.formatJSON=function(){var e,t;this.baggage=(e=this.baggage,(t={}).first_name={"#text":e.first_name||""},t.mid_name={"#text":e.mid_name||""},t.last_name={"#text":e.last_name||""},t.suffix={"#text":e.suffix||""},t.title={"#text":e.title||""},t.address1={"#text":e.address1||""},t.address2={"#text":e.address2||""},t.city={"#text":e.city||""},t.state={"#text":e.state||""},t.zip={"#text":e.zip||""},t.email={"#text":e.email||""},t.gate_keeper={"#text":e.gate_keeper||""},t.extern_id={"#text":e.extern_id||""},t.aux_data1={"#text":e.aux_data1||""},t.aux_data2={"#text":e.aux_data2||""},t.aux_data3={"#text":e.aux_data3||""},t.aux_data4={"#text":e.aux_data4||""},t.aux_data5={"#text":e.aux_data5||""},t);var n={ui_request:{"@destination":"IQ","@type":qe.LEAD_UPDATE,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":this.agentId},lead_id:{"#text":sn.toString(this.leadId)},lead_phone:{"#text":sn.toString(this.leadPhone)},lead_phone_e164:{"#text":sn.toString(this.leadPhoneE164)},phoneNumbersI18nEnabled:{"#text":sn.toString(this.phoneNumbersI18nEnabled)},baggage:this.baggage}};return JSON.stringify(n)},Nt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return n.message=t.msg["#text"],n};const Ot=function(e,t,n,s,i,r,o){this.queueIds=t||[],this.chatIds=n||[],this.skillProfileId=s||"",this.dialGroupId=i||"",this.dialDest=e||"",this.updateFromAdminUI=r||!1,this.loginType="NO-SELECTION",this.updateLogin=!1,this.isForce=o;var a=Mn.getInstance();this.queueIds=sn.checkExistingIds(a.inboundSettings.availableQueues,this.queueIds,"gateId"),this.chatIds=sn.checkExistingIds(a.chatSettings.availableChatQueues,this.chatIds,"chatQueueId"),this.skillProfileId=sn.checkExistingIds(a.inboundSettings.availableSkillProfiles,[this.skillProfileId],"profileId")[0]||"",this.dialGroupId=sn.checkExistingIds(a.outboundSettings.availableOutdialGroups,[this.dialGroupId],"dialGroupId")[0]||"",this.queueIds.length>0&&""!==this.dialGroupId?this.loginType="BLENDED":this.queueIds.length>0?this.loginType="INBOUND":""!==this.dialGroupId?this.loginType="OUTBOUND":this.chatIds.length>0?this.loginType="CHAT":this.loginType="NO-SELECTION",a.agentSettings.isLoggedIn&&(this.updateLogin=!0,this.dialDest=Mn.getInstance().agentSettings.dialDest),sn.validateDest(this.dialDest)||sn.logMessage(Ae,"dialDest ["+this.dialDest+"] must be a valid sip or 10-digit DID","")};function Dt(e){var t=Mn.getInstance(),n=t.outboundSettings.availableOutdialGroups;t.outboundSettings.outdialGroup={};for(var s=0;s<n.length;s++){var i=n[s];i.dialGroupId===e.ui_response.outdial_group_id["#text"]&&(t.agentPermissions.allowLeadSearch=i.allowLeadSearch,t.agentPermissions.allowPreviewLeadFilters=i.allowPreviewLeadFilters,t.agentPermissions.progressiveEnabled=i.progressiveEnabled,t.outboundSettings.outdialGroup=JSON.parse(JSON.stringify(i)),t.agentPermissions.requireFetchedLeadsCalled=i.requireFetchedLeadsCalled)}}function wt(e){var t=Mn.getInstance();t.inboundSettings.skillProfile={};for(var n=t.inboundSettings.availableSkillProfiles,s=0;s<n.length;s++){var i=n[s],r=sn.getText(e.ui_response,"skill_profile_id");i.profileId===r&&(t.inboundSettings.skillProfile=JSON.parse(JSON.stringify(i)))}}function xt(e){var t=Mn.getInstance(),n=t.inboundSettings.availableQueues,s=[],i=[],r=e.ui_response.gates.gate_id||[];Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++){var a=r[o];s.push(a["#text"])}for(var c=0;c<n.length;c++){var u=n[c];s.indexOf(u.gateId)>-1&&i.push(u)}t.inboundSettings.queues=JSON.parse(JSON.stringify(i))}function Ut(e){var t=Mn.getInstance(),n=t.chatSettings.availableChatQueues,s=[],i=[],r=(e.ui_response.chat_queues||{}).chat_queue_id||[];Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++){var a=r[o];s.push(a["#text"])}for(var c=0;c<n.length;c++){var u=n[c];s.indexOf(u.chatQueueId)>-1&&i.push(u)}t.chatSettings.chatQueues=JSON.parse(JSON.stringify(i))}Ot.prototype.formatJSON=function(){for(var e={ui_request:{"@destination":"IQ","@type":qe.LOGIN,"@message_id":sn.getMessageId(),"@rcx_client_app_type":sn.toString(Mn.getInstance().clientAppType),"@rcx_client_sdk_version":sn.toString(Mn.getInstance().clientSDKVersion),"@rcx_client_app_version":sn.toString(Mn.getInstance().clientAppVersion),response_to:"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},access_token:{"#text":Mn.getInstance().authenticateRequest.accessToken},hash_code:{"#text":Mn.getInstance().connectionSettings.hashCode},allow_multisocket:{"#text":sn.toString(Mn.getInstance().applicationSettings.allowMultiSocket)},dial_dest:{"#text":sn.toString(this.dialDest)},login_type:{"#text":this.loginType},update_login:{"#text":sn.toString(this.updateLogin)},outdial_group_id:{"#text":sn.toString(this.dialGroupId)},skill_profile_id:{"#text":sn.toString(this.skillProfileId)},update_from_adminui:{"#text":sn.toString(this.updateFromAdminUI)},agent_platform_id:{"#text":sn.toString(2)},is_force:{"#text":sn.toString(this.isForce)}}},t=[],n=0;n<this.queueIds.length;n++)""!==this.queueIds[n]&&t.push({"#text":sn.toString(this.queueIds[n])});t.length>0?e.ui_request.gates={gate_id:t}:e.ui_request.gates={};for(var s=[],i=0;i<this.chatIds.length;i++)""!==this.chatIds[i]&&s.push({"#text":sn.toString(this.chatIds[i])});return s.length>0?e.ui_request.chat_queues={chat_queue_id:s}:e.ui_request.chat_queues={},JSON.stringify(e)},Ot.prototype.processResponse=function(e){var t=e.ui_response,n=sn.getText(t,"status"),s=sn.getText(t,"detail"),i=Mn.getInstance(),r="",o=sn.buildDefaultResponse(e),a=Mn.getInstance().libraryInstance,c=!1;if("Logon Session Configuration Updated!"===s&&(i.agentSettings.updateLoginMode=!0,r="Logon Session Configuration Updated!",sn.logMessage(Re,r,e)),"SUCCESS"===n){if(i.agentSettings.isLoggedIn)if(i.agentSettings.updateLoginMode)i.agentSettings.dialDest=sn.getText(t,"dial_dest"),i.agentSettings.loginType=sn.getText(t,"login_type"),i.agentSettings.accountId=sn.getText(t,"account_id"),i.agentSettings.updateLoginMode=!1,i.agentPermissions.allowLeadSearch=!1,i.agentPermissions.requireFetchedLeadsCalled=!1,i.agentPermissions.allowPreviewLeadFilters=!1,Dt(e),xt(e),Ut(e),wt(e);else{if(c=!0,r="Processed a Layer 2 Reconnect Successfully",i.agentSettings.onCall=sn.getText(t,"is_on_call"),i.connectionSettings.activeCallUii=sn.getText(t,"active_call_uii"),i.connectionSettings.isPendingDisp=sn.getText(t,"is_pending_disp"),!1===i.agentSettings.onCall){if(i.currentCall.uii){var u={ui_notification:{"@message_id":"","@type":"END-CALL",uii:{"#text":i.currentCall.uii},term_reason:{"#text":"SOCKET-DISCONNECT"}}};sn.processNotification(a,u)}if(i.agentSettings.isOffhook){var l={ui_notification:{agent_id:{"#text":Mn.getInstance().agentSettings.agentId},"@type":"OFF-HOOK-TERM","@message_id":""}},d=sn.processNotification(a,l);a.offhookTerm(d)}}else if(!i.agentSettings.onCall||i.currentCall.uii===i.connectionSettings.activeCallUii&&!0!==a.waitingForAddSession){var g=a.getTransferSessions(),p=e.ui_response.active_call_sessions.call_session_id.map((function(e){return e["#text"]}));for(var h in g)-1===p.indexOf(h)&&delete Mn.getInstance().transferSessions[h]}else i.currentCall.uii=i.connectionSettings.activeCallUii,i.currentCall.pendingDisp=!1,a.hangup(1,!0);sn.logMessage(Re,r,e)}else i.loginPacket=e,i.agentSettings.isLoggedIn=!0,i.agentSettings.loginDTS=new Date,i.connectionSettings.reconnect=!0,i.agentPermissions.allowLeadSearch=!1,i.agentSettings.dialDest=sn.getText(t,"dial_dest"),i.agentSettings.loginType=sn.getText(t,"login_type"),i.agentSettings.accountId=sn.getText(t,"account_id"),i.agentSettings.corporateDirectory=sn.getText(t,"corporate_dir"),i.agentSettings.consultCall=sn.getText(t,"is_consultcall"),i.connectionSettings.isMultiSocket="true"===sn.getText(t,"is_multisocket"),!0!==i.applicationSettings.allowMultiSocket&&!0!==i.connectionSettings.isMultiSocket||ke.init(),Dt(e),xt(e),Ut(e),wt(e);i.connectionSettings.hashCode=sn.getText(t,"hash_code")||i.connectionSettings.hashCode,i.agentSettings.guid=sn.getText(t,"guid")||i.agentSettings.guid,i.dataStore.save("agent_id",sn.getText(t,"agent_id")),i.dataStore.save("hash_code",sn.getText(t,"hash_code")),o.agentSettings=i.agentSettings,o.agentPermissions=i.agentPermissions,o.applicationSettings=i.applicationSettings,o.chatSettings=i.chatSettings,o.connectionSettings=i.connectionSettings,o.inboundSettings=i.inboundSettings,o.outboundSettings=i.outboundSettings,o.scriptSettings=i.scriptSettings,o.isReconnect=c}else""===o.message&&(o.message="Agent configuration attempt failed (2nd layer login)"),sn.logMessage(Ae,o.message,e);return o};const qt=function(){};function kt(e){var t=e["@campaign_id"],n=e["@allow_lead_updates"];Mn.getInstance().agentPermissions.allowLeadUpdatesByCampaign[t]=n;var s=e.custom_labels,i=[];for(var r in s){var o={};o[r.replace(/@/,"")]=s[r],i.push(o)}return{campaignId:t,campaignName:e["@campaign_name"],surveyId:e["@survey_id"],surveyName:e["@survey_name"],customLabels:i,allowLeadUpdates:n}}qt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.LOGIN_PHASE_1,"@message_id":sn.getMessageId(),response_to:"",reconnect:{"#text":sn.toString(Mn.getInstance().connectionSettings.reconnect)},agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},access_token:{"#text":sn.toString(Mn.getInstance().authenticateRequest.accessToken)}}};return JSON.stringify(e)},qt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.getText(t,"status"),s=Mn.getInstance(),i=sn.buildDefaultResponse(e);if("OK"===n&&!s.applicationSettings.isLoggedInIS){s.loginPhase1Packet=e,s.applicationSettings.isEmbeddedLogin=sn.parseJwt(s.authenticateRequest.engageAccessToken).embd||!1,s.applicationSettings.isLoggedInIS=!0,s.applicationSettings.isSso=sn.getText(t,"is_sso"),s.applicationSettings.isFlr=sn.getText(t,"is_flr"),s.applicationSettings.isTcpaSafeMode="1"===sn.getText(t,"tcpa_safe_mode"),s.applicationSettings.pciEnabled="1"===sn.getText(t,"pci_enabled"),s.applicationSettings.enableCallContactHistory=sn.getText(t,"enable_call_contact_history"),s.agentSettings.enableCallQuality=sn.getText(t,"enable_call_quality"),s.chatSettings.alias=sn.getText(t,"first_name")+" "+sn.getText(t,"last_name"),s.agentSettings.loginDTS=new Date,s.agentSettings.maxBreakTime=sn.getText(t,"max_break_time"),s.agentSettings.maxLunchTime=sn.getText(t,"max_lunch_time"),s.agentSettings.firstName=sn.getTextString(t,"first_name"),s.agentSettings.lastName=sn.getTextString(t,"last_name"),s.agentSettings.email=sn.getText(t,"email"),s.agentSettings.agentId=sn.getText(t,"agent_id"),s.agentSettings.externalAgentId=sn.getText(t,"external_agent_id"),s.agentSettings.agentType=sn.getText(t,"agent_type"),s.agentSettings.realAgentType=sn.getText(t,"real_agent_type"),s.agentSettings.defaultLoginDest=sn.getText(t,"default_login_dest"),s.agentSettings.altDefaultLoginDest=sn.getText(t,"alt_default_login_dest"),s.agentSettings.initLoginState=sn.getText(t,"init_login_state"),s.agentSettings.initLoginStateLabel=sn.getText(t,"init_login_state_label"),s.agentSettings.outboundManualDefaultRingtime=sn.getText(t,"outbound_manual_default_ringtime"),s.agentSettings.phoneLoginPin=sn.getText(t,"phone_login_pin"),s.agentSettings.username=sn.getTextString(t,"username"),s.agentSettings.agentPassword=sn.getText(t,"agent_pwd"),s.agentPermissions.allowCallControl="1"===sn.getText(t,"allow_call_control"),s.agentPermissions.allowChat="1"===sn.getText(t,"allow_chat"),s.agentPermissions.enableChat="1"===sn.getText(t,"enable_chat"),s.agentPermissions.showLeadHistory="1"===sn.getText(t,"show_lead_history"),s.agentPermissions.allowManualOutboundGates="1"===sn.getText(t,"allow_manual_outbound_gates"),s.agentPermissions.allowOffHook="1"===sn.getText(t,"allow_off_hook"),s.agentPermissions.allowManualCalls="1"===sn.getText(t,"allow_manual_calls"),s.agentPermissions.allowManualPass="1"===sn.getText(t,"allow_manual_pass"),s.agentPermissions.allowManualIntlCalls="1"===sn.getText(t,"allow_manual_intl_calls"),s.agentPermissions.allowLoginUpdates="1"===sn.getText(t,"allow_login_updates"),s.agentPermissions.allowInbound="1"===sn.getText(t,"allow_inbound"),s.agentPermissions.allowOutbound="1"===sn.getText(t,"allow_outbound"),s.agentPermissions.allowBlended="1"===sn.getText(t,"allow_blended"),s.agentPermissions.allowLoginControl="1"===sn.getText(t,"allow_login_control"),s.agentPermissions.allowCrossQueueRequeue="1"===sn.getText(t,"allow_cross_gate_requeue"),s.agentPermissions.disableSupervisorMonitoring="1"===sn.getText(t,"disable_supervisor_monitoring"),s.agentPermissions.allowAutoAnswer="1"===sn.getText(t,"allow_auto_answer"),s.agentPermissions.defaultAutoAnswerOn="1"===sn.getText(t,"default_auto_answer_on"),s.agentPermissions.allowHistoricalDialing="1"===sn.getText(t,"allow_historical_dialing"),s.agentPermissions.allowAgentStats="1"===sn.getText(t,"allow_agent_stats"),s.agentPermissions.allowCampaignStats="1"===sn.getText(t,"allow_camp_stats"),s.agentPermissions.allowGateStats="1"===sn.getText(t,"allow_gate_stats"),s.agentPermissions.allowChatStats="1"===sn.getText(t,"allow_chat_stats"),s.agentPermissions.enableFolderMode="1"===sn.getText(t,"enable_folder_mode"),s.agentPermissions.enableTaskMode="1"===sn.getText(t,"enable_task_mode"),s.outboundSettings.defaultDialGroup=sn.getText(t,"phone_login_dial_group"),e.ui_response.allow_lead_inserts&&void 0!==t.insert_campaigns&&e.ui_response.insert_campaigns.campaign&&(s.agentPermissions.allowLeadInserts="1"===sn.getText(t,"allow_lead_inserts")),s.outboundSettings.availableCampaigns=function(e){var t=[],n=null;if(void 0!==e.ui_response.campaigns.campaign&&(n=e.ui_response.campaigns.campaign),n){Array.isArray(n)||(n=[n]);for(var s=0;s<n.length;s++)t.push(kt(n[s]))}return t}(e),s.chatSettings.availableChatQueues=sn.processResponseCollection(e.ui_response,"login_chat_queues","chat_queue"),function(e,t){var n=e.availableChatQueues,s=t.ui_response.login_chat_queues.chat_queue;Array.isArray(s)||(s=[s]);for(var i=0;i<n.length;i++){for(var r=n[i],o={},a=0;a<s.length;a++){var c=s[a];if(c["@chat_queue_id"]===r.chatQueueId){o=c;break}}o.dnis&&(Array.isArray(o.dnis)||(o.dnis=[o.dnis]),r.dnis=o.dnis.map((function(e){return e["#text"]})))}}(s.chatSettings,e),s.chatSettings.availableChatRequeueQueues=sn.processResponseCollection(e.ui_response,"chat_requeue_queues","chat_group"),s.inboundSettings.availableQueues=sn.processResponseCollection(e.ui_response,"login_gates","gate"),s.inboundSettings.availableSkillProfiles=sn.processResponseCollection(e.ui_response,"skill_profiles","profile"),s.inboundSettings.availableRequeueQueues=sn.processResponseCollection(e.ui_response,"requeue_gates","gate_group"),s.chatSettings.availableChatRooms=sn.processResponseCollection(e.ui_response,"chat_rooms","room"),s.scriptSettings.availableScripts=sn.processResponseCollection(e.ui_response,"scripts","script"),s.agentSettings.callerIds=sn.processResponseCollection(e.ui_response,"caller_ids","caller_id"),s.agentSettings.availableAgentStates=sn.processResponseCollection(e.ui_response,"agent_states","agent_state"),s.agentSettings.allAgentStates=sn.processResponseCollection(e.ui_response,"agent_states_all","agent_state"),s.applicationSettings.availableCountries=sn.processResponseCollection(e.ui_response,"account_countries","country"),s.agentSettings.reportCallQualityIssueTypes=sn.processResponseCollection(e.ui_response,"call_quality_issues","call_issues"),s.outboundSettings.insertCampaigns=sn.processResponseCollection(e.ui_response,"insert_campaigns","campaign");for(var r=sn.processResponseCollection(e.ui_response,"outdial_groups","group"),o=0;o<r.length;o++){var a=r[o];a.allowLeadSearch="YES"===a.allowLeadSearch,a.allowPreviewLeadFilters="1"===a.allowPreviewLeadFilters,a.progressiveEnabled="1"===a.progressiveEnabled,a.requireFetchedLeadsCalled="1"===a.requireFetchedLeadsCalled,a.hciType=parseInt(a.hciEnabled)||0,a.hciEnabled="1"===a.hciEnabled||"2"===a.hciEnabled,a.hciClicker="1"===a.hciClicker}s.outboundSettings.availableOutdialGroups=r;var c=s.authenticateRequest.agents.find((function(e){return+e.agentId==+s.agentSettings.agentId}));s.agentSettings.accountId=c.accountId,s.etrRequest.initEtrAPI()}return i.agentSettings=s.agentSettings,i.agentPermissions=s.agentPermissions,i.applicationSettings=s.applicationSettings,i.chatSettings=s.chatSettings,i.connectionSettings=s.connectionSettings,i.inboundSettings=s.inboundSettings,i.outboundSettings=s.outboundSettings,i.scriptSettings=s.scriptSettings,i};const Pt=function(e,t){this.agentId=e,this.message=t||""};Pt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.LOGOUT,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":this.agentId},message:{"#text":this.message}}};return JSON.stringify(e)},Pt.prototype.processResponse=function(e){return sn.buildDefaultResponse(e)};const Lt=function(){};Lt.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@type":qe.LOGIN_MULTISOCKET,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":JSON.parse(e.dataStore.get("agent_id"))},hash_code:{"#text":JSON.parse(e.dataStore.get("hash_code"))}}};return Mn.getInstance().loginRequest=new Ot(null,null,null,null,null,null,null),JSON.stringify(t)};const Mt=function(){};Mt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.OFFHOOK_INIT,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},dial_dest:{"#text":Mn.getInstance().agentSettings.dialDest}}};return JSON.stringify(e)},Mt.prototype.processResponse=function(e){var t=e.ui_response.status["#text"],n=sn.buildDefaultResponse(e);if("OK"===t){var s=sn.getText(e.ui_response,"monitoring");Mn.getInstance().offhookInitPacket=e,Mn.getInstance().agentSettings.isOffhook=!0,Mn.getInstance().agentSettings.isMonitoring=s,n.monitoring=s,Mn.getInstance().softphoneSettings.attemptingSoftphoneReconnect=!1}else""===n.message&&(n.message="Unable to process offhook request"),sn.logMessage(Ae,n.message+" "+n.detail,e);return n};const Ht=function(){};Ht.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.OFFHOOK_TERM,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId}}};return JSON.stringify(e)},Ht.prototype.processResponse=function(e){var t=e.ui_notification,n="1"===sn.getText(t,"monitoring"),s=Mn.getInstance();return s.agentSettings.wasMonitoring=n,s.offhookTermPacket=e,s.agentSettings.isOffhook=!1,s.agentSettings.isMonitoring=!1,{status:"OK",agentId:sn.getText(t,"agent_id"),startDts:sn.getText(t,"start_dts"),endDts:sn.getText(t,"end_dts"),monitoring:n}};const Ft=function(e,t,n,s,i){this.destination=e,this.callerId=t,this.ringTime=n||"60",this.countryId=s||"USA",this.gateId=i||""};Ft.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.ONE_TO_ONE_OUTDIAL,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},destination:{"#text":sn.toString(this.destination)},ring_time:{"#text":sn.toString(this.ringTime)},caller_id:{"#text":sn.toString(this.callerId)},country_id:{"#text":sn.toString(this.countryId)},gate_id:{"#text":sn.toString(this.gateId)}}};return JSON.stringify(e)};const Gt=function(e){this.uii=e};Gt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.ONE_TO_ONE_OUTDIAL_CANCEL,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},uii:{"#text":sn.toString(this.uii)}}};return JSON.stringify(e)};const jt=function(e){this.record=e};jt.prototype.formatJSON=function(){var e=Mn.getInstance(),t="10";e.currentCall.agentRecording&&e.currentCall.agentRecording.pause&&(t=e.currentCall.agentRecording.pause);var n={ui_request:{"@destination":"IQ","@type":qe.PAUSE_RECORD,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(e.currentCall.agentId)},uii:{"#text":sn.toString(e.currentCall.uii)},record:{"#text":sn.toString(!0===this.record?"TRUE":"FALSE")},pause:{"#text":sn.toString(t)}}};return JSON.stringify(n)},jt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e),s="";return Mn.getInstance().currentCall.uii&&(s=Mn.getInstance().currentCall.uii),n.uii=sn.getText(t,"uii"),n.state=sn.getText(t,"state"),n.pause=sn.getText(t,"pause"),"OK"===n.status?n.uii===s?(""===n.message&&(n.message="Broadcasting new record state of "+n.state),sn.logMessage(Ee,"Broadcasting new record state of "+n.state,e)):sn.logMessage(Ee,"Pause Record Response is for a different call...discarding",e):(""===n.message&&(n.message="Error processing PAUSE-RECORD request."+n.message+"\n"+n.detail),sn.logMessage(Ae,n.message,e)),n};const Bt=function(){};Bt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.PING_CALL,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().currentCall.agentId},uii:{"#text":Mn.getInstance().currentCall.uii}}};return JSON.stringify(e)};const Kt=function(e,t,n,s,i){this.agentId=Mn.getInstance().agentSettings.agentId,this.searchFields=t||[],this.requestId=n||"",this.action=e||"",this.leadPhone=s||"",this.leadPhoneE164=i||""};Kt.prototype.formatJSON=function(){for(var e={},t=0;t<this.searchFields.length;t++){var n=this.searchFields[t];e[n.key]={"#text":sn.toString(n.value)}}var s={ui_request:{"@destination":"IQ","@type":qe.PREVIEW_DIAL,"@message_id":sn.getMessageId(),"@action":this.action,"@response_to":"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},pending_request_id:{"#text":sn.toString(this.requestId)},lead_phone:{"#text":sn.toString(this.leadPhone)},lead_phone_e164:{"#text":sn.toString(this.leadPhoneE164)},search_fields:e}};return JSON.stringify(s)},Kt.prototype.processResponse=function(e){for(var t=e.dialer_request,n=Mn.getInstance(),s=sn.processResponseCollection(t,"destinations","lead"),i=0;i<s.length;i++){var r=s[i];r.requestId=r.requestKey,r.ani=r.destination,r.aniE164=r.destinationE164,Array.isArray(t.destinations.lead)||(t.destinations.lead=[t.destinations.lead]);try{var o=t.destinations.lead[i];if(o.extra_data)for(var a in o["@lead_id"]!==r.leadId&&(o=t.destinations.lead.filter((function(e){return e["@lead_id"]===r.leadId}))),delete r.extraDatas,r.extraData={},o.extra_data)r.extraData[a]=o.extra_data[a]["#text"]}catch(e){console.warn("error parsing lead extra data: "+e)}}var c={action:t["@action"],callbacks:"TRUE"===t["@callbacks"],dialGroupId:sn.getText(t,"dial_group_id"),accountId:sn.getText(t,"account_id"),agentId:sn.getText(t,"agent_id"),isInsert:sn.getText(t,"is_insert"),leads:s};return"TRUE"===t["@callbacks"]?(sn.logMessage(Re,"New CALLBACK packet request rec'd from dialer",e),s.forEach((function(e){n.callbacks.push(e)}))):n.outboundSettings.previewDialLeads=s,c};const Jt=function(e){this.record=e};Jt.prototype.formatJSON=function(){var e=Mn.getInstance(),t={ui_request:{"@destination":"IQ","@type":qe.RECORD,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(e.currentCall.agentId)},uii:{"#text":sn.toString(e.currentCall.uii)},record:{"#text":!0===this.record?"TRUE":"FALSE"}}};return JSON.stringify(t)},Jt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e),s="";return Mn.getInstance().currentCall.uii&&(s=Mn.getInstance().currentCall.uii),n.uii=sn.getText(t,"uii"),n.state=sn.getText(t,"state"),"OK"===n.status?n.uii===s?(""===n.message&&(n.message="Broadcasting new record state of "+n.state),sn.logMessage(Ee,n.message,e)):sn.logMessage(Ee,"Record Response is for a different call...discarding",e):(""===n.message&&(n.message="Error processing RECORD request."+n.message+"\n"+n.detail),sn.logMessage(Ae,n.message,e)),n};const Wt=function(e,t,n){this.queueId=e,this.skillId=t,this.maintain=n};Wt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.REQUEUE,"@message_id":sn.getMessageId(),response_to:"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},uii:{"#text":Mn.getInstance().currentCall.uii},gate_number:{"#text":sn.toString(this.queueId)},skill_id:{"#text":sn.toString(this.skillId)},maintain_agent:{"#text":!0===this.maintain?"TRUE":"FALSE"}}};return JSON.stringify(e)},Wt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);if(n.agentId=sn.getText(t,"agent_id"),n.uii=sn.getText(t,"uii"),n.queueId=sn.getText(t,"gate_number"),"OK"!==n.status){var s="There was an error processing the requeue request. "+n.detail;sn.logMessage(Ae,s,e)}return n};const Vt=function(e,t){this.scriptId=e,this.version=t||null};Vt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@message_id":sn.getMessageId(),response_to:"","@type":qe.SCRIPT_CONFIG,agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},script_id:{"#text":sn.toString(this.scriptId)}}};return JSON.stringify(e)},Vt.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return"true"===n.status?(n.status=!0,n.scriptId=sn.getText(t,"script_id"),n.version=sn.getText(t,"version"),n.json=sn.getText(t,"json"),Mn.getInstance().scriptSettings.loadedScripts[n.scriptId]=n):n.status=!1,n};const Yt=function(e,t,n){this.uii=e,this.scriptId=t,this.jsonResult=n};Yt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@message_id":sn.getMessageId(),response_to:"","@type":qe.SCRIPT_RESULT,agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},uii:{"#text":sn.toString(this.uii)},script_id:{"#text":sn.toString(this.scriptId)},sequence_id:{"#text":sn.toString(Mn.getInstance().currentCall.sessionId)},segment_id:{"#text":sn.toString(Mn.getInstance().currentCall.segmentId)},json_result:{"#text":JSON.stringify(this.jsonResult)}}};return JSON.stringify(e)};const Qt=function(){};Qt.prototype.searchDirectory=function(e){Mn.getInstance().searchDirectoryRequest=this,function(e,t){var n=Mn.getInstance(),s=n.agentSettings.accountId,i=n.authHost+n.baseApiUri,r="Bearer "+sn.toString(Mn.getInstance().authenticateRequest.engageAccessToken),o={headers:{"Content-Type":"application/json"},queryParams:{}};o.headers.Authorization=r,o.queryParams.searchString=t,o.queryParams.accountId=s;var a="Error on request to search Directory: "+i+e;new Me(i).httpGet(e,o).then((function(e){try{e=JSON.parse(e.response);var t=Mn.getInstance().searchDirectoryRequest.processResponse(e);sn.fireCallback(Mn.getInstance().libraryInstance,Ue.SEARCH_DIR,t)}catch(e){sn.logMessage(Ae,a,e)}}),(function(e){var t={type:"Error retrieving directory list",message:a};sn.logMessage(Ae,a,e),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.SEARCH_DIR,t)}))}("rcdirectory/getRcCorporateDirectory",e)},Qt.prototype.processResponse=function(e){return Mn.getInstance().filteredDirectory=e,Mn.getInstance().filteredDirectory};const Xt=function(){};Xt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":qe.STATS,"@message_id":sn.getMessageId(),"@response_to":"",include_supervisor_stats:{"#text":!0===Mn.getInstance().agentSettings.includeSupervisorStats?"TRUE":"FALSE"},last_roundtrip_duration_ms:{"#text":sn.toString(Mn.getInstance().applicationSettings.statsRoundtripDurationMs)}}};return JSON.stringify(e)};const zt=function(e,t,n,s,i,r,o){this.uii=e,this.sessionId=t,this.segmentId=n,this.agentId=s,this.segment_cut_timestamp_ms=i,this.dialogId=r,this.requestMessageId=o};zt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.REQUEST_SUMMARY,"@message_id":sn.getMessageId(),"@response_to":"",requestMessageId:{"#text":sn.toString(this.requestMessageId)},dialog_id:{"#text":sn.toString(this.dialogId)},uii:{"#text":sn.toString(this.uii)},session_id:{"#text":sn.toString(this.sessionId)},segment_id:{"#text":sn.toString(this.segmentId)},agent_id:{"#text":sn.toString(this.agentId)},segment_cut_timestamp_ms:{"#text":sn.toString(this.segment_cut_timestamp_ms)}}};return JSON.stringify(e)};const $t=function(e,t,n,s){this.agentId=Mn.getInstance().agentSettings.agentId,this.searchFields=t||[],this.requestId=n||"",this.action=e||"",this.leadPhone=s||""};$t.prototype.formatJSON=function(){for(var e={},t=0;t<this.searchFields.length;t++){var n=this.searchFields[t];e[n.key]={"#text":sn.toString(n.value)}}var s={ui_request:{"@destination":"IQ","@type":qe.TCPA_SAFE,"@message_id":sn.getMessageId(),"@action":this.action,response_to:"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},pending_request_id:{"#text":sn.toString(this.requestId)},lead_phone:{"#text":sn.toString(this.leadPhone)},search_fields:e}};return JSON.stringify(s)},$t.prototype.processResponse=function(e){for(var t=e.dialer_request,n=Mn.getInstance(),s=sn.processResponseCollection(t,"destinations","lead"),i=0;i<s.length;i++){var r=s[i];r.requestId=r.requestKey,r.ani=r.destination,Array.isArray(t.destinations.lead)||(t.destinations.lead=[t.destinations.lead]);try{var o=t.destinations.lead[i];if(o.extra_data)for(var a in o["@lead_id"]!==r.leadId&&(o=t.destinations.lead.filter((function(e){return e["@lead_id"]===r.leadId}))),delete r.extraDatas,r.extraData={},o.extra_data)r.extraData[a]=o.extra_data[a]["#text"]}catch(e){console.warn("error parsing lead extra data: "+e)}}var c={action:t["@action"],callbacks:"TRUE"===t["@callbacks"],dialGroupId:sn.getText(t,"dial_group_id"),accountId:sn.getText(t,"account_id"),agentId:sn.getText(t,"agent_id"),isInsert:sn.getText(t,"is_insert"),leads:s};return"TRUE"===t["@callbacks"]?(sn.logMessage(Re,"New CALLBACK packet request rec'd from dialer",e),s.forEach((function(e){n.callbacks.push(e)}))):n.outboundSettings.tcpaSafeLeads=s,c};const Zt=function(e,t){this.dialDest=e,this.isSoftphoneError=t||!1};Zt.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.UPDATE_DIAL_DESTINATION,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)},dial_dest:{"#text":sn.toString(this.dialDest)},log_softphone_error:{"#text":sn.toString(!0===this.isSoftphoneError?"TRUE":"FALSE")}}};return JSON.stringify(e)};const en=function(e,t,n,s){this.dialDest=e,this.callerId=t||"",this.sipHeaders=n||[],this.countryId=s};en.prototype.formatJSON=function(){for(var e=[],t=0;t<this.sipHeaders.length;t++){var n=this.sipHeaders[t];e.push({"@name":sn.toString(n.name),"@value":sn.toString(n.value)})}var s={ui_request:{"@destination":"IQ","@type":qe.XFER_WARM,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},uii:{"#text":Mn.getInstance().currentCall.uii},dial_dest:{"#text":sn.toString(this.dialDest)},caller_id:{"#text":sn.toString(this.callerId)},country_id:{"#text":sn.toString(this.countryId)},xfer_header:e}};return JSON.stringify(s)},en.prototype.processResponse=function(e){var t=e.ui_response,n=sn.buildDefaultResponse(e);return n.agentId=sn.getText(t,"agent_id"),n.uii=sn.getText(t,"uii"),n.sessionId=sn.getText(t,"session_id"),n.dialDest=sn.getText(t,"dial_dest"),"OK"===n.status?sn.logMessage(Ee,"Warm Xfer to "+n.dialDest+" processed successfully.",e):sn.logMessage(Ae,"There was an error processing the Warm Xfer request. "+n.message+"\n"+n.detail,e),n};const tn=function(e){this.dialDest=e};tn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.XFER_WARM_CANCEL,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},uii:{"#text":Mn.getInstance().currentCall.uii},dial_dest:{"#text":sn.toString(this.dialDest)}}};return JSON.stringify(e)};const nn=function(){};nn.prototype.getSipRegistrationInfo=function(){Mn.getInstance().WebRTCRequest=this,function(e,t){var n=Mn.getInstance(),s=n.authHost+n.baseApiUri,i="Bearer "+sn.toString(Mn.getInstance().authenticateRequest.engageAccessToken),r={headers:{"Content-Type":"application/json"}};r.headers.Authorization=i,r.queryParams=t;var o="Error on request get to sip registration info. URL: "+s+e;new Me(s).httpGet(e,r).then((function(e){try{e=JSON.parse(e.response);var t=Mn.getInstance().WebRTCRequest.processResponse(e);n.softphoneSettings.lastSipFetchTime=Date.now(),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.WEBRTC_INFO,t)}catch(e){sn.logMessage(Ae,o,e)}}),(function(e){var t={type:"Error retrieving sip registration information",message:o};sn.logMessage(Ae,o,e),sn.fireCallback(Mn.getInstance().libraryInstance,Ue.WEBRTC_INFO,t)}))}("sip/sipRegistrationInfo",{agentId:Mn.getInstance().agentSettings.agentId,ssoLogin:Mn.getInstance().applicationSettings.isSso})},nn.prototype.processResponse=function(e){var t=Mn.getInstance().softphoneSettings;return t.sipInfo=e.sipInfo,t.sipInfo};const sn={logMessage:function(e,t,n){var s=Mn.getInstance().libraryInstance;if(s._db)try{var i=s._db.transaction(["logger"],"readwrite").objectStore("logger"),r={logLevel:e,message:t,dts:new Date,data:n};i.add(r)}catch(e){console.error("Error adding log message: "+e)}},sendMessage:function(e,t){var n=JSON.parse(t),s=n.ui_request["@type"];if(e.socket&&1===e.socket.readyState){var i="Sending "+s+" request message to "+n.ui_request["@destination"];e._requests.push({id:n.ui_request["@message_id"],type:n.ui_request["@type"],msg:n.ui_request}),e._requests.length>1e3&&e._requests.shift(),e.socket.send(t),"STATS"===s?sn.logMessage("stats",i,n):sn.logMessage(Re,i,n)}else sn._isStatOrBeatMessage(s,n.ui_request)||(e._queuedMsgs.length+1>100&&e._queuedMsgs.shift(),e._queuedMsgs.push({dts:new Date,msg:t}))},processResponse:function(e,t){var n,s,i=t.ui_response["@type"],r=t.ui_response["@message_id"],o=""!==r&&r?r.slice(0,2):"IS",a="Received "+i.toUpperCase()+" response message from "+o;switch(sn.logMessage(Re,a,t),sn.fireCallback(e,Ue.ON_MESSAGE,t),i.toUpperCase()){case qe.AGENT_STATE:null===Mn.getInstance().agentStateRequest&&(Mn.getInstance().agentStateRequest=new rt(t.ui_response.current_state["#text"],t.ui_response.agent_aux_state["#text"]));var c=Mn.getInstance().agentStateRequest.processResponse(t);sn.fireCallback(e,Ue.AGENT_STATE,c);break;case qe.BARGE_IN:var u=Mn.getInstance().bargeInRequest.processResponse(t);if(n=t.ui_response["@response_to"],s=sn.findRequestById(e,n)){var l=s.msg.audio_state["#text"];"MUTE"===l?sn.fireCallback(e,Ue.SILENT_MONITOR,u):"COACHING"===l?sn.fireCallback(e,Ue.COACH_CALL,u):sn.fireCallback(e,Ue.BARGE_IN,u)}else sn.fireCallback(e,Ue.BARGE_IN,u);break;case qe.CAMPAIGN_DISPOSITIONS:var d=Mn.getInstance().campaignDispositionsRequest.processResponse(t);sn.fireCallback(e,Ue.CAMPAIGN_DISPOSITIONS,d);break;case qe.CALL_NOTES:var g=Mn.getInstance().callNotesRequest.processResponse(t);sn.fireCallback(e,Ue.CALL_NOTES,g);break;case qe.CALLBACK_PENDING:var p=Mn.getInstance().callbacksPendingRequest.processResponse(t);sn.fireCallback(e,Ue.CALLBACK_PENDING,p);break;case qe.HOLD:var h=(null===Mn.getInstance().holdRequest?new Rt:Mn.getInstance().holdRequest).processResponse(t);sn.fireCallback(e,Ue.HOLD,h);break;case qe.LEAD_HISTORY:var f=Mn.getInstance().leadHistoryRequest.processResponse(t);sn.fireCallback(e,Ue.LEAD_HISTORY,f);break;case qe.LEAD_INSERT:var S=Mn.getInstance().leadInsertRequest.processResponse(t);sn.fireCallback(e,Ue.LEAD_INSERT,S);break;case qe.LEAD_UPDATE:var T=Mn.getInstance().leadUpdateRequest.processResponse(t);sn.fireCallback(e,Ue.LEAD_UPDATE,T);break;case qe.LOGIN_PHASE_1:var m=Mn.getInstance().loginPhase1Request.processResponse(t);sn.fireCallback(e,Ue.LOGIN_PHASE_1,m);break;case qe.LOGIN:var _=Mn.getInstance().loginRequest.processResponse(t);sn.fireCallback(e,Ue.LOGIN,_);break;case qe.OFFHOOK_INIT:var I=(new Mt).processResponse(t);sn.fireCallback(e,Ue.OFFHOOK_INIT,I);break;case qe.PAUSE_RECORD:var C=(null===Mn.getInstance().pauseRecordRequest?new jt:Mn.getInstance().pauseRecordRequest).processResponse(t);sn.fireCallback(e,Ue.PAUSE_RECORD,C);break;case qe.RECORD:var v=Mn.getInstance().recordRequest.processResponse(t);sn.fireCallback(e,Ue.RECORD,v);break;case qe.REQUEUE:var y=Mn.getInstance().requeueRequest.processResponse(t);sn.fireCallback(e,Ue.REQUEUE,y);break;case qe.SUPERVISOR_LIST:var E=Mn.getInstance().supervisorListRequest.processResponse(t);sn.fireCallback(e,Ue.SUPERVISOR_LIST,E);break;case qe.SCRIPT_CONFIG:var R=Mn.getInstance().scriptConfigRequest.processResponse(t);sn.fireCallback(e,Ue.SCRIPT_CONFIG,R);break;case qe.XFER_COLD:var A=Mn.getInstance().coldXferRequest.processResponse(t);sn.fireCallback(e,Ue.XFER_COLD,A);break;case qe.XFER_WARM:var b=Mn.getInstance().warmXferRequest.processResponse(t);sn.fireCallback(e,Ue.XFER_WARM,b);break;case qe.XFER_WARM_CANCEL:var N=Mn.getInstance().warmXferCancelRequest.processResponse(t);sn.fireCallback(e,Ue.XFER_WARM_CANCEL,N);break;case qe.ACK:var O=Mn.getInstance().ackRequest.processResponse(t);n=t.ui_response["@response_to"],s=sn.findRequestById(e,n),O.uii=s.msg.uii&&s.msg.uii["#text"],sn.fireCallback(e,Ue.ACK,O);break;case qe.CHAT_LIST:var D=(new hn).processResponse(t);sn.fireCallback(e,Ue.CHAT_LIST,D);break;case qe.CHAT_STATE:var w=(new ht).processResponse(t);sn.fireCallback(e,Ue.CHAT_STATE,w);break;case qe.DIRECT_AGENT_TRANSFER_LIST:var x=(new Tt).processResponse(t);sn.fireCallback(e,Ue.DIRECT_AGENT_TRANSFER_LIST,x);break;case qe.DIRECT_AGENT_TRANSFER:var U=(new St).processResponse(t);sn.fireCallback(e,Ue.DIRECT_AGENT_TRANSFER,U)}},processNotification:function(e,t){var n=t.ui_notification["@type"],s=t.ui_notification["@message_id"],i=""===s?"IS":s.slice(0,2),r="Received "+n.toUpperCase()+" notification message from "+i;switch(sn.logMessage(Re,r,t),n.toUpperCase()){case qe.ADD_SESSION:new rn(e,t).setupAddSessionCallback();break;case qe.DIAL_GROUP_CHANGE:var o=(new je).processResponse(t);sn.fireCallback(e,Ue.DIAL_GROUP_CHANGE,o);break;case qe.DIAL_GROUP_CHANGE_PENDING:var a=(new Be).processResponse(t);sn.fireCallback(e,Ue.DIAL_GROUP_CHANGE_PENDING,a);break;case qe.DROP_SESSION:var c=(new Je).processResponse(t);sn.fireCallback(e,Ue.DROP_SESSION,c);break;case qe.EARLY_UII:var u=(new We).processResponse(t);sn.fireCallback(e,Ue.EARLY_UII,u);break;case qe.END_CALL:var l=new Ve(e).processResponse(t);sn.fireCallback(e,Ue.END_CALL,l);break;case qe.GATES_CHANGE:var d=(new Ye).processResponse(t);sn.fireCallback(e,Ue.GATES_CHANGE,d);break;case qe.GENERIC:var g=(new Qe).processResponse(t),p=t.ui_notification["@response_to"],h=sn.findRequestById(e,p);if(h){var f=h.type,S=sn.findCallbackBasedOnMessageType(f);S?(f===qe.CALLBACK_CANCEL&&(g.leadId=h.msg.lead_id["#text"]),sn.fireCallback(e,S,g)):sn.fireCallback(e,Ue.GENERIC_NOTIFICATION,g)}else"001"===g.messageCode&&Mn.getInstance().pingIntervalId&&clearInterval(Mn.getInstance().pingIntervalId),sn.fireCallback(e,Ue.GENERIC_NOTIFICATION,g);break;case qe.NEW_CALL:var T=(new Xe).processResponse(t);sn.fireCallback(e,Ue.NEW_CALL,T),new rn(e,t).processSessionsForCall();break;case qe.OFFHOOK_TERM:null===Mn.getInstance().offhookTermRequest&&(Mn.getInstance().offhookTermRequest=new Ht);var m=Mn.getInstance().offhookTermRequest.processResponse(t);sn.fireCallback(e,Ue.OFFHOOK_TERM,m);break;case qe.PREVIEW_LEAD_STATE:var _=(new Ze).processResponse(t);sn.fireCallback(e,Ue.PREVIEW_LEAD_STATE,_);break;case qe.PENDING_DISP:var I=(new $e).processResponse(t);sn.fireCallback(e,Ue.PENDING_DISP,I);break;case qe.PENDING_CHAT_DISP:var C=(new ze).processResponse(t);sn.fireCallback(e,Ue.PENDING_CHAT_DISP,C);break;case qe.REVERSE_MATCH:var v=(new et).processResponse(t);sn.fireCallback(e,Ue.REVERSE_MATCH,v);break;case qe.TCPA_SAFE_LEAD_STATE:var y=(new st).processResponse(t);sn.fireCallback(e,Ue.TCPA_SAFE_LEAD_STATE,y);break;case qe.CHAT_ACTIVE:var E=(new on).processResponse(t);sn.fireCallback(e,Ue.CHAT_ACTIVE,E);break;case qe.CHAT_INACTIVE:var R=(new pn).processResponse(t);sn.fireCallback(e,Ue.CHAT_INACTIVE,R);break;case qe.CHAT_CLIENT_RECONNECT:var A=(new dn).processResponse(t);sn.fireCallback(e,Ue.CHAT_CLIENT_RECONNECT,A);break;case qe.CHAT_PRESENTED:(new Sn).processResponse(t);break;case qe.CHAT_TYPING:var b=(new yn).processResponse(t);sn.fireCallback(e,Ue.CHAT_TYPING,b);break;case qe.CHAT_NEW:var N=(new On).processResponse(t);sn.fireCallback(e,Ue.CHAT_NEW,N);break;case qe.CHAT_MESSAGE:var O=(new fn).processResponse(t);sn.fireCallback(e,Ue.CHAT_MESSAGE,O);break;case qe.CHAT_CANCELLED:var D=(new ln).processResponse(t);sn.fireCallback(e,Ue.CHAT_CANCELLED,D);break;case qe.STOP_MONITOR_CHAT:var w=(new Dn).processResponse(t);sn.fireCallback(e,Ue.CHAT_STOP_MONITOR,w);break;case qe.DIRECT_AGENT_ROUTE:var x=(new Ke).processResponse(t);sn.fireCallback(e,Ue.DIRECT_AGENT_TRANSFER_NOTIF,x);break;case qe.AGENT_DEBUG_EMAIL:var U=(new Ge).processResponse(t);sn.fireCallback(e,Ue.AGENT_DEBUG_EMAIL_NOTIF,U);break;case qe.CHAT_LOAD_MEDIA:var q=(new An).processResponse(t);sn.fireCallback(e,Ue.CHAT_LOAD_MEDIA,q);break;case qe.CHAT_AGENT_ASSIGN_FAILURE:var k=(new an).processResponse(t);sn.fireCallback(e,Ue.CHAT_AGENT_ASSIGN_FAILURE,k);break;case qe.LOGOUT:var P=(new Pt).processResponse(t);sn.fireCallback(e,Ue.LOGOUT,P);var L=Mn.getInstance();L.dataStore.remove("agent_id"),L.dataStore.remove("hash_code"),L.agentSettings.isLoggedIn=!1,e.closeSocket();break;case qe.SUMMARY:var M=(new tt).processResponse(t);sn.fireCallback(e,Ue.SUMMARY,M);break;case qe.SUMMARY_ERROR:var H=(new nt).processResponse(t);sn.fireCallback(e,Ue.SUMMARY_ERROR,H)}},processDialerResponse:function(e,t){var n=t.dialer_request["@type"],s=t.dialer_request["@message_id"],i=""===s?"IS":s.slice(0,2),r="Received "+n.toUpperCase()+" dialer response message from "+i;switch(sn.logMessage(Re,r,t),sn.fireCallback(e,Ue.ON_MESSAGE,t),n.toUpperCase()){case qe.PREVIEW_DIAL_ID:var o=(new Kt).processResponse(t);"SEARCH"===o.action.toUpperCase()?sn.fireCallback(e,Ue.LEAD_SEARCH,o):sn.fireCallback(e,Ue.PREVIEW_FETCH,o);break;case qe.TCPA_SAFE_ID:var a=(new $t).processResponse(t);"SEARCH"===a.action.toUpperCase()?sn.fireCallback(e,Ue.SAFE_MODE_SEARCH,a):sn.fireCallback(e,Ue.SAFE_MODE_FETCH,a)}},processRequest:function(e,t){switch(t.ui_request["@type"].toUpperCase()){case qe.CHAT_SEND:var n=(new vn).processResponse(t);sn.fireCallback(e,Ue.CHAT,n);break;case qe.CHAT_ROOM_STATE:var s=(new Cn).processResponse(t);sn.fireCallback(e,Ue.CHAT_ROOM_STATE,s)}},processStats:function(e,t){var n=t.ui_stats["@type"],s=Mn.getInstance().applicationSettings;switch(s.statsMsgRequestedTime>0&&(s.statsRoundtripDurationMs=Date.now()-s.statsMsgRequestedTime,s.statsMsgRequestedTime=0),n.toUpperCase()){case qe.STATS_AGENT:var i=Mn.getInstance().agentStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_AGENT,i);break;case qe.STATS_SUPERVISOR:var r=Mn.getInstance().supervisorStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_SUPERVISOR,r);break;case qe.STATS_AGENT_DAILY:var o=Mn.getInstance().agentDailyStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_AGENT_DAILY,o),null===Mn.getInstance().agentDailyIntervalId&&(Mn.getInstance().agentDailyIntervalId=setInterval(sn.onAgentDailyStats,1e3));break;case qe.STATS_CAMPAIGN:var a=Mn.getInstance().campaignStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_CAMPAIGN,a);break;case qe.STATS_QUEUE:var c=Mn.getInstance().queueStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_QUEUE,c);break;case qe.STATS_CHAT:var u=Mn.getInstance().chatQueueStatsPacket.processResponse(t);sn.fireCallback(e,Ue.STATS_CHAT_QUEUE,u)}},processResponseCollection:function(e,t,n,s){if(s=s||"text",e[t]&&void 0!==e[t][n]){var i=e[t][n];return this._processItems(i,s)}return[]},escapeSoftphoneUsername:function(e){return e&&e.replace(/[@]/g,"_at_")},_processItems:function(e,t){var n=[];if(null==e)return n;Array.isArray(e)||(e=[e]);for(var s=0;s<e.length;s++)n.push(this._processItem(e[s],t));return n},_processItem:function(e,t){if("text"===t&&1===Object.keys(e).length&&null!=e["#text"])return this._tryConvertValueToBoolean(e["#text"]);var n={};for(var s in e){var i=this._convertToFormattedKey(s,t),r=e[s];"object"==typeof r?Array.isArray(r)&&0===r.length||0===Object.keys(r).length?n[i]="":Array.isArray(r)||Object.keys(r).length>1?n[i=this._convertKeyForCollection(i)]=this._processItems(r,t):1===Object.keys(r).length&&null!=r["#text"]?n[i]=r["#text"]:n[i]=this._processItems(r[Object.keys(r)[0]],"text"):n[i]="@agent_aux_state"===s?r.toString():this._tryConvertValueToBoolean(r)}return n},_convertToFormattedKey:function(e,t){return e.match(/^#/)?t:e.replace(/@/,"").replace(/_([a-z])/g,(function(e){return e[1].toUpperCase()}))},_convertKeyForCollection:function(e){return"s"!==e.substr(e.length-1)?e+"s":e},_tryConvertValueToBoolean:function(e){return null===e?null:"TRUE"===e.toUpperCase()||"FALSE"!==e.toUpperCase()&&e},fireCallback:function(e,t,n){n=n||"",void 0!==t&&"function"==typeof e.callbacks[t]&&e.callbacks[t].call(e,n)},setCallback:function(e,t,n){void 0!==t&&void 0!==n&&(e.callbacks[t]=n)},getMessageId:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},checkExistingIds:function(e,t,n){for(var s=[],i=[],r=0;r<e.length;r++)s.push(parseInt(e[r][n],10));for(var o=0;o<t.length;o++)-1===s.indexOf(parseInt(t[o],10))&&i.push(parseInt(t[o],10));for(var a=t.length-1;a>=0;a--)i.indexOf(parseInt(t[a],10))>-1&&t.splice(a,1);return t},findObjById:function(e,t,n){for(var s=0;s<e.length;s++){var i=e[s];if(i[n]===t)return i}return null},validateDest:function(e){var t=!1;return(/^\d+$/.test(e)&&10===e.length||"sip:"===e.slice(0,4).toLowerCase()&&-1!==e.indexOf("@"))&&(t=!0),t},findCallbackBasedOnMessageType:function(e){var t="";for(var n in qe)qe[n]===e&&(t=Ue[n]);return t},buildDefaultResponse:function(e,t){t=t||!1;var n="",s="",i="",r="",o="",a={},c="",u="",l="",d="",g="",p="",h={},f="";e.ui_response?(u=e.ui_response.message,l=e.ui_response.detail,d=e.ui_response.status,g=e.ui_response.operation_id,p=e.ui_response.error_code,h=e.ui_response.error_params,f=e.ui_response["@type"]):e.ui_notification&&(u=e.ui_notification.message,l=e.ui_notification.detail,d=e.ui_notification.status,g=e.ui_notification.operation_id,p=e.ui_notification.error_code,h=e.ui_notification.error_params,f=e.ui_notification["@type"]),u&&(n=u["#text"]||""),l&&(s=l["#text"]||""),d&&(i=d["#text"]||""),g&&(r=g["#text"]||""),p&&(o=p["#text"]||""),h&&(a=h["#text"]?JSON.parse(h["#text"]):{}),f&&(c=f||"");var S={message:n,detail:s,status:i,errorCode:o,errorParams:a,type:c};return t&&(S.operationId=r),S},toString:function(e){return e?e.toString():""},getValue:function(e,t){var n=e[t];return n&&n||""},getText:function(e,t){var n=e[t];return n&&n["#text"]?"TRUE"===n["#text"].toUpperCase()||"FALSE"!==n["#text"].toUpperCase()&&(n["#text"]||""):""},getTextString:function(e,t){var n=e[t];return n&&n["#text"]&&n["#text"]||""},getAttribute:function(e,t){var n=e[t];return n&&n[t]?"TRUE"===n[t].toUpperCase()||"FALSE"!==n[t].toUpperCase()&&(n[t]||""):""},getEdValue:function(e,t){var n,s,i=!1,r="";if(e)for(n=0;n<e.length;n++)e[n].id===t&&(r=e[n].name,i=!0,e[n].color&&(s=e[n].color));var o={isCached:i,name:r};return s&&(o.color=s),o},getMultiEdValues:function(e,t){var n,s,i=!1,r=[];if(e)for(n=0;n<t.length;n++)s=sn.getEdValue(e,t[n]),r.push(s.name),s.isCached&&(i=!0);return{isCached:i,names:r}},parseKeyValuePairsFromString:function(e,t,n){return e?e.split(t).reduce((function(e,t){var s=t.split(n);return e[s[0]]=s[1],e}),{}):[]},findRequestById:function(e,t){for(var n=null,s=0;s<e._requests.length;s++)if(e._requests[s].id===t){n=e._requests[s];break}return n},sendPingCallMessage:function(){Mn.getInstance().pingCallRequest=new Bt;var e=Mn.getInstance().pingCallRequest.formatJSON(),t=JSON.parse(e),n=sn.getText(t.ui_request,"agent_id"),s=sn.getText(t.ui_request,"uii");""===n||""===s?sn.logMessage(Ae,"PING-CALL message failed, agentId or UII is empty",t):sn.sendMessage(Mn.getInstance().libraryInstance,e)},sendStatsRequestMessage:function(){var e=Mn.getInstance(),t=e.statsRequest.formatJSON();return 0===e.applicationSettings.statsMsgRequestedTime&&(e.applicationSettings.statsMsgRequestedTime=Date.now()),sn.sendMessage(e.libraryInstance,t),t},sendPingRequestMessage:function(){var e=Mn.getInstance().libraryInstance;e.socket&&1===e.socket.readyState&&e.socket.send("BEAT")},onAgentDailyStats:function(){if(0!==Object.keys(Mn.getInstance().agentDailyStats).length){var e=Mn.getInstance().agentSettings,t=Mn.getInstance().agentDailyStats;if(e.isOffhook){var n=t.totalOffhookTime;t.totalOffhookTime=Number(n)+1}if("ENGAGED"===e.currentState){var s=t.currCallTime;t.currCallTime=Number(s)+1}}},getDialDestination:function(){const e=Mn.getInstance(),t=e.softphoneSettings;if(t.sipInfo.length){const n=t.sipInfo[0],s=e.applicationSettings.dialDestType;if("LEGACY_SOFTPHONE"===s)return"sip:"+sn.escapeSoftphoneUsername(n.username)+"@"+n.domain;if("RC_SOFTPHONE"===s){const t=e.applicationSettings.isI18nEnabled?n.username_e164:n.username;return sn.escapeSoftphoneUsername(t)+"@RC_SOFTPHONE"}}return""},refreshAccessToken:function(){var e=Mn.getInstance(),t=e.authHost+e.baseAuthUri,n="Error in refreshing access token",s={queryParams:{loginHashcode:e.connectionSettings.hashCode,agentId:e.agentSettings.agentId,platformId:e.authenticateRequest.platformId,isSso:e.applicationSettings.isSso}};return new Me(t).httpPost("login/agent/hashcode",s).then((function(e){try{e=JSON.parse(e.response),Mn.getInstance().authenticateRequest.engageAccessToken=e.accessToken}catch(e){sn.logMessage(Ae,n,e)}}),(function(e){var t={type:"refreshAccessToken Error",message:n};sn.logMessage(Ae,t,e)}))},isAccessTokenExpired:function(){const{accessToken:e}=Mn.getInstance().authenticateRequest;if(!e)return!0;try{const{exp:t}=sn.parseJwt(e);return Math.round(1e3*t-Date.now()-200)<=0}catch(e){return!0}},generateOpId:function(e){for(var t="",n=e=e||24;n>0;--n)t+="0123456789abcdefghijklmnopqrstuvwxyz"[Math.round(35*Math.random())];return t},parseJwt:function(e){try{return JSON.parse(window.atob(e.split(".")[1]))}catch(e){return{}}},getConsoleLogData:function(){return new Promise((function(e,t){try{Mn.getInstance().libraryInstance.getConsoleLogRecords(null,(function(t){e(JSON.stringify(sn.handleConsoleLogMessages(t)))}))}catch(e){t(JSON.stringify(e))}}))},handleConsoleLogMessages:function(e){return e.map((function(e){return e.message})).reverse().join(" ")},getDebugLogData:function(){return new Promise((function(e,t){try{var n=new Date((new Date).setHours((new Date).getHours()-4)),s=new Date;Mn.getInstance().libraryInstance.getLogRecords("all",n,s,void 0,(function(t){e(JSON.stringify(t))}))}catch(e){t(JSON.stringify(e))}}))},_isStatOrBeatMessage:function(e,t){return"STAT"===e||"BEAT"===t}};function rn(e,t){this.instance=e,this.data=t;var n=this;function s(e,t){var n=(new Fe).processResponse(t);sn.fireCallback(e,Ue.ADD_SESSION,n)}this.setupAddSessionCallback=function(){var e=sn.getText(t.ui_notification,"uii"),i=sn.getText(t.ui_notification,"session_id"),r=Mn.getInstance().currentCall;console.log(e+" ADD SESSION "+i),r.uii===e?s(n.instance,n.data):(Mn.getInstance().pendingNewCallSessions[e]=Mn.getInstance().pendingNewCallSessions[e]||{},Mn.getInstance().pendingNewCallSessions[e][i]=n)},this.processSessionsForCall=function(){var e=Mn.getInstance().currentCall.uii,t=Mn.getInstance().pendingNewCallSessions[e];if(console.log(e+" NEW CALL"),t&&Object.keys(t).length>0){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[n];s(i.instance,i.data)}else console.error("error processing sessions for uii: "+e+" session: "+n);delete Mn.getInstance().pendingNewCallSessions[e]}}}const on=function(){};on.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e,!0);return n.message="Received CHAT-ACTIVE notification",n.status="OK",n.accountId=sn.getText(t,"account_id"),n.uii=sn.getText(t,"uii"),n.isMonitoring=sn.getText(t,"is_monitoring"),n.sessionId=sn.getText(t,"session_id"),n.segmentId=sn.getText(t,"segment_id"),n.dialogId=sn.getText(t,"dialog_id"),n.summary=sn.getText(t,"summary"),n};const an=function(){};an.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e,!0);return n.message="Received CHAT-AGENT-ASSIGN-FAILURE notification",n.status="OK",n.uii=sn.getText(t,"uii"),n.taskId=sn.getText(t,"task_id"),n.accountId=sn.getText(t,"account_id"),n};const cn=function(e,t){this.uii=t,this.agentId=e};cn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_AGENT_END,uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":sn.toString(this.agentId)},operation_id:{"#text":sn.generateOpId()}}};return JSON.stringify(e)};const un=function(e){this.alias=e};un.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":qe.CHAT_ALIAS,"@message_id":sn.getMessageId(),"@response_to":"",alias:{"#text":sn.toString(this.alias)}}};return JSON.stringify(e)};const ln=function(){};ln.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e,!0);return n.message="Received CHAT-CANCELLED notification",n.status="OK",n.messageId=t["@message_id"],n.accountId=sn.getText(t,"account_id"),n.uii=sn.getText(t,"uii"),n};const dn=function(){};dn.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e);return n.message="Received CHAT-CLIENT-RECONNECT notification",n.status="OK",n.accountId=sn.getText(t,"account_id"),n.uii=sn.getText(t,"uii"),n.agentId=sn.getText(t,"agent_id"),n};const gn=function(e,t,n,s,i,r,o,a,c){this.uii=e,this.agentId=t,this.dispositionId=n,this.notes=s||"",this.sendAcknowlegement=i||!1,this.sessionId=o,this.dialogId=a,this.segmentId=c,this.survey=r||null};gn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_DISPOSITION,"@message_id":sn.getMessageId(),"@response_to":"",dialog_id:{"#text":sn.toString(this.dialogId)},segment_id:{"#text":sn.toString(this.segmentId)},uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":sn.toString(this.agentId)},session_id:{"#text":sn.toString(this.sessionId)},disposition_id:{"#text":sn.toString(this.dispositionId)},notes:{"#text":sn.toString(this.notes)},do_ack:{"#text":!0===this.sendAcknowlegement?"TRUE":"FALSE"}}};if(null!==this.survey){for(var t=[],n=Object.keys(this.survey),s=0;s<n.length;s++){var i=n[s],r={"@extern_id":i,"#text":sn.toString(this.survey[i].value)};t.push(r)}e.ui_request.survey={response:t}}return JSON.stringify(e)};const pn=function(){};pn.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e,!0);return n.message="Received CHAT-INACTIVE notification",n.status="OK",n.accountId=sn.getText(t,"account_id"),n.uii=sn.getText(t,"uii"),n.dispositionTimeout=sn.getText(t,"disposition_timeout"),n.dequeueAgentId=sn.getText(t,"dequeue_agent_id"),n};const hn=function(e,t){this.agentId=e,this.monitorAgentId=t};hn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_LIST,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(this.agentId)},monitor_agent_id:{"#text":sn.toString(this.monitorAgentId)}}};return JSON.stringify(e)},hn.prototype.processResponse=function(e){var t=e.ui_response;Mn.getInstance().chatListResponse=e;var n=sn.buildDefaultResponse(e);return n.message="Received CHAT-LIST response",n.status="OK",n.messageId=t["@message_id"],n.agentId=sn.getText(t,"agent_id"),n.monitorAgentId=sn.getText(t,"monitor_agent_id"),n.chatList=sn.processResponseCollection(t,"chat_list","active_chat"),n};const fn=function(e,t,n,s){this.uii=e,this.agentId=t,this.message=n,this.whisper=s};fn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_MESSAGE,"@message_id":sn.getMessageId(),"@response_to":"",uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":sn.toString(this.agentId)},message:{"#text":sn.toString(this.message)},whisper:{"#text":sn.toString(this.whisper)}}};return JSON.stringify(e)},fn.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.getText(t,"dts").trim(),s=new Date(n.replace(" ","T")),i=sn.buildDefaultResponse(e);return i.status="OK",i.uii=sn.getText(t,"uii"),i.accountId=sn.getText(t,"account_id"),i.from=sn.getText(t,"from"),i.type=sn.getText(t,"type"),i.message=sn.getText(t,"message"),i.whisper=sn.getText(t,"whisper"),i.dequeueAgentId=sn.getText(t,"dequeue_agent_id"),i.dts=s,i.mediaLinks=sn.processResponseCollection(t,"media_links","link"),sn.logMessage(Ee,"New CHAT-MESSAGE packet received from IntelliQueue",e),i};const Sn=function(){};function Tn(e,t,n,s,i){var r=e.ui_notification,o=sn.buildDefaultResponse(e,!0);return o.message="Received CHAT-PRESENTED notification",o.status="OK",o.messageId=r["@message_id"],o.accountId=sn.getText(r,"account_id"),o.taskId=sn.getText(r,"task_id"),o.dialogId=sn.getText(r,"dialog_id"),o.uii=sn.getText(r,"uii"),o.channelType=sn.getText(r,"channel_type"),o.chatQueueId=sn.getText(r,"chat_queue_id"),o.chatQueueName=sn.getText(r,"chat_queue_name"),o.allowAccept=sn.getText(r,"allow_accept"),o.isReconnect=sn.getText(r,"is_reconnect"),o.edAuthorScreenName=sn.getText(r,"ed_author_screen_name"),o.edCreatedAt=sn.getText(r,"ed_created_at"),o.edThreadTitle=sn.getText(r,"ed_thread_title"),o.edSourceName=t,o.sourceColor=n,o.edLanguage=s,o.edCategories=i,""!==sn.getText(r,"chat_type")?o.chatType=sn.getText(r,"chat_type"):o.chatType="LEGACY",o.segmentContext=function(e={}){const t=e.dialog||{},n=e.customer_identity||{};return{segmentId:sn.getText(e,"segment_id"),dialog:{dialogId:sn.getText(t,"dialog_id"),channelId:sn.getText(t,"channel_id"),channelType:sn.getText(t,"channel_type"),dialogDirection:sn.getText(t,"dialog_direction")},customerIdentity:{id:sn.getText(n,"id"),identityGroupId:sn.getText(n,"identity_group_id"),uuid:sn.getText(n,"uuid"),foreignId:sn.getText(n,"foreign_id"),type:sn.getText(n,"type"),createdAt:sn.getText(n,"created_at"),updatedAt:sn.getText(n,"updated_at"),company:sn.getText(n,"company"),email:sn.getText(n,"email"),displayName:sn.getText(n,"display_name"),avatarUrl:sn.getText(n,"avatar_url"),firstName:sn.getText(n,"firstname"),lastName:sn.getText(n,"lastname"),screenName:sn.getText(n,"screenname"),gender:sn.getText(n,"gender"),homePhone:sn.getText(n,"home_phone"),mobilePhone:sn.getText(n,"mobile_phone"),communityId:sn.getText(n,"community_id"),communityUrl:sn.getText(n,"community_url")}}}(r.segment_context),o}Sn.prototype.processResponse=function(e){const t=e.ui_notification,n=sn.getText(t,"ed_source_id"),s=sn.getText(t,"ed_language_id"),i=sn.getText(t,"ed_category_ids").split(","),r=sn.getText(t,"task_id"),o=Mn.getInstance(),a=o.libraryInstance;let c="",u=0,l="",d=[];if(r){const t=o.agentSettings.accountId,r=o.applicationSettings.edSources[t],g=o.applicationSettings.edLanguages[t],p=o.applicationSettings.edCategories[t],h=sn.getEdValue(r,n),f=sn.getEdValue(g,s),S=sn.getMultiEdValues(p,i);c=h.name,u=h.color,l=f.name,d=S.names;const T=Tn(e,c,u,l,d);return sn.fireCallback(a,Ue.CHAT_PRESENTED,T),T}const g=Tn(e,c,u,l,d);return sn.fireCallback(a,Ue.CHAT_PRESENTED,g),g};const mn=function(e,t,n,s,i){this.uii=e,this.messageId=t,this.dialogId=i,this.response=n,this.responseReason=s||""};mn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_PRESENTED_RESPONSE,"@message_id":sn.getMessageId(),"@response_to":this.messageId,dialog_id:{"#text":sn.toString(this.dialogId)},uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":Mn.getInstance().agentSettings.agentId},response:{"#text":sn.toString(this.response)},response_reason:{"#text":sn.toString(this.responseReason)},operation_id:{"#text":sn.generateOpId()}}};return JSON.stringify(e)};const _n=function(e,t,n,s,i){this.uii=e,this.agentId=t,this.chatQueueId=n,this.skillId=s||"",this.maintainAgent=i||!1};_n.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_REQUEUE,"@message_id":sn.getMessageId(),"@response_to":"",operation_id:{"#text":sn.generateOpId()},uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":sn.toString(this.agentId)},chat_queue_id:{"#text":sn.toString(this.chatQueueId)},skill_id:{"#text":sn.toString(this.skillId)},maintain_agent:{"#text":sn.toString(this.maintainAgent)}}};return JSON.stringify(e)};const In=function(e,t,n,s,i){this.action=e,this.roomType=t,this.roomId=n,this.agentOne=s||"",this.agentTwo=i||""};In.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":qe.CHAT_ROOM,"@message_id":sn.getMessageId(),"@response_to":"",action:{"#text":sn.toString(this.action)}}};return"EXIT"!==this.action&&(e.ui_request["@room_type"]=this.roomType),"PRIVATE"===this.roomType&&"ENTER"===this.action?(e.ui_request.agent_one={"#text":sn.toString(this.agentOne)},e.ui_request.agent_two={"#text":sn.toString(this.agentTwo)}):e.ui_request.room_id={"#text":sn.toString(this.roomId)},JSON.stringify(e)};const Cn=function(){};Cn.prototype.processResponse=function(e){var t=e.ui_request,n={roomId:sn.getText(t,"room_id"),agentId:sn.getText(t,"agent_id"),chatAlias:sn.getText(t,"chat_alias"),state:sn.getText(t,"state")};return sn.logMessage(Ee,"Chat-Room-State update packet received for room #"+n.roomId,e),n};const vn=function(e,t){this.roomId=e,this.message=t};vn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":qe.CHAT_SEND,"@message_id":sn.getMessageId(),"@response_to":"",room_id:{"#text":sn.toString(this.roomId)},message:{"#text":sn.toString(this.message)}}};return JSON.stringify(e)},vn.prototype.processResponse=function(e){var t=e.ui_request,n={roomType:sn.getText(t,"room_type"),roomId:sn.getText(t,"room_id"),message:sn.getText(t,"message"),sender:sn.getText(t,"sender"),senderId:sn.getText(t,"sender_id"),roomName:sn.getText(t,"room_name"),dynamicCreate:"TRUE"===sn.getText(t,"dynamic_create")};return sn.logMessage(Ee,"New CHAT packet received from IntelliServices",e),n};const yn=function(){};yn.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.buildDefaultResponse(e);return n.message="Received CHAT-TYPING notification",n.status="OK",n.accountId=sn.getText(t,"account_id"),n.uii=sn.getText(t,"uii"),n.from=sn.getText(t,"from"),n.type=sn.getText(t,"type"),n.pendingMessage=sn.getText(t,"message"),n.dequeueAgentId=sn.getText(t,"dequeue_agent_id"),n};const En=function(e,t){this.uii=e,this.message=t};En.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_TYPING,"@message_id":sn.getMessageId(),"@response_to":"",uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":Mn.getInstance().agentSettings.agentId},message:{"#text":sn.toString(this.message)}}};return JSON.stringify(e)};const Rn=function(e,t,n){this.uii=e,this.agentId=t,this.sessionId=n};Rn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.LEAVE_CHAT,"@message_id":sn.getMessageId(),"@response_to":"",uii:{"#text":sn.toString(this.uii)},agent_id:{"#text":Mn.getInstance().agentSettings.agentId},session_id:{"#text":sn.toString(this.sessionId)}}};return JSON.stringify(e)};const An=function(){};An.prototype.processResponse=function(e){var t=e.ui_notification,n=sn.getText(t,"queue_dts");n=new Date(n.replace(" ","T"));var s=sn.buildDefaultResponse(e,!0);if(s.message="Received LOAD-MEDIA notification",s.status="OK",s.uii=sn.getText(t,"uii"),s.taskId=sn.getText(t,"task_id"),s.accountId=sn.getText(t,"account_id"),s.sessionId=sn.getText(t,"session_id"),s.agentId=sn.getText(t,"agent_id"),s.queueDts=n,s.queueTime=sn.getText(t,"queue_time"),s.chatQueueId=sn.getText(t,"chat_queue_id"),s.chatQueueName=sn.getText(t,"chat_queue_name"),s.chatRequeueType=sn.getText(t,"chat_requeue_type"),s.channelType=sn.getText(t,"channel_type"),s.idleTimeout=sn.getText(t,"idle_timeout"),s.enableConversationSummary=sn.getText(t,"summary"),s.requestMessageId=sn.getText(t,"requestMessageId"),s.segmentId=sn.getText(t,"segment_id"),s.requeueShortcuts=sn.processResponseCollection(e,"ui_notification","chat_requeue_shortcuts","shortcut")[0],s.chatDispositions=sn.processResponseCollection(e,"ui_notification","chat_dispositions","disposition")[0],s.chatDispositions&&s.chatDispositions.disposition?s.chatDispositions.dispositions=[s.chatDispositions]:s.chatDispositions=s.chatDispositions.dispositions,s.chatDispositions)for(var i=0;i<s.chatDispositions.length;i++){var r=s.chatDispositions[i];r.isComplete="1"===r.isComplete,r.isSuccess="1"===r.isSuccess,r.isDefault="1"===r.isDefault}return s.baggage=function(e){var t={},n=Mn.getInstance();try{t.chatQueueId=e.chatQueueId,t.chatQueueName=e.chatQueueName,t.uii=e.uii}catch(e){console.error("There was an error parsing chat tokens for basic chat info. ",e)}try{t.agentFirstName=n.agentSettings.firstName,t.agentLastName=n.agentSettings.lastName,t.agentExternalId=n.agentSettings.externalAgentId,t.agentType=n.agentSettings.agentType,t.agentEmail=n.agentSettings.email,t.agentUserName=n.agentSettings.username}catch(e){console.error("There was an error parsing chat tokens for agent info. ",e)}return t}(s),s};const bn=function(e,t,n,s,i){this.agentId=e,this.chatQueueId=t,this.ani=n,this.dnis=s,this.message=i};bn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.CHAT_MANUAL_SMS,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(this.agentId)},chat_queue_id:{"#text":sn.toString(this.chatQueueId)},ani:{"#text":sn.toString(this.ani)},dnis:{"#text":sn.toString(this.dnis)},message:{"#text":sn.toString(this.message)}}};return JSON.stringify(e)};const Nn=function(e){this.monitorAgentId=e};Nn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.MONITOR_CHAT,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":sn.toString(this.monitorAgentId)}}};return JSON.stringify(e)};const On=function(){};On.prototype.processResponse=function(e){var t=e.ui_notification,n=Mn.getInstance(),s=sn.getText(t,"queue_dts");s=new Date(s.replace(" ","T"));var i=sn.getText(t,"ed_source_id"),r=sn.getText(t,"ed_language_id"),o=sn.getText(t,"ed_category_ids").split(","),a=sn.buildDefaultResponse(e);if(a.message="Received NEW-CHAT notification",a.status="OK",a.uii=sn.getText(t,"uii"),a.accountId=sn.getText(t,"account_id"),a.sessionId=sn.getText(t,"session_id"),a.agentId=sn.getText(t,"agent_id"),a.queueDts=s,a.queueTime=sn.getText(t,"queue_time"),a.chatQueueId=sn.getText(t,"chat_queue_id"),a.chatQueueName=sn.getText(t,"chat_queue_name"),a.chatRequeueType=sn.getText(t,"chat_requeue_type"),a.appUrl=sn.getText(t,"app_url"),a.channelType=sn.getText(t,"channel_type"),a.ani=sn.getText(t,"ani"),a.dnis=sn.getText(t,"dnis"),a.surveyPopType=sn.getText(t,"survey_pop_type"),a.scriptId=sn.getText(t,"script_id"),a.scriptVersion=sn.getText(t,"script_version"),a.idleTimeout=sn.getText(t,"idle_timeout"),a.isMonitoring=sn.getText(t,"is_monitoring"),a.monitoredAgentId=sn.getText(t,"monitored_agent_id"),a.preChatData=sn.getText(t,"json_baggage"),a.taskId=sn.getText(t,"task_id"),a.chatType=sn.getText(t,"chat_type"),a.edThreadTitle=sn.getText(t,"ed_thread_title"),a.edAuthorScreenName=sn.getText(t,"ed_author_screen_name"),a.edCreatedAt=sn.getText(t,"ed_created_at"),a.edSourceName="",a.sourceColor=0,a.edLanguage="",a.edCategories=[],a.requeueShortcuts=sn.processResponseCollection(e,"ui_notification","chat_requeue_shortcuts","shortcut")[0],a.chatDispositions=sn.processResponseCollection(e,"ui_notification","chat_dispositions","disposition")[0],a.transcript=sn.processResponseCollection(e,"ui_notification","transcript","message")[0],a.baggage=sn.processResponseCollection(e,"ui_notification","json_baggage")[0],a.chatDispositions&&a.chatDispositions.disposition?a.chatDispositions.dispositions=[a.chatDispositions]:a.chatDispositions=a.chatDispositions.dispositions,a.transcript&&a.transcript.message?a.transcript=[a.transcript]:a.transcript=a.transcript.messages,a.preChatData)try{a.preChatData=JSON.parse(a.preChatData)}catch(e){sn.logMessage("error","Error parsing the pre-form chat data.",t)}if(a.chatDispositions)for(var c=0;c<a.chatDispositions.length;c++){var u=a.chatDispositions[c];u.isComplete="1"===u.isComplete,u.isSuccess="1"===u.isSuccess,u.isDefault="1"===u.isDefault}if(a.transcript)for(var l=0;l<a.transcript.length;l++){var d=a.transcript[l];d.dts&&(d.dts=new Date(d.dts.replace(" ","T")))}if(a.baggage=function(e,t){var n={},s=Mn.getInstance();if(t.preChatData)for(var i in t.preChatData)Object.prototype.hasOwnProperty.call(t.preChatData,i)&&(n[i]=t.preChatData[i]);try{n.chatQueueId=t.chatQueueId,n.chatQueueName=t.chatQueueName,n.ani=t.ani,n.dnis=t.dnis,n.uii=t.uii}catch(e){console.error("There was an error parsing chat tokens for basic chat info. ",e)}try{n.agentFirstName=s.agentSettings.firstName,n.agentLastName=s.agentSettings.lastName,n.agentExternalId=s.agentSettings.externalAgentId,n.agentType=s.agentSettings.agentType,n.agentEmail=s.agentSettings.email,n.agentUserName=s.agentSettings.username}catch(e){console.error("There was an error parsing chat tokens for agent info. ",e)}return n}(0,a),"ENGAGE_DIGITAL"===a.chatType){var g=n.agentSettings.accountId,p=n.applicationSettings.edSources[g],h=n.applicationSettings.edLanguages[g],f=n.applicationSettings.edCategories[g],S=sn.getEdValue(p,i),T=sn.getEdValue(h,r),m=sn.getMultiEdValues(f,o);a.edSourceName=S.isCached?S.name:a.edSourceName,a.sourceColor=S.isCached?S.color:a.sourceColor,a.edLanguage=T.isCached?T.name:a.edLanguage,a.edCategories=m.isCached?m.names:a.edCategories}return a};const Dn=function(e){this.monitorAgentId=e||""};Dn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IQ","@type":qe.STOP_MONITOR_CHAT,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":Mn.getInstance().agentSettings.agentId},monitor_agent_id:{"#text":sn.toString(this.monitorAgentId)}}};return JSON.stringify(e)},Dn.prototype.processResponse=function(e){var t=e.ui_notification;return{monitoredAgentId:sn.getText(t,"monitored_agent_id")}};const wn=function(){};wn.prototype.formatJSON=function(){var e={ui_request:{"@destination":"IS","@type":qe.SUPERVISOR_LIST,"@message_id":sn.getMessageId(),"@response_to":"",agent_id:{"#text":sn.toString(Mn.getInstance().agentSettings.agentId)}}};return JSON.stringify(e)},wn.prototype.processResponse=function(e){for(var t=Mn.getInstance(),n=sn.processResponseCollection(e,"ui_response","supervisor"),s=[],i=0;i<n.length;i++){var r=n[i];s.push({agentId:r.id,firstName:r.fname,lastName:r.lname,username:r.uname})}return sn.logMessage(Ee,"New supervisor list received ",s),t.supervisors=s,t.supervisors};const xn=function(){};xn.prototype.processResponse=function(e){var t=e.ui_stats.agent,n=[];Array.isArray(t)||(t=[t]);try{for(var s=0;s<t.length;s++)n.push({agentLoginType:t[s]["@alt"],agentType:t[s]["@atype"],avgTalkTime:t[s]["@avgtt"],calls:t[s]["@calls"],isDequeueAgent:t[s]["@da"],defaultRoute:t[s]["@droute"],firstName:t[s]["@f"],queueDesc:t[s]["@gdesc"],queueName:t[s]["@gname"],agentId:t[s]["@id"],lastName:t[s]["@l"],loginDuration:t[s]["@ldur"],loginType:t[s]["@ltype"],offHook:t[s]["@oh"],pendingDisp:t[s]["@pd"],pendingDispTime:t[s]["@pdt"],presented:t[s]["@pres"],rna:t[s]["@rna"],stateDuration:t[s]["@sdur"],skillProfileName:t[s]["@sp"],agentState:t[s]["@state"],totalTalkTime:t[s]["@ttt"],username:t[s]["@u"],uii:t[s]["@uii"],utilization:t[s]["@util"],callDuration:t[s]["@call_duration"],chatState:t[s]["@chat_state"],currentChatCount:t[s]["@current_chats_count"],chatsHandled:t[s]["@chats_handled"],totalChatTime:t[s]["@total_chats_time"]})}catch(e){}return Mn.getInstance().agentStats=n,n};const Un=function(){};Un.prototype.processResponse=function(e){var t=Mn.getInstance().agentDailyStats,n=e.ui_stats;return t.agentId=sn.getText(n,"agent_id"),t.totalLoginSessions=sn.getText(n,"total_login_sessions"),t.totalChatsHandled=sn.getText(n,"total_chats_handled"),t.totalCallsHandled=sn.getText(n,"total_calls_handled"),t.totalPreviewDials=sn.getText(n,"total_preview_dials"),t.totalManualDials=sn.getText(n,"total_manual_dials"),t.totalRna=sn.getText(n,"total_rna"),t.totalSuccessDispositions=sn.getText(n,"total_success_dispositions"),t.totalLoginTime=sn.getText(n,"total_login_time"),t.totalTalkTime=sn.getText(n,"total_talk_time"),t.currCallTime||(t.totalOffhookTime=sn.getText(n,"total_offhook_time"),t.currCallTime="0"),t};const qn=function(){};qn.prototype.processResponse=function(e){var t=e.ui_stats,n=sn.processResponseCollection(e,"ui_stats","totals")[0],s=[],i=null;Array.isArray(t.campaign)||(t.campaign=[t.campaign]);for(var r=0;r<t.campaign.length;r++)null!=(i=t.campaign[r])&&s.push({active:i["@a"],abandon:i["@aba"],answer:i["@an"],available:i["@av"],busy:i["@b"],complete:i["@c"],error:i["@e"],fax:i["@f"],campaignId:i["@id"],intercept:i["@int"],machine:i["@m"],noanswer:i["@na"],campaignName:i["@name"],pending:i["@p"],ready:i["@r"],staffed:i["@s"],totalConnects:i["@tc"],totalTalkTime:i["@ttt"]});var o={type:t["@type"],campaigns:s,totals:n};return Mn.getInstance().campaignStats=o,o};const kn=function(){};kn.prototype.processResponse=function(e){var t=e.ui_stats,n=sn.processResponseCollection(e,"ui_stats","totals")[0],s=sn.processResponseCollection(e,"ui_stats","chatQueue"),i={type:t["@type"],chatQueues:s,totals:n};return Mn.getInstance().chatQueueStats=i,i};const Pn=function(){};Pn.prototype.processResponse=function(e){var t=e.ui_stats,n=sn.processResponseCollection(e,"ui_stats","totals")[0],s=[],i={};Array.isArray(t.gate)||(t.gate=[t.gate]);for(var r=0;r<t.gate.length;r++)null!=(i=t.gate[r])&&s.push({abandon:i["@aba"],active:i["@active"],answer:i["@ans"],asa:i["@asa"],available:i["@avail"],avgAbandon:i["@avga"],avgQueue:i["@avgq"],avgTalk:i["@avgt"],deflected:i["@def"],queueId:i["@id"],inQueue:i["@inq"],longCall:i["@long_c"],longestInQueue:i["@longq"],queueName:i["@name"],presented:i["@pres"],routing:i["@route"],shortAbandon:i["@short_aba"],shortCall:i["@short_c"],sla:i["@sla"],slaPass:i["@sla_p"],slaFail:i["@sla_f"],staffed:i["@staff"],tAbandonTime:i["@t_aba"],tQueueTime:i["@t_q"],tSpeedOfAnswer:i["@t_soa"],utilization:i["@util"]});var o={type:t["@type"],queues:s,totals:n};return Mn.getInstance().queueStats=o,o};const Ln=function(){};Ln.prototype.processResponse=function(e){var t=e.ui_stats.agents,n=[],s=Mn.getInstance(),i=s.agentSettings.accountId,r=s.applicationSettings.edSources[i];Array.isArray(t)||(t=[t]);try{t.forEach((function(e){var t=[],s=sn.getValue(e,"@longestEngagementSourceId"),i=sn.getEdValue(r,s),o=i.isCached?i.name:"",a=i.isCached?i.color:"";try{var c=sn.getValue(e,"engagements");""!==c&&(Array.isArray(c)||(c=[c]),c.forEach((function(e){var n=sn.getValue(e,"@initialEngagementSourceId"),s=sn.getEdValue(r,n),i=s.isCached?s.name:"",o=s.isCached?s.color:"";t.push({engagementId:sn.getValue(e,"@engagementId"),isActive:"TRUE"===sn.getValue(e,"@active").toUpperCase(),isLegacyChat:"TRUE"===sn.getValue(e,"@isLegacyChat").toUpperCase(),contactIdentity:sn.getValue(e,"@contactIdentity"),contactIdentityE164:sn.getValue(e,"@contactIdentityE164"),threadTitle:sn.getValue(e,"@threadTitle"),focusedConnectionId:sn.getValue(e,"@focusedConnectionId"),productId:sn.getValue(e,"@productId"),productName:sn.getValue(e,"@productName"),agentDurationMs:sn.getValue(e,"@agentDurationMs"),pendingDispositionMs:sn.getValue(e,"@pendingDispositionMs"),engagementSource:{initialEngagementSourceId:n,initialEngagementSourceType:sn.getValue(e,"@initialEngagementSourceType"),initialEngagementSourceName:i,initialEngagementSourceColor:o,connections:sn.getValue(e,"connections")}})})))}catch(e){console.error(e)}try{var u=sn.getValue(e,"connections24hRollup"),l=0,d="",g="";""!==u&&(Array.isArray(u)||(u=[u]),u=u.map((function(e){var t=sn.getValue(e,"@connectionSourceId");if(t)var n=(g=sn.getEdValue(r,t)).isCached?g.name:"",s=g.isCached?g.color:"";var i=sn.getValue(e,"@connectionSourceType"),o=sn.getValue(e,"@count");l+=Number(o);const a={count:o,sourceType:i};return t&&(a.sourceId=t),s&&(a.sourceColor=s),n&&(a.sourceName=n),a})),d=l.toString())}catch(e){console.error(e)}n.push({activeEngagementsCount:sn.getValue(e,"@activeEngagementsCount"),agentLoginType:sn.getValue(e,"@agentLoginType"),agentType:sn.getValue(e,"@agentType"),agentUtilization:sn.getValue(e,"@agentUtilization"),currentAgentStateDurationMs:sn.getValue(e,"@currentAgentStateDurationMs"),currentAgentStateLabel:sn.getValue(e,"@currentAgentStateLabel"),currentAgentBaseState:sn.getValue(e,"@currentAgentBaseState"),defaultRoute:sn.getValue(e,"@defaultRoute"),isDequeueAgent:"TRUE"===sn.getValue(e,"@isDequeueAgent").toUpperCase(),isOffHook:"TRUE"===sn.getValue(e,"@isOffHook").toUpperCase(),firstName:sn.getValue(e,"@firstName"),evAgentId:sn.getValue(e,"@evAgentId"),rcUserId:sn.getValue(e,"@rcUserId"),lastName:sn.getValue(e,"@lastName"),loginDurationMs:sn.getValue(e,"@loginDurationMs"),skillProfileName:sn.getValue(e,"@skillProfileName"),username:sn.getValue(e,"@username"),voicePendingDispositionMs:sn.getValue(e,"@engagementVoicePendingDispositionMs"),engagement24hRollupCount:sn.getValue(e,"@engagement24hRollupCount"),engagements24hRollup:u,engagements24hRollupTotalCount:d,avgTimePerEngagement24hRollupMs:sn.getValue(e,"@avgEngagementFocusTime24hRollupMs"),engagementVoice24hRollupCount:sn.getValue(e,"@engagementVoice24hRollupCount"),timePerVoiceEngagement24hRollupMs:sn.getValue(e,"@engagementVoiceFocusTime24hRollupMs"),avgTimePerVoiceEngagement24hRollupMs:sn.getValue(e,"@avgEngagementVoiceFocusTime24hRollupMs"),longestEngagement:{engagementId:sn.getValue(e,"@longestEngagementId"),sourceId:s,sourceType:sn.getValue(e,"@longestEngagementSourceType"),sourceName:o,sourceColor:a,agentDurationMs:sn.getValue(e,"@longestEngagementDurationMs")},engagements:t})}))}catch(e){console.log("Error processing SUPERVISOR stat message")}return Mn.getInstance().supervisorStats=n,n};const Mn=function(){let e;return{getInstance:function(){return e||(e=function(){const e="/api/v1/";return{currentCall:{},pendingNewCallSessions:{},callTokens:{},callbacks:[],libraryInstance:null,pingIntervalId:null,statsIntervalId:null,pingStatIntervalId:null,agentDailyIntervalId:null,reconnectIntervalId:null,waitingForAddSession:null,authHost:window.location.origin,socketProtocol:"wss://",baseAuthUri:"/api/auth/",baseApiUri:e,baseEtrUri:"/platform/api/ed-task-routing/v1/",baseVoiceUri:"/voice"+e,chatAliasRequest:null,chatRoomRequest:null,chatSendRequest:null,supervisorListRequest:null,chatRoomStateRequest:new Cn,multiSocketRequest:new Lt,dataStore:new He("agentSDK"),chatCancelledNotification:new ln,chatActiveNotification:new on,chatInactiveNotification:new pn,chatDispositionRequest:null,chatMessageRequest:new fn,chatPresentedNotification:new Sn,chatPresentedRequest:null,chatRequeueRequest:null,chatTypingNotification:new yn,chatTypingRequest:null,newChatNotification:new On,loadMediaNotification:new An,chatAgentAssignFailureNotification:new an,chatClientReconnectNotification:new dn,chatSummaryRequest:null,agentStateRequest:null,chatStateRequest:null,ackRequest:new it,bargeInRequest:null,callNotesRequest:null,callbacksPendingRequest:null,campaignDispositionsRequest:null,loginRequest:null,coldXferRequest:null,dispositionRequest:null,dispositionManualPassRequest:null,hangupRequest:null,holdRequest:null,leadHistoryRequest:null,leadInsertRequest:null,leadUpdateRequest:null,logoutRequest:null,authenticateRequest:null,loginPhase1Request:null,offhookInitRequest:null,offhookTermRequest:null,oneToOneOutdialRequest:null,oneToOneOutdialCancelRequest:null,pauseRecordRequest:null,pingCallRequest:null,previewDialRequest:null,reconnectRequest:null,recordRequest:null,requeueRequest:null,statsRequest:new Xt,tcpaSafeRequest:null,warmXferRequest:null,warmXferCancelRequest:null,chatListRequest:null,directAgentTransferListRequest:null,directAgentTransferRequest:null,webRTCRequest:null,searchDirectoryRequest:null,extensionPresenceRequest:null,etrRequest:new It,callSummaryRequest:null,agentStatePacket:null,chatStatePacket:null,loginPacket:null,currentCallPacket:null,authenticatePacket:null,loginPhase1Packet:null,offhookInitPacket:null,offhookTermPacket:null,transferSessions:{},chatListResponse:null,addSessionNotification:new Fe,dialGroupChangeNotification:new je,dialGroupChangePendingNotification:new Be,dropSessionNotification:new Je,earlyUiiNotification:new We,endCallNotification:new Ve,gatesChangeNotification:new Ye,genericNotification:new Qe,newCallNotification:new Xe,summaryNotification:new tt,summaryErrorNotification:new nt,agentStatsPacket:new xn,agentDailyStatsPacket:new Un,queueStatsPacket:new Pn,campaignStatsPacket:new qn,chatQueueStatsPacket:new kn,supervisorStatsPacket:new Ln,applicationSettings:{allowMultiSocket:!1,availableCountries:[],dialDestType:"",edSources:{},edLanguages:{},edCategories:{},enableCallContactHistory:!1,isEmbeddedLogin:!1,isFlr:!1,isLoggedInIS:!1,isSso:!1,isTcpaSafeMode:!1,statsRoundtripDurationMs:0,statsMsgRequestedTime:0,socketConnected:!1,socketDest:""},agentStats:[],agentDailyStats:{},campaignStats:{},queueStats:{},chatQueueStats:{},supervisorStats:[],agentSettings:{accountId:null,agentId:0,agentPassword:"",agentType:"AGENT",altDefaultLoginDest:"",availableAgentStates:[],allAgentStates:[],callerIds:[],callState:null,corporateDirectory:!1,consultCall:!1,currentState:"OFFLINE",currentStateLabel:"",defaultLoginDest:"",dialDest:"",email:"",externalAgentId:"",firstName:"",guid:"",isLoggedIn:!1,isOffhook:!1,isMonitoring:!1,includeSupervisorStats:!1,initLoginState:"AVAILABLE",initLoginStateLabel:"Available",lastName:"",loginDTS:null,loginType:"NO-SELECTION",maxBreakTime:-1,maxLunchTime:-1,onCall:!1,onManualOutdial:!1,outboundManualDefaultRingtime:"30",pendingCallbacks:[],pendingDialGroupChange:0,phoneLoginPin:"",realAgentType:"AGENT",supervisors:[],totalCalls:0,transferNumber:"",updateDGFromAdminUI:!1,updateLoginMode:!1,username:"",wasMonitoring:!1,enableCallQuality:!1,reportCallQualityIssueTypes:[]},agentPermissions:{allowBlended:!0,allowCallControl:!0,allowChat:!1,enableChat:!1,allowCrossQueueRequeue:!1,allowInbound:!0,allowLeadInserts:!1,allowLeadSearch:!1,allowLoginControl:!0,allowLoginUpdates:!0,allowManualCalls:!0,allowManualPass:!0,allowManualIntlCalls:!1,allowManualOutboundGates:!1,allowOffHook:!0,allowOutbound:!0,allowPreviewLeadFilters:!1,allowLeadUpdatesByCampaign:{},disableSupervisorMonitoring:!0,progressiveEnabled:!1,requireFetchedLeadsCalled:!1,showLeadHistory:!0,enableTaskMode:!1,enableFolderMode:!1},chatSettings:{availableChatQueues:[],availableChatRooms:[],chatQueues:[],alias:""},connectionSettings:{hashCode:"",reconnect:!1,isMultiSocket:!1},inboundSettings:{availableQueues:[],availableSkillProfiles:[],queues:[],skillProfile:{}},outboundSettings:{availableCampaigns:[],availableOutdialGroups:[],insertCampaigns:[],defaultDialGroup:0,outdialGroup:{},previewDialLeads:[],tcpaSafeLeads:[],campaignDispositions:[]},scriptSettings:{availableScripts:[],loadedScripts:{}},softphoneSettings:{isRegistered:!1,maintainOH:!1,autoStartOH:!1,wsServers:[],sipInfo:[],uri:"",displayName:"",authorizationUser:"",sipPassword:"",sipDialDest:"",attemptingSoftphoneReconnect:!1,lastSipFetchTime:0},filteredDirectory:{rcAccountId:"",records:[]},extensionPresenceResponse:[],callHistory:{},clientAppType:"",clientSDKVersion:"",clientAppVersion:"",incrementTotalCalls:function(){this.agentSettings.totalCalls=this.agentSettings.totalCalls+1}}}()),e},resetInstance:function(){e=null}}}();const Hn=function(){const e=new Set(Object.values(xe));return function(t){return e.has(t)}}(),Fn=function(){const e=new Set(Object.values(we));return function(t){return e.has(t)}}();var Gn=function(e={}){return function(e){const t=e.AgentLibrary=function(e){if(e=e||{},this.callbacks={},this.softphoneCallbacks={},this.componentName="SDK",this._requests=[],this._queuedMsgs=[],this._isReconnect=!1,Mn.resetInstance(),Mn.getInstance().libraryInstance=this,this.openLogger(),this.openConsoleLogger(),void 0!==e.callbacks&&(this.callbacks=e.callbacks),void 0!==e.authHost&&(Mn.getInstance().authHost=e.authHost),"undefined"!==e.isSecureSocket&&("string"==typeof e.isSecureSocket&&(e.isSecureSocket="true"===e.isSecureSocket.toLowerCase()),e.isSecureSocket?Mn.getInstance().socketProtocol="wss://":Mn.getInstance().socketProtocol="ws://"),"string"==typeof e.componentName&&(this.componentName=e.componentName,Le.setComponentName(this.componentName)),Mn.getInstance().applicationSettings.allowMultiSocket=!0===e.allowMultiSocket,Mn.getInstance().applicationSettings.isI18nEnabled=!!e.isI18nEnabled,!e.clientAppType)throw new Error("Registration error: `clientAppType` missing from the configuration");return Mn.getInstance().clientAppType=e.clientAppType,Mn.getInstance().clientSDKVersion="1.5.17",Mn.getInstance().clientAppVersion=e.clientAppVersion,this};t.prototype.setCallbacks=function(e){for(var t in e)this.setCallback(t,e[t])},t.prototype.setCallback=function(e,t){if("string"==typeof e)if("function"==typeof t)switch(!0){case function(e){return Hn(e)&&Fn(e)}(e):this.callbacks[e]=t,this.softphoneCallbacks[e]=t,this._SoftphoneService.setCallback(e,t);break;case Fn(e):this.callbacks[e]=t;break;case Hn(e):this.softphoneCallbacks[e]=t,this._SoftphoneService.setCallback(e,t);break;default:window.console.warn("Try to set Unsupported callback type:",e)}else window.console.warn("callback is not defined or has invalid type",t);else window.console.warn("type is not defined or has invalid type",e)},t.prototype.getCallbacks=function(){return Object.assign({},this.callbacks,this.softphoneCallbacks)},t.prototype.getCallback=function(e){return this.callbacks[e]||this.softphoneCallbacks[e]},t.prototype.getSocket=function(){return this.socket},t.prototype.getAuthenticateRequest=function(){return Mn.getInstance().authenticateRequest},t.prototype.getLoginRequest=function(){return Mn.getInstance().loginRequest},t.prototype.getMultiSocketRequest=function(){return Mn.getInstance().multiSocketRequest},t.prototype.getAgentConfigRequest=function(){return Mn.getInstance().loginPhase1Request},t.prototype.getLogoutRequest=function(){return Mn.getInstance().logoutRequest},t.prototype.getCallTokens=function(){return Mn.getInstance().callTokens},t.prototype.getAgentStateRequest=function(){return Mn.getInstance().agentStateRequest},t.prototype.getOffhookInitRequest=function(){return Mn.getInstance().offhookInitRequest},t.prototype.getOffhookTermRequest=function(){return Mn.getInstance().offhookTermRequest},t.prototype.getHangupRequest=function(){return Mn.getInstance().hangupRequest},t.prototype.getPreviewDialRequest=function(){return Mn.getInstance().previewDialRequest},t.prototype.getTcpaSafeRequest=function(){return Mn.getInstance().tcpaSafeRequest},t.prototype.getManualOutdialRequest=function(){return Mn.getInstance().oneToOneOutdialRequest},t.prototype.getManualOutdialCancelRequest=function(){return Mn.getInstance().oneToOneOutdialCancelRequest},t.prototype.getCallNotesRequest=function(){return Mn.getInstance().callNotesRequest},t.prototype.getCampaignDispositionsRequest=function(){return Mn.getInstance().campaignDispositionsRequest},t.prototype.getDispositionRequest=function(){return Mn.getInstance().dispositionRequest},t.prototype.getDispositionManualPassRequest=function(){return Mn.getInstance().dispositionManualPassRequest},t.prototype.getWarmTransferRequest=function(){return Mn.getInstance().warmXferRequest},t.prototype.getColdTransferRequest=function(){return Mn.getInstance().coldXferRequest},t.prototype.getWarmTransferCancelRequest=function(){return Mn.getInstance().warmXferCancelRequest},t.prototype.getRequeueRequest=function(){return Mn.getInstance().requeueRequest},t.prototype.getCallSummaryRequest=function(){return Mn.getInstance().callSummaryRequest},t.prototype.getBargeInRequest=function(){return Mn.getInstance().bargeInRequest},t.prototype.getHoldRequest=function(){return Mn.getInstance().holdRequest},t.prototype.getPauseRecordRequest=function(){return Mn.getInstance().pauseRecordRequest},t.prototype.getRecordRequest=function(){return Mn.getInstance().recordRequest},t.prototype.getChatPresentedRequest=function(){return Mn.getInstance().chatPresentedRequest},t.prototype.getChatDispositionRequest=function(){return Mn.getInstance().chatDispositionRequest},t.prototype.getChatMessageRequest=function(){return Mn.getInstance().chatMessageRequest},t.prototype.getChatRequeueRequest=function(){return Mn.getInstance().chatRequeueRequest},t.prototype.getChatSummaryRequest=function(){return Mn.getInstance().chatSummaryRequest},t.prototype.getChatTypingRequest=function(){return Mn.getInstance().chatTypingRequest},t.prototype.getAgentStatsPacket=function(){return Mn.getInstance().agentStatsPacket},t.prototype.getAgentDailyStatsPacket=function(){return Mn.getInstance().agentDailyStatsPacket},t.prototype.getQueueStatsPacket=function(){return Mn.getInstance().queueStatsPacket},t.prototype.getChatQueueStatsPacket=function(){return Mn.getInstance().chatQueueStatsPacket},t.prototype.getCampaignStatsPacket=function(){return Mn.getInstance().campaignStatsPacket},t.prototype.getSupervisorStatsPacket=function(){return Mn.getInstance().supervisorStatsPacket},t.prototype.getAgentConfigPacket=function(){return Mn.getInstance().loginPhase1Packet},t.prototype.getLoginPacket=function(){return Mn.getInstance().loginPacket},t.prototype.getAgentStatePacket=function(){return Mn.getInstance().agentStatePacket},t.prototype.getCurrentCallPacket=function(){return Mn.getInstance().currentCallPacket},t.prototype.getOffhookInitPacket=function(){return Mn.getInstance().offhookInitPacket},t.prototype.getOffhookTermPacket=function(){return Mn.getInstance().offhookTermPacket},t.prototype.getChatAgentEnd=function(){return Mn.getInstance().chatAgentEnd},t.prototype.getWebRTCRequest=function(){return Mn.getInstance().webRTCRequest},t.prototype.getChatListRequest=function(){return Mn.getInstance().chatListRequest},t.prototype.getSearchDirectoryRequest=function(){return Mn.getInstance().searchDirectoryRequest},t.prototype.getDialGroupChangeNotification=function(){return Mn.getInstance().dialGroupChangeNotification},t.prototype.getDialGroupChangePendingNotification=function(){return Mn.getInstance().dialGroupChangePendingNotification},t.prototype.getEndCallNotification=function(){return Mn.getInstance().endCallNotification},t.prototype.getGatesChangeNotification=function(){return Mn.getInstance().gatesChangeNotification},t.prototype.getGenericNotification=function(){return Mn.getInstance().genericNotification},t.prototype.getNewCallNotification=function(){return Mn.getInstance().newCallNotification},t.prototype.getCurrentCall=function(){return Mn.getInstance().currentCall},t.prototype.getAddSessionNotification=function(){return Mn.getInstance().addSessionNotification},t.prototype.getDropSessionNotification=function(){return Mn.getInstance().dropSessionNotification},t.prototype.getEarlyUiiNotification=function(){return Mn.getInstance().earlyUiiNotification},t.prototype.getChatActiveNotification=function(){return Mn.getInstance().chatActiveNotification},t.prototype.getChatInactiveNotification=function(){return Mn.getInstance().chatInactiveNotification},t.prototype.getChatClientReconnectNotification=function(){return Mn.getInstance().chatClientReconnectNotification},t.prototype.getChatPresentedNotification=function(){return Mn.getInstance().chatPresentedNotification},t.prototype.getChatTypingNotification=function(){return Mn.getInstance().chatTypingNotification},t.prototype.getNewChatNotification=function(){return Mn.getInstance().newChatNotification},t.prototype.getLoadMediaNotification=function(){return Mn.getInstance().loadMediaNotification},t.prototype.getChatAgentAssignFailureNotification=function(){return Mn.getInstance().chatAgentAssignFailureNotification},t.prototype.getChatCancelledNotification=function(){return Mn.getInstance().chatCancelledNotification},t.prototype.getApplicationSettings=function(){return Mn.getInstance().applicationSettings},t.prototype.getSoftphoneSettings=function(){return Mn.getInstance().softphoneSettings},t.prototype.getChatSettings=function(){return Mn.getInstance().chatSettings},t.prototype.getConnectionSettings=function(){return Mn.getInstance().connectionSettings},t.prototype.getInboundSettings=function(){return Mn.getInstance().inboundSettings},t.prototype.getOutboundSettings=function(){return Mn.getInstance().outboundSettings},t.prototype.getAgentSettings=function(){return Mn.getInstance().agentSettings},t.prototype.getTransferSessions=function(){return Mn.getInstance().transferSessions},t.prototype.getPendingSessions=function(){return Mn.getInstance().pendingNewCallSessions},t.prototype.getAgentPermissions=function(){return Mn.getInstance().agentPermissions},t.prototype.getSupervisorStats=function(){return Mn.getInstance().supervisorStats},t.prototype.getAgentStats=function(){return Mn.getInstance().agentStats},t.prototype.getAgentDailyStats=function(){return Mn.getInstance().agentDailyStats},t.prototype.getQueueStats=function(){return Mn.getInstance().queueStats},t.prototype.getChatQueueStats=function(){return Mn.getInstance().chatQueueStats},t.prototype.getCampaignStats=function(){return Mn.getInstance().campaignStats},t.prototype.getFilteredDirectory=function(){return Mn.getInstance().filteredDirectory},t.prototype.getExtensionPresenceResponse=function(){return Mn.getInstance().extensionPresenceResponse},t.prototype.getExtensionPresenceRequest=function(){return Mn.getInstance().extensionPresenceRequest},t.prototype.getETRRequest=function(){return Mn.getInstance().etrRequest},t.prototype.getIsOmni=function(){return Mn.getInstance().isOmni},t.prototype._utils=sn,t.prototype._NewCallUtils=rn,t.prototype._HttpService=Me,t.prototype._getUIModel=function(){return Mn}}(e),function(e){const t=e.AgentLibrary;function n(){var e=Mn.getInstance(),t=e.applicationSettings.socketDest;return t=e.socketProtocol+e.authenticateRequest.socketUrl,t+=":"+e.authenticateRequest.socketPort,t+="?access_token="+e.authenticateRequest.accessToken,t+="&agent_id="+e.agentSettings.agentId,t+=Le.getLoggingQueryParameters(),e.applicationSettings.socketDest=t,t}function s(e){var t=Mn.getInstance().applicationSettings.socketDest;sn.logMessage(Ee,"Attempting to open socket connection to "+t,""),e.socket=new WebSocket(t),e.socket.onopen=function(){clearTimeout(Mn.getInstance().reconnectIntervalId),Mn.getInstance().reconnectIntervalId=null,Mn.getInstance().reconnectAttemptsCounter=0,Mn.getInstance().applicationSettings.socketConnected=!0,sn.fireCallback(e,Ue.OPEN_SOCKET,{reconnect:e._isReconnect}),e.socketOpened()},e.socket.onerror=function(t){const n=e._isReconnect&&!r();sn.fireCallback(e,Ue.OPEN_SOCKET,{error:t,reconnect:n})},e.socket.onmessage=function(t){if("BOP"!==t.data){var n=JSON.parse(t.data);n.ui_response?sn.processResponse(e,n):n.ui_notification?sn.processNotification(e,n):n.dialer_request?sn.processDialerResponse(e,n):n.ui_stats?sn.processStats(e,n):n.ui_request&&sn.processRequest(e,n)}},e.socket.onclose=function(){Mn.getInstance().applicationSettings.socketConnected=!1,e.socket=null,i(e)}}function i(e){sn.fireCallback(e,Ue.CLOSE_SOCKET,""),clearInterval(Mn.getInstance().agentDailyIntervalId),Mn.getInstance().agentDailyIntervalId=null,clearInterval(Mn.getInstance().statsIntervalId),Mn.getInstance().statsIntervalId=null,clearInterval(Mn.getInstance().pingStatIntervalId),Mn.getInstance().pingStatIntervalId=null,Mn.getInstance().agentSettings.isLoggedIn&&(e._isReconnect=!0,console.warn("AgentLibrary: WebSocket is not connected, attempting to reconnect."),r()||(Mn.getInstance().reconnectAttemptsCounter++,Mn.getInstance().reconnectIntervalId=setTimeout((function(){e.openSocket(Mn.getInstance().agentSettings.agentId)}),5e3)))}function r(){return Mn.getInstance().reconnectAttemptsCounter>72}t.prototype.openSocket=function(t,r){var o=this;sn.setCallback(o,Ue.OPEN_SOCKET,r),"WebSocket"in e?o.socket||(Mn.getInstance().agentSettings.agentId=t,sn.isAccessTokenExpired()?function(e){var t=Mn.getInstance(),r=t.authHost+t.baseAuthUri,o={queryParams:{loginHashcode:t.connectionSettings.hashCode,agentId:t.agentSettings.agentId,platformId:t.authenticateRequest.platformId,isSso:t.applicationSettings.isSso}};new Me(r).httpPost("login/agent/hashcode",o).then((function(t){t=JSON.parse(t.response),Mn.getInstance().authenticateRequest.accessToken=t.accessToken,n(),s(e)})).catch((t=>{sn.logMessage(Ae,"Error in opening WebSocket on retrieving access token",t),e._isReconnect&&i(e)}))}(o):(n(),s(o))):(console.error("WebSocket NOT supported by your Browser"),sn.logMessage(Ae,"WebSocket NOT supported by your Browser",""))},t.prototype.closeSocket=function(){this.socket.close()},t.prototype.socketOpened=function(){var e=this,t=new Date;Mn.getInstance().loginPhase1Request=new qt;var n=Mn.getInstance().loginPhase1Request.formatJSON();if(sn.sendMessage(this,n),e._isReconnect){e._isReconnect=!1;var s=JSON.parse(Mn.getInstance().loginRequest.formatJSON()),i=Mn.getInstance().connectionSettings.hashCode;s.ui_request.hash_code={"#text":i},s.ui_request.update_login={"#text":"FALSE"},s.ui_request.reconnect={"#text":"TRUE"},e._queuedMsgs.unshift({dts:new Date,msg:JSON.stringify(s)})}!function(e,t){e._queuedMsgs.forEach((function(n){t.getTime()-n.dts.getTime()<18e4?(sn.logMessage(Ee,"Sending queued message to IntelliSocket.",n.msg),sn.sendMessage(e,n.msg)):sn.logMessage(Ee,"Queued message expired, discarding.",n.msg)}))}(e,t),e._queuedMsgs=[]}}(e),function(e){var t=e.AgentLibrary;function n(e,t,n){Mn.getInstance().loginRequest=new Ot(e.dialDest,e.queueIds,e.chatIds,e.skillProfileId,e.dialGroupId,e.updateFromAdminUI,e.isForce);var s=Mn.getInstance().loginRequest.formatJSON();sn.setCallback(n,Ue.LOGIN,t),sn.sendMessage(n,s)}t.prototype.authenticateAgentWithUsernamePassword=function(e,t,n,s){Mn.getInstance().authenticateRequest=new ot({username:e,password:t,platformId:n,authType:be}),Mn.getInstance().authenticateRequest.sendHttpRequest(),sn.setCallback(this,Ue.AUTHENTICATE,s)},t.prototype.authenticateAgentWithRcAccessToken=function(e,t,n){Mn.getInstance().authenticateRequest=new ot({rcAccessToken:e,tokenType:t,authType:Ne}),Mn.getInstance().authenticateRequest.sendHttpRequest(),sn.setCallback(this,Ue.AUTHENTICATE,n)},t.prototype.authenticateAgentWithEngageAccessToken=function(e,t){Mn.getInstance().authenticateRequest=new ot({engageAccessToken:e,authType:Oe}),Mn.getInstance().authenticateRequest.sendHttpRequest(),sn.setCallback(this,Ue.AUTHENTICATE,t)},t.prototype.getAgentConfig=function(e){Mn.getInstance().loginPhase1Request=new qt;var t=Mn.getInstance().loginPhase1Request.formatJSON();sn.setCallback(this,Ue.LOGIN_PHASE_1,e),sn.sendMessage(this,t)},t.prototype.getWebRtcInfo=function(e){var t=Mn.getInstance();t.webRTCRequest=new nn,t.webRTCRequest.getSipRegistrationInfo(),sn.setCallback(this,Ue.WEBRTC_INFO,e)},t.prototype.loginAgent=function(e,t,s,i,r,o,a,c){var u=Mn.getInstance(),l={dialDest:e,queueIds:t,chatIds:s,skillProfileId:i,dialGroupId:r,updateFromAdminUI:o,isForce:a},d=this;"integrated"===l.dialDest?(u.applicationSettings.isFlr||!u.applicationSettings.isSso?u.applicationSettings.dialDestType="LEGACY_SOFTPHONE":u.applicationSettings.dialDestType="RC_SOFTPHONE",0===u.softphoneSettings.sipInfo.length?u.libraryInstance.getWebRtcInfo((function(){l.dialDest=sn.getDialDestination(),n(l,c,d)})):(l.dialDest=sn.getDialDestination(),n(l,c,d))):("RC_PHONE"===l.dialDest&&(u.applicationSettings.dialDestType="RC_PHONE"),n(l,c,d))},t.prototype.multiLoginRequest=function(e){var t=Mn.getInstance();t.multiSocketRequest=new Lt;var n=t.multiSocketRequest.formatJSON();t.dataStore.get("agent_id")&&t.dataStore.get("hash_code")?(sn.setCallback(this,Ue.LOGIN_MULTISOCKET,e),sn.sendMessage(this,n)):this.getAgentConfig(e)},t.prototype.logoutAgent=function(e,t){var n=Mn.getInstance();if(n.agentSettings.isLoggedIn){n.agentSettings.isLoggedIn=!1,n.logoutRequest=new Pt(e);var s=n.logoutRequest.formatJSON();sn.setCallback(this,Ue.LOGOUT,t),sn.sendMessage(this,s)}},t.prototype.requestLogoutAgent=function(e,t,n){if("SUPERVISOR"===Mn.getInstance().agentSettings.agentType){Mn.getInstance().logoutRequest=new Pt(e,t),sn.setCallback(this,Ue.LOGOUT,n);var s=Mn.getInstance().logoutRequest.formatJSON();sn.sendMessage(this,s)}},t.prototype.setAgentState=function(e,t,n){Mn.getInstance().agentStateRequest=new rt(e,t);var s=Mn.getInstance().agentStateRequest.formatJSON();sn.setCallback(this,Ue.AGENT_STATE,n),sn.sendMessage(this,s)},t.prototype.offhookInit=function(e){Mn.getInstance().offhookInitRequest=new Mt;var t=Mn.getInstance().offhookInitRequest.formatJSON();sn.setCallback(this,Ue.OFFHOOK_INIT,e),sn.sendMessage(this,t)},t.prototype.offhookTerm=function(e){Mn.getInstance().offhookTermRequest=new Ht;var t=Mn.getInstance().offhookTermRequest.formatJSON();sn.setCallback(this,Ue.OFFHOOK_TERM,e),sn.sendMessage(this,t)},t.prototype.getPendingCallbacks=function(e,t){Mn.getInstance().callbacksPendingRequest=new lt(e);var n=Mn.getInstance().callbacksPendingRequest.formatJSON();sn.setCallback(this,Ue.CALLBACK_PENDING,t),sn.sendMessage(this,n)},t.prototype.cancelCallback=function(e,t,n){Mn.getInstance().callbackCancelRequest=new ut(e,t);var s=Mn.getInstance().callbackCancelRequest.formatJSON();sn.setCallback(this,Ue.CALLBACK_CANCEL,n),sn.sendMessage(this,s)},t.prototype.requestStats=function(){null===Mn.getInstance().statsIntervalId&&(Mn.getInstance().statsIntervalId=setInterval(sn.sendStatsRequestMessage,5e3),clearInterval(Mn.getInstance().pingStatIntervalId),Mn.getInstance().pingStatIntervalId=null)},t.prototype.terminateStats=function(){clearInterval(Mn.getInstance().statsIntervalId),Mn.getInstance().statsIntervalId=null,null===Mn.getInstance().pingStatIntervalId&&(Mn.getInstance().pingStatIntervalId=setInterval(sn.sendPingRequestMessage,2e4))},t.prototype.setIncludeSupervisorStatsFlag=function(e){Mn.getInstance().agentSettings.includeSupervisorStats=e},t.prototype.updateDialDestination=function(e,t){Mn.getInstance().updateDialDestinationRequest=new Zt(e,t);var n=Mn.getInstance().updateDialDestinationRequest.formatJSON();sn.sendMessage(this,n)},t.prototype.searchDirectory=function(e,t){var n=Mn.getInstance();n.searchDirectoryRequest=new Qt,n.searchDirectoryRequest.searchDirectory(e),sn.setCallback(this,Ue.SEARCH_DIR,t)},t.prototype.getRefreshedToken=function(){sn.refreshAccessToken()},t.prototype.getExtensionPresenceInfo=function(e,t){var n=Mn.getInstance();n.extensionPresenceRequest=new yt,n.extensionPresenceRequest.getExtensionPresenceInfo(e),sn.setCallback(this,Ue.EXTENSION_PRESENCE,t)}}(e),function(e){var t=e.AgentLibrary;t.prototype.bargeIn=function(e,t,n,s){Mn.getInstance().bargeInRequest=new ct("FULL",e,t,n);var i=Mn.getInstance().bargeInRequest.formatJSON();sn.setCallback(this,Ue.BARGE_IN,s),sn.sendMessage(this,i)},t.prototype.coach=function(e,t,n,s){Mn.getInstance().bargeInRequest=new ct("COACHING",e,t,n);var i=Mn.getInstance().bargeInRequest.formatJSON();sn.setCallback(this,Ue.COACH_CALL,s),sn.sendMessage(this,i)},t.prototype.coldXfer=function(e,t,n,s){Mn.getInstance().coldXferRequest=new ft(e,t,n);var i=Mn.getInstance().coldXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_COLD,s),sn.sendMessage(this,i)},t.prototype.internationalColdXfer=function(e,t,n,s,i){Mn.getInstance().coldXferRequest=new ft(e,t,n,s);var r=Mn.getInstance().coldXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_COLD,i),sn.sendMessage(this,r)},t.prototype.reportCall=function(e,t,n,s,i){var r,o,a,c=Mn.getInstance(),u=c.callHistory[e],l=c.authHost+c.baseVoiceUri,d="Bearer "+sn.toString(c.authenticateRequest.engageAccessToken),g="",p="";return u||(u={baggage:{agentFirstName:"",agentLastName:"",sourceType:""},dialDest:"",sessionId:"",ani:"",dnis:"",queue:{number:"",name:""}},console.warn("No call object found, make sure to call setCallHistory before reporting this call")),Promise.allSettled([sn.getDebugLogData(),sn.getConsoleLogData()]).then((function(h){g=h[0].value,p=h[1].value,r="INBOUND"!==u.baggage.sourceType?u.dnis:"",o=u.queue&&u.queue.number?u.queue.number:"",a=u.queue&&u.queue.name?u.queue.name:"";var f={body:{platformId:sn.parseJwt(c.authenticateRequest.engageAccessToken).plat,accountId:c.agentSettings.accountId,agentId:c.agentSettings.agentId,time:(new Date).getTime().toString(),name:u.baggage.agentFirstName+" "+u.baggage.agentLastName,dialDestination:u.dialDest,callUII:e,sessionId:u.sessionId,ani:u.ani,aniE164:u.aniE164,dnis:u.dnis,dnisE164:u.dnisE164,callType:u.baggage.sourceType,outboundCallerId:r,productId:o,productName:a,issueType:t,agentNote:n,agentConsole:p||"",debugLogs:g||""},headers:{"Content-Type":"application/json",Authorization:d}};return new Me(l).httpPost("agent/callQualityReport?origin="+s,f).then((function(e){var t=JSON.parse(e.response);return new Promise((function(e){e(t)}))})).catch((function(r){r.status&&r.status>400&&r.status<404&&(i||(i=!0,sn.refreshAccessToken().then((function(){c.libraryInstance.reportCall(e,t,n,s,i)}))))}))}))},t.prototype.dispositionCall=function(e,t,n,s,i,r,o,a,c,u){var l=Mn.getInstance();l.dispositionRequest=new mt(e,t,n,s,i,r,o,a,c,u);var d=l.dispositionRequest.formatJSON();sn.sendMessage(this,d),l.pingIntervalId&&(clearInterval(l.pingIntervalId),l.pingIntervalId=null)},t.prototype.dispositionManualPass=function(e,t,n,s,i,r,o){Mn.getInstance().dispositionManualPassRequest=new _t(e,t,n,s,i,r,o);var a=Mn.getInstance().dispositionManualPassRequest.formatJSON();sn.sendMessage(this,a)},t.prototype.getCampaignDispositions=function(e,t){Mn.getInstance().campaignDispositionsRequest=new pt(e);var n=Mn.getInstance().campaignDispositionsRequest.formatJSON();sn.setCallback(this,Ue.CAMPAIGN_DISPOSITIONS,t),sn.sendMessage(this,n)},t.prototype.hangup=function(e,t){Mn.getInstance().hangupRequest=new Et(e,t);var n=Mn.getInstance().hangupRequest.formatJSON();sn.sendMessage(this,n)},t.prototype.hold=function(e,t){Mn.getInstance().holdRequest=new Rt(e);var n=Mn.getInstance().holdRequest.formatJSON();sn.setCallback(this,Ue.HOLD,t),sn.sendMessage(this,n)},t.prototype.holdSession=function(e,t,n){Mn.getInstance().holdRequest=new Rt(e,t);var s=Mn.getInstance().holdRequest.formatJSON();sn.setCallback(this,Ue.HOLD,n),sn.sendMessage(this,s)},t.prototype.manualOutdial=function(e,t,n,s,i){Mn.getInstance().oneToOneOutdialRequest=new Ft(e,t,n,s,i);var r=Mn.getInstance().oneToOneOutdialRequest.formatJSON();sn.sendMessage(this,r)},t.prototype.manualOutdialCancel=function(e){Mn.getInstance().oneToOneOutdialCancelRequest=new Gt(e);var t=Mn.getInstance().oneToOneOutdialCancelRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.pauseRecord=function(e,t){Mn.getInstance().pauseRecordRequest=new jt(e);var n=Mn.getInstance().pauseRecordRequest.formatJSON();sn.setCallback(this,Ue.PAUSE_RECORD,t),sn.sendMessage(this,n)},t.prototype.previewDial=function(e,t,n){Mn.getInstance().previewDialRequest=new Kt("",[],e,t,n);var s=Mn.getInstance().previewDialRequest.formatJSON();sn.sendMessage(this,s)},t.prototype.previewFetch=function(e,t){Mn.getInstance().previewDialRequest=new Kt("",e,"");var n=Mn.getInstance().previewDialRequest.formatJSON();sn.setCallback(this,Ue.PREVIEW_FETCH,t),sn.sendMessage(this,n)},t.prototype.searchLeads=function(e,t){Mn.getInstance().previewDialRequest=new Kt("search",e,"");var n=Mn.getInstance().previewDialRequest.formatJSON();sn.setCallback(this,Ue.LEAD_SEARCH,t),sn.sendMessage(this,n)},t.prototype.setCallNotes=function(e,t){Mn.getInstance().callNotesRequest=new gt(e);var n=Mn.getInstance().callNotesRequest.formatJSON();sn.setCallback(this,Ue.CALL_NOTES,t),sn.sendMessage(this,n)},t.prototype.monitor=function(e,t,n,s){Mn.getInstance().bargeInRequest=new ct("MUTE",e,t,n);var i=Mn.getInstance().bargeInRequest.formatJSON();sn.setCallback(this,Ue.SILENT_MONITOR,s),sn.sendMessage(this,i)},t.prototype.record=function(e,t){Mn.getInstance().recordRequest=new Jt(e);var n=Mn.getInstance().recordRequest.formatJSON();sn.setCallback(this,Ue.RECORD,t),sn.sendMessage(this,n)},t.prototype.requeueCall=function(e,t,n,s){Mn.getInstance().requeueRequest=new Wt(e,t,n);var i=Mn.getInstance().requeueRequest.formatJSON();sn.setCallback(this,Ue.REQUEUE,s),sn.sendMessage(this,i)},t.prototype.requestCallSummary=function(e,t,n,s,i){Mn.getInstance().callSummaryRequest=new zt(e,t,n,Mn.getInstance().agentSettings.agentId,Date.now(),s,i);const r=Mn.getInstance().callSummaryRequest.formatJSON();sn.sendMessage(this,r)},t.prototype.safeModeCall=function(e,t){Mn.getInstance().tcpaSafeRequest=new $t("",[],e,t);var n=Mn.getInstance().tcpaSafeRequest.formatJSON();sn.sendMessage(this,n)},t.prototype.safeModeFetch=function(e,t){Mn.getInstance().tcpaSafeRequest=new $t("",e,"");var n=Mn.getInstance().tcpaSafeRequest.formatJSON();sn.setCallback(this,Ue.SAFE_MODE_FETCH,t),sn.sendMessage(this,n)},t.prototype.safeSearchLeads=function(e,t){Mn.getInstance().tcpaSafeRequest=new $t("search",e,"");var n=Mn.getInstance().tcpaSafeRequest.formatJSON();sn.setCallback(this,Ue.SAFE_MODE_SEARCH,t),sn.sendMessage(this,n)},t.prototype.internationalWarmXfer=function(e,t,n,s,i){Mn.getInstance().warmXferRequest=new en(e,t,n,s);var r=Mn.getInstance().warmXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_WARM,i),sn.sendMessage(this,r)},t.prototype.warmXfer=function(e,t,n,s){Mn.getInstance().warmXferRequest=new en(e,t,n);var i=Mn.getInstance().warmXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_WARM,s),sn.sendMessage(this,i)},t.prototype.warmXferCancel=function(e){Mn.getInstance().warmXferCancelRequest=new tn(e);var t=Mn.getInstance().warmXferCancelRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.corporateDirWarmXfer=function(e,t,n,s,i){Mn.getInstance().warmXferRequest=new en(e,t,n,s);var r=Mn.getInstance().warmXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_WARM,i),sn.sendMessage(this,r)},t.prototype.corporateDirColdXfer=function(e,t,n,s,i){Mn.getInstance().coldXferRequest=new ft(e,t,n,s);var r=Mn.getInstance().coldXferRequest.formatJSON();sn.setCallback(this,Ue.XFER_COLD,i),sn.sendMessage(this,r)},t.prototype.getScript=function(e,t,n){var s=Mn.getInstance(),i=s.scriptSettings.loadedScripts[e];if(sn.setCallback(this,Ue.SCRIPT_CONFIG,n),i&&i.version===t)n(Mn.getInstance().scriptSettings.loadedScripts[e]);else{s.scriptConfigRequest=new Vt(e);var r=Mn.getInstance().scriptConfigRequest.formatJSON();sn.sendMessage(this,r)}},t.prototype.saveScriptResult=function(e,t,n){Mn.getInstance().scriptResultRequest=new Yt(e,t,n);var s=Mn.getInstance().scriptResultRequest.formatJSON();sn.sendMessage(this,s)},t.prototype.directAgentXferList=function(e){Mn.getInstance().directAgentTransferListRequest=new Tt;var t=Mn.getInstance().directAgentTransferListRequest.formatJSON();sn.setCallback(this,Ue.DIRECT_AGENT_TRANSFER_LIST,e),sn.sendMessage(this,t)},t.prototype.warmDirectAgentXfer=function(e){Mn.getInstance().directAgentTransferRequest=new St(e,"WARM");var t=Mn.getInstance().directAgentTransferRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.coldDirectAgentXfer=function(e){Mn.getInstance().directAgentTransferRequest=new St(e,"COLD");var t=Mn.getInstance().directAgentTransferRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.cancelDirectAgentXfer=function(e){Mn.getInstance().directAgentTransferRequest=new St(e,"CANCEL");var t=Mn.getInstance().directAgentTransferRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.voicemailDirectAgentXfer=function(e){Mn.getInstance().directAgentTransferRequest=new St(e,"VOICEMAIL");var t=Mn.getInstance().directAgentTransferRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.rejectDirectAgentXfer=function(e){Mn.getInstance().directAgentTransferRequest=new St("0","REJECT",e);var t=Mn.getInstance().directAgentTransferRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.setCallHistory=function(e){var t=Mn.getInstance();t.callHistory=Object.assign(t.callHistory,e)}}(e),function(e){const t=e.AgentLibrary;t.prototype.leadHistory=function(e,t){Mn.getInstance().leadHistoryRequest=new At(e);var n=Mn.getInstance().leadHistoryRequest.formatJSON();sn.setCallback(this,Ue.LEAD_HISTORY,t),sn.sendMessage(this,n)},t.prototype.leadInsert=function(e,t){Mn.getInstance().leadInsertRequest=new bt(e);var n=Mn.getInstance().leadInsertRequest.formatJSON();sn.setCallback(this,Ue.LEAD_INSERT,t),sn.sendMessage(this,n)},t.prototype.leadUpdate=function(e,t,n,s,i,r){Mn.getInstance().leadUpdateRequest=new Nt(e,t,n,s,i);var o=Mn.getInstance().leadUpdateRequest.formatJSON();sn.setCallback(this,Ue.LEAD_UPDATE,r),sn.sendMessage(this,o)}}(e),function(e){var t=e.AgentLibrary;t.prototype.setChatAlias=function(e){Mn.getInstance().chatAliasRequest=new un(e);var t=Mn.getInstance().chatAliasRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.publicChatRoom=function(e,t){Mn.getInstance().chatRoomRequest=new In(e,"PUBLIC",t);var n=Mn.getInstance().chatRoomRequest.formatJSON();sn.sendMessage(this,n)},t.prototype.privateChatRoom=function(e,t,n,s){Mn.getInstance().chatRoomRequest=new In(e,"PRIVATE",t,n,s);var i=Mn.getInstance().chatRoomRequest.formatJSON();sn.sendMessage(this,i)},t.prototype.sendChat=function(e,t,n){Mn.getInstance().chatSendRequest=new vn(e,t);var s=Mn.getInstance().chatSendRequest.formatJSON();sn.setCallback(this,Ue.CHAT,n),sn.sendMessage(this,s)},t.prototype.getSupervisors=function(e){Mn.getInstance().supervisorListRequest=new wn;var t=Mn.getInstance().supervisorListRequest.formatJSON();sn.setCallback(this,Ue.SUPERVISOR_LIST,e),sn.sendMessage(this,t)},t.prototype.chatPresentedResponse=function(e,t,n,s,i){Mn.getInstance().chatPresentedRequest=new mn(e,t,n,s,i);var r=Mn.getInstance().chatPresentedRequest.formatJSON();sn.sendMessage(this,r)},t.prototype.chatMessage=function(e,t,n){Mn.getInstance().chatMessageRequest=new fn(e,t,n,!1);var s=Mn.getInstance().chatMessageRequest.formatJSON();sn.sendMessage(this,s)},t.prototype.chatWhisper=function(e,t,n){Mn.getInstance().chatMessageRequest=new fn(e,t,n,!0);var s=Mn.getInstance().chatMessageRequest.formatJSON();sn.sendMessage(this,s)},t.prototype.chatDisposition=function(e,t,n,s,i,r,o,a,c){Mn.getInstance().chatDispositionRequest=new gn(e,t,n,s,i,r,o,a,c);var u=Mn.getInstance().chatDispositionRequest.formatJSON();sn.sendMessage(this,u)},t.prototype.chatRequeue=function(e,t,n,s,i){Mn.getInstance().chatRequeueRequest=new _n(e,t,n,s,i);var r=Mn.getInstance().chatRequeueRequest.formatJSON();sn.sendMessage(this,r)},t.prototype.requestChatSummary=function(e,t,n,s,i){Mn.getInstance().chatSummaryRequest=new zt(e,t,n,Mn.getInstance().agentSettings.agentId,Date.now(),s,i);const r=Mn.getInstance().chatSummaryRequest.formatJSON();sn.sendMessage(this,r)},t.prototype.chatTyping=function(e,t){Mn.getInstance().chatTypingRequest=new En(e,t);var n=Mn.getInstance().chatTypingRequest.formatJSON();sn.sendMessage(this,n)},t.prototype.monitorAgentChats=function(e){Mn.getInstance().monitorChatRequest=new Nn(e);var t=Mn.getInstance().monitorChatRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.stopMonitoringChatsByAgent=function(e){Mn.getInstance().stopMonitorChatRequest=new Dn(e);var t=Mn.getInstance().stopMonitorChatRequest.formatJSON();sn.sendMessage(this,t)},t.prototype.stopMonitoringAllAgentChats=function(){Mn.getInstance().stopMonitorChatRequest=new Dn;var e=Mn.getInstance().stopMonitorChatRequest.formatJSON();sn.sendMessage(this,e)},t.prototype.leaveChat=function(e,t,n){Mn.getInstance().leaveChatRequest=new Rn(e,t,n);var s=Mn.getInstance().leaveChatRequest.formatJSON();sn.sendMessage(this,s)},t.prototype.chatList=function(e,t,n){Mn.getInstance().chatListRequest=new hn(e,t);var s=Mn.getInstance().chatListRequest.formatJSON();sn.setCallback(this,Ue.CHAT_LIST,n),sn.sendMessage(this,s)},t.prototype.chatAgentEnd=function(e,t){Mn.getInstance().chatAgentEnd=new cn(e,t);var n=Mn.getInstance().chatAgentEnd.formatJSON();sn.sendMessage(this,n)},t.prototype.setChatState=function(e,t){Mn.getInstance().chatStateRequest=new ht(e);var n=Mn.getInstance().chatStateRequest.formatJSON();sn.setCallback(this,Ue.CHAT_STATE,t),sn.sendMessage(this,n)},t.prototype.sendManualOutboundSms=function(e,t,n,s,i){Mn.getInstance().chatManualSms=new bn(e,t,n,s,i);var r=Mn.getInstance().chatManualSms.formatJSON();sn.sendMessage(this,r)}}(e),function(e){var t=e.AgentLibrary;t.prototype.openLogger=function(){var t=this;if("indexedDB"in e){var n=indexedDB.open("AgentLibraryLogging",6);n.onerror=function(e){console.error("AgentLibrary: AgentLibraryLogging Database error - "+e.target.errorCode)},n.onsuccess=function(e){t._db=e.target.result,t.purgeLog(t._db,"logger"),console.log("AgentLibrary: AgentLibraryLogging Successful logging of record")},n.onupgradeneeded=function(e){if(console.log("AgentLibrary: Upgrading AgentLibraryLogging"),t._db=e.target.result,!t._db.objectStoreNames.contains("logger")){var n=t._db.createObjectStore("logger",{autoIncrement:!0});n.createIndex("logLevel","logLevel",{unique:!1}),n.createIndex("dts","dts",{unique:!1}),n.createIndex("levelAndDate",["logLevel","dts"],{unique:!1})}}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},t.prototype.purgeLog=function(e,t){if(e)try{var n=e.transaction([t],"readwrite").objectStore(t),s=n.index("dts"),i=new Date;i.setDate(i.getDate()-2);var r=IDBKeyRange.upperBound(i);s.openCursor(r).onsuccess=function(e){var t=e.target.result;t&&(n.delete(t.primaryKey),t.continue())}}catch(e){}},t.prototype.clearLog=function(e){e.transaction(["logger"],"readwrite").objectStore("logger").clear().onsuccess=function(e){console.log("AgentLibrary: logger database cleared")}},t.prototype.deleteDB=function(e){e=e||"AgentLibraryLogging";var t=indexedDB.deleteDatabase(e);t.onerror=function(t){console.log("Error deleting database.",e)},t.onsuccess=function(t){console.log("Database",e,"deleted successfully")}},t.prototype.getLogRecords=function(e,t,n,s,i){e=e||"";var r=this,o=r._db.transaction(["logger"],"readonly").objectStore("logger"),a=null,c=null,u=s||100;if(sn.setCallback(r,Ue.LOG_RESULTS,i),""!==e&&"ALL"!==e.toUpperCase()&&"NO-STATS"!==e.toUpperCase()){if(t&&n){var l=[e.toLowerCase(),t],d=[e.toLowerCase(),n];c=IDBKeyRange.bound(l,d)}else t?c=IDBKeyRange.lowerBound([e.toLowerCase(),t]):n&&(c=IDBKeyRange.upperBound([e.toLowerCase(),n]));if(null!==c){var g=[],p=0;o.index("levelAndDate").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&p<u?(g.push(a.value),p+=1,a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,g)}}else{var h=[],f=0;o.index("logLevel").openCursor(e,"prev").onsuccess=function(e){(a=e.target.result)&&f<u?(h.push(a.value),f+=1,a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,h)}}}else if("NO-STATS"===e.toUpperCase())if(t&&n?c=IDBKeyRange.bound(t,n):t?c=IDBKeyRange.lowerBound(t):n&&(c=IDBKeyRange.upperBound(n)),null!==c){var S=[],T=0;o.index("dts").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&T<u?("stats"!==a.value.logLevel&&(S.push(a.value),T+=1),a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,S)}}else{var m=[],_=0;o.openCursor().onsuccess=function(e){(a=e.target.result)&&_<u?("stats"!==a.value.logLevel&&(m.push(a.value),_+=1),a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,m)}}else if(t&&n?c=IDBKeyRange.bound(t,n):t?c=IDBKeyRange.lowerBound(t):n&&(c=IDBKeyRange.upperBound(n)),null!==c){var I=[],C=0;o.index("dts").openCursor(c,"prev").onsuccess=function(e){(a=e.target.result)&&C<u?(I.push(a.value),C+=1,a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,I)}}else{var v=[],y=0;o.openCursor().onsuccess=function(e){(a=e.target.result)&&y<u?(v.push(a.value),y+=1,a.continue()):sn.fireCallback(r,Ue.LOG_RESULTS,v)}}return null}}(e),function(e){var t=e.AgentLibrary;t.prototype.openConsoleLogger=function(){var n=this;if("indexedDB"in e){var s=indexedDB.open("AgentLibraryConsoleLogging",1);s.onerror=function(e){console.error("AgentLibrary: AgentLibraryConsoleLogging Database error - "+e.target.errorCode)},s.onsuccess=function(e){n._consoleDb=e.target.result,n.purgeLog(n._consoleDb,"consoleLogger"),console.log("AgentLibrary: AgentLibraryConsoleLogging Successful logging of record"),function(e){var n;n=Mn&&Mn.getInstance()&&Mn.getInstance().libraryInstance?Mn.getInstance().libraryInstance:new t;var s=Mn.getInstance().agentSettings;function i(t,i){if(n._consoleDb)try{n._consoleDb.transaction(["consoleLogger"],"readwrite").objectStore("consoleLogger").add(function(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i];if("function"==typeof r)n.push(r.toString());else if("object"==typeof r)try{n.push(ne.sanitizeToString(r))}catch(e){}else n.push(r)}return{type:e,message:n.join(" "),dts:new Date,agentId:s.agentId,agentName:ee.maskString(s.firstName+" "+s.lastName)}}(t,i))}catch(t){e.error.apply(this,"AgentLibrary: AgentLibraryConsoleLogging Error adding console log message: "+t)}}window.console.log=function(){e.log.apply(this,arguments),i("LOG",arguments)},window.console.info=function(){e.info.apply(this,arguments),i("INFO",arguments)},window.console.warn=function(){e.warn.apply(this,arguments),i("WARN",arguments)},window.console.error=function(){e.error.apply(this,arguments),i("ERROR",arguments)}}(Object.assign({},window.console))},s.onupgradeneeded=function(e){if(console.log("AgentLibrary: Upgrading AgentLibraryConsoleLogging"),n._consoleDb=e.target.result,!n._consoleDb.objectStoreNames.contains("consoleLogger")){var t=n._consoleDb.createObjectStore("consoleLogger",{autoIncrement:!0});t.createIndex("type","type",{unique:!1}),t.createIndex("dts","dts",{unique:!1}),t.createIndex("agentId","agentId",{unique:!1}),t.createIndex("typeAndAgent",["type","agentId"],{unique:!1})}}}else console.warn("AgentLibrary: indexedDB NOT supported by your Browser.")},t.prototype.getConsoleLogRecords=function(e,t){var n=Mn.getInstance().agentSettings.agentId,s=this,i=s._consoleDb.transaction(["consoleLogger"],"readonly").objectStore("consoleLogger"),r=null,o=null,a=null;sn.setCallback(s,Ue.LOG_CONSOLE_RESULTS,t);var c=[];e?(r=i.index("typeAndAgent"),a=IDBKeyRange.only([e.toUpperCase(),n])):(r=i.index("agentId"),a=IDBKeyRange.only(n));var u=0;r.openCursor(a,"prev").onsuccess=function(e){(o=e.target.result)&&u<5e3?(c.push(o.value),u++,o.continue()):sn.fireCallback(s,Ue.LOG_CONSOLE_RESULTS,c)}}}(e),function(e){const t=e.AgentLibrary;var n=Mn.getInstance().authenticateRequest,s=new ye({authToken:n&&n.engageAccessToken,agentId:Mn.getInstance().agentSettings.agentId,componentName:t.componentName});t.prototype._SoftphoneService=s,t.prototype.sipInit=s.sipInit.bind(s),t.prototype.sipTerminate=s.sipTerminate.bind(s),t.prototype.sipAnswer=s.sipAnswer.bind(s),t.prototype.sipReject=s.sipReject.bind(s),t.prototype.sipRegister=s.sipRegister.bind(s),t.prototype.sipHangUp=s.sipHangUp.bind(s),t.prototype.sipSendDTMF=s.sipSendDTMF.bind(s),t.prototype.sipToggleMute=s.sipToggleMute.bind(s),t.prototype.switchSoftphoneRegistrar=s.switchSoftphoneRegistrar.bind(s),t.prototype.resetSoftphoneSession=s.resetSoftphoneSession.bind(s),t.prototype.sipInitAndRegister=s.sipInitAndRegister.bind(s)}(e),function(e){e.AgentLibrary.prototype.loadCurrentCall=function(e){ke.requestCurrentCall(e)}}(e),e.AgentLibrary}(n.g);const jn=Gn})(),s.default})()));